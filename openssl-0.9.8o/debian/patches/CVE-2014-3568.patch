Index: openssl-0.9.8o/ssl/s23_clnt.c
===================================================================
--- openssl-0.9.8o.orig/ssl/s23_clnt.c	2010-03-30 17:31:58.000000000 +0000
+++ openssl-0.9.8o/ssl/s23_clnt.c	2014-11-01 14:39:53.597734280 +0000
@@ -72,9 +72,11 @@
 	if (ver == SSL2_VERSION)
 		return(SSLv2_client_method());
 #endif
+#ifndef OPENSSL_NO_SSL3
 	if (ver == SSL3_VERSION)
 		return(SSLv3_client_method());
-	else if (ver == TLS1_VERSION)
+#endif
+	if (ver == TLS1_VERSION)
 		return(TLSv1_client_method());
 	else
 		return(NULL);
@@ -547,6 +549,7 @@
 		s->s3->rbuf.left=n;
 		s->s3->rbuf.offset=0;
 
+#ifndef OPENSSL_NO_SSL3
 		if ((p[2] == SSL3_VERSION_MINOR) &&
 			!(s->options & SSL_OP_NO_SSLv3))
 			{
@@ -561,7 +564,9 @@
 			s->version=SSL3_VERSION;
 			s->method=SSLv3_client_method();
 			}
-		else if ((p[2] == TLS1_VERSION_MINOR) &&
+		else
+#endif
+		if ((p[2] == TLS1_VERSION_MINOR) &&
 			!(s->options & SSL_OP_NO_TLSv1))
 			{
 			s->version=TLS1_VERSION;
Index: openssl-0.9.8o/ssl/s23_srvr.c
===================================================================
--- openssl-0.9.8o.orig/ssl/s23_srvr.c	2014-11-01 14:28:39.631854035 +0000
+++ openssl-0.9.8o/ssl/s23_srvr.c	2014-11-01 14:39:53.665732878 +0000
@@ -124,9 +124,11 @@
 	if (ver == SSL2_VERSION)
 		return(SSLv2_server_method());
 #endif
+#ifndef OPENSSL_NO_SSL3
 	if (ver == SSL3_VERSION)
 		return(SSLv3_server_method());
-	else if (ver == TLS1_VERSION)
+#endif
+	if (ver == TLS1_VERSION)
 		return(TLSv1_server_method());
 	else
 		return(NULL);
@@ -557,6 +559,12 @@
 	if ((type == 2) || (type == 3))
 		{
 		/* we have SSLv3/TLSv1 (type 2: SSL2 style, type 3: SSL3/TLS style) */
+                s->method = ssl23_get_server_method(s->version);
+		if (s->method == NULL)
+			{
+			SSLerr(SSL_F_SSL23_GET_CLIENT_HELLO,SSL_R_UNSUPPORTED_PROTOCOL);
+			goto err;
+			}
 
 		if (!ssl_init_wbio_buffer(s,1)) goto err;
 
@@ -580,11 +588,6 @@
 			s->s3->rbuf.left=0;
 			s->s3->rbuf.offset=0;
 			}
-
-		if (s->version == TLS1_VERSION)
-			s->method = TLSv1_server_method();
-		else
-			s->method = SSLv3_server_method();
 #if 0 /* ssl3_get_client_hello does this */
 		s->client_version=(v[0]<<8)|v[1];
 #endif
Index: openssl-0.9.8o/util/mk1mf.pl
===================================================================
--- openssl-0.9.8o.orig/util/mk1mf.pl	2014-11-01 14:26:39.000000000 +0000
+++ openssl-0.9.8o/util/mk1mf.pl	2014-11-01 14:39:53.665732878 +0000
@@ -786,12 +786,6 @@
 	$lib_obj=$lib_obj{$_};
 	local($slib)=$shlib;
 
-	if (($_ eq "SSL") && $no_ssl2 && $no_ssl3)
-		{
-		$rules.="\$(O_SSL):\n\n"; 
-		next;
-		}
-
 	if ((!$fips && ($_ eq "CRYPTO")) || ($fips && ($_ eq "FIPS")))
 		{
 		if ($cpuid_asm_obj ne "")
