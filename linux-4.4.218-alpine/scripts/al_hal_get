#!/bin/bash

#Usage: ./set_env.sh [HAL_TOP - default from env or ./HAL/] [HAL commit id default hard-coded]

HAL_COMMIT_ID=4f134c1
SERVER_URL=http://gerrit.il.annapurnalabs.com:8080

#set working directory if given
if [ $# -gt 0 ]; then
	HAL_TOP=$1
fi

#set HAL commit id if given
if [ $# -gt 1 ]; then
	HAL_COMMIT_ID=$2
fi

if [[ -z "$HAL_TOP" ]]; then
	HAL_TOP=./HAL/
fi

echo ====================================================================
echo HAL Directory: $HAL_TOP
echo HAL commit id: $HAL_COMMIT_ID
echo ====================================================================

echo ===================== Update HAL ===================================
if [ ! -d "$HAL_TOP" ]; then
  git clone "$SERVER_URL/HAL" "$HAL_TOP"
fi

pushd "$HAL_TOP"
git fetch
git checkout $HAL_COMMIT_ID
echo Updated HAL to commit: $HAL_COMMIT_ID
popd

#in case someone is sourcing this
export HAL_TOP

