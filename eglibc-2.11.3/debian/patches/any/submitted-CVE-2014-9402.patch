From 11e3417af6e354f1942c68a271ae51e892b2814d Mon Sep 17 00:00:00 2001
From: Florian Weimer <fweimer@redhat.com>
Date: Mon, 15 Dec 2014 17:41:13 +0100
Subject: [PATCH] Avoid infinite loop in nss_dns getnetbyname [BZ #17630]

---
 ChangeLog                    |    6 ++++++
 NEWS                         |    7 +++++--
 resolv/nss_dns/dns-network.c |    4 ++--
 3 files changed, 13 insertions(+), 4 deletions(-)

Index: eglibc-2.11.3/ChangeLog
===================================================================
--- eglibc-2.11.3.orig/ChangeLog	2014-12-22 15:12:15.000000000 +0100
+++ eglibc-2.11.3/ChangeLog	2014-12-22 15:13:21.000000000 +0100
@@ -1,3 +1,9 @@
+2014-12-16  Florian Weimer  <fweimer@redhat.com>
+
+       [BZ #17630]
+       * resolv/nss_dns/dns-network.c (getanswer_r): Iterate over alias
+       names.
+
 2014-11-19  Carlos O'Donell  <carlos@redhat.com>
            Florian Weimer  <fweimer@redhat.com>
            Joseph Myers  <joseph@codesourcery.com>
Index: eglibc-2.11.3/NEWS
===================================================================
--- eglibc-2.11.3.orig/NEWS	2014-12-22 15:12:15.000000000 +0100
+++ eglibc-2.11.3/NEWS	2014-12-22 15:14:40.000000000 +0100
@@ -9,7 +9,11 @@
 
 * The following bugs are resolved with this release:
 
-  14134, 17325, 17625
+  14134, 17325, 17625, 17630
+
+* The nss_dns implementation of getnetbyname could run into an infinite loop
+  if the DNS response contained a PTR record of an unexpected format.
+  (CVE-2014-9402)
 
 * Decoding a crafted input sequence in the character sets IBM933, IBM935,
   IBM937, IBM939, IBM1364 could result in an out-of-bounds array read,
Index: eglibc-2.11.3/resolv/nss_dns/dns-network.c
===================================================================
--- eglibc-2.11.3.orig/resolv/nss_dns/dns-network.c	2014-12-22 15:12:15.000000000 +0100
+++ eglibc-2.11.3/resolv/nss_dns/dns-network.c	2014-12-22 15:12:15.000000000 +0100
@@ -402,8 +402,8 @@
 
 	case BYNAME:
 	  {
-	    char **ap = result->n_aliases++;
-	    while (*ap != NULL)
+	    char **ap;
+	    for (ap = result->n_aliases; *ap != NULL; ++ap)
 	      {
 		/* Check each alias name for being of the forms:
 		   4.3.2.1.in-addr.arpa		= net 1.2.3.4
