#!/usr/bin/make -f
# Made with the aid of debmake, by Christoph Lameter,
# based on the sample debian/rules file for GNU hello by Ian Jackson.

package=raidtools2
installbin = install -o root -g root -m 755
installdoc = install -o root -g root -m 644
raidstartlinks = raidstop raidhotadd raidhotremove raidhotgenerateerror raidsetfaulty
mkraidlinks = raid0run

build:
	$(checkdir)
	./configure --prefix=/usr --sysconf=/etc
	$(MAKE) 
	touch build

clean:
	$(checkdir)
	-rm -f build
	-$(MAKE) clean
	-rm -f `find . -name "*~"`
	-rm -rf debian/tmp debian/files debian/substvars debian/*debhelper

binary-indep: checkroot build
	$(checkdir)
# There are no architecture-independent files to be uploaded
# generated by this package.  If there were any they would be
# made here.

binary-arch: checkroot build
	$(checkdir)
	-rm -rf debian/tmp
	$(installbin) -d debian/tmp
	cd debian/tmp && $(installbin) -d `cat ../dirs`
	$(installbin) raidstart mkraid mkpv debian/tmp/sbin
	for i in $(raidstartlinks); do \
	  ln -sf raidstart debian/tmp/sbin/$$i ;\
	done
	for i in $(mkraidlinks); do \
	  ln -sf mkraid debian/tmp/sbin/$$i ;\
	done
	$(installbin) debian/raid2 debian/tmp/etc/init.d	
	$(installdoc) debian/raidtools2.mod debian/tmp/etc/modutils/raidtools2
	$(installdoc) debian/logcheck.normal debian/tmp/etc/logcheck/ignore.d.server/raidtools2
	ln -s ../ignore.d.server/raidtools2 debian/tmp/etc/logcheck/ignore.d.workstation/raidtools2
	$(installdoc) debian/logcheck.paranoid debian/tmp/etc/logcheck/ignore.d.paranoid/raidtools2

#	dh_installdirs
	dh_installdebconf
	dh_installdocs Software-RAID.HOWTO README
	dh_installexamples raid0.conf.sample raid1.conf.sample \
raid4.conf.sample raid5.conf.sample raidtab.sample multipath.conf.sample
	dh_installchangelogs
#	dh_installmenu
#	dh_installcron
	dh_installmanpages ckraid.8
	dh_installcron
	ln -sf mdrun.8.gz debian/tmp/usr/share/man/man8/ckraid.8.gz
	ln -sf raidhotadd.8.gz debian/tmp/usr/share/man/man8/raidhotremove.8.gz
	ln -sf raidhotgenerateerror.8.gz debian/tmp/usr/share/man/man8/raidsetfaulty.8.gz
#	dh_undocumented raidhotadd.8 raidhotremove.8
#	dh_movefiles
	dh_strip
	dh_compress
	dh_fixperms
	dh_shlibdeps
	dh_gencontrol
	dh_makeshlibs
	dh_installdeb
	dh_md5sums
	dpkg-gencontrol
	chown -R root.root debian/tmp
	cd debian/tmp && chmod 755 `cat ../dirs`
	dh_builddeb

define checkdir
	test -f debian/rules
endef

binary: binary-indep binary-arch

checkroot:
	$(checkdir)
	test root = "`whoami`"

.PHONY: binary binary-arch binary-indep clean checkroot
