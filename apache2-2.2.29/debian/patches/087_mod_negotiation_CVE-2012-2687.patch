commit 706691e6fd5445f6d60456f55c5647e788e7b3ad
Author: Joe Orton <jorton@apache.org>
Date:   Wed Jun 13 15:33:48 2012 +0000

    SECURITY: CVE-2012-2687 (cve.mitre.org):
    
    mod_negotiation: Escape filenames in variant list to prevent an
    possible XSS for a site where untrusted users can upload files to a
    location with MultiViews enabled.
    
    * modules/mappers/mod_negotiation.c (make_variant_list): Escape
      filenames in variant list.
    
    Submitted by: Niels Heinen <heinenn google.com>
    
    
    git-svn-id: https://svn.apache.org/repos/asf/httpd/httpd/trunk@1349905 13f79535-47bb-0310-9956-ffa450edef68
Index: apache2/modules/mappers/mod_negotiation.c
===================================================================
--- apache2.orig/modules/mappers/mod_negotiation.c	2012-06-22 23:17:12.000000000 +0200
+++ apache2/modules/mappers/mod_negotiation.c	2012-06-22 23:22:12.775905499 +0200
@@ -2658,9 +2658,9 @@
          * need to change the calculation of max_vlist_array above.
          */
         *((const char **) apr_array_push(arr)) = "<li><a href=\"";
-        *((const char **) apr_array_push(arr)) = filename;
+        *((const char **) apr_array_push(arr)) = ap_escape_path_segment(r->pool, filename);
         *((const char **) apr_array_push(arr)) = "\">";
-        *((const char **) apr_array_push(arr)) = filename;
+        *((const char **) apr_array_push(arr)) = ap_escape_html(r->pool, filename);
         *((const char **) apr_array_push(arr)) = "</a> ";
         *((const char **) apr_array_push(arr)) = description;
 
