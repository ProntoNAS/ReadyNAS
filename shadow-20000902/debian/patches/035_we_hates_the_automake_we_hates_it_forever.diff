diff -urN shadow-20000902/Makefile.in shadow-20000902.new/Makefile.in
--- shadow-20000902/Makefile.in	Fri Mar 22 11:55:35 2002
+++ shadow-20000902.new/Makefile.in	Fri Mar 22 11:52:51 2002
@@ -1,4 +1,4 @@
-# Makefile.in generated automatically by automake 1.4 from Makefile.am
+# Makefile.in generated automatically by automake 1.4-p4 from Makefile.am
 
 # Copyright (C) 1994, 1995-8, 1999 Free Software Foundation, Inc.
 # This Makefile.in is free software; the Free Software Foundation
@@ -122,16 +122,16 @@
 all: all-redirect
 .SUFFIXES:
 #$(srcdir)/Makefile.in: Makefile.am $(top_srcdir)/configure.in $(ACLOCAL_M4) 
-#	cd $(top_srcdir) && $(AUTOMAKE) --foreign --include-deps Makefile
+#	cd $(top_srcdir) && $(AUTOMAKE) --foreign Makefile
 #
-#Makefile: $(srcdir)/Makefile.in  $(top_builddir)/config.status
+#Makefile: $(srcdir)/Makefile.in  $(top_builddir)/config.status $(BUILT_SOURCES)
 #	cd $(top_builddir) \
 #	  && CONFIG_FILES=$@ CONFIG_HEADERS= $(SHELL) ./config.status
 #
 #$(ACLOCAL_M4):  configure.in 
 #	cd $(srcdir) && $(ACLOCAL)
 #
-#config.status: $(srcdir)/configure $(CONFIG_STATUS_DEPENDENCIES)
+#config.status: $(srcdir)/configure.in $(CONFIG_STATUS_DEPENDENCIES)
 #	$(SHELL) ./config.status --recheck
 #$(srcdir)/configure: $(srcdir)/configure.in $(ACLOCAL_M4) $(CONFIGURE_DEPENDENCIES)
 #	cd $(srcdir) && $(AUTOCONF)
@@ -291,10 +291,15 @@
 	-rm -rf $(distdir)
 	mkdir $(distdir)
 	-chmod 777 $(distdir)
+	here=`cd $(top_builddir) && pwd`; \
+	top_distdir=`cd $(distdir) && pwd`; \
+	distdir=`cd $(distdir) && pwd`; \
+	cd $(top_srcdir) \
+	  && $(AUTOMAKE) --include-deps --build-dir=$$here --srcdir-name=$(top_srcdir) --output-dir=$$top_distdir --foreign Makefile
 	@for file in $(DISTFILES); do \
 	  d=$(srcdir); \
 	  if test -d $$d/$$file; then \
-	    cp -pr $$/$$file $(distdir)/$$file; \
+	    cp -pr $$d/$$file $(distdir)/$$file; \
 	  else \
 	    test -f $(distdir)/$$file \
 	    || ln $$d/$$file $(distdir)/$$file 2> /dev/null \
diff -urN shadow-20000902/contrib/Makefile.in shadow-20000902.new/contrib/Makefile.in
--- shadow-20000902/contrib/Makefile.in	Sat Sep  2 15:26:05 2000
+++ shadow-20000902.new/contrib/Makefile.in	Fri Mar 22 11:51:25 2002
@@ -1,4 +1,4 @@
-# Makefile.in generated automatically by automake 1.4 from Makefile.am
+# Makefile.in generated automatically by automake 1.4-p4 from Makefile.am
 
 # Copyright (C) 1994, 1995-8, 1999 Free Software Foundation, Inc.
 # This Makefile.in is free software; the Free Software Foundation
@@ -119,12 +119,12 @@
 GZIP_ENV = --best
 all: all-redirect
 .SUFFIXES:
-$(srcdir)/Makefile.in: Makefile.am $(top_srcdir)/configure.in $(ACLOCAL_M4) 
-	cd $(top_srcdir) && $(AUTOMAKE) --gnu --include-deps contrib/Makefile
-
-Makefile: $(srcdir)/Makefile.in  $(top_builddir)/config.status
-	cd $(top_builddir) \
-	  && CONFIG_FILES=$(subdir)/$@ CONFIG_HEADERS= $(SHELL) ./config.status
+#$(srcdir)/Makefile.in: Makefile.am $(top_srcdir)/configure.in $(ACLOCAL_M4) 
+#	cd $(top_srcdir) && $(AUTOMAKE) --gnu contrib/Makefile
+#
+#Makefile: $(srcdir)/Makefile.in  $(top_builddir)/config.status $(BUILT_SOURCES)
+#	cd $(top_builddir) \
+#	  && CONFIG_FILES=$(subdir)/$@ CONFIG_HEADERS= $(SHELL) ./config.status
 
 tags: TAGS
 TAGS:
@@ -135,10 +135,15 @@
 subdir = contrib
 
 distdir: $(DISTFILES)
+	here=`cd $(top_builddir) && pwd`; \
+	top_distdir=`cd $(top_distdir) && pwd`; \
+	distdir=`cd $(distdir) && pwd`; \
+	cd $(top_srcdir) \
+	  && $(AUTOMAKE) --include-deps --build-dir=$$here --srcdir-name=$(top_srcdir) --output-dir=$$top_distdir --gnu contrib/Makefile
 	@for file in $(DISTFILES); do \
 	  d=$(srcdir); \
 	  if test -d $$d/$$file; then \
-	    cp -pr $$/$$file $(distdir)/$$file; \
+	    cp -pr $$d/$$file $(distdir)/$$file; \
 	  else \
 	    test -f $(distdir)/$$file \
 	    || ln $$d/$$file $(distdir)/$$file 2> /dev/null \
diff -urN shadow-20000902/debian/Makefile.in shadow-20000902.new/debian/Makefile.in
--- shadow-20000902/debian/Makefile.in	Sat Sep  2 15:26:05 2000
+++ shadow-20000902.new/debian/Makefile.in	Fri Mar 22 11:51:29 2002
@@ -1,4 +1,4 @@
-# Makefile.in generated automatically by automake 1.4 from Makefile.am
+# Makefile.in generated automatically by automake 1.4-p4 from Makefile.am
 
 # Copyright (C) 1994, 1995-8, 1999 Free Software Foundation, Inc.
 # This Makefile.in is free software; the Free Software Foundation
@@ -119,12 +119,12 @@
 GZIP_ENV = --best
 all: all-redirect
 .SUFFIXES:
-$(srcdir)/Makefile.in: Makefile.am $(top_srcdir)/configure.in $(ACLOCAL_M4) 
-	cd $(top_srcdir) && $(AUTOMAKE) --gnu --include-deps debian/Makefile
-
-Makefile: $(srcdir)/Makefile.in  $(top_builddir)/config.status
-	cd $(top_builddir) \
-	  && CONFIG_FILES=$(subdir)/$@ CONFIG_HEADERS= $(SHELL) ./config.status
+#$(srcdir)/Makefile.in: Makefile.am $(top_srcdir)/configure.in $(ACLOCAL_M4) 
+#	cd $(top_srcdir) && $(AUTOMAKE) --gnu debian/Makefile
+#
+#Makefile: $(srcdir)/Makefile.in  $(top_builddir)/config.status $(BUILT_SOURCES)
+#	cd $(top_builddir) \
+#	  && CONFIG_FILES=$(subdir)/$@ CONFIG_HEADERS= $(SHELL) ./config.status
 
 tags: TAGS
 TAGS:
@@ -135,10 +135,15 @@
 subdir = debian
 
 distdir: $(DISTFILES)
+	here=`cd $(top_builddir) && pwd`; \
+	top_distdir=`cd $(top_distdir) && pwd`; \
+	distdir=`cd $(distdir) && pwd`; \
+	cd $(top_srcdir) \
+	  && $(AUTOMAKE) --include-deps --build-dir=$$here --srcdir-name=$(top_srcdir) --output-dir=$$top_distdir --gnu debian/Makefile
 	@for file in $(DISTFILES); do \
 	  d=$(srcdir); \
 	  if test -d $$d/$$file; then \
-	    cp -pr $$/$$file $(distdir)/$$file; \
+	    cp -pr $$d/$$file $(distdir)/$$file; \
 	  else \
 	    test -f $(distdir)/$$file \
 	    || ln $$d/$$file $(distdir)/$$file 2> /dev/null \
diff -urN shadow-20000902/doc/Makefile.in shadow-20000902.new/doc/Makefile.in
--- shadow-20000902/doc/Makefile.in	Sat Sep  2 15:26:06 2000
+++ shadow-20000902.new/doc/Makefile.in	Fri Mar 22 11:54:10 2002
@@ -1,4 +1,4 @@
-# Makefile.in generated automatically by automake 1.4 from Makefile.am
+# Makefile.in generated automatically by automake 1.4-p4 from Makefile.am
 
 # Copyright (C) 1994, 1995-8, 1999 Free Software Foundation, Inc.
 # This Makefile.in is free software; the Free Software Foundation
@@ -119,12 +119,12 @@
 GZIP_ENV = --best
 all: all-redirect
 .SUFFIXES:
-$(srcdir)/Makefile.in: Makefile.am $(top_srcdir)/configure.in $(ACLOCAL_M4) 
-	cd $(top_srcdir) && $(AUTOMAKE) --gnu --include-deps doc/Makefile
-
-Makefile: $(srcdir)/Makefile.in  $(top_builddir)/config.status
-	cd $(top_builddir) \
-	  && CONFIG_FILES=$(subdir)/$@ CONFIG_HEADERS= $(SHELL) ./config.status
+#$(srcdir)/Makefile.in: Makefile.am $(top_srcdir)/configure.in $(ACLOCAL_M4) 
+#	cd $(top_srcdir) && $(AUTOMAKE) --gnu doc/Makefile
+#
+#Makefile: $(srcdir)/Makefile.in  $(top_builddir)/config.status $(BUILT_SOURCES)
+#	cd $(top_builddir) \
+#	  && CONFIG_FILES=$(subdir)/$@ CONFIG_HEADERS= $(SHELL) ./config.status
 
 tags: TAGS
 TAGS:
@@ -135,10 +135,15 @@
 subdir = doc
 
 distdir: $(DISTFILES)
+	here=`cd $(top_builddir) && pwd`; \
+	top_distdir=`cd $(top_distdir) && pwd`; \
+	distdir=`cd $(distdir) && pwd`; \
+	cd $(top_srcdir) \
+	  && $(AUTOMAKE) --include-deps --build-dir=$$here --srcdir-name=$(top_srcdir) --output-dir=$$top_distdir --gnu doc/Makefile
 	@for file in $(DISTFILES); do \
 	  d=$(srcdir); \
 	  if test -d $$d/$$file; then \
-	    cp -pr $$/$$file $(distdir)/$$file; \
+	    cp -pr $$d/$$file $(distdir)/$$file; \
 	  else \
 	    test -f $(distdir)/$$file \
 	    || ln $$d/$$file $(distdir)/$$file 2> /dev/null \
diff -urN shadow-20000902/etc/Makefile.in shadow-20000902.new/etc/Makefile.in
--- shadow-20000902/etc/Makefile.in	Sat Sep  2 15:26:07 2000
+++ shadow-20000902.new/etc/Makefile.in	Fri Mar 22 11:54:19 2002
@@ -1,4 +1,4 @@
-# Makefile.in generated automatically by automake 1.4 from Makefile.am
+# Makefile.in generated automatically by automake 1.4-p4 from Makefile.am
 
 # Copyright (C) 1994, 1995-8, 1999 Free Software Foundation, Inc.
 # This Makefile.in is free software; the Free Software Foundation
@@ -121,12 +121,12 @@
 GZIP_ENV = --best
 all: all-redirect
 .SUFFIXES:
-$(srcdir)/Makefile.in: Makefile.am $(top_srcdir)/configure.in $(ACLOCAL_M4) 
-	cd $(top_srcdir) && $(AUTOMAKE) --gnu --include-deps etc/Makefile
-
-Makefile: $(srcdir)/Makefile.in  $(top_builddir)/config.status
-	cd $(top_builddir) \
-	  && CONFIG_FILES=$(subdir)/$@ CONFIG_HEADERS= $(SHELL) ./config.status
+#$(srcdir)/Makefile.in: Makefile.am $(top_srcdir)/configure.in $(ACLOCAL_M4) 
+#	cd $(top_srcdir) && $(AUTOMAKE) --gnu etc/Makefile
+#
+#Makefile: $(srcdir)/Makefile.in  $(top_builddir)/config.status $(BUILT_SOURCES)
+#	cd $(top_builddir) \
+#	  && CONFIG_FILES=$(subdir)/$@ CONFIG_HEADERS= $(SHELL) ./config.status
 
 
 # This directory's subdirectories are mostly independent; you can cd
@@ -223,10 +223,15 @@
 subdir = etc
 
 distdir: $(DISTFILES)
+	here=`cd $(top_builddir) && pwd`; \
+	top_distdir=`cd $(top_distdir) && pwd`; \
+	distdir=`cd $(distdir) && pwd`; \
+	cd $(top_srcdir) \
+	  && $(AUTOMAKE) --include-deps --build-dir=$$here --srcdir-name=$(top_srcdir) --output-dir=$$top_distdir --gnu etc/Makefile
 	@for file in $(DISTFILES); do \
 	  d=$(srcdir); \
 	  if test -d $$d/$$file; then \
-	    cp -pr $$/$$file $(distdir)/$$file; \
+	    cp -pr $$d/$$file $(distdir)/$$file; \
 	  else \
 	    test -f $(distdir)/$$file \
 	    || ln $$d/$$file $(distdir)/$$file 2> /dev/null \
diff -urN shadow-20000902/etc/pam.d/Makefile.in shadow-20000902.new/etc/pam.d/Makefile.in
--- shadow-20000902/etc/pam.d/Makefile.in	Sat Sep  2 15:26:08 2000
+++ shadow-20000902.new/etc/pam.d/Makefile.in	Fri Mar 22 11:54:26 2002
@@ -1,4 +1,4 @@
-# Makefile.in generated automatically by automake 1.4 from Makefile.am
+# Makefile.in generated automatically by automake 1.4-p4 from Makefile.am
 
 # Copyright (C) 1994, 1995-8, 1999 Free Software Foundation, Inc.
 # This Makefile.in is free software; the Free Software Foundation
@@ -118,12 +118,12 @@
 GZIP_ENV = --best
 all: all-redirect
 .SUFFIXES:
-$(srcdir)/Makefile.in: Makefile.am $(top_srcdir)/configure.in $(ACLOCAL_M4) 
-	cd $(top_srcdir) && $(AUTOMAKE) --gnu --include-deps etc/pam.d/Makefile
-
-Makefile: $(srcdir)/Makefile.in  $(top_builddir)/config.status
-	cd $(top_builddir) \
-	  && CONFIG_FILES=$(subdir)/$@ CONFIG_HEADERS= $(SHELL) ./config.status
+#$(srcdir)/Makefile.in: Makefile.am $(top_srcdir)/configure.in $(ACLOCAL_M4) 
+#	cd $(top_srcdir) && $(AUTOMAKE) --gnu etc/pam.d/Makefile
+#
+#Makefile: $(srcdir)/Makefile.in  $(top_builddir)/config.status $(BUILT_SOURCES)
+#	cd $(top_builddir) \
+#	  && CONFIG_FILES=$(subdir)/$@ CONFIG_HEADERS= $(SHELL) ./config.status
 
 tags: TAGS
 TAGS:
@@ -134,10 +134,15 @@
 subdir = etc/pam.d
 
 distdir: $(DISTFILES)
+	here=`cd $(top_builddir) && pwd`; \
+	top_distdir=`cd $(top_distdir) && pwd`; \
+	distdir=`cd $(distdir) && pwd`; \
+	cd $(top_srcdir) \
+	  && $(AUTOMAKE) --include-deps --build-dir=$$here --srcdir-name=$(top_srcdir) --output-dir=$$top_distdir --gnu etc/pam.d/Makefile
 	@for file in $(DISTFILES); do \
 	  d=$(srcdir); \
 	  if test -d $$d/$$file; then \
-	    cp -pr $$/$$file $(distdir)/$$file; \
+	    cp -pr $$d/$$file $(distdir)/$$file; \
 	  else \
 	    test -f $(distdir)/$$file \
 	    || ln $$d/$$file $(distdir)/$$file 2> /dev/null \
diff -urN shadow-20000902/lib/Makefile.in shadow-20000902.new/lib/Makefile.in
--- shadow-20000902/lib/Makefile.in	Sat Sep  2 15:25:59 2000
+++ shadow-20000902.new/lib/Makefile.in	Fri Mar 22 11:51:08 2002
@@ -1,4 +1,4 @@
-# Makefile.in generated automatically by automake 1.4 from Makefile.am
+# Makefile.in generated automatically by automake 1.4-p4 from Makefile.am
 
 # Copyright (C) 1994, 1995-8, 1999 Free Software Foundation, Inc.
 # This Makefile.in is free software; the Free Software Foundation
@@ -179,18 +179,27 @@
 
 TAR = tar
 GZIP_ENV = --best
+DEP_FILES =  .deps/commonio.P .deps/dialchk.P .deps/dialup.P \
+.deps/encrypt.P .deps/fputsx.P .deps/getdef.P .deps/getpass.P \
+.deps/groupio.P .deps/gshadow.P .deps/lockpw.P .deps/md5.P \
+.deps/md5crypt.P .deps/mkdir.P .deps/port.P .deps/putgrent.P \
+.deps/putpwent.P .deps/putspent.P .deps/pwauth.P .deps/pwio.P \
+.deps/rad64.P .deps/rename.P .deps/rmdir.P .deps/sgetgrent.P \
+.deps/sgetpwent.P .deps/sgetspent.P .deps/sgroupio.P .deps/shadow.P \
+.deps/shadowio.P .deps/snprintf.P .deps/strcasecmp.P .deps/strdup.P \
+.deps/strerror.P .deps/strstr.P .deps/tcfsio.P .deps/utent.P
 SOURCES = $(libshadow_a_SOURCES) $(libshadow_la_SOURCES)
 OBJECTS = $(libshadow_a_OBJECTS) $(libshadow_la_OBJECTS)
 
 all: all-redirect
 .SUFFIXES:
 .SUFFIXES: .S .c .lo .o .s
-$(srcdir)/Makefile.in: Makefile.am $(top_srcdir)/configure.in $(ACLOCAL_M4) 
-	cd $(top_srcdir) && $(AUTOMAKE) --foreign --include-deps lib/Makefile
-
-Makefile: $(srcdir)/Makefile.in  $(top_builddir)/config.status
-	cd $(top_builddir) \
-	  && CONFIG_FILES=$(subdir)/$@ CONFIG_HEADERS= $(SHELL) ./config.status
+#$(srcdir)/Makefile.in: Makefile.am $(top_srcdir)/configure.in $(ACLOCAL_M4) 
+#	cd $(top_srcdir) && $(AUTOMAKE) --foreign lib/Makefile
+#
+#Makefile: $(srcdir)/Makefile.in  $(top_builddir)/config.status $(BUILT_SOURCES)
+#	cd $(top_builddir) \
+#	  && CONFIG_FILES=$(subdir)/$@ CONFIG_HEADERS= $(SHELL) ./config.status
 
 
 mostlyclean-noinstLIBRARIES:
@@ -202,9 +211,6 @@
 
 maintainer-clean-noinstLIBRARIES:
 
-.c.o:
-	$(COMPILE) -c $<
-
 .s.o:
 	$(COMPILE) -c $<
 
@@ -221,9 +227,6 @@
 
 maintainer-clean-compile:
 
-.c.lo:
-	$(LIBTOOL) --mode=compile $(COMPILE) -c $<
-
 .s.lo:
 	$(LIBTOOL) --mode=compile $(COMPILE) -c $<
 
@@ -307,54 +310,53 @@
 subdir = lib
 
 distdir: $(DISTFILES)
+	here=`cd $(top_builddir) && pwd`; \
+	top_distdir=`cd $(top_distdir) && pwd`; \
+	distdir=`cd $(distdir) && pwd`; \
+	cd $(top_srcdir) \
+	  && $(AUTOMAKE) --include-deps --build-dir=$$here --srcdir-name=$(top_srcdir) --output-dir=$$top_distdir --foreign lib/Makefile
 	@for file in $(DISTFILES); do \
 	  d=$(srcdir); \
 	  if test -d $$d/$$file; then \
-	    cp -pr $$/$$file $(distdir)/$$file; \
+	    cp -pr $$d/$$file $(distdir)/$$file; \
 	  else \
 	    test -f $(distdir)/$$file \
 	    || ln $$d/$$file $(distdir)/$$file 2> /dev/null \
 	    || cp -p $$d/$$file $(distdir)/$$file || :; \
 	  fi; \
 	done
-commonio.lo commonio.o : commonio.c ../config.h rcsid.h defines.h \
-	gshadow_.h commonio.h
-dialchk.lo dialchk.o : dialchk.c ../config.h rcsid.h defines.h \
-	gshadow_.h prototypes.h dialup.h dialchk.h
-dialup.lo dialup.o : dialup.c ../config.h rcsid.h prototypes.h defines.h \
-	gshadow_.h dialup.h
-encrypt.lo encrypt.o : encrypt.c ../config.h rcsid.h prototypes.h \
-	defines.h gshadow_.h
-fputsx.lo fputsx.o : fputsx.c ../config.h defines.h gshadow_.h rcsid.h
-getdef.lo getdef.o : getdef.c ../config.h rcsid.h prototypes.h defines.h \
-	gshadow_.h getdef.h
-getpass.lo getpass.o : getpass.c ../config.h rcsid.h defines.h \
-	gshadow_.h getdef.h
-groupio.lo groupio.o : groupio.c ../config.h rcsid.h prototypes.h \
-	defines.h gshadow_.h commonio.h groupio.h
-gshadow.lo gshadow.o : gshadow.c ../config.h rcsid.h prototypes.h \
-	defines.h gshadow_.h
-lockpw.lo lockpw.o : lockpw.c ../config.h
-port.lo port.o : port.c ../config.h rcsid.h defines.h gshadow_.h port.h
-putgrent.lo putgrent.o : putgrent.c ../config.h prototypes.h defines.h \
-	gshadow_.h
-pwauth.lo pwauth.o : pwauth.c ../config.h rcsid.h prototypes.h defines.h \
-	gshadow_.h pwauth.h getdef.h
-pwio.lo pwio.o : pwio.c ../config.h rcsid.h prototypes.h defines.h \
-	gshadow_.h commonio.h pwio.h
-rad64.lo rad64.o : rad64.c ../config.h rcsid.h
-sgetgrent.lo sgetgrent.o : sgetgrent.c ../config.h rcsid.h defines.h \
-	gshadow_.h
-sgetpwent.lo sgetpwent.o : sgetpwent.c ../config.h rcsid.h defines.h \
-	gshadow_.h
-sgroupio.lo sgroupio.o : sgroupio.c ../config.h rcsid.h prototypes.h \
-	defines.h gshadow_.h commonio.h sgroupio.h
-shadowio.lo shadowio.o : shadowio.c ../config.h rcsid.h prototypes.h \
-	defines.h gshadow_.h commonio.h shadowio.h
-shadow.lo shadow.o : shadow.c ../config.h
-tcfsio.lo tcfsio.o : tcfsio.c ../config.h
-utent.lo utent.o : utent.c ../config.h
 
+DEPS_MAGIC := $(shell mkdir .deps > /dev/null 2>&1 || :)
+
+-include $(DEP_FILES)
+
+mostlyclean-depend:
+
+clean-depend:
+
+distclean-depend:
+	-rm -rf .deps
+
+maintainer-clean-depend:
+
+%.o: %.c
+	@echo '$(COMPILE) -c $<'; \
+	$(COMPILE) -Wp,-MD,.deps/$(*F).pp -c $<
+	@-cp .deps/$(*F).pp .deps/$(*F).P; \
+	tr ' ' '\012' < .deps/$(*F).pp \
+	  | sed -e 's/^\\$$//' -e '/^$$/ d' -e '/:$$/ d' -e 's/$$/ :/' \
+	    >> .deps/$(*F).P; \
+	rm .deps/$(*F).pp
+
+%.lo: %.c
+	@echo '$(LTCOMPILE) -c $<'; \
+	$(LTCOMPILE) -Wp,-MD,.deps/$(*F).pp -c $<
+	@-sed -e 's/^\([^:]*\)\.o[ 	]*:/\1.lo \1.o :/' \
+	  < .deps/$(*F).pp > .deps/$(*F).P; \
+	tr ' ' '\012' < .deps/$(*F).pp \
+	  | sed -e 's/^\\$$//' -e '/^$$/ d' -e '/:$$/ d' -e 's/$$/ :/' \
+	    >> .deps/$(*F).P; \
+	rm -f .deps/$(*F).pp
 info-am:
 info: info-am
 dvi-am:
@@ -395,19 +397,20 @@
 maintainer-clean-generic:
 mostlyclean-am:  mostlyclean-noinstLIBRARIES mostlyclean-compile \
 		mostlyclean-libtool mostlyclean-libLTLIBRARIES \
-		mostlyclean-tags mostlyclean-generic
+		mostlyclean-tags mostlyclean-depend mostlyclean-generic
 
 mostlyclean: mostlyclean-am
 
 clean-am:  clean-noinstLIBRARIES clean-compile clean-libtool \
-		clean-libLTLIBRARIES clean-tags clean-generic \
-		mostlyclean-am
+		clean-libLTLIBRARIES clean-tags clean-depend \
+		clean-generic mostlyclean-am
 
 clean: clean-am
 
 distclean-am:  distclean-noinstLIBRARIES distclean-compile \
 		distclean-libtool distclean-libLTLIBRARIES \
-		distclean-tags distclean-generic clean-am
+		distclean-tags distclean-depend distclean-generic \
+		clean-am
 	-rm -f libtool
 
 distclean: distclean-am
@@ -415,7 +418,8 @@
 maintainer-clean-am:  maintainer-clean-noinstLIBRARIES \
 		maintainer-clean-compile maintainer-clean-libtool \
 		maintainer-clean-libLTLIBRARIES maintainer-clean-tags \
-		maintainer-clean-generic distclean-am
+		maintainer-clean-depend maintainer-clean-generic \
+		distclean-am
 	@echo "This command is intended for maintainers to use;"
 	@echo "it deletes files that may require special tools to rebuild."
 
@@ -429,8 +433,9 @@
 distclean-libLTLIBRARIES clean-libLTLIBRARIES \
 maintainer-clean-libLTLIBRARIES uninstall-libLTLIBRARIES \
 install-libLTLIBRARIES tags mostlyclean-tags distclean-tags clean-tags \
-maintainer-clean-tags distdir info-am info dvi-am dvi check check-am \
-installcheck-am installcheck install-exec-am install-exec \
+maintainer-clean-tags distdir mostlyclean-depend distclean-depend \
+clean-depend maintainer-clean-depend info-am info dvi-am dvi check \
+check-am installcheck-am installcheck install-exec-am install-exec \
 install-data-am install-data install-am install uninstall-am uninstall \
 all-redirect all-am all installdirs mostlyclean-generic \
 distclean-generic clean-generic maintainer-clean-generic clean \
diff -urN shadow-20000902/libmisc/Makefile.in shadow-20000902.new/libmisc/Makefile.in
--- shadow-20000902/libmisc/Makefile.in	Sat Sep  2 15:26:01 2000
+++ shadow-20000902.new/libmisc/Makefile.in	Fri Mar 22 11:51:14 2002
@@ -1,4 +1,4 @@
-# Makefile.in generated automatically by automake 1.4 from Makefile.am
+# Makefile.in generated automatically by automake 1.4-p4 from Makefile.am
 
 # Copyright (C) 1994, 1995-8, 1999 Free Software Foundation, Inc.
 # This Makefile.in is free software; the Free Software Foundation
@@ -145,18 +145,30 @@
 
 TAR = tar
 GZIP_ENV = --best
+DEP_FILES =  .deps/addgrps.P .deps/age.P .deps/basename.P \
+.deps/chkname.P .deps/chkshell.P .deps/chowndir.P .deps/chowntty.P \
+.deps/console.P .deps/copydir.P .deps/entry.P .deps/env.P \
+.deps/failure.P .deps/fields.P .deps/getdate.P .deps/hushed.P \
+.deps/isexpired.P .deps/limits.P .deps/list.P .deps/log.P \
+.deps/login_access.P .deps/login_desrpc.P .deps/login_krb.P \
+.deps/loginprompt.P .deps/mail.P .deps/motd.P .deps/myname.P \
+.deps/obscure.P .deps/pam_pass.P .deps/pwd2spwd.P .deps/pwd_init.P \
+.deps/pwdcheck.P .deps/rlogin.P .deps/salt.P .deps/setugid.P \
+.deps/setup.P .deps/setupenv.P .deps/shell.P .deps/strtoday.P \
+.deps/suauth.P .deps/sub.P .deps/sulog.P .deps/ttytype.P .deps/tz.P \
+.deps/ulimit.P .deps/utmp.P .deps/valid.P .deps/xmalloc.P
 SOURCES = $(libmisc_a_SOURCES)
 OBJECTS = $(libmisc_a_OBJECTS)
 
 all: all-redirect
 .SUFFIXES:
 .SUFFIXES: .S .c .lo .o .s .y
-$(srcdir)/Makefile.in: Makefile.am $(top_srcdir)/configure.in $(ACLOCAL_M4) 
-	cd $(top_srcdir) && $(AUTOMAKE) --foreign --include-deps libmisc/Makefile
-
-Makefile: $(srcdir)/Makefile.in  $(top_builddir)/config.status
-	cd $(top_builddir) \
-	  && CONFIG_FILES=$(subdir)/$@ CONFIG_HEADERS= $(SHELL) ./config.status
+#$(srcdir)/Makefile.in: Makefile.am $(top_srcdir)/configure.in $(ACLOCAL_M4) 
+#	cd $(top_srcdir) && $(AUTOMAKE) --foreign libmisc/Makefile
+#
+#Makefile: $(srcdir)/Makefile.in  $(top_builddir)/config.status $(BUILT_SOURCES)
+#	cd $(top_builddir) \
+#	  && CONFIG_FILES=$(subdir)/$@ CONFIG_HEADERS= $(SHELL) ./config.status
 
 
 mostlyclean-noinstLIBRARIES:
@@ -168,9 +180,6 @@
 
 maintainer-clean-noinstLIBRARIES:
 
-.c.o:
-	$(COMPILE) -c $<
-
 .s.o:
 	$(COMPILE) -c $<
 
@@ -187,9 +196,6 @@
 
 maintainer-clean-compile:
 
-.c.lo:
-	$(LIBTOOL) --mode=compile $(COMPILE) -c $<
-
 .s.lo:
 	$(LIBTOOL) --mode=compile $(COMPILE) -c $<
 
@@ -252,108 +258,53 @@
 subdir = libmisc
 
 distdir: $(DISTFILES)
+	here=`cd $(top_builddir) && pwd`; \
+	top_distdir=`cd $(top_distdir) && pwd`; \
+	distdir=`cd $(distdir) && pwd`; \
+	cd $(top_srcdir) \
+	  && $(AUTOMAKE) --include-deps --build-dir=$$here --srcdir-name=$(top_srcdir) --output-dir=$$top_distdir --foreign libmisc/Makefile
 	@for file in $(DISTFILES); do \
 	  d=$(srcdir); \
 	  if test -d $$d/$$file; then \
-	    cp -pr $$/$$file $(distdir)/$$file; \
+	    cp -pr $$d/$$file $(distdir)/$$file; \
 	  else \
 	    test -f $(distdir)/$$file \
 	    || ln $$d/$$file $(distdir)/$$file 2> /dev/null \
 	    || cp -p $$d/$$file $(distdir)/$$file || :; \
 	  fi; \
 	done
-addgrps.o: addgrps.c ../config.h ../lib/prototypes.h ../lib/defines.h \
-	../lib/gshadow_.h ../lib/rcsid.h
-age.o: age.c ../config.h ../lib/prototypes.h ../lib/defines.h \
-	../lib/gshadow_.h ../lib/rcsid.h
-basename.o: basename.c ../config.h ../lib/rcsid.h ../lib/defines.h \
-	../lib/gshadow_.h ../lib/prototypes.h
-chkname.o: chkname.c ../config.h ../lib/rcsid.h ../lib/defines.h \
-	../lib/gshadow_.h chkname.h
-chkshell.o: chkshell.c ../config.h ../lib/rcsid.h ../lib/prototypes.h \
-	../lib/defines.h ../lib/gshadow_.h
-chowndir.o: chowndir.c ../config.h ../lib/rcsid.h ../lib/prototypes.h \
-	../lib/defines.h ../lib/gshadow_.h
-chowntty.o: chowntty.c ../config.h ../lib/rcsid.h ../lib/prototypes.h \
-	../lib/defines.h ../lib/gshadow_.h ../lib/getdef.h
-console.o: console.c ../config.h ../lib/defines.h ../lib/gshadow_.h \
-	../lib/getdef.h ../lib/rcsid.h
-copydir.o: copydir.c ../config.h ../lib/rcsid.h ../lib/prototypes.h \
-	../lib/defines.h ../lib/gshadow_.h
-entry.o: entry.c ../config.h ../lib/rcsid.h ../lib/prototypes.h \
-	../lib/defines.h ../lib/gshadow_.h
-env.o: env.c ../config.h ../lib/rcsid.h ../lib/prototypes.h \
-	../lib/defines.h ../lib/gshadow_.h
-failure.o: failure.c ../config.h ../lib/rcsid.h ../lib/defines.h \
-	../lib/gshadow_.h ../lib/faillog.h ../lib/getdef.h failure.h
-fields.o: fields.c ../config.h ../lib/rcsid.h ../lib/prototypes.h \
-	../lib/defines.h ../lib/gshadow_.h
-getdate.o: getdate.c ../config.h getdate.h ../lib/defines.h \
-	../lib/gshadow_.h
-hushed.o: hushed.c ../config.h ../lib/rcsid.h ../lib/defines.h \
-	../lib/gshadow_.h ../lib/prototypes.h ../lib/getdef.h
-isexpired.o: isexpired.c ../config.h ../lib/prototypes.h \
-	../lib/defines.h ../lib/gshadow_.h ../lib/rcsid.h
-limits.o: limits.c ../config.h ../lib/rcsid.h ../lib/prototypes.h \
-	../lib/defines.h ../lib/gshadow_.h ../lib/getdef.h
-list.o: list.c ../config.h ../lib/rcsid.h ../lib/prototypes.h \
-	../lib/defines.h ../lib/gshadow_.h
-login_access.o: login_access.c ../config.h ../lib/rcsid.h \
-	../lib/prototypes.h ../lib/defines.h ../lib/gshadow_.h
-login_desrpc.o: login_desrpc.c ../config.h
-login_krb.o: login_krb.c ../config.h
-loginprompt.o: loginprompt.c ../config.h ../lib/rcsid.h \
-	../lib/prototypes.h ../lib/defines.h ../lib/gshadow_.h \
-	../lib/getdef.h
-log.o: log.c ../config.h ../lib/rcsid.h ../lib/defines.h \
-	../lib/gshadow_.h
-mail.o: mail.c ../config.h ../lib/prototypes.h ../lib/defines.h \
-	../lib/gshadow_.h ../lib/getdef.h ../lib/rcsid.h
-motd.o: motd.c ../config.h ../lib/rcsid.h ../lib/prototypes.h \
-	../lib/defines.h ../lib/gshadow_.h ../lib/getdef.h
-myname.o: myname.c ../config.h ../lib/rcsid.h ../lib/defines.h \
-	../lib/gshadow_.h ../lib/prototypes.h
-obscure.o: obscure.c ../config.h ../lib/rcsid.h ../lib/prototypes.h \
-	../lib/defines.h ../lib/gshadow_.h ../lib/getdef.h
-pam_pass.o: pam_pass.c ../config.h
-pwd2spwd.o: pwd2spwd.c ../config.h ../lib/rcsid.h ../lib/prototypes.h \
-	../lib/defines.h ../lib/gshadow_.h
-pwdcheck.o: pwdcheck.c ../config.h ../lib/rcsid.h ../lib/prototypes.h \
-	../lib/defines.h ../lib/gshadow_.h ../lib/pwauth.h
-pwd_init.o: pwd_init.c ../config.h ../lib/rcsid.h ../lib/defines.h \
-	../lib/gshadow_.h
-rlogin.o: rlogin.c ../config.h ../lib/rcsid.h ../lib/prototypes.h \
-	../lib/defines.h ../lib/gshadow_.h
-salt.o: salt.c ../config.h ../lib/rcsid.h ../lib/prototypes.h \
-	../lib/defines.h ../lib/gshadow_.h ../lib/getdef.h
-setugid.o: setugid.c ../config.h ../lib/rcsid.h ../lib/prototypes.h \
-	../lib/defines.h ../lib/gshadow_.h ../lib/getdef.h
-setupenv.o: setupenv.c ../config.h ../lib/rcsid.h ../lib/prototypes.h \
-	../lib/defines.h ../lib/gshadow_.h ../lib/getdef.h
-setup.o: setup.c ../config.h ../lib/rcsid.h ../lib/prototypes.h \
-	../lib/defines.h ../lib/gshadow_.h
-shell.o: shell.c ../config.h ../lib/rcsid.h ../lib/prototypes.h \
-	../lib/defines.h ../lib/gshadow_.h
-strtoday.o: strtoday.c ../config.h ../lib/rcsid.h ../lib/defines.h \
-	../lib/gshadow_.h getdate.h
-suauth.o: suauth.c ../config.h ../lib/prototypes.h ../lib/defines.h \
-	../lib/gshadow_.h
-sub.o: sub.c ../config.h ../lib/rcsid.h ../lib/prototypes.h \
-	../lib/defines.h ../lib/gshadow_.h
-sulog.o: sulog.c ../config.h ../lib/rcsid.h ../lib/prototypes.h \
-	../lib/defines.h ../lib/gshadow_.h ../lib/getdef.h
-ttytype.o: ttytype.c ../config.h ../lib/rcsid.h ../lib/prototypes.h \
-	../lib/defines.h ../lib/gshadow_.h ../lib/getdef.h
-tz.o: tz.c ../config.h ../lib/rcsid.h ../lib/defines.h ../lib/gshadow_.h \
-	../lib/getdef.h
-ulimit.o: ulimit.c ../config.h ../lib/rcsid.h
-utmp.o: utmp.c ../config.h ../lib/defines.h ../lib/gshadow_.h \
-	../lib/rcsid.h
-valid.o: valid.c ../config.h ../lib/rcsid.h ../lib/prototypes.h \
-	../lib/defines.h ../lib/gshadow_.h
-xmalloc.o: xmalloc.c ../config.h ../lib/rcsid.h ../lib/defines.h \
-	../lib/gshadow_.h
 
+DEPS_MAGIC := $(shell mkdir .deps > /dev/null 2>&1 || :)
+
+-include $(DEP_FILES)
+
+mostlyclean-depend:
+
+clean-depend:
+
+distclean-depend:
+	-rm -rf .deps
+
+maintainer-clean-depend:
+
+%.o: %.c
+	@echo '$(COMPILE) -c $<'; \
+	$(COMPILE) -Wp,-MD,.deps/$(*F).pp -c $<
+	@-cp .deps/$(*F).pp .deps/$(*F).P; \
+	tr ' ' '\012' < .deps/$(*F).pp \
+	  | sed -e 's/^\\$$//' -e '/^$$/ d' -e '/:$$/ d' -e 's/$$/ :/' \
+	    >> .deps/$(*F).P; \
+	rm .deps/$(*F).pp
+
+%.lo: %.c
+	@echo '$(LTCOMPILE) -c $<'; \
+	$(LTCOMPILE) -Wp,-MD,.deps/$(*F).pp -c $<
+	@-sed -e 's/^\([^:]*\)\.o[ 	]*:/\1.lo \1.o :/' \
+	  < .deps/$(*F).pp > .deps/$(*F).P; \
+	tr ' ' '\012' < .deps/$(*F).pp \
+	  | sed -e 's/^\\$$//' -e '/^$$/ d' -e '/:$$/ d' -e 's/$$/ :/' \
+	    >> .deps/$(*F).P; \
+	rm -f .deps/$(*F).pp
 info-am:
 info: info-am
 dvi-am:
@@ -391,27 +342,27 @@
 maintainer-clean-generic:
 	-test -z "getdatehgetdatec" || rm -f getdateh getdatec
 mostlyclean-am:  mostlyclean-noinstLIBRARIES mostlyclean-compile \
-		mostlyclean-libtool mostlyclean-tags \
+		mostlyclean-libtool mostlyclean-tags mostlyclean-depend \
 		mostlyclean-generic
 
 mostlyclean: mostlyclean-am
 
 clean-am:  clean-noinstLIBRARIES clean-compile clean-libtool clean-tags \
-		clean-generic mostlyclean-am
+		clean-depend clean-generic mostlyclean-am
 
 clean: clean-am
 
 distclean-am:  distclean-noinstLIBRARIES distclean-compile \
-		distclean-libtool distclean-tags distclean-generic \
-		clean-am
+		distclean-libtool distclean-tags distclean-depend \
+		distclean-generic clean-am
 	-rm -f libtool
 
 distclean: distclean-am
 
 maintainer-clean-am:  maintainer-clean-noinstLIBRARIES \
 		maintainer-clean-compile maintainer-clean-libtool \
-		maintainer-clean-tags maintainer-clean-generic \
-		distclean-am
+		maintainer-clean-tags maintainer-clean-depend \
+		maintainer-clean-generic distclean-am
 	@echo "This command is intended for maintainers to use;"
 	@echo "it deletes files that may require special tools to rebuild."
 
@@ -422,12 +373,14 @@
 mostlyclean-compile distclean-compile clean-compile \
 maintainer-clean-compile mostlyclean-libtool distclean-libtool \
 clean-libtool maintainer-clean-libtool tags mostlyclean-tags \
-distclean-tags clean-tags maintainer-clean-tags distdir info-am info \
-dvi-am dvi check check-am installcheck-am installcheck install-exec-am \
-install-exec install-data-am install-data install-am install \
-uninstall-am uninstall all-redirect all-am all installdirs \
-mostlyclean-generic distclean-generic clean-generic \
-maintainer-clean-generic clean mostlyclean distclean maintainer-clean
+distclean-tags clean-tags maintainer-clean-tags distdir \
+mostlyclean-depend distclean-depend clean-depend \
+maintainer-clean-depend info-am info dvi-am dvi check check-am \
+installcheck-am installcheck install-exec-am install-exec \
+install-data-am install-data install-am install uninstall-am uninstall \
+all-redirect all-am all installdirs mostlyclean-generic \
+distclean-generic clean-generic maintainer-clean-generic clean \
+mostlyclean distclean maintainer-clean
 
 
 # Tell versions [3.59,3.63) of GNU make to not export all variables.
diff -urN shadow-20000902/man/Makefile.in shadow-20000902.new/man/Makefile.in
--- shadow-20000902/man/Makefile.in	Sat Sep  2 15:25:57 2000
+++ shadow-20000902.new/man/Makefile.in	Fri Mar 22 11:50:46 2002
@@ -1,4 +1,4 @@
-# Makefile.in generated automatically by automake 1.4 from Makefile.am
+# Makefile.in generated automatically by automake 1.4-p4 from Makefile.am
 
 # Copyright (C) 1994, 1995-8, 1999 Free Software Foundation, Inc.
 # This Makefile.in is free software; the Free Software Foundation
@@ -130,12 +130,12 @@
 GZIP_ENV = --best
 all: all-redirect
 .SUFFIXES:
-$(srcdir)/Makefile.in: Makefile.am $(top_srcdir)/configure.in $(ACLOCAL_M4) 
-	cd $(top_srcdir) && $(AUTOMAKE) --foreign --include-deps man/Makefile
-
-Makefile: $(srcdir)/Makefile.in  $(top_builddir)/config.status
-	cd $(top_builddir) \
-	  && CONFIG_FILES=$(subdir)/$@ CONFIG_HEADERS= $(SHELL) ./config.status
+#$(srcdir)/Makefile.in: Makefile.am $(top_srcdir)/configure.in $(ACLOCAL_M4) 
+#	cd $(top_srcdir) && $(AUTOMAKE) --foreign man/Makefile
+#
+#Makefile: $(srcdir)/Makefile.in  $(top_builddir)/config.status $(BUILT_SOURCES)
+#	cd $(top_builddir) \
+#	  && CONFIG_FILES=$(subdir)/$@ CONFIG_HEADERS= $(SHELL) ./config.status
 
 
 install-man1:
@@ -372,10 +372,15 @@
 subdir = man
 
 distdir: $(DISTFILES)
+	here=`cd $(top_builddir) && pwd`; \
+	top_distdir=`cd $(top_distdir) && pwd`; \
+	distdir=`cd $(distdir) && pwd`; \
+	cd $(top_srcdir) \
+	  && $(AUTOMAKE) --include-deps --build-dir=$$here --srcdir-name=$(top_srcdir) --output-dir=$$top_distdir --foreign man/Makefile
 	@for file in $(DISTFILES); do \
 	  d=$(srcdir); \
 	  if test -d $$d/$$file; then \
-	    cp -pr $$/$$file $(distdir)/$$file; \
+	    cp -pr $$d/$$file $(distdir)/$$file; \
 	  else \
 	    test -f $(distdir)/$$file \
 	    || ln $$d/$$file $(distdir)/$$file 2> /dev/null \
diff -urN shadow-20000902/man/pl/Makefile.in shadow-20000902.new/man/pl/Makefile.in
--- shadow-20000902/man/pl/Makefile.in	Sat Sep  2 15:25:58 2000
+++ shadow-20000902.new/man/pl/Makefile.in	Fri Mar 22 11:50:51 2002
@@ -1,4 +1,4 @@
-# Makefile.in generated automatically by automake 1.4 from Makefile.am
+# Makefile.in generated automatically by automake 1.4-p4 from Makefile.am
 
 # Copyright (C) 1994, 1995-8, 1999 Free Software Foundation, Inc.
 # This Makefile.in is free software; the Free Software Foundation
@@ -137,12 +137,12 @@
 GZIP_ENV = --best
 all: all-redirect
 .SUFFIXES:
-$(srcdir)/Makefile.in: Makefile.am $(top_srcdir)/configure.in $(ACLOCAL_M4) 
-	cd $(top_srcdir) && $(AUTOMAKE) --foreign --include-deps man/pl/Makefile
-
-Makefile: $(srcdir)/Makefile.in  $(top_builddir)/config.status
-	cd $(top_builddir) \
-	  && CONFIG_FILES=$(subdir)/$@ CONFIG_HEADERS= $(SHELL) ./config.status
+#$(srcdir)/Makefile.in: Makefile.am $(top_srcdir)/configure.in $(ACLOCAL_M4) 
+#	cd $(top_srcdir) && $(AUTOMAKE) --foreign man/pl/Makefile
+#
+#Makefile: $(srcdir)/Makefile.in  $(top_builddir)/config.status $(BUILT_SOURCES)
+#	cd $(top_builddir) \
+#	  && CONFIG_FILES=$(subdir)/$@ CONFIG_HEADERS= $(SHELL) ./config.status
 
 
 install-manpl1DATA: $(manpl1_DATA)
@@ -229,10 +229,15 @@
 subdir = man/pl
 
 distdir: $(DISTFILES)
+	here=`cd $(top_builddir) && pwd`; \
+	top_distdir=`cd $(top_distdir) && pwd`; \
+	distdir=`cd $(distdir) && pwd`; \
+	cd $(top_srcdir) \
+	  && $(AUTOMAKE) --include-deps --build-dir=$$here --srcdir-name=$(top_srcdir) --output-dir=$$top_distdir --foreign man/pl/Makefile
 	@for file in $(DISTFILES); do \
 	  d=$(srcdir); \
 	  if test -d $$d/$$file; then \
-	    cp -pr $$/$$file $(distdir)/$$file; \
+	    cp -pr $$d/$$file $(distdir)/$$file; \
 	  else \
 	    test -f $(distdir)/$$file \
 	    || ln $$d/$$file $(distdir)/$$file 2> /dev/null \
diff -urN shadow-20000902/redhat/Makefile.in shadow-20000902.new/redhat/Makefile.in
--- shadow-20000902/redhat/Makefile.in	Sat Sep  2 15:26:09 2000
+++ shadow-20000902.new/redhat/Makefile.in	Fri Mar 22 11:55:15 2002
@@ -1,4 +1,4 @@
-# Makefile.in generated automatically by automake 1.4 from Makefile.am
+# Makefile.in generated automatically by automake 1.4-p4 from Makefile.am
 
 # Copyright (C) 1994, 1995-8, 1999 Free Software Foundation, Inc.
 # This Makefile.in is free software; the Free Software Foundation
@@ -119,12 +119,12 @@
 GZIP_ENV = --best
 all: all-redirect
 .SUFFIXES:
-$(srcdir)/Makefile.in: Makefile.am $(top_srcdir)/configure.in $(ACLOCAL_M4) 
-	cd $(top_srcdir) && $(AUTOMAKE) --gnu --include-deps redhat/Makefile
-
-Makefile: $(srcdir)/Makefile.in  $(top_builddir)/config.status
-	cd $(top_builddir) \
-	  && CONFIG_FILES=$(subdir)/$@ CONFIG_HEADERS= $(SHELL) ./config.status
+#$(srcdir)/Makefile.in: Makefile.am $(top_srcdir)/configure.in $(ACLOCAL_M4) 
+#	cd $(top_srcdir) && $(AUTOMAKE) --gnu redhat/Makefile
+#
+#Makefile: $(srcdir)/Makefile.in  $(top_builddir)/config.status $(BUILT_SOURCES)
+#	cd $(top_builddir) \
+#	  && CONFIG_FILES=$(subdir)/$@ CONFIG_HEADERS= $(SHELL) ./config.status
 
 shadow-utils.spec: $(top_builddir)/config.status shadow-utils.spec.in
 	cd $(top_builddir) && CONFIG_FILES=$(subdir)/$@ CONFIG_HEADERS= $(SHELL) ./config.status
@@ -137,10 +137,15 @@
 subdir = redhat
 
 distdir: $(DISTFILES)
+	here=`cd $(top_builddir) && pwd`; \
+	top_distdir=`cd $(top_distdir) && pwd`; \
+	distdir=`cd $(distdir) && pwd`; \
+	cd $(top_srcdir) \
+	  && $(AUTOMAKE) --include-deps --build-dir=$$here --srcdir-name=$(top_srcdir) --output-dir=$$top_distdir --gnu redhat/Makefile
 	@for file in $(DISTFILES); do \
 	  d=$(srcdir); \
 	  if test -d $$d/$$file; then \
-	    cp -pr $$/$$file $(distdir)/$$file; \
+	    cp -pr $$d/$$file $(distdir)/$$file; \
 	  else \
 	    test -f $(distdir)/$$file \
 	    || ln $$d/$$file $(distdir)/$$file 2> /dev/null \
diff -urN shadow-20000902/src/Makefile.in shadow-20000902.new/src/Makefile.in
--- shadow-20000902/src/Makefile.in	Sat Sep  2 15:26:04 2000
+++ shadow-20000902.new/src/Makefile.in	Fri Mar 22 11:51:19 2002
@@ -1,4 +1,4 @@
-# Makefile.in generated automatically by automake 1.4 from Makefile.am
+# Makefile.in generated automatically by automake 1.4-p4 from Makefile.am
 
 # Copyright (C) 1994, 1995-8, 1999 Free Software Foundation, Inc.
 # This Makefile.in is free software; the Free Software Foundation
@@ -129,7 +129,7 @@
 
 ubin_PROGRAMS = faillog lastlog  chage chfn chsh expiry gpasswd newgrp passwd
 
-usbin_PROGRAMS = chpasswd dpasswd groupadd groupdel groupmod  logoutd mkpasswd newusers  useradd userdel usermod grpck pwck vipw  grpconv grpunconv pwconv pwunconv
+usbin_PROGRAMS = chpasswd dpasswd groupadd groupdel groupmod  logoutd mkpasswd newusers  useradd userdel usermod grpck pwck vipw  grpconv grpunconv pwconv pwunconv cppw
 
 
 EXTRA_DIST = shadowconfig.sh
@@ -162,7 +162,7 @@
 # chage chfn chsh expiry gpasswd newgrp passwd \
 # sulogin
 
-shlibs = ../lib/libshadow.la
+shlibs = #../lib/libshadow.la
 # With glibc2, almost all programs need libcrypt for some reason,
 # even those that don't actually use crypt().
 LDADD = ${shlibs} ../libmisc/libmisc.a ../lib/libshadow.a @INTLLIBS@ @LIBCRYPT@ @LIBTCFS@ @LIBSKEY@ @LIBMD@
@@ -184,191 +184,164 @@
 LIBS = @LIBS@
 login_SOURCES = login.c
 login_OBJECTS =  login.o
-login_DEPENDENCIES =  ../lib/libshadow.la ../libmisc/libmisc.a \
-../lib/libshadow.a
+login_DEPENDENCIES =  ../libmisc/libmisc.a ../lib/libshadow.a
 login_LDFLAGS = 
 su_SOURCES = su.c
 su_OBJECTS =  su.o
-su_DEPENDENCIES =  ../lib/libshadow.la ../libmisc/libmisc.a \
-../lib/libshadow.a
+su_DEPENDENCIES =  ../libmisc/libmisc.a ../lib/libshadow.a
 su_LDFLAGS = 
 groups_SOURCES = groups.c
 groups_OBJECTS =  groups.o
 groups_LDADD = $(LDADD)
-groups_DEPENDENCIES =  ../lib/libshadow.la ../libmisc/libmisc.a \
-../lib/libshadow.a
+groups_DEPENDENCIES =  ../libmisc/libmisc.a ../lib/libshadow.a
 groups_LDFLAGS = 
 id_SOURCES = id.c
 id_OBJECTS =  id.o
 id_LDADD = $(LDADD)
-id_DEPENDENCIES =  ../lib/libshadow.la ../libmisc/libmisc.a \
-../lib/libshadow.a
+id_DEPENDENCIES =  ../libmisc/libmisc.a ../lib/libshadow.a
 id_LDFLAGS = 
 sulogin_SOURCES = sulogin.c
 sulogin_OBJECTS =  sulogin.o
 sulogin_LDADD = $(LDADD)
-sulogin_DEPENDENCIES =  ../lib/libshadow.la ../libmisc/libmisc.a \
-../lib/libshadow.a
+sulogin_DEPENDENCIES =  ../libmisc/libmisc.a ../lib/libshadow.a
 sulogin_LDFLAGS = 
 faillog_SOURCES = faillog.c
 faillog_OBJECTS =  faillog.o
 faillog_LDADD = $(LDADD)
-faillog_DEPENDENCIES =  ../lib/libshadow.la ../libmisc/libmisc.a \
-../lib/libshadow.a
+faillog_DEPENDENCIES =  ../libmisc/libmisc.a ../lib/libshadow.a
 faillog_LDFLAGS = 
 lastlog_SOURCES = lastlog.c
 lastlog_OBJECTS =  lastlog.o
 lastlog_LDADD = $(LDADD)
-lastlog_DEPENDENCIES =  ../lib/libshadow.la ../libmisc/libmisc.a \
-../lib/libshadow.a
+lastlog_DEPENDENCIES =  ../libmisc/libmisc.a ../lib/libshadow.a
 lastlog_LDFLAGS = 
 chage_SOURCES = chage.c
 chage_OBJECTS =  chage.o
 chage_LDADD = $(LDADD)
-chage_DEPENDENCIES =  ../lib/libshadow.la ../libmisc/libmisc.a \
-../lib/libshadow.a
+chage_DEPENDENCIES =  ../libmisc/libmisc.a ../lib/libshadow.a
 chage_LDFLAGS = 
 chfn_SOURCES = chfn.c
 chfn_OBJECTS =  chfn.o
-chfn_DEPENDENCIES =  ../lib/libshadow.la ../libmisc/libmisc.a \
-../lib/libshadow.a
+chfn_DEPENDENCIES =  ../libmisc/libmisc.a ../lib/libshadow.a
 chfn_LDFLAGS = 
 chsh_SOURCES = chsh.c
 chsh_OBJECTS =  chsh.o
-chsh_DEPENDENCIES =  ../lib/libshadow.la ../libmisc/libmisc.a \
-../lib/libshadow.a
+chsh_DEPENDENCIES =  ../libmisc/libmisc.a ../lib/libshadow.a
 chsh_LDFLAGS = 
 expiry_SOURCES = expiry.c
 expiry_OBJECTS =  expiry.o
 expiry_LDADD = $(LDADD)
-expiry_DEPENDENCIES =  ../lib/libshadow.la ../libmisc/libmisc.a \
-../lib/libshadow.a
+expiry_DEPENDENCIES =  ../libmisc/libmisc.a ../lib/libshadow.a
 expiry_LDFLAGS = 
 gpasswd_SOURCES = gpasswd.c
 gpasswd_OBJECTS =  gpasswd.o
 gpasswd_LDADD = $(LDADD)
-gpasswd_DEPENDENCIES =  ../lib/libshadow.la ../libmisc/libmisc.a \
-../lib/libshadow.a
+gpasswd_DEPENDENCIES =  ../libmisc/libmisc.a ../lib/libshadow.a
 gpasswd_LDFLAGS = 
 newgrp_SOURCES = newgrp.c
 newgrp_OBJECTS =  newgrp.o
 newgrp_LDADD = $(LDADD)
-newgrp_DEPENDENCIES =  ../lib/libshadow.la ../libmisc/libmisc.a \
-../lib/libshadow.a
+newgrp_DEPENDENCIES =  ../libmisc/libmisc.a ../lib/libshadow.a
 newgrp_LDFLAGS = 
 passwd_SOURCES = passwd.c
 passwd_OBJECTS =  passwd.o
-passwd_DEPENDENCIES =  ../lib/libshadow.la ../libmisc/libmisc.a \
-../lib/libshadow.a
+passwd_DEPENDENCIES =  ../libmisc/libmisc.a ../lib/libshadow.a
 passwd_LDFLAGS = 
 chpasswd_SOURCES = chpasswd.c
 chpasswd_OBJECTS =  chpasswd.o
 chpasswd_LDADD = $(LDADD)
-chpasswd_DEPENDENCIES =  ../lib/libshadow.la ../libmisc/libmisc.a \
-../lib/libshadow.a
+chpasswd_DEPENDENCIES =  ../libmisc/libmisc.a ../lib/libshadow.a
 chpasswd_LDFLAGS = 
 dpasswd_SOURCES = dpasswd.c
 dpasswd_OBJECTS =  dpasswd.o
 dpasswd_LDADD = $(LDADD)
-dpasswd_DEPENDENCIES =  ../lib/libshadow.la ../libmisc/libmisc.a \
-../lib/libshadow.a
+dpasswd_DEPENDENCIES =  ../libmisc/libmisc.a ../lib/libshadow.a
 dpasswd_LDFLAGS = 
 groupadd_SOURCES = groupadd.c
 groupadd_OBJECTS =  groupadd.o
 groupadd_LDADD = $(LDADD)
-groupadd_DEPENDENCIES =  ../lib/libshadow.la ../libmisc/libmisc.a \
-../lib/libshadow.a
+groupadd_DEPENDENCIES =  ../libmisc/libmisc.a ../lib/libshadow.a
 groupadd_LDFLAGS = 
 groupdel_SOURCES = groupdel.c
 groupdel_OBJECTS =  groupdel.o
 groupdel_LDADD = $(LDADD)
-groupdel_DEPENDENCIES =  ../lib/libshadow.la ../libmisc/libmisc.a \
-../lib/libshadow.a
+groupdel_DEPENDENCIES =  ../libmisc/libmisc.a ../lib/libshadow.a
 groupdel_LDFLAGS = 
 groupmod_SOURCES = groupmod.c
 groupmod_OBJECTS =  groupmod.o
 groupmod_LDADD = $(LDADD)
-groupmod_DEPENDENCIES =  ../lib/libshadow.la ../libmisc/libmisc.a \
-../lib/libshadow.a
+groupmod_DEPENDENCIES =  ../libmisc/libmisc.a ../lib/libshadow.a
 groupmod_LDFLAGS = 
 logoutd_SOURCES = logoutd.c
 logoutd_OBJECTS =  logoutd.o
 logoutd_LDADD = $(LDADD)
-logoutd_DEPENDENCIES =  ../lib/libshadow.la ../libmisc/libmisc.a \
-../lib/libshadow.a
+logoutd_DEPENDENCIES =  ../libmisc/libmisc.a ../lib/libshadow.a
 logoutd_LDFLAGS = 
 mkpasswd_SOURCES = mkpasswd.c
 mkpasswd_OBJECTS =  mkpasswd.o
 mkpasswd_LDADD = $(LDADD)
-mkpasswd_DEPENDENCIES =  ../lib/libshadow.la ../libmisc/libmisc.a \
-../lib/libshadow.a
+mkpasswd_DEPENDENCIES =  ../libmisc/libmisc.a ../lib/libshadow.a
 mkpasswd_LDFLAGS = 
 newusers_SOURCES = newusers.c
 newusers_OBJECTS =  newusers.o
 newusers_LDADD = $(LDADD)
-newusers_DEPENDENCIES =  ../lib/libshadow.la ../libmisc/libmisc.a \
-../lib/libshadow.a
+newusers_DEPENDENCIES =  ../libmisc/libmisc.a ../lib/libshadow.a
 newusers_LDFLAGS = 
 useradd_SOURCES = useradd.c
 useradd_OBJECTS =  useradd.o
 useradd_LDADD = $(LDADD)
-useradd_DEPENDENCIES =  ../lib/libshadow.la ../libmisc/libmisc.a \
-../lib/libshadow.a
+useradd_DEPENDENCIES =  ../libmisc/libmisc.a ../lib/libshadow.a
 useradd_LDFLAGS = 
 userdel_SOURCES = userdel.c
 userdel_OBJECTS =  userdel.o
 userdel_LDADD = $(LDADD)
-userdel_DEPENDENCIES =  ../lib/libshadow.la ../libmisc/libmisc.a \
-../lib/libshadow.a
+userdel_DEPENDENCIES =  ../libmisc/libmisc.a ../lib/libshadow.a
 userdel_LDFLAGS = 
 usermod_SOURCES = usermod.c
 usermod_OBJECTS =  usermod.o
 usermod_LDADD = $(LDADD)
-usermod_DEPENDENCIES =  ../lib/libshadow.la ../libmisc/libmisc.a \
-../lib/libshadow.a
+usermod_DEPENDENCIES =  ../libmisc/libmisc.a ../lib/libshadow.a
 usermod_LDFLAGS = 
 grpck_SOURCES = grpck.c
 grpck_OBJECTS =  grpck.o
 grpck_LDADD = $(LDADD)
-grpck_DEPENDENCIES =  ../lib/libshadow.la ../libmisc/libmisc.a \
-../lib/libshadow.a
+grpck_DEPENDENCIES =  ../libmisc/libmisc.a ../lib/libshadow.a
 grpck_LDFLAGS = 
 pwck_SOURCES = pwck.c
 pwck_OBJECTS =  pwck.o
 pwck_LDADD = $(LDADD)
-pwck_DEPENDENCIES =  ../lib/libshadow.la ../libmisc/libmisc.a \
-../lib/libshadow.a
+pwck_DEPENDENCIES =  ../libmisc/libmisc.a ../lib/libshadow.a
 pwck_LDFLAGS = 
 vipw_SOURCES = vipw.c
 vipw_OBJECTS =  vipw.o
 vipw_LDADD = $(LDADD)
-vipw_DEPENDENCIES =  ../lib/libshadow.la ../libmisc/libmisc.a \
-../lib/libshadow.a
+vipw_DEPENDENCIES =  ../libmisc/libmisc.a ../lib/libshadow.a
 vipw_LDFLAGS = 
 grpconv_SOURCES = grpconv.c
 grpconv_OBJECTS =  grpconv.o
 grpconv_LDADD = $(LDADD)
-grpconv_DEPENDENCIES =  ../lib/libshadow.la ../libmisc/libmisc.a \
-../lib/libshadow.a
+grpconv_DEPENDENCIES =  ../libmisc/libmisc.a ../lib/libshadow.a
 grpconv_LDFLAGS = 
 grpunconv_SOURCES = grpunconv.c
 grpunconv_OBJECTS =  grpunconv.o
 grpunconv_LDADD = $(LDADD)
-grpunconv_DEPENDENCIES =  ../lib/libshadow.la ../libmisc/libmisc.a \
-../lib/libshadow.a
+grpunconv_DEPENDENCIES =  ../libmisc/libmisc.a ../lib/libshadow.a
 grpunconv_LDFLAGS = 
 pwconv_SOURCES = pwconv.c
 pwconv_OBJECTS =  pwconv.o
 pwconv_LDADD = $(LDADD)
-pwconv_DEPENDENCIES =  ../lib/libshadow.la ../libmisc/libmisc.a \
-../lib/libshadow.a
+pwconv_DEPENDENCIES =  ../libmisc/libmisc.a ../lib/libshadow.a
 pwconv_LDFLAGS = 
 pwunconv_SOURCES = pwunconv.c
 pwunconv_OBJECTS =  pwunconv.o
 pwunconv_LDADD = $(LDADD)
-pwunconv_DEPENDENCIES =  ../lib/libshadow.la ../libmisc/libmisc.a \
-../lib/libshadow.a
+pwunconv_DEPENDENCIES =  ../libmisc/libmisc.a ../lib/libshadow.a
 pwunconv_LDFLAGS = 
+cppw_SOURCES = cppw.c
+cppw_OBJECTS =  cppw.o
+cppw_LDADD = $(LDADD)
+cppw_DEPENDENCIES =  ../libmisc/libmisc.a ../lib/libshadow.a
+cppw_LDFLAGS = 
 CFLAGS = @CFLAGS@
 COMPILE = $(CC) $(DEFS) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(AM_CFLAGS) $(CFLAGS)
 LTCOMPILE = $(LIBTOOL) --mode=compile $(CC) $(DEFS) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(AM_CFLAGS) $(CFLAGS)
@@ -383,18 +356,26 @@
 
 TAR = tar
 GZIP_ENV = --best
-SOURCES = login.c su.c groups.c id.c sulogin.c faillog.c lastlog.c chage.c chfn.c chsh.c expiry.c gpasswd.c newgrp.c passwd.c chpasswd.c dpasswd.c groupadd.c groupdel.c groupmod.c logoutd.c mkpasswd.c newusers.c useradd.c userdel.c usermod.c grpck.c pwck.c vipw.c grpconv.c grpunconv.c pwconv.c pwunconv.c
-OBJECTS = login.o su.o groups.o id.o sulogin.o faillog.o lastlog.o chage.o chfn.o chsh.o expiry.o gpasswd.o newgrp.o passwd.o chpasswd.o dpasswd.o groupadd.o groupdel.o groupmod.o logoutd.o mkpasswd.o newusers.o useradd.o userdel.o usermod.o grpck.o pwck.o vipw.o grpconv.o grpunconv.o pwconv.o pwunconv.o
+DEP_FILES =  .deps/chage.P .deps/chfn.P .deps/chpasswd.P .deps/chsh.P \
+.deps/cppw.P .deps/dpasswd.P .deps/expiry.P .deps/faillog.P \
+.deps/gpasswd.P .deps/groupadd.P .deps/groupdel.P .deps/groupmod.P \
+.deps/groups.P .deps/grpck.P .deps/grpconv.P .deps/grpunconv.P \
+.deps/id.P .deps/lastlog.P .deps/login.P .deps/logoutd.P \
+.deps/mkpasswd.P .deps/newgrp.P .deps/newusers.P .deps/passwd.P \
+.deps/pwck.P .deps/pwconv.P .deps/pwunconv.P .deps/su.P .deps/sulogin.P \
+.deps/useradd.P .deps/userdel.P .deps/usermod.P .deps/vipw.P
+SOURCES = login.c su.c groups.c id.c sulogin.c faillog.c lastlog.c chage.c chfn.c chsh.c expiry.c gpasswd.c newgrp.c passwd.c chpasswd.c dpasswd.c groupadd.c groupdel.c groupmod.c logoutd.c mkpasswd.c newusers.c useradd.c userdel.c usermod.c grpck.c pwck.c vipw.c grpconv.c grpunconv.c pwconv.c pwunconv.c cppw.c
+OBJECTS = login.o su.o groups.o id.o sulogin.o faillog.o lastlog.o chage.o chfn.o chsh.o expiry.o gpasswd.o newgrp.o passwd.o chpasswd.o dpasswd.o groupadd.o groupdel.o groupmod.o logoutd.o mkpasswd.o newusers.o useradd.o userdel.o usermod.o grpck.o pwck.o vipw.o grpconv.o grpunconv.o pwconv.o pwunconv.o cppw.o
 
 all: all-redirect
 .SUFFIXES:
 .SUFFIXES: .S .c .lo .o .s
-$(srcdir)/Makefile.in: Makefile.am $(top_srcdir)/configure.in $(ACLOCAL_M4) 
-	cd $(top_srcdir) && $(AUTOMAKE) --foreign --include-deps src/Makefile
-
-Makefile: $(srcdir)/Makefile.in  $(top_builddir)/config.status
-	cd $(top_builddir) \
-	  && CONFIG_FILES=$(subdir)/$@ CONFIG_HEADERS= $(SHELL) ./config.status
+#$(srcdir)/Makefile.in: Makefile.am $(top_srcdir)/configure.in $(ACLOCAL_M4) 
+#	cd $(top_srcdir) && $(AUTOMAKE) --foreign src/Makefile
+#
+#Makefile: $(srcdir)/Makefile.in  $(top_builddir)/config.status $(BUILT_SOURCES)
+#	cd $(top_builddir) \
+#	  && CONFIG_FILES=$(subdir)/$@ CONFIG_HEADERS= $(SHELL) ./config.status
 
 
 mostlyclean-binPROGRAMS:
@@ -481,9 +462,6 @@
 	  rm -f $(DESTDIR)$(usbindir)/`echo $$p|sed 's/$(EXEEXT)$$//'|sed '$(transform)'|sed 's/$$/$(EXEEXT)/'`; \
 	done
 
-.c.o:
-	$(COMPILE) -c $<
-
 .s.o:
 	$(COMPILE) -c $<
 
@@ -500,9 +478,6 @@
 
 maintainer-clean-compile:
 
-.c.lo:
-	$(LIBTOOL) --mode=compile $(COMPILE) -c $<
-
 .s.lo:
 	$(LIBTOOL) --mode=compile $(COMPILE) -c $<
 
@@ -647,6 +622,10 @@
 	@rm -f pwunconv
 	$(LINK) $(pwunconv_LDFLAGS) $(pwunconv_OBJECTS) $(pwunconv_LDADD) $(LIBS)
 
+cppw: $(cppw_OBJECTS) $(cppw_DEPENDENCIES)
+	@rm -f cppw
+	$(LINK) $(cppw_LDFLAGS) $(cppw_OBJECTS) $(cppw_LDADD) $(LIBS)
+
 tags: TAGS
 
 ID: $(HEADERS) $(SOURCES) $(LISP)
@@ -681,109 +660,53 @@
 subdir = src
 
 distdir: $(DISTFILES)
+	here=`cd $(top_builddir) && pwd`; \
+	top_distdir=`cd $(top_distdir) && pwd`; \
+	distdir=`cd $(distdir) && pwd`; \
+	cd $(top_srcdir) \
+	  && $(AUTOMAKE) --include-deps --build-dir=$$here --srcdir-name=$(top_srcdir) --output-dir=$$top_distdir --foreign src/Makefile
 	@for file in $(DISTFILES); do \
 	  d=$(srcdir); \
 	  if test -d $$d/$$file; then \
-	    cp -pr $$/$$file $(distdir)/$$file; \
+	    cp -pr $$d/$$file $(distdir)/$$file; \
 	  else \
 	    test -f $(distdir)/$$file \
 	    || ln $$d/$$file $(distdir)/$$file 2> /dev/null \
 	    || cp -p $$d/$$file $(distdir)/$$file || :; \
 	  fi; \
 	done
-chage.o: chage.c ../config.h ../lib/rcsid.h ../lib/prototypes.h \
-	../lib/defines.h ../lib/gshadow_.h ../lib/pwio.h \
-	../lib/shadowio.h
-chfn.o: chfn.c ../config.h ../lib/rcsid.h ../lib/prototypes.h \
-	../lib/defines.h ../lib/gshadow_.h ../lib/pwio.h \
-	../lib/getdef.h ../lib/pwauth.h
-chpasswd.o: chpasswd.c ../config.h ../lib/rcsid.h ../lib/prototypes.h \
-	../lib/defines.h ../lib/gshadow_.h ../lib/pwio.h \
-	../lib/shadowio.h
-chsh.o: chsh.c ../config.h ../lib/rcsid.h ../lib/prototypes.h \
-	../lib/defines.h ../lib/gshadow_.h ../lib/pwio.h \
-	../lib/getdef.h ../lib/pwauth.h
-dpasswd.o: dpasswd.c ../config.h ../lib/rcsid.h ../lib/prototypes.h \
-	../lib/defines.h ../lib/gshadow_.h ../lib/dialup.h
-expiry.o: expiry.c ../config.h ../lib/rcsid.h ../lib/prototypes.h \
-	../lib/defines.h ../lib/gshadow_.h
-faillog.o: faillog.c ../config.h ../lib/rcsid.h ../lib/prototypes.h \
-	../lib/defines.h ../lib/gshadow_.h ../lib/faillog.h
-gpasswd.o: gpasswd.c ../config.h ../lib/rcsid.h ../lib/prototypes.h \
-	../lib/defines.h ../lib/gshadow_.h ../lib/groupio.h \
-	../lib/sgroupio.h
-groupadd.o: groupadd.c ../config.h ../lib/rcsid.h ../lib/defines.h \
-	../lib/gshadow_.h ../lib/prototypes.h ../libmisc/chkname.h \
-	../lib/getdef.h ../lib/groupio.h ../lib/sgroupio.h
-groupdel.o: groupdel.c ../config.h ../lib/rcsid.h ../lib/prototypes.h \
-	../lib/defines.h ../lib/gshadow_.h ../lib/groupio.h \
-	../lib/sgroupio.h
-groupmod.o: groupmod.c ../config.h ../lib/rcsid.h ../lib/prototypes.h \
-	../lib/defines.h ../lib/gshadow_.h ../libmisc/chkname.h \
-	../lib/groupio.h ../lib/sgroupio.h
-groups.o: groups.c ../config.h ../lib/rcsid.h ../lib/prototypes.h \
-	../lib/defines.h ../lib/gshadow_.h
-grpck.o: grpck.c ../config.h ../lib/rcsid.h ../lib/prototypes.h \
-	../lib/defines.h ../lib/gshadow_.h ../libmisc/chkname.h \
-	../lib/commonio.h ../lib/groupio.h ../lib/sgroupio.h
-grpconv.o: grpconv.c ../config.h ../lib/prototypes.h ../lib/defines.h \
-	../lib/gshadow_.h ../lib/groupio.h ../lib/sgroupio.h \
-	../lib/rcsid.h
-grpunconv.o: grpunconv.c ../config.h ../lib/rcsid.h ../lib/prototypes.h \
-	../lib/defines.h ../lib/gshadow_.h ../lib/groupio.h \
-	../lib/sgroupio.h
-id.o: id.c ../config.h ../lib/rcsid.h ../lib/defines.h ../lib/gshadow_.h
-lastlog.o: lastlog.c ../config.h ../lib/rcsid.h ../lib/prototypes.h \
-	../lib/defines.h ../lib/gshadow_.h
-login.o: login.c ../config.h ../lib/rcsid.h ../lib/prototypes.h \
-	../lib/defines.h ../lib/gshadow_.h ../lib/faillog.h \
-	../libmisc/failure.h ../lib/pwauth.h ../lib/getdef.h \
-	../lib/dialchk.h
-logoutd.o: logoutd.c ../config.h ../lib/rcsid.h ../lib/prototypes.h \
-	../lib/defines.h ../lib/gshadow_.h
-mkpasswd.o: mkpasswd.c ../config.h ../lib/rcsid.h ../lib/prototypes.h \
-	../lib/defines.h ../lib/gshadow_.h
-newgrp.o: newgrp.c ../config.h ../lib/rcsid.h ../lib/prototypes.h \
-	../lib/defines.h ../lib/gshadow_.h ../lib/getdef.h
-newusers.o: newusers.c ../config.h ../lib/rcsid.h ../lib/prototypes.h \
-	../lib/defines.h ../lib/gshadow_.h ../lib/getdef.h \
-	../lib/pwio.h ../lib/groupio.h ../lib/shadowio.h
-passwd.o: passwd.c ../config.h ../lib/rcsid.h ../lib/prototypes.h \
-	../lib/defines.h ../lib/gshadow_.h ../lib/pwauth.h \
-	../lib/shadowio.h ../lib/pwio.h ../lib/getdef.h
-pwck.o: pwck.c ../config.h ../lib/rcsid.h ../lib/prototypes.h \
-	../lib/defines.h ../lib/gshadow_.h ../libmisc/chkname.h \
-	../lib/commonio.h ../lib/pwio.h ../lib/shadowio.h
-pwconv.o: pwconv.c ../config.h ../lib/rcsid.h ../lib/prototypes.h \
-	../lib/defines.h ../lib/gshadow_.h ../lib/pwio.h \
-	../lib/shadowio.h ../lib/getdef.h
-pwunconv.o: pwunconv.c ../config.h ../lib/rcsid.h ../lib/defines.h \
-	../lib/gshadow_.h ../lib/prototypes.h ../lib/pwio.h \
-	../lib/shadowio.h
-sulogin.o: sulogin.c ../config.h ../lib/rcsid.h ../lib/prototypes.h \
-	../lib/defines.h ../lib/gshadow_.h ../lib/getdef.h \
-	../lib/pwauth.h
-su.o: su.c ../config.h ../lib/rcsid.h ../lib/prototypes.h \
-	../lib/defines.h ../lib/gshadow_.h ../lib/pwauth.h \
-	../lib/getdef.h
-useradd.o: useradd.c ../config.h ../lib/rcsid.h ../lib/prototypes.h \
-	../lib/defines.h ../lib/gshadow_.h ../libmisc/chkname.h \
-	../lib/pwauth.h ../lib/faillog.h ../lib/groupio.h \
-	../lib/sgroupio.h ../lib/pwio.h ../lib/shadowio.h \
-	../lib/getdef.h
-userdel.o: userdel.c ../config.h ../lib/rcsid.h ../lib/prototypes.h \
-	../lib/defines.h ../lib/gshadow_.h ../lib/getdef.h \
-	../lib/pwauth.h ../lib/groupio.h ../lib/pwio.h \
-	../lib/shadowio.h ../lib/sgroupio.h
-usermod.o: usermod.c ../config.h ../lib/rcsid.h ../lib/prototypes.h \
-	../lib/defines.h ../lib/gshadow_.h ../libmisc/chkname.h \
-	../lib/faillog.h ../lib/pwauth.h ../lib/getdef.h \
-	../lib/groupio.h ../lib/sgroupio.h ../lib/pwio.h \
-	../lib/shadowio.h
-vipw.o: vipw.c ../config.h ../lib/rcsid.h ../lib/defines.h \
-	../lib/gshadow_.h ../lib/prototypes.h ../lib/pwio.h \
-	../lib/shadowio.h ../lib/groupio.h ../lib/sgroupio.h
 
+DEPS_MAGIC := $(shell mkdir .deps > /dev/null 2>&1 || :)
+
+-include $(DEP_FILES)
+
+mostlyclean-depend:
+
+clean-depend:
+
+distclean-depend:
+	-rm -rf .deps
+
+maintainer-clean-depend:
+
+%.o: %.c
+	@echo '$(COMPILE) -c $<'; \
+	$(COMPILE) -Wp,-MD,.deps/$(*F).pp -c $<
+	@-cp .deps/$(*F).pp .deps/$(*F).P; \
+	tr ' ' '\012' < .deps/$(*F).pp \
+	  | sed -e 's/^\\$$//' -e '/^$$/ d' -e '/:$$/ d' -e 's/$$/ :/' \
+	    >> .deps/$(*F).P; \
+	rm .deps/$(*F).pp
+
+%.lo: %.c
+	@echo '$(LTCOMPILE) -c $<'; \
+	$(LTCOMPILE) -Wp,-MD,.deps/$(*F).pp -c $<
+	@-sed -e 's/^\([^:]*\)\.o[ 	]*:/\1.lo \1.o :/' \
+	  < .deps/$(*F).pp > .deps/$(*F).P; \
+	tr ' ' '\012' < .deps/$(*F).pp \
+	  | sed -e 's/^\\$$//' -e '/^$$/ d' -e '/:$$/ d' -e 's/$$/ :/' \
+	    >> .deps/$(*F).P; \
+	rm -f .deps/$(*F).pp
 info-am:
 info: info-am
 dvi-am:
@@ -829,20 +752,20 @@
 mostlyclean-am:  mostlyclean-binPROGRAMS mostlyclean-noinstPROGRAMS \
 		mostlyclean-ubinPROGRAMS mostlyclean-usbinPROGRAMS \
 		mostlyclean-compile mostlyclean-libtool \
-		mostlyclean-tags mostlyclean-generic
+		mostlyclean-tags mostlyclean-depend mostlyclean-generic
 
 mostlyclean: mostlyclean-am
 
 clean-am:  clean-binPROGRAMS clean-noinstPROGRAMS clean-ubinPROGRAMS \
 		clean-usbinPROGRAMS clean-compile clean-libtool \
-		clean-tags clean-generic mostlyclean-am
+		clean-tags clean-depend clean-generic mostlyclean-am
 
 clean: clean-am
 
 distclean-am:  distclean-binPROGRAMS distclean-noinstPROGRAMS \
 		distclean-ubinPROGRAMS distclean-usbinPROGRAMS \
 		distclean-compile distclean-libtool distclean-tags \
-		distclean-generic clean-am
+		distclean-depend distclean-generic clean-am
 	-rm -f libtool
 
 distclean: distclean-am
@@ -852,7 +775,8 @@
 		maintainer-clean-ubinPROGRAMS \
 		maintainer-clean-usbinPROGRAMS maintainer-clean-compile \
 		maintainer-clean-libtool maintainer-clean-tags \
-		maintainer-clean-generic distclean-am
+		maintainer-clean-depend maintainer-clean-generic \
+		distclean-am
 	@echo "This command is intended for maintainers to use;"
 	@echo "it deletes files that may require special tools to rebuild."
 
@@ -870,12 +794,13 @@
 distclean-compile clean-compile maintainer-clean-compile \
 mostlyclean-libtool distclean-libtool clean-libtool \
 maintainer-clean-libtool tags mostlyclean-tags distclean-tags \
-clean-tags maintainer-clean-tags distdir info-am info dvi-am dvi check \
-check-am installcheck-am installcheck install-exec-am install-exec \
-install-data-am install-data install-am install uninstall-am uninstall \
-all-redirect all-am all installdirs mostlyclean-generic \
-distclean-generic clean-generic maintainer-clean-generic clean \
-mostlyclean distclean maintainer-clean
+clean-tags maintainer-clean-tags distdir mostlyclean-depend \
+distclean-depend clean-depend maintainer-clean-depend info-am info \
+dvi-am dvi check check-am installcheck-am installcheck install-exec-am \
+install-exec install-data-am install-data install-am install \
+uninstall-am uninstall all-redirect all-am all installdirs \
+mostlyclean-generic distclean-generic clean-generic \
+maintainer-clean-generic clean mostlyclean distclean maintainer-clean
 
 
 install-exec-hook:
@@ -889,6 +814,7 @@
 	done
 	rm -f $(DESTDIR)$(ubindir)/sg
 	ln -s newgrp $(DESTDIR)$(ubindir)/sg
+	ln -s cpgr $(DESTDIR)$(ubindir)/cppw
 
 # Tell versions [3.59,3.63) of GNU make to not export all variables.
 # Otherwise a system limit (for SysV at least) may be exceeded.
