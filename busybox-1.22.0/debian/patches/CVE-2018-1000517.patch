From: Markus Koschany <apo@debian.org>
Date: Sat, 14 Jul 2018 19:37:27 +0200
Subject: CVE-2018-1000517

Bug-Debian: https://bugs.debian.org/902724
Origin: https://git.busybox.net/busybox/commit/?id=8e2174e9bd836e53c8b9c6e00d1bc6e2a718686e
---
 networking/wget.c | 5 ++++-
 1 file changed, 4 insertions(+), 1 deletion(-)

diff --git a/networking/wget.c b/networking/wget.c
index d6c509e..8fdec43 100644
--- a/networking/wget.c
+++ b/networking/wget.c
@@ -431,7 +431,7 @@ static FILE* prepare_ftp_session(FILE **dfpp, struct host_info *target, len_and_
 	if (ftpcmd("SIZE ", target->path, sfp) == 213) {
 		G.content_len = BB_STRTOOFF(G.wget_buf + 4, NULL, 10);
 		if (G.content_len < 0 || errno) {
-			bb_error_msg_and_die("SIZE value is garbage");
+			bb_error_msg_and_die("bad SIZE value '%s'", G.wget_buf + 4);
 		}
 		G.got_clen = 1;
 	}
@@ -591,8 +591,11 @@ static void NOINLINE retrieve_file_data(FILE *dfp)
 		fgets_and_trim(dfp); /* Eat empty line */
  get_clen:
 		fgets_and_trim(dfp);
+		errno = 0;
 		G.content_len = STRTOOFF(G.wget_buf, NULL, 16);
 		/* FIXME: error check? */
+		if (G.content_len < 0 || errno)
+			bb_error_msg_and_die("bad chunk length '%s'", G.wget_buf);
 		if (G.content_len == 0)
 			break; /* all done! */
 		G.got_clen = 1;
