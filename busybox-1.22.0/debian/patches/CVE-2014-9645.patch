From: Markus Koschany <apo@debian.org>
Date: Sat, 14 Jul 2018 18:53:12 +0200
Subject: CVE-2014-9645

Bug-Debian: https://bugs.debian.org/cgi-bin/bugreport.cgi?bug=776186
Origin: http://git.busybox.net/busybox/commit/?id=4e314faa0aecb66717418e9a47a4451aec59262b
---
 modutils/modprobe.c | 11 +++++++++++
 1 file changed, 11 insertions(+)

diff --git a/modutils/modprobe.c b/modutils/modprobe.c
index 3ed5c1b..47cc2fb 100644
--- a/modutils/modprobe.c
+++ b/modutils/modprobe.c
@@ -239,6 +239,17 @@ static void add_probe(const char *name)
 {
 	struct module_entry *m;
 
+	/*
+	 * get_or_add_modentry() strips path from name and works
+	 * on remaining basename.
+	 * This would make "rmmod dir/name" and "modprobe dir/name"
+	 * to work like "rmmod name" and "modprobe name",
+	 * which is wrong, and can be abused via implicit modprobing:
+	 * "ifconfig /usbserial up" tries to modprobe netdev-/usbserial.
+	 */
+	if (strchr(name, '/'))
+		bb_error_msg_and_die("malformed module name '%s'", name);
+
 	m = get_or_add_modentry(name);
 	if (!(option_mask32 & (OPT_REMOVE | OPT_SHOW_DEPS))
 	 && (m->flags & (MODULE_FLAG_LOADED | MODULE_FLAG_BUILTIN))
