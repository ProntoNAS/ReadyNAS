<!-- ***** BEGIN LICENSE BLOCK *****
  Source last modified: $Id: multitarget.html,v 1.1.1.1 2006/03/29 16:45:39 hagi Exp $
  
  Portions Copyright (c) 1995-2004 RealNetworks, Inc. All Rights Reserved.
  
  The contents of this file, and the files included with this file,
  are subject to the current version of the RealNetworks Public
  Source License (the "RPSL") available at
  http://www.helixcommunity.org/content/rpsl unless you have licensed
  the file under the current version of the RealNetworks Community
  Source License (the "RCSL") available at
  http://www.helixcommunity.org/content/rcsl, in which case the RCSL
  will apply. You may also obtain the license terms directly from
  RealNetworks.  You may not use this file except in compliance with
  the RPSL or, if you have a valid RCSL with RealNetworks applicable
  to this file, the RCSL.  Please see the applicable RPSL or RCSL for
  the rights, obligations and limitations governing use of the
  contents of the file.
  
  Alternatively, the contents of this file may be used under the
  terms of the GNU General Public License Version 2 or later (the
  "GPL") in which case the provisions of the GPL are applicable
  instead of those above. If you wish to allow use of your version of
  this file only under the terms of the GPL, and not to allow others
  to use your version of this file under the terms of either the RPSL
  or RCSL, indicate your decision by deleting the provisions above
  and replace them with the notice and other provisions required by
  the GPL. If you do not delete the provisions above, a recipient may
  use your version of this file under the terms of any one of the
  RPSL, the RCSL or the GPL.
  
  This file is part of the Helix DNA Technology. RealNetworks is the
  developer of the Original Code and owns the copyrights in the
  portions it created.
  
  This file, and the files included with this file, is distributed
  and made available on an 'AS IS' basis, WITHOUT WARRANTY OF ANY
  KIND, EITHER EXPRESS OR IMPLIED, AND REALNETWORKS HEREBY DISCLAIMS
  ALL SUCH WARRANTIES, INCLUDING WITHOUT LIMITATION, ANY WARRANTIES
  OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE, QUIET
  ENJOYMENT OR NON-INFRINGEMENT.
  
  Technology Compatibility Kit Test Suite(s) Location:
     http://www.helixcommunity.org/content/tck
  
  Contributor(s):
  
  ***** END LICENSE BLOCK *****
-->
<html>
<head><title>Multi-Target Umake files</title></head>
<body bgcolor="#ffffff">

<h1>Multi-Target Umake files</h1>
<hr>

<p>A Top-level Umakefil defines sub-targets in the module with the statement:</p>
<pre>
MultiTargetMake("target1", "target2", ...)
</pre>

<p>In addition to this, you can optionally call UseCommonObjects() before
the MutiTargetMake() call.  UseCommonObjects() is a optimization hint
which tells Umake it can use object files which may have been compiled
by one of the other targets instead of compiling a separate copy.
This can only be used if you are sure the objects from the two targets
are compiled identically.  This means the same defines, include paths, 
etc.</p>
<pre>
TODO: add something to multi-target specification to define what platforms
      a target builds on; the problem with this is we will have
      platform/target determination in two locations, the BIF file and
      the Umakefil which isn't good either
</pre>

<p>Instead of listing *.pcf files in the Umakefil, the new MultiTargetMake
acts more like single target Umake.  Let's review how single target
Umake works for a target.  When Umake is invoked, a series of .pcf files
are executed, ending with the Umakefil itself.  The .pcf files are
determined by the platform Umake is being run on.  Under 
linux-2.0-libc6-i386, the following files would be executed, if they exist:</p>
<ol>
  <li>unix.pcf</li>
  <li>linux.pcf</li>
  <li>linux2.pcf</li>
  <li>Umakefil</li>
</ol>

<p>The old multi-target make syntax made it impossible to emulate 
this .pcf file execution behavior for sub-targets.  This is now fixed.
MultiTargetMake("target1", "target2") would exec the following .pcf files:</p>
<ol>
  <li>unix.pcf</li>
  <li>target1_unix.pcf</li>
  <li>linux2.pcf</li>
  <li>target1_linux2.pcf</li>
  <li>all.pcf</li>
  <li>target1</li>
  <li>unix.pcf</li>
  <li>target2_unix.pcf</li>
  <li>linux2.pcf</li>
  <li>target2_linux2.pcf</li>
  <li>all.pcf</li>
  <li>target2</li>
</ol>
   
<p>Remember these files are not mandatory -- the are only executed
if they are there.</p>

<p>You no longer have to list out the .pcf files for execution.  The .pcf 
file names are the same as those used in single-target Umake, except
for the <b>targetname</b>_ prepended to them.  Notice the single-target .pcf
files are also executed for each target.  This is a mechanism for keeping
platform data global to all the targets in one place.</p>

<p>The new "all.pcf" file is executes for all sub-targets, no matter what
platform you are on.  It's there to help keep only a single copy of 
data which otherwise may have to be replicated in both the "target1" and
"target2" umake files.</p>

<p>If you want to want to know what files will be executed for a particular
platform, look in the build/umake/*.cf files.  Near the top of the file,
there's a line:</p>
<pre>
platform.pcf_prefix_list = [ ... ]
</pre>

<p>This lists the .pcf file execution in the correct order.  There are no
problems adding to this list for a particular platform.  For example,
the linux-2.0-libc6-i386 platform has:</p>
<pre>
platform.pcf_prefix_list = ['unix', 'linux2']
</pre>

<p>It may make be necessary to add "linux-i386" to all Linux/i386 platforms
to include some set of assembly objects.</p>

</body>
</html>
