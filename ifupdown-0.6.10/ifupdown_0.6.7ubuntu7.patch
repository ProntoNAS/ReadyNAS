Binary files 0.6.7/_darcs/current/execution.dia and 0.6.7ubuntu7/_darcs/current/execution.dia differ
Binary files 0.6.7/_darcs/current/modules.dia and 0.6.7ubuntu7/_darcs/current/modules.dia differ
Binary files 0.6.7/_darcs/patches/20050322184259-48b0a-3d7d00a0c38d726902f24ae37090ed7af95dc35b.gz and 0.6.7ubuntu7/_darcs/patches/20050322184259-48b0a-3d7d00a0c38d726902f24ae37090ed7af95dc35b.gz differ
Binary files 0.6.7/_darcs/patches/20050322185711-48b0a-265b47864d2d5eb1b5e40dcae77f4234e83e1e09.gz and 0.6.7ubuntu7/_darcs/patches/20050322185711-48b0a-265b47864d2d5eb1b5e40dcae77f4234e83e1e09.gz differ
Binary files 0.6.7/_darcs/patches/20050322185930-48b0a-899f2c66d03fccd88c81a91a27ad918e83df8241.gz and 0.6.7ubuntu7/_darcs/patches/20050322185930-48b0a-899f2c66d03fccd88c81a91a27ad918e83df8241.gz differ
Binary files 0.6.7/_darcs/patches/20050322190943-48b0a-e970d73397730c0825bb9d37e0ac15607857ce11.gz and 0.6.7ubuntu7/_darcs/patches/20050322190943-48b0a-e970d73397730c0825bb9d37e0ac15607857ce11.gz differ
Binary files 0.6.7/_darcs/patches/20050322191425-48b0a-338ca9e6e811ee13e25fcac84c499fa6ee5b81f6.gz and 0.6.7ubuntu7/_darcs/patches/20050322191425-48b0a-338ca9e6e811ee13e25fcac84c499fa6ee5b81f6.gz differ
Binary files 0.6.7/_darcs/patches/20050325172759-48b0a-b001b9856880f508cee8ff667615da2c16df3158.gz and 0.6.7ubuntu7/_darcs/patches/20050325172759-48b0a-b001b9856880f508cee8ff667615da2c16df3158.gz differ
Binary files 0.6.7/_darcs/patches/20050325172831-48b0a-6d40f49e987c5c8dbf4ad2f0f6285d84fb51e3fb.gz and 0.6.7ubuntu7/_darcs/patches/20050325172831-48b0a-6d40f49e987c5c8dbf4ad2f0f6285d84fb51e3fb.gz differ
Binary files 0.6.7/_darcs/patches/20050325173048-48b0a-f17b1c4e81302f32ea5341c165c72335487c4e0d.gz and 0.6.7ubuntu7/_darcs/patches/20050325173048-48b0a-f17b1c4e81302f32ea5341c165c72335487c4e0d.gz differ
Binary files 0.6.7/_darcs/patches/20050325173537-48b0a-404f6e17843f4e0292bf258e5542e9802a159b14.gz and 0.6.7ubuntu7/_darcs/patches/20050325173537-48b0a-404f6e17843f4e0292bf258e5542e9802a159b14.gz differ
Binary files 0.6.7/_darcs/patches/20050325174738-48b0a-508807aae413654455d5d3c00c7717af85ee4c17.gz and 0.6.7ubuntu7/_darcs/patches/20050325174738-48b0a-508807aae413654455d5d3c00c7717af85ee4c17.gz differ
Binary files 0.6.7/_darcs/patches/20050325174749-48b0a-61da41cded8e77e4347a964ee2111d9b21a2ceea.gz and 0.6.7ubuntu7/_darcs/patches/20050325174749-48b0a-61da41cded8e77e4347a964ee2111d9b21a2ceea.gz differ
Binary files 0.6.7/_darcs/patches/20050325174926-48b0a-935743f08e999b2ddb6041e3fbd29ec1298555d8.gz and 0.6.7ubuntu7/_darcs/patches/20050325174926-48b0a-935743f08e999b2ddb6041e3fbd29ec1298555d8.gz differ
Binary files 0.6.7/_darcs/patches/20050326151125-48b0a-c2ed89301d3a7a42fed7174513023f9067a1a347.gz and 0.6.7ubuntu7/_darcs/patches/20050326151125-48b0a-c2ed89301d3a7a42fed7174513023f9067a1a347.gz differ
Binary files 0.6.7/_darcs/patches/20050326151130-48b0a-e655ac6f135e14c6f088be1a687c07774c58e96d.gz and 0.6.7ubuntu7/_darcs/patches/20050326151130-48b0a-e655ac6f135e14c6f088be1a687c07774c58e96d.gz differ
Binary files 0.6.7/_darcs/patches/20050331140306-48b0a-192b390dc5d22de8e61d5e3c21370d44bca6726e.gz and 0.6.7ubuntu7/_darcs/patches/20050331140306-48b0a-192b390dc5d22de8e61d5e3c21370d44bca6726e.gz differ
Binary files 0.6.7/_darcs/patches/20050403071601-48b0a-277064f82b402d73dd3e9f4dc18edec161e592f8.gz and 0.6.7ubuntu7/_darcs/patches/20050403071601-48b0a-277064f82b402d73dd3e9f4dc18edec161e592f8.gz differ
Binary files 0.6.7/_darcs/patches/20050403130722-48b0a-cc5a3bf9eb540a9ba9e130626912237e96a9609d.gz and 0.6.7ubuntu7/_darcs/patches/20050403130722-48b0a-cc5a3bf9eb540a9ba9e130626912237e96a9609d.gz differ
Binary files 0.6.7/_darcs/patches/20050403133706-48b0a-ac0145fc85e019fecf12356618aa3ecc6aef73ff.gz and 0.6.7ubuntu7/_darcs/patches/20050403133706-48b0a-ac0145fc85e019fecf12356618aa3ecc6aef73ff.gz differ
Binary files 0.6.7/_darcs/patches/20050403142603-48b0a-ea9f259b5bc7061a3cfcb23e791d27dcaffbb898.gz and 0.6.7ubuntu7/_darcs/patches/20050403142603-48b0a-ea9f259b5bc7061a3cfcb23e791d27dcaffbb898.gz differ
Binary files 0.6.7/_darcs/patches/20050403150334-48b0a-1bec190d7c5130a0de8b79579a1e664bdfe6303f.gz and 0.6.7ubuntu7/_darcs/patches/20050403150334-48b0a-1bec190d7c5130a0de8b79579a1e664bdfe6303f.gz differ
Binary files 0.6.7/_darcs/patches/20050403150343-48b0a-02e148db83abd6cd9f9e6ec53a2a1916a38a61cb.gz and 0.6.7ubuntu7/_darcs/patches/20050403150343-48b0a-02e148db83abd6cd9f9e6ec53a2a1916a38a61cb.gz differ
Binary files 0.6.7/_darcs/patches/20050403150657-48b0a-15ca5d98146a5b255dd993de9e8ccb07ce586b20.gz and 0.6.7ubuntu7/_darcs/patches/20050403150657-48b0a-15ca5d98146a5b255dd993de9e8ccb07ce586b20.gz differ
Binary files 0.6.7/_darcs/patches/20050403150711-48b0a-b7a219596d7793c014e937d477b07e8cf5cf9033.gz and 0.6.7ubuntu7/_darcs/patches/20050403150711-48b0a-b7a219596d7793c014e937d477b07e8cf5cf9033.gz differ
Binary files 0.6.7/_darcs/patches/20050403150728-48b0a-ad57c1b54ea04699dd8454be692cf0ac25c599de.gz and 0.6.7ubuntu7/_darcs/patches/20050403150728-48b0a-ad57c1b54ea04699dd8454be692cf0ac25c599de.gz differ
Binary files 0.6.7/_darcs/patches/20050403154821-48b0a-c05c4823816cc11771bd66a8eef9baa14ff29e1e.gz and 0.6.7ubuntu7/_darcs/patches/20050403154821-48b0a-c05c4823816cc11771bd66a8eef9baa14ff29e1e.gz differ
Binary files 0.6.7/_darcs/patches/20050403155657-48b0a-a78731fa7b94026a1bce3d86ec14703e4595ad21.gz and 0.6.7ubuntu7/_darcs/patches/20050403155657-48b0a-a78731fa7b94026a1bce3d86ec14703e4595ad21.gz differ
Binary files 0.6.7/_darcs/patches/20050403160939-48b0a-69fa8a1fcabd5f848efb68b6efb17d88ea9846e2.gz and 0.6.7ubuntu7/_darcs/patches/20050403160939-48b0a-69fa8a1fcabd5f848efb68b6efb17d88ea9846e2.gz differ
Binary files 0.6.7/_darcs/patches/20050403160952-48b0a-858bcd92fe2ecda0dff3f0f2d6f4bb88791dd336.gz and 0.6.7ubuntu7/_darcs/patches/20050403160952-48b0a-858bcd92fe2ecda0dff3f0f2d6f4bb88791dd336.gz differ
Binary files 0.6.7/_darcs/patches/20050403161110-48b0a-710fb33717b518175348f16756bc6248934ae15a.gz and 0.6.7ubuntu7/_darcs/patches/20050403161110-48b0a-710fb33717b518175348f16756bc6248934ae15a.gz differ
Binary files 0.6.7/_darcs/patches/20050403161538-48b0a-75ab76ed9925211a1b83efde1cc4a213f429a7be.gz and 0.6.7ubuntu7/_darcs/patches/20050403161538-48b0a-75ab76ed9925211a1b83efde1cc4a213f429a7be.gz differ
Binary files 0.6.7/_darcs/patches/20050403161611-48b0a-5dc34a325877de7548d9f4636b75e75d71f8344c.gz and 0.6.7ubuntu7/_darcs/patches/20050403161611-48b0a-5dc34a325877de7548d9f4636b75e75d71f8344c.gz differ
Binary files 0.6.7/_darcs/patches/20050403161634-48b0a-9010b91cdccf9ad2cffd13e848384692469232bd.gz and 0.6.7ubuntu7/_darcs/patches/20050403161634-48b0a-9010b91cdccf9ad2cffd13e848384692469232bd.gz differ
Binary files 0.6.7/_darcs/patches/20050403161830-48b0a-4cbfbff1753740cb4e4e72b6309621f170caeaae.gz and 0.6.7ubuntu7/_darcs/patches/20050403161830-48b0a-4cbfbff1753740cb4e4e72b6309621f170caeaae.gz differ
Binary files 0.6.7/_darcs/patches/20050403164423-48b0a-f4c3920fcf3caefba1297b1ade7338990f1c859f.gz and 0.6.7ubuntu7/_darcs/patches/20050403164423-48b0a-f4c3920fcf3caefba1297b1ade7338990f1c859f.gz differ
Binary files 0.6.7/_darcs/patches/20050403164757-48b0a-8ad09d3f62ee0d157e4648a67ef16f680abe8933.gz and 0.6.7ubuntu7/_darcs/patches/20050403164757-48b0a-8ad09d3f62ee0d157e4648a67ef16f680abe8933.gz differ
Binary files 0.6.7/_darcs/patches/20050403164804-48b0a-e909e1e9ed995134a316a22ebc1ffa8d5b3f633a.gz and 0.6.7ubuntu7/_darcs/patches/20050403164804-48b0a-e909e1e9ed995134a316a22ebc1ffa8d5b3f633a.gz differ
Binary files 0.6.7/_darcs/patches/20050403170911-48b0a-1b052d27df2f8d7764bd5aa71c832aa5f73aa122.gz and 0.6.7ubuntu7/_darcs/patches/20050403170911-48b0a-1b052d27df2f8d7764bd5aa71c832aa5f73aa122.gz differ
Binary files 0.6.7/_darcs/patches/20050403170919-48b0a-40bc9c8afdf3b2ec6cfb9cc84222991be5495c23.gz and 0.6.7ubuntu7/_darcs/patches/20050403170919-48b0a-40bc9c8afdf3b2ec6cfb9cc84222991be5495c23.gz differ
Binary files 0.6.7/_darcs/patches/20050404011259-48b0a-db60e8597853894dc22ff0226ecf8ea7dfb2bd0f.gz and 0.6.7ubuntu7/_darcs/patches/20050404011259-48b0a-db60e8597853894dc22ff0226ecf8ea7dfb2bd0f.gz differ
Binary files 0.6.7/_darcs/patches/20050404030039-48b0a-993cd391cfa3d828a35b52da39abed02d69d4d50.gz and 0.6.7ubuntu7/_darcs/patches/20050404030039-48b0a-993cd391cfa3d828a35b52da39abed02d69d4d50.gz differ
Binary files 0.6.7/_darcs/patches/20050404030209-48b0a-3d326cb89210df162b267bc2120ca20066deb39e.gz and 0.6.7ubuntu7/_darcs/patches/20050404030209-48b0a-3d326cb89210df162b267bc2120ca20066deb39e.gz differ
Binary files 0.6.7/_darcs/patches/20050404030334-48b0a-49ae19612c6b7d8211c6b89239397064c53f7cdf.gz and 0.6.7ubuntu7/_darcs/patches/20050404030334-48b0a-49ae19612c6b7d8211c6b89239397064c53f7cdf.gz differ
Binary files 0.6.7/_darcs/patches/20050404111917-48b0a-3666132d54f974fa92dd5402d4570d505724c04e.gz and 0.6.7ubuntu7/_darcs/patches/20050404111917-48b0a-3666132d54f974fa92dd5402d4570d505724c04e.gz differ
Binary files 0.6.7/_darcs/patches/20050404111950-48b0a-360b54b858475ae4e78e2ef4c6e0d84b2dd6a56c.gz and 0.6.7ubuntu7/_darcs/patches/20050404111950-48b0a-360b54b858475ae4e78e2ef4c6e0d84b2dd6a56c.gz differ
Binary files 0.6.7/_darcs/patches/20050404153209-48b0a-169d4444f3c27466a8d7a3d56ddb15f41d1bb5f1.gz and 0.6.7ubuntu7/_darcs/patches/20050404153209-48b0a-169d4444f3c27466a8d7a3d56ddb15f41d1bb5f1.gz differ
Binary files 0.6.7/_darcs/patches/20050405164755-48b0a-e33319257ad5608206f0abf53c6adf7eb9a3764b.gz and 0.6.7ubuntu7/_darcs/patches/20050405164755-48b0a-e33319257ad5608206f0abf53c6adf7eb9a3764b.gz differ
Binary files 0.6.7/_darcs/patches/20050405164913-48b0a-6cb47dfd47e9259a9c588c9a61fc8cf4086d61cd.gz and 0.6.7ubuntu7/_darcs/patches/20050405164913-48b0a-6cb47dfd47e9259a9c588c9a61fc8cf4086d61cd.gz differ
Binary files 0.6.7/_darcs/patches/20050405164921-48b0a-31ba4f33e19477ff10a68ddb24c6bbd7aad63d0d.gz and 0.6.7ubuntu7/_darcs/patches/20050405164921-48b0a-31ba4f33e19477ff10a68ddb24c6bbd7aad63d0d.gz differ
Binary files 0.6.7/_darcs/patches/20050405164951-48b0a-c06ed2064f300df62ea7b8b18994d3a314e3b6b3.gz and 0.6.7ubuntu7/_darcs/patches/20050405164951-48b0a-c06ed2064f300df62ea7b8b18994d3a314e3b6b3.gz differ
Binary files 0.6.7/_darcs/patches/20050405173454-48b0a-7dd75d1a00e8a35a038628a6fceae4eca9e31fd3.gz and 0.6.7ubuntu7/_darcs/patches/20050405173454-48b0a-7dd75d1a00e8a35a038628a6fceae4eca9e31fd3.gz differ
Binary files 0.6.7/_darcs/patches/20050405173752-48b0a-3437c72ae180a5c8357dca7a79f16976dd904b10.gz and 0.6.7ubuntu7/_darcs/patches/20050405173752-48b0a-3437c72ae180a5c8357dca7a79f16976dd904b10.gz differ
Binary files 0.6.7/_darcs/patches/20050416142311-48b0a-2cc01e8f4873f2281ecea741c173d52e64b2f6ba.gz and 0.6.7ubuntu7/_darcs/patches/20050416142311-48b0a-2cc01e8f4873f2281ecea741c173d52e64b2f6ba.gz differ
Binary files 0.6.7/_darcs/patches/20050423030949-48b0a-07da52fd9e90c570754aff473397bbad371dd748.gz and 0.6.7ubuntu7/_darcs/patches/20050423030949-48b0a-07da52fd9e90c570754aff473397bbad371dd748.gz differ
Binary files 0.6.7/_darcs/patches/20050502135743-bb3ee-eec9c722232316e0040f3ee2baa9df3f4ecd1514.gz and 0.6.7ubuntu7/_darcs/patches/20050502135743-bb3ee-eec9c722232316e0040f3ee2baa9df3f4ecd1514.gz differ
diff -pruN 0.6.7/_darcs/prefs/author 0.6.7ubuntu7/_darcs/prefs/author
--- 0.6.7/_darcs/prefs/author	2005-05-02 14:57:49.000000000 +0100
+++ 0.6.7ubuntu7/_darcs/prefs/author	2005-05-12 12:49:59.000000000 +0100
@@ -1 +1 @@
-aj@azure.humbug.org.au
\ No newline at end of file
+aj@azure.humbug.org.au
diff -pruN 0.6.7/addrfam.c 0.6.7ubuntu7/addrfam.c
--- 0.6.7/addrfam.c	2005-05-02 14:58:06.000000000 +0100
+++ 0.6.7ubuntu7/addrfam.c	2006-01-26 15:59:34.000000000 +0000
@@ -2,21 +2,21 @@
 #include <stdlib.h>
 #include "header.h"
 
-#line 3825 "ifupdown.nw"
+#line 3867 "ifupdown.nw"
 extern address_family addr_inet;
-#line 4005 "ifupdown.nw"
+#line 4047 "ifupdown.nw"
 extern address_family addr_inet6;
-#line 4076 "ifupdown.nw"
+#line 4118 "ifupdown.nw"
 extern address_family addr_ipx;
 
 #line 455 "ifupdown.nw"
 address_family *addr_fams[] = {
 	
-#line 3829 "ifupdown.nw"
+#line 3871 "ifupdown.nw"
 &addr_inet, 
-#line 4009 "ifupdown.nw"
+#line 4051 "ifupdown.nw"
 &addr_inet6,
-#line 4080 "ifupdown.nw"
+#line 4122 "ifupdown.nw"
 &addr_ipx,
 #line 457 "ifupdown.nw"
 	NULL
diff -pruN 0.6.7/archlinux.c 0.6.7ubuntu7/archlinux.c
--- 0.6.7/archlinux.c	2005-05-02 14:58:05.000000000 +0100
+++ 0.6.7ubuntu7/archlinux.c	2006-01-26 15:59:33.000000000 +0000
@@ -1,4 +1,4 @@
-#line 3782 "ifupdown.nw"
+#line 3824 "ifupdown.nw"
 #include <stdio.h>
 #include <stdlib.h>
 #include <string.h>
diff -pruN 0.6.7/archlinux.h 0.6.7ubuntu7/archlinux.h
--- 0.6.7/archlinux.h	2005-05-02 14:58:06.000000000 +0100
+++ 0.6.7ubuntu7/archlinux.h	2006-01-26 15:59:34.000000000 +0000
@@ -1,4 +1,4 @@
-#line 3776 "ifupdown.nw"
+#line 3818 "ifupdown.nw"
 unsigned int mylinuxver();
 unsigned int mylinux(int,int,int);
 int execable(char *);
diff -pruN 0.6.7/contrib/ifstate-check 0.6.7ubuntu7/contrib/ifstate-check
--- 0.6.7/contrib/ifstate-check	2005-04-04 14:33:54.000000000 +0100
+++ 0.6.7ubuntu7/contrib/ifstate-check	2006-01-23 18:56:20.000000000 +0000
@@ -19,7 +19,7 @@
 #    Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
 #
 
-$statefile="/etc/network/run/ifstate";
+$statefile="/var/run/network/ifstate";
 $configfile="/etc/network/interfaces";
 
 open (IFACE,"<$configfile") || die ("Could not open $configfile: $!\n");
diff -pruN 0.6.7/debian/changelog 0.6.7ubuntu7/debian/changelog
--- 0.6.7/debian/changelog	2005-05-02 14:57:40.000000000 +0100
+++ 0.6.7ubuntu7/debian/changelog	2006-01-30 12:48:11.000000000 +0000
@@ -1,3 +1,78 @@
+ifupdown (0.6.7ubuntu7) dapper; urgency=low
+
+  * Fix up the interfaces file removing duplicated "auto" lines, and
+    don't write them in the first place.  Ubuntu #29654.
+
+ -- Scott James Remnant <scott@ubuntu.com>  Mon, 30 Jan 2006 12:45:19 +0000
+
+ifupdown (0.6.7ubuntu6) dapper; urgency=low
+
+  * Rewrite the way that ifup and ifdown read and write the state file.
+    Instead of storing it in memory and holding a lock on it (preventing
+    concurrent processes from actually being concurrent) use atomic read and
+    write functions that only hold the lock for very short periods.
+
+  * Write to the state file when we start bringing up or tearing down the
+    interface, so we don't ever try to do the same operation at the same
+    time.
+  * Update the state file once the operation is complete to ensure we
+    record the actual status of it.
+  
+  * Restore the dhcp wait, so "ifup eth0" will hang around until DHCP is
+    either successful or times out.  Adjust the udev rule again so that
+    udevplug doesn't hang around.
+
+ -- Scott James Remnant <scott@ubuntu.com>  Thu, 26 Jan 2006 15:56:54 +0000
+
+ifupdown (0.6.7ubuntu5) dapper; urgency=low
+
+  * Don't wait for dhcp to complete ... there's a general ifup problem that
+    it doesn't have any state to record "I'm bringing this interface up",
+    so no way to avoid multiple dhcp invocations for the same interface which
+    end up blocking on each other.  This is a short-term hack until I sit
+    down and think about this properly (probably next week at the sprint).
+
+ -- Scott James Remnant <scott@ubuntu.com>  Tue, 24 Jan 2006 18:04:53 +0000
+
+ifupdown (0.6.7ubuntu4) dapper; urgency=low
+
+  * Install new loopback init script at S:S08 which brings up the loopback
+    (127.0.0.1) network device early enough for anything needing DHCP.  This
+    also deals with creating /var/run/network if necessary.
+  * Move /etc/network/run/ifstate to /var/run/network/ifstate
+  * Drop the ifupdown and ifupdown-clean init scripts as everything they did
+    is obsolete or already taken care of.
+  
+  * Ship a udev rule that brings network devices up or down if the device
+    is marked "auto" in the configuration file.
+  * Convert existing /etc/network/interfaces file with "mapping hotplug"
+    lines to just use "auto" lines.
+  
+  * Adjusted "ifup -a" and "ifdown -a" to not report when interfaces are
+    already up or down.
+
+ -- Scott James Remnant <scott@ubuntu.com>  Mon, 23 Jan 2006 18:56:54 +0000
+
+ifupdown (0.6.7ubuntu3) dapper; urgency=low
+
+  * Silence init.d/ifupdown-clean
+
+ -- Matt Zimmerman <mdz@ubuntu.com>  Wed,  4 Jan 2006 09:46:09 -0800
+
+ifupdown (0.6.7ubuntu2) dapper; urgency=low
+
+  * Change the dhclient3 leases path to /var/lib/dhcp3 so the leases survive
+    a reboot.  (Ubuntu: #18148)
+
+ -- Scott James Remnant <scott@ubuntu.com>  Wed, 23 Nov 2005 16:11:30 +0000
+
+ifupdown (0.6.7ubuntu1) breezy; urgency=low
+
+  * Resynchronise with Debian, resolving merge conflicts.
+  * Remove the initscripts dependency, since we now use our own readlink.
+
+ -- Adam Conrad <adconrad@ubuntu.com>  Fri, 27 May 2005 06:43:06 +0000
+
 ifupdown (0.6.7) unstable; urgency=low
 
   * Don't use dirname/basename in ifupdown init script; they're in /usr/bin.
@@ -106,6 +181,32 @@ ifupdown (0.6.4-4.11) unstable; urgency=
 
  -- Thomas Hood <jdthood@yahoo.co.uk>  Sun, 12 Sep 2004 14:46:29 +0200
 
+ifupdown (0.6.4-4.10ubuntu4) breezy; urgency=low
+
+  * Fixed typo in interfaces (5) man page (closes: Ubuntu #9854)
+
+ -- Charles Majola <charles@ubuntu.com>  Thu, 12 May 2005 10:12:36 +0200
+
+ifupdown (0.6.4-4.10ubuntu3) hoary; urgency=low
+
+  * Add a dependency on initscripts (>= 2.85-12) to make sure we get
+    a working /lib/init/readlink for our scripts (Ubuntu bug #8605)
+
+ -- Adam Conrad <adconrad@0c3.net>  Tue,  5 Apr 2005 10:29:07 +0000
+
+ifupdown (0.6.4-4.10ubuntu2) hoary; urgency=low
+
+  * Fancify new ifupdown-clean init script
+  * Re-fancify ifupdown init script due to many conflicts
+
+ -- Matt Zimmerman <mdz@canonical.com>  Thu, 28 Oct 2004 21:00:28 -0700
+
+ifupdown (0.6.4-4.10ubuntu1) hoary; urgency=low
+
+  * Resynchronise with Debian.
+
+ -- Scott James Remnant <scott@canonical.com>  Wed, 27 Oct 2004 21:41:56 +0100
+
 ifupdown (0.6.4-4.10) unstable; urgency=low
 
   * Non-maintainer upload. Fix critical bugs.
@@ -177,6 +278,18 @@ ifupdown (0.6.4-4.9) unstable; urgency=l
  -- Javier Fernandez-Sanguino Pen~a <jfs@computer.org>  Wed, 28 Jul 2004 17:04:19 +0200
 
 
+ifupdown (0.6.4-4.8ubuntu2) warty; urgency=low
+
+  * Added versioned depend on lsb-base
+
+ -- Nathaniel McCallum <npmccallum@canonical.com>  Fri,  3 Sep 2004 14:55:12 -0400
+
+ifupdown (0.6.4-4.8ubuntu1) warty; urgency=low
+
+  * debian/ifupdown.init: pretty initscript
+
+ -- Nathaniel McCallum <npmccallum@canonical.com>  Fri,  3 Sep 2004 11:00:40 -0400
+
 ifupdown (0.6.4-4.8) unstable; urgency=low
 
   * Fix configuration of interfaces with multiple address families.
diff -pruN 0.6.7/debian/conffiles 0.6.7ubuntu7/debian/conffiles
--- 0.6.7/debian/conffiles	2005-04-04 14:33:54.000000000 +0100
+++ 0.6.7ubuntu7/debian/conffiles	2006-01-23 19:03:19.000000000 +0000
@@ -1,3 +1,2 @@
-/etc/init.d/ifupdown
-/etc/init.d/ifupdown-clean
-/etc/default/ifupdown
+/etc/init.d/loopback
+/etc/udev/rules.d/85-ifupdown.rules
diff -pruN 0.6.7/debian/control 0.6.7ubuntu7/debian/control
--- 0.6.7/debian/control	2005-04-04 16:39:17.000000000 +0100
+++ 0.6.7ubuntu7/debian/control	2005-05-27 08:06:44.000000000 +0100
@@ -7,7 +7,7 @@ Build-Depends: debhelper (>= 4.1.68), no
 
 Package: ifupdown
 Architecture: any
-Depends: net-tools, ${shlibs:Depends}, ${debconf-depends}
+Depends: net-tools, ${shlibs:Depends}, ${debconf-depends}, lsb-base (>= 1.3-9ubuntu3)
 Suggests: iproute, dhcp3-client | dhcp-client, ppp
 Replaces: netbase (<< 4.00)
 Description: high level tools to configure network interfaces
diff -pruN 0.6.7/debian/dirs 0.6.7ubuntu7/debian/dirs
--- 0.6.7/debian/dirs	2005-04-04 14:33:54.000000000 +0100
+++ 0.6.7ubuntu7/debian/dirs	2006-01-23 18:39:05.000000000 +0000
@@ -6,3 +6,4 @@ usr/share/man/man5
 usr/share/man/man8
 etc/network
 etc/init.d
+etc/udev/rules.d
diff -pruN 0.6.7/debian/ifupdown-clean.init 0.6.7ubuntu7/debian/ifupdown-clean.init
--- 0.6.7/debian/ifupdown-clean.init	2005-04-04 14:33:54.000000000 +0100
+++ 0.6.7ubuntu7/debian/ifupdown-clean.init	2006-01-04 17:46:08.000000000 +0000
@@ -5,6 +5,8 @@
 
 set -e
 
+. /lib/lsb/init-functions
+
 MYNAME="${0##*/}"
 PATH=/sbin:/bin
 [ -r /etc/default/ifupdown ] && . /etc/default/ifupdown
@@ -17,14 +19,12 @@ IFSTATE=/etc/network/run/ifstate
 
 case "$1" in
   start)
-    echo -n "Cleaning up ifupdown..."
     if [ -f $IFSTATE -a ! -L $IFSTATE ]; then
       rm -f "$IFSTATE"
     elif [ -f $IFSTATE ]; then
       # This is kinda bad :(
       >$IFSTATE
     fi
-    echo "done."
     exit 0
     ;;
 
diff -pruN 0.6.7/debian/ifupdown.init 0.6.7ubuntu7/debian/ifupdown.init
--- 0.6.7/debian/ifupdown.init	2005-05-02 14:57:05.000000000 +0100
+++ 0.6.7ubuntu7/debian/ifupdown.init	2005-05-27 08:06:02.000000000 +0100
@@ -3,9 +3,11 @@
 [ -x /sbin/ifup ] || exit 0
 [ -x /sbin/ifdown ] || exit 0
 
+. /lib/lsb/init-functions
+
 MYNAME="${0##*/}"
 report() { echo "${MYNAME}: $*" ; }
-report_err() { report "Error: $*" >&2 ; }
+report_err() { log_failure_msg "$*" ; }
 RUN_DIR=/etc/network/run
 [ -r /etc/default/ifupdown ] && . /etc/default/ifupdown
 
@@ -50,7 +52,7 @@ case "$1" in
       report_err "Arguments to '$1' command not accepted"
       exit 3
     fi
-    echo -n "Setting up networking..."
+    log_begin_msg "Setting up networking..."
 
     # if /etc/network/run is a symlink to a directory that doesn't exist,
     # create it.
@@ -58,13 +60,13 @@ case "$1" in
     if [ -L "$RUN_DIR" ] && [ ! -d "$RUN_DIR" ] ; then
       runmkdir="$(myreadlink "$RUN_DIR")"
       if [ ! "$runmkdir" ] ; then
-        echo "failed."
         report_err "Cannot create target of /etc/network/run"
+        log_end_msg 1
         exit 1
       fi
       if ! mkdir -p "$runmkdir"; then
-        echo "failed."
         report_err "Failure creating directory $runmkdir"
+        log_end_msg 1
         exit 1
       fi
     fi
@@ -73,13 +75,13 @@ case "$1" in
     # Doing this also signals that ifupdown is available for use
     if [ ! -r "$IFSTATE" ]; then
       if ! : > "$IFSTATE" ; then
-        echo "failed."
         report_err "Failure initializing $IFSTATE"
+        log_end_msg 1
         exit 1
       fi 
     fi
 
-    echo "done."
+    log_end_msg 0
     exit 0
     ;;
 
diff -pruN 0.6.7/debian/ifupdown.rules 0.6.7ubuntu7/debian/ifupdown.rules
--- 0.6.7/debian/ifupdown.rules	1970-01-01 01:00:00.000000000 +0100
+++ 0.6.7ubuntu7/debian/ifupdown.rules	2006-01-26 15:59:24.000000000 +0000
@@ -0,0 +1,13 @@
+# This file causes network devices to be brought up or down as a result
+# of hardware being added or removed, including that which isn't ordinarily
+# removable.
+# See udev(8) for syntax.
+
+SUBSYSTEM!="net", GOTO="net_end"
+
+# Bring devices up and down only if they're marked auto.
+# Use start-stop-daemon so we don't wait on dhcp
+ACTION=="add",		RUN+="/sbin/start-stop-daemon --start --background --pidfile /var/run/network/bogus --startas /sbin/ifup -- --allow auto $env{INTERFACE}"
+ACTION=="remove",	RUN+="/sbin/start-stop-daemon --start --background --pidfile /var/run/network/bogus --startas /sbin/ifdown -- --allow auto $env{INTERFACE}"
+
+LABEL="net_end"
diff -pruN 0.6.7/debian/loopback.init 0.6.7ubuntu7/debian/loopback.init
--- 0.6.7/debian/loopback.init	1970-01-01 01:00:00.000000000 +0100
+++ 0.6.7ubuntu7/debian/loopback.init	2006-01-23 18:47:26.000000000 +0000
@@ -0,0 +1,42 @@
+#!/bin/sh -e
+#
+# loopback - brings up the loopback (127.0.0.1) network device so that
+#            DHCP and other such things will work
+#
+
+# Check the package is still installed
+[ -x /sbin/ifup ] || exit 0
+
+# Get LSB functions
+. /lib/lsb/init-functions
+. /etc/default/rcS
+
+case "$1" in
+    start)
+	[ -d /var/run/network ] || mkdir /var/run/network
+
+	log_begin_msg "Starting basic networking..."
+	if ifup --allow auto lo; then
+	    log_end_msg 0
+	else
+	    log_end_msg $?
+	fi
+	;;
+    stop)
+	log_begin_msg "Stopping basic networking..."
+	if ifdown lo; then
+	    log_end_msg 0
+	else
+	    log_end_msg $?
+	fi
+	;;
+    restart|force-reload)
+	exit 0
+	;;
+    *)
+	echo "Usage: /etc/init.d/loopback {start|stop|restart|force-reload}"
+	exit 1
+	;;
+esac
+
+exit 0
diff -pruN 0.6.7/debian/po/ca.po 0.6.7ubuntu7/debian/po/ca.po
--- 0.6.7/debian/po/ca.po	2005-05-02 14:58:10.000000000 +0100
+++ 0.6.7ubuntu7/debian/po/ca.po	2006-01-23 18:57:15.000000000 +0000
@@ -7,8 +7,8 @@
 msgid ""
 msgstr ""
 "Project-Id-Version: ifupdown-0.6.4-4.6_templates\n"
-"Report-Msgid-Bugs-To: \n"
-"POT-Creation-Date: 2004-08-04 17:16+0200\n"
+"Report-Msgid-Bugs-To: ajt@debian.org\n"
+"POT-Creation-Date: 2006-01-23 18:57+0000\n"
 "PO-Revision-Date: 2004-02-28 19:46GMT\n"
 "Last-Translator: Aleix Badia i Bosch <abadia@ica.es>\n"
 "Language-Team: Debian L10n Catalan <debian-l10n-catalan@lists.debian.org>\n"
@@ -19,17 +19,30 @@ msgstr ""
 #. Type: boolean
 #. Description
 #: ../templates.master:4
+msgid ""
+"The format of /etc/network/interfaces has had a minor but incompatible "
+"change made between version 0.5.x and 0.6.x of ifupdown. It is however "
+"possible to automatically convert from the old format to the new in almost "
+"all cases."
+msgstr ""
+"El format del fitxer /etc/network/interfaces de l'ifupdown s'ha modificat "
+"entre les versions 0.5.x i 0.6.x. Tot i aix√≤, en la majoria dels casos es "
+"pot actualitzar autom√†ticament del format vell al nou."
+
+#. Type: boolean
+#. Description
+#: ../templates.master:13
 msgid "Update /etc/network/interfaces?"
 msgstr "Voleu actualitzar el fitxer /etc/network/interfaces?"
 
 #. Type: boolean
 #. Description
-#: ../templates.master:4
+#: ../templates.master:13
+#, fuzzy
 msgid ""
 "The format of /etc/network/interfaces has had a minor but incompatible "
-"change made between version 0.5.x and 0.6.x of ifupdown. It is however "
-"possible to automatically convert from the old format to the new in almost "
-"all cases."
+"change made for dapper. It is however possible to automatically convert from "
+"the old format to the new in almost all cases."
 msgstr ""
 "El format del fitxer /etc/network/interfaces de l'ifupdown s'ha modificat "
 "entre les versions 0.5.x i 0.6.x. Tot i aix√≤, en la majoria dels casos es "
diff -pruN 0.6.7/debian/po/cs.po 0.6.7ubuntu7/debian/po/cs.po
--- 0.6.7/debian/po/cs.po	2005-05-02 14:58:10.000000000 +0100
+++ 0.6.7ubuntu7/debian/po/cs.po	2006-01-23 18:57:15.000000000 +0000
@@ -14,8 +14,8 @@
 msgid ""
 msgstr ""
 "Project-Id-Version: ifupdown\n"
-"Report-Msgid-Bugs-To: \n"
-"POT-Creation-Date: 2004-08-04 17:16+0200\n"
+"Report-Msgid-Bugs-To: ajt@debian.org\n"
+"POT-Creation-Date: 2006-01-23 18:57+0000\n"
 "PO-Revision-Date: 2004-02-09 20:09+0100\n"
 "Last-Translator: Miroslav Kure <kurem@debian.cz>\n"
 "Language-Team: Czech <provoz@debian.cz>\n"
@@ -26,17 +26,30 @@ msgstr ""
 #. Type: boolean
 #. Description
 #: ../templates.master:4
+msgid ""
+"The format of /etc/network/interfaces has had a minor but incompatible "
+"change made between version 0.5.x and 0.6.x of ifupdown. It is however "
+"possible to automatically convert from the old format to the new in almost "
+"all cases."
+msgstr ""
+"Mezi verzemi 0.5.x a 0.6 programu ifupdown doπlo k malÈ, ale nekompatibilnÌ "
+"zmÏnÏ form·tu souboru /etc/network/interfaces. V tÈmÏ¯ vπech p¯Ìpadech lze "
+"p¯evÈst data ze starÈho form·tu do novÈho zcela automaticky."
+
+#. Type: boolean
+#. Description
+#: ../templates.master:13
 msgid "Update /etc/network/interfaces?"
 msgstr "Aktualizovat /etc/network/interfaces?"
 
 #. Type: boolean
 #. Description
-#: ../templates.master:4
+#: ../templates.master:13
+#, fuzzy
 msgid ""
 "The format of /etc/network/interfaces has had a minor but incompatible "
-"change made between version 0.5.x and 0.6.x of ifupdown. It is however "
-"possible to automatically convert from the old format to the new in almost "
-"all cases."
+"change made for dapper. It is however possible to automatically convert from "
+"the old format to the new in almost all cases."
 msgstr ""
 "Mezi verzemi 0.5.x a 0.6 programu ifupdown doπlo k malÈ, ale nekompatibilnÌ "
 "zmÏnÏ form·tu souboru /etc/network/interfaces. V tÈmÏ¯ vπech p¯Ìpadech lze "
diff -pruN 0.6.7/debian/po/da.po 0.6.7ubuntu7/debian/po/da.po
--- 0.6.7/debian/po/da.po	2005-05-02 14:58:10.000000000 +0100
+++ 0.6.7ubuntu7/debian/po/da.po	2006-01-23 18:57:15.000000000 +0000
@@ -14,8 +14,8 @@
 msgid ""
 msgstr ""
 "Project-Id-Version: ifupdown 0.6.4\n"
-"Report-Msgid-Bugs-To: \n"
-"POT-Creation-Date: 2004-08-04 17:16+0200\n"
+"Report-Msgid-Bugs-To: ajt@debian.org\n"
+"POT-Creation-Date: 2006-01-23 18:57+0000\n"
 "PO-Revision-Date: 2004-03-31 14:37+0200\n"
 "Last-Translator: Morten Brix Pedersen <morten@wtf.dk>\n"
 "Language-Team: Danish <dansk@klid.dk>\n"
@@ -26,17 +26,31 @@ msgstr ""
 #. Type: boolean
 #. Description
 #: ../templates.master:4
+msgid ""
+"The format of /etc/network/interfaces has had a minor but incompatible "
+"change made between version 0.5.x and 0.6.x of ifupdown. It is however "
+"possible to automatically convert from the old format to the new in almost "
+"all cases."
+msgstr ""
+"Formatet i filen /etc/network/interfaces har f√•et lavet en mindre men "
+"inkompatibel √¶ndring mellem version 0.5.x og 0.6.x af ifupdown. Det er dog "
+"muligt at automatisk konvertere fra det gamle format til det nye i n√¶sten "
+"alle tilf√¶lde."
+
+#. Type: boolean
+#. Description
+#: ../templates.master:13
 msgid "Update /etc/network/interfaces?"
 msgstr "Opdat√©r /etc/network/interfaces?"
 
 #. Type: boolean
 #. Description
-#: ../templates.master:4
+#: ../templates.master:13
+#, fuzzy
 msgid ""
 "The format of /etc/network/interfaces has had a minor but incompatible "
-"change made between version 0.5.x and 0.6.x of ifupdown. It is however "
-"possible to automatically convert from the old format to the new in almost "
-"all cases."
+"change made for dapper. It is however possible to automatically convert from "
+"the old format to the new in almost all cases."
 msgstr ""
 "Formatet i filen /etc/network/interfaces har f√•et lavet en mindre men "
 "inkompatibel √¶ndring mellem version 0.5.x og 0.6.x af ifupdown. Det er dog "
diff -pruN 0.6.7/debian/po/de.po 0.6.7ubuntu7/debian/po/de.po
--- 0.6.7/debian/po/de.po	2005-05-02 14:58:11.000000000 +0100
+++ 0.6.7ubuntu7/debian/po/de.po	2006-01-23 18:57:15.000000000 +0000
@@ -15,8 +15,8 @@
 msgid ""
 msgstr ""
 "Project-Id-Version: PACKAGE VERSION\n"
-"Report-Msgid-Bugs-To: \n"
-"POT-Creation-Date: 2004-08-04 17:16+0200\n"
+"Report-Msgid-Bugs-To: ajt@debian.org\n"
+"POT-Creation-Date: 2006-01-23 18:57+0000\n"
 "PO-Revision-Date: YEAR-MO-DA HO:MI+ZONE\n"
 "Last-Translator: FULL NAME <EMAIL@ADDRESS>\n"
 "Language-Team: LANGUAGE <LL@li.org>\n"
@@ -27,17 +27,31 @@ msgstr ""
 #. Type: boolean
 #. Description
 #: ../templates.master:4
+msgid ""
+"The format of /etc/network/interfaces has had a minor but incompatible "
+"change made between version 0.5.x and 0.6.x of ifupdown. It is however "
+"possible to automatically convert from the old format to the new in almost "
+"all cases."
+msgstr ""
+"Das Format von /etc/network/interfaces hat eine kleinere aber inkompatible "
+"ƒnderung zwischen Version 0.5.x und 0.6.x von ifupdown erfahren. Es ist "
+"jedoch in fast allen F‰llen mˆglich, automatisch vom alten in das neue "
+"Format zu konvertieren."
+
+#. Type: boolean
+#. Description
+#: ../templates.master:13
 msgid "Update /etc/network/interfaces?"
 msgstr "Soll /etc/network/interfaces erneuert werden?"
 
 #. Type: boolean
 #. Description
-#: ../templates.master:4
+#: ../templates.master:13
+#, fuzzy
 msgid ""
 "The format of /etc/network/interfaces has had a minor but incompatible "
-"change made between version 0.5.x and 0.6.x of ifupdown. It is however "
-"possible to automatically convert from the old format to the new in almost "
-"all cases."
+"change made for dapper. It is however possible to automatically convert from "
+"the old format to the new in almost all cases."
 msgstr ""
 "Das Format von /etc/network/interfaces hat eine kleinere aber inkompatible "
 "ƒnderung zwischen Version 0.5.x und 0.6.x von ifupdown erfahren. Es ist "
diff -pruN 0.6.7/debian/po/el.po 0.6.7ubuntu7/debian/po/el.po
--- 0.6.7/debian/po/el.po	2005-05-02 14:58:11.000000000 +0100
+++ 0.6.7ubuntu7/debian/po/el.po	2006-01-23 18:57:15.000000000 +0000
@@ -15,8 +15,8 @@
 msgid ""
 msgstr ""
 "Project-Id-Version: el\n"
-"Report-Msgid-Bugs-To: \n"
-"POT-Creation-Date: 2004-08-04 17:16+0200\n"
+"Report-Msgid-Bugs-To: ajt@debian.org\n"
+"POT-Creation-Date: 2006-01-23 18:57+0000\n"
 "PO-Revision-Date: 2004-01-15 22:04EEST\n"
 "Last-Translator: Konstantinos Margaritis <markos@debian.org>\n"
 "Language-Team: Greek <debian-l10n-greek@lists.debian.org>\n"
@@ -28,17 +28,30 @@ msgstr ""
 #. Type: boolean
 #. Description
 #: ../templates.master:4
+msgid ""
+"The format of /etc/network/interfaces has had a minor but incompatible "
+"change made between version 0.5.x and 0.6.x of ifupdown. It is however "
+"possible to automatically convert from the old format to the new in almost "
+"all cases."
+msgstr ""
+"Œó Œ¥ŒøŒºŒÆ œÑŒøœÖ /etc/network/interfaces Œ¨ŒªŒªŒ±ŒæŒµ ŒºŒµ Œ≠ŒΩŒ± ŒºŒπŒ∫œÅœå Œ±ŒªŒªŒ¨ Œ±œÉœçŒºŒ≤Œ±œÑŒø œÑœÅœåœÄŒø "
+"Œ±œÄœå œÑŒ∑ŒΩ Œ≠Œ∫Œ¥ŒøœÉŒ∑ œÑŒøœÖ œÄŒ±Œ∫Œ≠œÑŒøœÖ ifupdown 0.5.x Œ∫Œ±Œπ 0.6.x.  Œ©œÉœÑœåœÉŒø, ŒµŒØŒΩŒ±Œπ Œ¥œÖŒΩŒ±œÑŒÆ Œ∑ "
+"Œ±œÖœÑœåŒºŒ±œÑŒ∑ ŒºŒµœÑŒ±œÑœÅŒøœÄŒÆ œÑŒ∑œÇ œÄŒ±ŒªŒπŒ¨œÇ Œ¥ŒøŒºŒÆœÇ œÉœÑŒ∑ ŒΩŒ≠Œ± Œ≥ŒπŒ± œÉœáŒµŒ¥œåŒΩ œåŒªŒµœÇ œÑŒπœÇ œÄŒµœÅŒπœÄœÑœéœÉŒµŒπœÇ."
+
+#. Type: boolean
+#. Description
+#: ../templates.master:13
 msgid "Update /etc/network/interfaces?"
 msgstr "ŒùŒ± Œ≥ŒØŒΩŒµŒπ Œ¥ŒπœåœÅŒ∏œâœÉŒ∑ œÑŒøœÖ /etc/network/interfaces;"
 
 #. Type: boolean
 #. Description
-#: ../templates.master:4
+#: ../templates.master:13
+#, fuzzy
 msgid ""
 "The format of /etc/network/interfaces has had a minor but incompatible "
-"change made between version 0.5.x and 0.6.x of ifupdown. It is however "
-"possible to automatically convert from the old format to the new in almost "
-"all cases."
+"change made for dapper. It is however possible to automatically convert from "
+"the old format to the new in almost all cases."
 msgstr ""
 "Œó Œ¥ŒøŒºŒÆ œÑŒøœÖ /etc/network/interfaces Œ¨ŒªŒªŒ±ŒæŒµ ŒºŒµ Œ≠ŒΩŒ± ŒºŒπŒ∫œÅœå Œ±ŒªŒªŒ¨ Œ±œÉœçŒºŒ≤Œ±œÑŒø œÑœÅœåœÄŒø "
 "Œ±œÄœå œÑŒ∑ŒΩ Œ≠Œ∫Œ¥ŒøœÉŒ∑ œÑŒøœÖ œÄŒ±Œ∫Œ≠œÑŒøœÖ ifupdown 0.5.x Œ∫Œ±Œπ 0.6.x.  Œ©œÉœÑœåœÉŒø, ŒµŒØŒΩŒ±Œπ Œ¥œÖŒΩŒ±œÑŒÆ Œ∑ "
diff -pruN 0.6.7/debian/po/es.po 0.6.7ubuntu7/debian/po/es.po
--- 0.6.7/debian/po/es.po	2005-05-02 14:58:11.000000000 +0100
+++ 0.6.7ubuntu7/debian/po/es.po	2006-01-23 18:57:15.000000000 +0000
@@ -16,8 +16,8 @@
 msgid ""
 msgstr ""
 "Project-Id-Version: ifupdown 0.6.4\n"
-"Report-Msgid-Bugs-To: \n"
-"POT-Creation-Date: 2004-08-04 17:16+0200\n"
+"Report-Msgid-Bugs-To: ajt@debian.org\n"
+"POT-Creation-Date: 2006-01-23 18:57+0000\n"
 "PO-Revision-Date: 2003-08-29 01:00+0200\n"
 "Last-Translator: Carlos Valdivia Yag¸e <valyag@dat.etsit.upm.es>\n"
 "Language-Team: Debian L10n Spanish <debian-l10n-spanish@lists.debian.org>\n"
@@ -28,17 +28,31 @@ msgstr ""
 #. Type: boolean
 #. Description
 #: ../templates.master:4
+msgid ""
+"The format of /etc/network/interfaces has had a minor but incompatible "
+"change made between version 0.5.x and 0.6.x of ifupdown. It is however "
+"possible to automatically convert from the old format to the new in almost "
+"all cases."
+msgstr ""
+"El formato de /etc/network/interfaces ha sufrido un cambio pequeÒo pero "
+"incompatible entre las versiones 0.5.x y 0.6.x de ifupdown. No obstante, en "
+"casi todos los casos es posible realizar la conversiÛn autom·ticamente entre "
+"el formato antiguo y el nuevo."
+
+#. Type: boolean
+#. Description
+#: ../templates.master:13
 msgid "Update /etc/network/interfaces?"
 msgstr "øActualizar /etc/network/interfaces"
 
 #. Type: boolean
 #. Description
-#: ../templates.master:4
+#: ../templates.master:13
+#, fuzzy
 msgid ""
 "The format of /etc/network/interfaces has had a minor but incompatible "
-"change made between version 0.5.x and 0.6.x of ifupdown. It is however "
-"possible to automatically convert from the old format to the new in almost "
-"all cases."
+"change made for dapper. It is however possible to automatically convert from "
+"the old format to the new in almost all cases."
 msgstr ""
 "El formato de /etc/network/interfaces ha sufrido un cambio pequeÒo pero "
 "incompatible entre las versiones 0.5.x y 0.6.x de ifupdown. No obstante, en "
diff -pruN 0.6.7/debian/po/fr.po 0.6.7ubuntu7/debian/po/fr.po
--- 0.6.7/debian/po/fr.po	2005-05-02 14:58:11.000000000 +0100
+++ 0.6.7ubuntu7/debian/po/fr.po	2006-01-23 18:57:15.000000000 +0000
@@ -14,8 +14,8 @@
 msgid ""
 msgstr ""
 "Project-Id-Version: ifupdown 0.6.4\n"
-"Report-Msgid-Bugs-To: \n"
-"POT-Creation-Date: 2004-08-04 17:16+0200\n"
+"Report-Msgid-Bugs-To: ajt@debian.org\n"
+"POT-Creation-Date: 2006-01-23 18:57+0000\n"
 "PO-Revision-Date: 2003-07-10 19:52+0100\n"
 "Last-Translator: Thomas Morin <thomas.morin@webmotion.com>\n"
 "Language-Team: French <debian-l10n-french@lists.debian.org>\n"
@@ -26,17 +26,31 @@ msgstr ""
 #. Type: boolean
 #. Description
 #: ../templates.master:4
+msgid ""
+"The format of /etc/network/interfaces has had a minor but incompatible "
+"change made between version 0.5.x and 0.6.x of ifupdown. It is however "
+"possible to automatically convert from the old format to the new in almost "
+"all cases."
+msgstr ""
+"Le format du fichier /etc/network/interfaces a subi un changement mineur "
+"mais incompatible entre les versions 0.5.x et 0.6.x d'ifupdown. Il est "
+"nÈanmoins possible de convertir automatiquement ce fichier de l'ancien "
+"format au nouveau, dans la plupart des cas."
+
+#. Type: boolean
+#. Description
+#: ../templates.master:13
 msgid "Update /etc/network/interfaces?"
 msgstr "Mettre ‡ jour /etc/network/interfaces†?"
 
 #. Type: boolean
 #. Description
-#: ../templates.master:4
+#: ../templates.master:13
+#, fuzzy
 msgid ""
 "The format of /etc/network/interfaces has had a minor but incompatible "
-"change made between version 0.5.x and 0.6.x of ifupdown. It is however "
-"possible to automatically convert from the old format to the new in almost "
-"all cases."
+"change made for dapper. It is however possible to automatically convert from "
+"the old format to the new in almost all cases."
 msgstr ""
 "Le format du fichier /etc/network/interfaces a subi un changement mineur "
 "mais incompatible entre les versions 0.5.x et 0.6.x d'ifupdown. Il est "
diff -pruN 0.6.7/debian/po/it.po 0.6.7ubuntu7/debian/po/it.po
--- 0.6.7/debian/po/it.po	2005-05-02 14:58:11.000000000 +0100
+++ 0.6.7ubuntu7/debian/po/it.po	2006-01-23 18:57:15.000000000 +0000
@@ -6,8 +6,8 @@
 msgid ""
 msgstr ""
 "Project-Id-Version: ifupdown 0.6.4-4.10\n"
-"Report-Msgid-Bugs-To: \n"
-"POT-Creation-Date: 2004-08-04 17:16+0200\n"
+"Report-Msgid-Bugs-To: ajt@debian.org\n"
+"POT-Creation-Date: 2006-01-23 18:57+0000\n"
 "PO-Revision-Date: 2004-11-21 16:02+0100\n"
 "Last-Translator: Luca Monducci <luca.mo@tiscali.it>\n"
 "Language-Team: Italian <debian-l10n-italian@lists.debian.org>\n"
@@ -18,17 +18,31 @@ msgstr ""
 #. Type: boolean
 #. Description
 #: ../templates.master:4
+msgid ""
+"The format of /etc/network/interfaces has had a minor but incompatible "
+"change made between version 0.5.x and 0.6.x of ifupdown. It is however "
+"possible to automatically convert from the old format to the new in almost "
+"all cases."
+msgstr ""
+"Il formato del file /etc/network/interfaces ha subito un piccolo cambiamento "
+"che lo rende incompatibile fra le versioni 0.5.x e 0.6.x di ifupdown. "
+"Comunque, nella maggior parte dei casi, √® possibile convertire "
+"automaticamente il file dal vecchio formato al nuovo."
+
+#. Type: boolean
+#. Description
+#: ../templates.master:13
 msgid "Update /etc/network/interfaces?"
 msgstr "Aggiornare /etc/network/interfaces?"
 
 #. Type: boolean
 #. Description
-#: ../templates.master:4
+#: ../templates.master:13
+#, fuzzy
 msgid ""
 "The format of /etc/network/interfaces has had a minor but incompatible "
-"change made between version 0.5.x and 0.6.x of ifupdown. It is however "
-"possible to automatically convert from the old format to the new in almost "
-"all cases."
+"change made for dapper. It is however possible to automatically convert from "
+"the old format to the new in almost all cases."
 msgstr ""
 "Il formato del file /etc/network/interfaces ha subito un piccolo cambiamento "
 "che lo rende incompatibile fra le versioni 0.5.x e 0.6.x di ifupdown. "
diff -pruN 0.6.7/debian/po/ja.po 0.6.7ubuntu7/debian/po/ja.po
--- 0.6.7/debian/po/ja.po	2005-05-02 14:58:11.000000000 +0100
+++ 0.6.7ubuntu7/debian/po/ja.po	2006-01-23 18:57:15.000000000 +0000
@@ -14,8 +14,8 @@
 msgid ""
 msgstr ""
 "Project-Id-Version: PACKAGE VERSION\n"
-"Report-Msgid-Bugs-To: \n"
-"POT-Creation-Date: 2004-08-04 17:16+0200\n"
+"Report-Msgid-Bugs-To: ajt@debian.org\n"
+"POT-Creation-Date: 2006-01-23 18:57+0000\n"
 "PO-Revision-Date: 2003-09-11 23:13+0900\n"
 "Last-Translator: Kenshi Muto <kmuto@debian.org>\n"
 "Language-Team: Japanese <debian-japanese@lists.debian.org>\n"
@@ -26,17 +26,30 @@ msgstr ""
 #. Type: boolean
 #. Description
 #: ../templates.master:4
+msgid ""
+"The format of /etc/network/interfaces has had a minor but incompatible "
+"change made between version 0.5.x and 0.6.x of ifupdown. It is however "
+"possible to automatically convert from the old format to the new in almost "
+"all cases."
+msgstr ""
+"/etc/network/interfaces §Œ∑¡º∞§œ°¢ifupdown §Œ 0.5.x §» 0.6.x §Œ§¢§§§¿§«∫Ÿ§´"
+"§ °¢§∑§´§∑»Û∏ﬂ¥π§Œ —ππ§¨π‘§Ô§Ï§ﬁ§∑§ø°£§€§‹§π§Ÿ§∆§ŒæÏπÁ°¢∏≈§§∑¡º∞§´§Èø∑§∑§§∑¡"
+"º∞§ÿº´∆∞≈™§À —¥π§«§≠§ﬁ§π°£"
+
+#. Type: boolean
+#. Description
+#: ../templates.master:13
 msgid "Update /etc/network/interfaces?"
 msgstr "/etc/network/interfaces §Úππø∑§∑§ﬁ§π§´?"
 
 #. Type: boolean
 #. Description
-#: ../templates.master:4
+#: ../templates.master:13
+#, fuzzy
 msgid ""
 "The format of /etc/network/interfaces has had a minor but incompatible "
-"change made between version 0.5.x and 0.6.x of ifupdown. It is however "
-"possible to automatically convert from the old format to the new in almost "
-"all cases."
+"change made for dapper. It is however possible to automatically convert from "
+"the old format to the new in almost all cases."
 msgstr ""
 "/etc/network/interfaces §Œ∑¡º∞§œ°¢ifupdown §Œ 0.5.x §» 0.6.x §Œ§¢§§§¿§«∫Ÿ§´"
 "§ °¢§∑§´§∑»Û∏ﬂ¥π§Œ —ππ§¨π‘§Ô§Ï§ﬁ§∑§ø°£§€§‹§π§Ÿ§∆§ŒæÏπÁ°¢∏≈§§∑¡º∞§´§Èø∑§∑§§∑¡"
diff -pruN 0.6.7/debian/po/lt.po 0.6.7ubuntu7/debian/po/lt.po
--- 0.6.7/debian/po/lt.po	2005-05-02 14:58:11.000000000 +0100
+++ 0.6.7ubuntu7/debian/po/lt.po	2006-01-23 18:57:15.000000000 +0000
@@ -4,8 +4,8 @@
 msgid ""
 msgstr ""
 "Project-Id-Version: pcmcia-cs\n"
-"Report-Msgid-Bugs-To: \n"
-"POT-Creation-Date: 2004-08-04 17:16+0200\n"
+"Report-Msgid-Bugs-To: ajt@debian.org\n"
+"POT-Creation-Date: 2006-01-23 18:57+0000\n"
 "PO-Revision-Date: 2004-05-16 11:05+0300\n"
 "Last-Translator: Gintautas Miliauskas <gintas@akl.lt>\n"
 "Language-Team: Lithuanian <komp_lt@konferencijos.lt>\n"
@@ -16,17 +16,30 @@ msgstr ""
 #. Type: boolean
 #. Description
 #: ../templates.master:4
+msgid ""
+"The format of /etc/network/interfaces has had a minor but incompatible "
+"change made between version 0.5.x and 0.6.x of ifupdown. It is however "
+"possible to automatically convert from the old format to the new in almost "
+"all cases."
+msgstr ""
+"Failo /etc/network/interfaces formatas ne≈æymiai, bet nesuderinamai skiriasi "
+"tarp ifupdown versij≈≥ 0.5.x ir 0.6.x, taƒçiau beveik visais atvejais galima "
+"automati≈°kai konvertuoti i≈° seno formato ƒØ naujƒÖ."
+
+#. Type: boolean
+#. Description
+#: ../templates.master:13
 msgid "Update /etc/network/interfaces?"
 msgstr "Atnaujinti /etc/network/interfaces?"
 
 #. Type: boolean
 #. Description
-#: ../templates.master:4
+#: ../templates.master:13
+#, fuzzy
 msgid ""
 "The format of /etc/network/interfaces has had a minor but incompatible "
-"change made between version 0.5.x and 0.6.x of ifupdown. It is however "
-"possible to automatically convert from the old format to the new in almost "
-"all cases."
+"change made for dapper. It is however possible to automatically convert from "
+"the old format to the new in almost all cases."
 msgstr ""
 "Failo /etc/network/interfaces formatas ne≈æymiai, bet nesuderinamai skiriasi "
 "tarp ifupdown versij≈≥ 0.5.x ir 0.6.x, taƒçiau beveik visais atvejais galima "
diff -pruN 0.6.7/debian/po/nl.po 0.6.7ubuntu7/debian/po/nl.po
--- 0.6.7/debian/po/nl.po	2005-05-02 14:58:12.000000000 +0100
+++ 0.6.7ubuntu7/debian/po/nl.po	2006-01-23 18:57:15.000000000 +0000
@@ -14,8 +14,8 @@
 msgid ""
 msgstr ""
 "Project-Id-Version: ifupdown 0.6.4-4.6\n"
-"Report-Msgid-Bugs-To: \n"
-"POT-Creation-Date: 2004-08-04 17:16+0200\n"
+"Report-Msgid-Bugs-To: ajt@debian.org\n"
+"POT-Creation-Date: 2006-01-23 18:57+0000\n"
 "PO-Revision-Date: 2003-09-20 00:44+0100\n"
 "Last-Translator: Tim Dijkstra <tim@famdijkstra.org>\n"
 "Language-Team: Dutch <debian-l10n-dutch@lists.debian.org>\n"
@@ -26,17 +26,31 @@ msgstr ""
 #. Type: boolean
 #. Description
 #: ../templates.master:4
+msgid ""
+"The format of /etc/network/interfaces has had a minor but incompatible "
+"change made between version 0.5.x and 0.6.x of ifupdown. It is however "
+"possible to automatically convert from the old format to the new in almost "
+"all cases."
+msgstr ""
+"De indeling van /etc/network/interfaces heeft tussen versie 0.5.x en 0.6.x "
+"van ifupdown een kleine, maar incompatibele verandering ondergaan. In bijna "
+"alle gevallen is het echter mogelijk om automatisch het oude format naar het "
+"nieuwe om te zetten."
+
+#. Type: boolean
+#. Description
+#: ../templates.master:13
 msgid "Update /etc/network/interfaces?"
 msgstr "/etc/network/interfaces bijwerken?"
 
 #. Type: boolean
 #. Description
-#: ../templates.master:4
+#: ../templates.master:13
+#, fuzzy
 msgid ""
 "The format of /etc/network/interfaces has had a minor but incompatible "
-"change made between version 0.5.x and 0.6.x of ifupdown. It is however "
-"possible to automatically convert from the old format to the new in almost "
-"all cases."
+"change made for dapper. It is however possible to automatically convert from "
+"the old format to the new in almost all cases."
 msgstr ""
 "De indeling van /etc/network/interfaces heeft tussen versie 0.5.x en 0.6.x "
 "van ifupdown een kleine, maar incompatibele verandering ondergaan. In bijna "
diff -pruN 0.6.7/debian/po/pl.po 0.6.7ubuntu7/debian/po/pl.po
--- 0.6.7/debian/po/pl.po	2005-05-02 14:58:12.000000000 +0100
+++ 0.6.7ubuntu7/debian/po/pl.po	2006-01-23 18:57:15.000000000 +0000
@@ -15,8 +15,8 @@
 msgid ""
 msgstr ""
 "Project-Id-Version: PACKAGE VERSION\n"
-"Report-Msgid-Bugs-To: \n"
-"POT-Creation-Date: 2004-08-04 17:16+0200\n"
+"Report-Msgid-Bugs-To: ajt@debian.org\n"
+"POT-Creation-Date: 2006-01-23 18:57+0000\n"
 "PO-Revision-Date: YEAR-MO-DA HO:MI+ZONE\n"
 "Last-Translator: FULL NAME <EMAIL@ADDRESS>\n"
 "Language-Team: LANGUAGE <LL@li.org>\n"
@@ -27,17 +27,32 @@ msgstr ""
 #. Type: boolean
 #. Description
 #: ../templates.master:4
+msgid ""
+"The format of /etc/network/interfaces has had a minor but incompatible "
+"change made between version 0.5.x and 0.6.x of ifupdown. It is however "
+"possible to automatically convert from the old format to the new in almost "
+"all cases."
+msgstr ""
+"W porÛwnaniu z wersj± 0.5.x, wersja 0.6.x programu ifupdown wprowadza drobne "
+"zmiany, ktÛre jednak powoduj±, øe stara wersja pliku /etc/network/interfaces "
+"moøe nie pasowaÊ do nowej konfiguracji. Istnieje jednak moøliwo∂Ê "
+"automatycznej konwersji (w praktycznie wszystkich przypadkach) ze starego "
+"formatu do nowego."
+
+#. Type: boolean
+#. Description
+#: ../templates.master:13
 msgid "Update /etc/network/interfaces?"
 msgstr "UaktualniÊ /etc/network/interfaces?"
 
 #. Type: boolean
 #. Description
-#: ../templates.master:4
+#: ../templates.master:13
+#, fuzzy
 msgid ""
 "The format of /etc/network/interfaces has had a minor but incompatible "
-"change made between version 0.5.x and 0.6.x of ifupdown. It is however "
-"possible to automatically convert from the old format to the new in almost "
-"all cases."
+"change made for dapper. It is however possible to automatically convert from "
+"the old format to the new in almost all cases."
 msgstr ""
 "W porÛwnaniu z wersj± 0.5.x, wersja 0.6.x programu ifupdown wprowadza drobne "
 "zmiany, ktÛre jednak powoduj±, øe stara wersja pliku /etc/network/interfaces "
diff -pruN 0.6.7/debian/po/pt_BR.po 0.6.7ubuntu7/debian/po/pt_BR.po
--- 0.6.7/debian/po/pt_BR.po	2005-05-02 14:58:12.000000000 +0100
+++ 0.6.7ubuntu7/debian/po/pt_BR.po	2006-01-23 18:57:15.000000000 +0000
@@ -15,8 +15,8 @@
 msgid ""
 msgstr ""
 "Project-Id-Version: PACKAGE VERSION\n"
-"Report-Msgid-Bugs-To: \n"
-"POT-Creation-Date: 2004-08-04 17:16+0200\n"
+"Report-Msgid-Bugs-To: ajt@debian.org\n"
+"POT-Creation-Date: 2006-01-23 18:57+0000\n"
 "PO-Revision-Date: YEAR-MO-DA HO:MI+ZONE\n"
 "Last-Translator: FULL NAME <EMAIL@ADDRESS>\n"
 "Language-Team: LANGUAGE <LL@li.org>\n"
@@ -27,17 +27,31 @@ msgstr ""
 #. Type: boolean
 #. Description
 #: ../templates.master:4
+msgid ""
+"The format of /etc/network/interfaces has had a minor but incompatible "
+"change made between version 0.5.x and 0.6.x of ifupdown. It is however "
+"possible to automatically convert from the old format to the new in almost "
+"all cases."
+msgstr ""
+"O formato do arquivo /etc/network/interfaces sofreu uma mudanÁa menor mas "
+"incompatÌvel entre as versıes 0.5.x e 0.6.x do pacote ifupdown. PorÈm È "
+"possÌvel converter a partir do formato antigo para o novo formato na maioria "
+"dos casos."
+
+#. Type: boolean
+#. Description
+#: ../templates.master:13
 msgid "Update /etc/network/interfaces?"
 msgstr "Atualizar /etc/network/interfaces?"
 
 #. Type: boolean
 #. Description
-#: ../templates.master:4
+#: ../templates.master:13
+#, fuzzy
 msgid ""
 "The format of /etc/network/interfaces has had a minor but incompatible "
-"change made between version 0.5.x and 0.6.x of ifupdown. It is however "
-"possible to automatically convert from the old format to the new in almost "
-"all cases."
+"change made for dapper. It is however possible to automatically convert from "
+"the old format to the new in almost all cases."
 msgstr ""
 "O formato do arquivo /etc/network/interfaces sofreu uma mudanÁa menor mas "
 "incompatÌvel entre as versıes 0.5.x e 0.6.x do pacote ifupdown. PorÈm È "
diff -pruN 0.6.7/debian/po/ru.po 0.6.7ubuntu7/debian/po/ru.po
--- 0.6.7/debian/po/ru.po	2005-05-02 14:58:12.000000000 +0100
+++ 0.6.7ubuntu7/debian/po/ru.po	2006-01-23 18:57:15.000000000 +0000
@@ -15,8 +15,8 @@
 msgid ""
 msgstr ""
 "Project-Id-Version: PACKAGE VERSION\n"
-"Report-Msgid-Bugs-To: \n"
-"POT-Creation-Date: 2004-08-04 17:16+0200\n"
+"Report-Msgid-Bugs-To: ajt@debian.org\n"
+"POT-Creation-Date: 2006-01-23 18:57+0000\n"
 "PO-Revision-Date: YEAR-MO-DA HO:MI+ZONE\n"
 "Last-Translator: FULL NAME <EMAIL@ADDRESS>\n"
 "Language-Team: LANGUAGE <LL@li.org>\n"
@@ -27,17 +27,30 @@ msgstr ""
 #. Type: boolean
 #. Description
 #: ../templates.master:4
+msgid ""
+"The format of /etc/network/interfaces has had a minor but incompatible "
+"change made between version 0.5.x and 0.6.x of ifupdown. It is however "
+"possible to automatically convert from the old format to the new in almost "
+"all cases."
+msgstr ""
+"Êœ“Õ¡‘ /etc/network/interfaces …Õ≈≈‘ Œ≈¬œÃÿ€…≈, Œœ Œ≈”œ◊Õ≈”‘…ÕŸ≈ …⁄Õ≈Œ≈Œ…— "
+"Õ≈÷ƒ’ ◊≈“”…—Õ… 0.5.x … 0.6.x ifupdown. ÔƒŒ¡Àœ ◊œ⁄Õœ÷Œœ ¡◊‘œÕ¡‘…ﬁ≈”À… "
+"–“≈œ¬“¡⁄œ◊¡‘ÿ ”‘¡“Ÿ  ∆œ“Õ¡‘ ” Œœ◊Ÿ  –œﬁ‘… ◊œ ◊”≈» ”Ã’ﬁ¡—»."
+
+#. Type: boolean
+#. Description
+#: ../templates.master:13
 msgid "Update /etc/network/interfaces?"
 msgstr "Ô¬Œœ◊…‘ÿ /etc/network/interfaces?"
 
 #. Type: boolean
 #. Description
-#: ../templates.master:4
+#: ../templates.master:13
+#, fuzzy
 msgid ""
 "The format of /etc/network/interfaces has had a minor but incompatible "
-"change made between version 0.5.x and 0.6.x of ifupdown. It is however "
-"possible to automatically convert from the old format to the new in almost "
-"all cases."
+"change made for dapper. It is however possible to automatically convert from "
+"the old format to the new in almost all cases."
 msgstr ""
 "Êœ“Õ¡‘ /etc/network/interfaces …Õ≈≈‘ Œ≈¬œÃÿ€…≈, Œœ Œ≈”œ◊Õ≈”‘…ÕŸ≈ …⁄Õ≈Œ≈Œ…— "
 "Õ≈÷ƒ’ ◊≈“”…—Õ… 0.5.x … 0.6.x ifupdown. ÔƒŒ¡Àœ ◊œ⁄Õœ÷Œœ ¡◊‘œÕ¡‘…ﬁ≈”À… "
diff -pruN 0.6.7/debian/po/sv.po 0.6.7ubuntu7/debian/po/sv.po
--- 0.6.7/debian/po/sv.po	2005-05-02 14:58:12.000000000 +0100
+++ 0.6.7ubuntu7/debian/po/sv.po	2006-01-23 18:57:15.000000000 +0000
@@ -15,8 +15,8 @@
 msgid ""
 msgstr ""
 "Project-Id-Version: PACKAGE VERSION\n"
-"Report-Msgid-Bugs-To: \n"
-"POT-Creation-Date: 2004-08-04 17:16+0200\n"
+"Report-Msgid-Bugs-To: ajt@debian.org\n"
+"POT-Creation-Date: 2006-01-23 18:57+0000\n"
 "PO-Revision-Date: YEAR-MO-DA HO:MI+ZONE\n"
 "Last-Translator: FULL NAME <EMAIL@ADDRESS>\n"
 "Language-Team: LANGUAGE <LL@li.org>\n"
@@ -27,17 +27,30 @@ msgstr ""
 #. Type: boolean
 #. Description
 #: ../templates.master:4
+msgid ""
+"The format of /etc/network/interfaces has had a minor but incompatible "
+"change made between version 0.5.x and 0.6.x of ifupdown. It is however "
+"possible to automatically convert from the old format to the new in almost "
+"all cases."
+msgstr ""
+"Formatet pÂ /etc/network/interfaces genomgick en liten men inkompatibel "
+"‰ndring mellan version 0.5.x och 0.6.x av ifupdown. Det ‰r dock mˆjligt att "
+"n‰stan alltid automatiskt konvertera frÂn det gamla formatet till det nya."
+
+#. Type: boolean
+#. Description
+#: ../templates.master:13
 msgid "Update /etc/network/interfaces?"
 msgstr "Uppdatera /etc/network/interfaces?"
 
 #. Type: boolean
 #. Description
-#: ../templates.master:4
+#: ../templates.master:13
+#, fuzzy
 msgid ""
 "The format of /etc/network/interfaces has had a minor but incompatible "
-"change made between version 0.5.x and 0.6.x of ifupdown. It is however "
-"possible to automatically convert from the old format to the new in almost "
-"all cases."
+"change made for dapper. It is however possible to automatically convert from "
+"the old format to the new in almost all cases."
 msgstr ""
 "Formatet pÂ /etc/network/interfaces genomgick en liten men inkompatibel "
 "‰ndring mellan version 0.5.x och 0.6.x av ifupdown. Det ‰r dock mˆjligt att "
diff -pruN 0.6.7/debian/po/templates.pot 0.6.7ubuntu7/debian/po/templates.pot
--- 0.6.7/debian/po/templates.pot	2005-04-04 14:33:54.000000000 +0100
+++ 0.6.7ubuntu7/debian/po/templates.pot	2006-01-23 18:57:15.000000000 +0000
@@ -1,22 +1,14 @@
-#
-#    Translators, if you are not familiar with the PO format, gettext
-#    documentation is worth reading, especially sections dedicated to
-#    this format, e.g. by running:
-#         info -n '(gettext)PO Files'
-#         info -n '(gettext)Header Entry'
-#
-#    Some information specific to po-debconf are available at
-#            /usr/share/doc/po-debconf/README-trans
-#         or http://www.debian.org/intl/l10n/po-debconf/README-trans
-#
-#    Developers do not need to manually edit POT or PO files.
+# SOME DESCRIPTIVE TITLE.
+# Copyright (C) YEAR THE PACKAGE'S COPYRIGHT HOLDER
+# This file is distributed under the same license as the PACKAGE package.
+# FIRST AUTHOR <EMAIL@ADDRESS>, YEAR.
 #
 #, fuzzy
 msgid ""
 msgstr ""
 "Project-Id-Version: PACKAGE VERSION\n"
-"Report-Msgid-Bugs-To: \n"
-"POT-Creation-Date: 2004-08-04 17:16+0200\n"
+"Report-Msgid-Bugs-To: ajt@debian.org\n"
+"POT-Creation-Date: 2006-01-23 18:57+0000\n"
 "PO-Revision-Date: YEAR-MO-DA HO:MI+ZONE\n"
 "Last-Translator: FULL NAME <EMAIL@ADDRESS>\n"
 "Language-Team: LANGUAGE <LL@li.org>\n"
@@ -27,15 +19,24 @@ msgstr ""
 #. Type: boolean
 #. Description
 #: ../templates.master:4
+msgid ""
+"The format of /etc/network/interfaces has had a minor but incompatible "
+"change made between version 0.5.x and 0.6.x of ifupdown. It is however "
+"possible to automatically convert from the old format to the new in almost "
+"all cases."
+msgstr ""
+
+#. Type: boolean
+#. Description
+#: ../templates.master:13
 msgid "Update /etc/network/interfaces?"
 msgstr ""
 
 #. Type: boolean
 #. Description
-#: ../templates.master:4
+#: ../templates.master:13
 msgid ""
 "The format of /etc/network/interfaces has had a minor but incompatible "
-"change made between version 0.5.x and 0.6.x of ifupdown. It is however "
-"possible to automatically convert from the old format to the new in almost "
-"all cases."
+"change made for dapper. It is however possible to automatically convert from "
+"the old format to the new in almost all cases."
 msgstr ""
diff -pruN 0.6.7/debian/po/tr.po 0.6.7ubuntu7/debian/po/tr.po
--- 0.6.7/debian/po/tr.po	2005-05-02 14:58:12.000000000 +0100
+++ 0.6.7ubuntu7/debian/po/tr.po	2006-01-23 18:57:15.000000000 +0000
@@ -5,8 +5,8 @@
 msgid ""
 msgstr ""
 "Project-Id-Version: ifupdown\n"
-"Report-Msgid-Bugs-To: \n"
-"POT-Creation-Date: 2004-08-04 17:16+0200\n"
+"Report-Msgid-Bugs-To: ajt@debian.org\n"
+"POT-Creation-Date: 2006-01-23 18:57+0000\n"
 "PO-Revision-Date: 2004-03-21 03:22+0200\n"
 "Last-Translator: Mehmet Turker <mturker@innova.com.tr>\n"
 "Language-Team: Turkish <debian-l10n-turkish@lists.debian.org>\n"
@@ -19,17 +19,31 @@ msgstr ""
 #. Type: boolean
 #. Description
 #: ../templates.master:4
+msgid ""
+"The format of /etc/network/interfaces has had a minor but incompatible "
+"change made between version 0.5.x and 0.6.x of ifupdown. It is however "
+"possible to automatically convert from the old format to the new in almost "
+"all cases."
+msgstr ""
+"/etc/network/interfaces dosya bi√ßeminde 0.5.x'den 0.6.x s√ºr√ºm√ºne ge√ßi≈üte "
+"k√º√ß√ºk fakat uyumsuzluk yaratan bir deƒüi≈üiklik oldu. Bununla birlikte eski "
+"bi√ßemin otomatik olarak yenisine d√∂n√º≈üt√ºr√ºlmesi neredeyse her durumda "
+"m√ºmk√ºnd√ºr."
+
+#. Type: boolean
+#. Description
+#: ../templates.master:13
 msgid "Update /etc/network/interfaces?"
 msgstr "/etc/network/interfaces g√ºncellensin mi?"
 
 #. Type: boolean
 #. Description
-#: ../templates.master:4
+#: ../templates.master:13
+#, fuzzy
 msgid ""
 "The format of /etc/network/interfaces has had a minor but incompatible "
-"change made between version 0.5.x and 0.6.x of ifupdown. It is however "
-"possible to automatically convert from the old format to the new in almost "
-"all cases."
+"change made for dapper. It is however possible to automatically convert from "
+"the old format to the new in almost all cases."
 msgstr ""
 "/etc/network/interfaces dosya bi√ßeminde 0.5.x'den 0.6.x s√ºr√ºm√ºne ge√ßi≈üte "
 "k√º√ß√ºk fakat uyumsuzluk yaratan bir deƒüi≈üiklik oldu. Bununla birlikte eski "
diff -pruN 0.6.7/debian/po/zh_CN.po 0.6.7ubuntu7/debian/po/zh_CN.po
--- 0.6.7/debian/po/zh_CN.po	2005-05-02 14:58:12.000000000 +0100
+++ 0.6.7ubuntu7/debian/po/zh_CN.po	2006-01-23 18:57:15.000000000 +0000
@@ -14,8 +14,8 @@
 msgid ""
 msgstr ""
 "Project-Id-Version: ifupdown 0.6.4\n"
-"Report-Msgid-Bugs-To: \n"
-"POT-Creation-Date: 2004-08-04 17:16+0200\n"
+"Report-Msgid-Bugs-To: ajt@debian.org\n"
+"POT-Creation-Date: 2006-01-23 18:57+0000\n"
 "PO-Revision-Date: 2004-02-06 17:45+0800\n"
 "Last-Translator: Hiei Xu <nicky@mail.edu.cn>\n"
 "Language-Team: Chinese/Simplified <i18n-translation@lists.linux.net.cn>\n"
@@ -26,17 +26,29 @@ msgstr ""
 #. Type: boolean
 #. Description
 #: ../templates.master:4
+msgid ""
+"The format of /etc/network/interfaces has had a minor but incompatible "
+"change made between version 0.5.x and 0.6.x of ifupdown. It is however "
+"possible to automatically convert from the old format to the new in almost "
+"all cases."
+msgstr ""
+"ifupdown 0.5.x ‰∏é 0.6.x ÊâÄ‰ΩøÁî®ÁöÑ /etc/network/interfaces ÁöÑÊñá‰ª∂Ê†ºÂºè‰πãÈó¥Êúâ‰∏Ä‰∏™"
+"ËæÉÂ∞è‰ΩÜ‰∫í‰∏çÂÖºÂÆπÁöÑÊîπÂèòÔºåÁÑ∂ËÄåÂú®ÁªùÂ§ßÂ§öÊï∞ÊÉÖÂÜµ‰∏ãÁ®ãÂ∫èÈÉΩËÉΩËá™Âä®Â∞ÜÊóßÊ†ºÂºèËΩ¨Êç¢Âà∞Êñ∞Ê†ºÂºè„ÄÇ"
+
+#. Type: boolean
+#. Description
+#: ../templates.master:13
 msgid "Update /etc/network/interfaces?"
 msgstr "Êõ¥Êñ∞ /etc/network/interfaces ÂêóÔºü"
 
 #. Type: boolean
 #. Description
-#: ../templates.master:4
+#: ../templates.master:13
+#, fuzzy
 msgid ""
 "The format of /etc/network/interfaces has had a minor but incompatible "
-"change made between version 0.5.x and 0.6.x of ifupdown. It is however "
-"possible to automatically convert from the old format to the new in almost "
-"all cases."
+"change made for dapper. It is however possible to automatically convert from "
+"the old format to the new in almost all cases."
 msgstr ""
 "ifupdown 0.5.x ‰∏é 0.6.x ÊâÄ‰ΩøÁî®ÁöÑ /etc/network/interfaces ÁöÑÊñá‰ª∂Ê†ºÂºè‰πãÈó¥Êúâ‰∏Ä‰∏™"
 "ËæÉÂ∞è‰ΩÜ‰∫í‰∏çÂÖºÂÆπÁöÑÊîπÂèòÔºåÁÑ∂ËÄåÂú®ÁªùÂ§ßÂ§öÊï∞ÊÉÖÂÜµ‰∏ãÁ®ãÂ∫èÈÉΩËÉΩËá™Âä®Â∞ÜÊóßÊ†ºÂºèËΩ¨Êç¢Âà∞Êñ∞Ê†ºÂºè„ÄÇ"
diff -pruN 0.6.7/debian/postinst 0.6.7ubuntu7/debian/postinst
--- 0.6.7/debian/postinst	2005-05-02 14:57:05.000000000 +0100
+++ 0.6.7ubuntu7/debian/postinst	2006-01-30 12:45:18.000000000 +0000
@@ -41,79 +41,50 @@ if [ "$ATTEMPT_CONVERSION" = "true" ]; t
   )
 fi
 
-# Create /etc/network/run 
-if [ "$1" = configure -a ! -d /etc/network/run ]; then
-  if [ -e /etc/network/run -o -L /etc/network/run ]; then
-    echo "Renaming non-directory /etc/network/run to run.dpkg-old..."
-    mv /etc/network/run /etc/network/run.dpkg-old
-  fi
-
-  # The best choice is to use /dev/shm/network
-  #
-  # If we can't use that, we'll just make /etc/network/run a directory,
-  # unless we're upgrading, in which case we'll just keep ifstate where it
-  # is, by making /etc/network/run a symlink to /etc/network.
-
-  WHAT_TO_USE=devshm
-
-  if [ ! -d /dev/shm -o ! -w /dev/shm -o ! -r /proc/mounts ]; then
-    WHAT_TO_USE=owndir
-  elif ! grep -qs "^tmpfs[[:space:]]\+/dev/shm[[:space:]]\+tmpfs[[:space:]]\+\([^[:space:]]\+,\)\?rw" /proc/mounts
-  then
-    WHAT_TO_USE=owndir
-  elif grep -qs '[[:space:]]/dev[[:space:]]devfs[[:space:]]' /proc/mounts; then
-    WHAT_TO_USE=owndir
-  fi
 
-  # Check for available space if we are using devshm
-  if [ "$WHAT_TO_USE" = devshm ]; then
-    SPACE=`df -k /dev/shm | tail -1 | awk '{if ($4 ~ /%/) { print $3 } else { print $4 } }'`
-    if [ "$SPACE" -le 0 ]; then
-      WHAT_TO_USE=owndir
-    fi
-  fi
-
-  if [ "$WHAT_TO_USE" = owndir -a -e /etc/network/ifstate ]; then
-    WHAT_TO_USE=etcnetwork
-  fi
-
-  if [ "$WHAT_TO_USE" = devshm ]
-  then
-    [ -d /dev/shm/network ] || mkdir /dev/shm/network
-    ln -s /dev/shm/network /etc/network/run
-  elif [ "$WHAT_TO_USE" = "owndir" ]; then
-    mkdir /etc/network/run
-  else
-    ln -s . /etc/network/run
-  fi
-fi 
-
-# Move /etc/network/ifstate to /etc/network/run/ifstate
-if [ "$1" = configure -a "$2" != "" -a -e /etc/network/ifstate ] &&
-     dpkg --compare-versions "$2" lt "0.6.5"
+ATTEMPT_CONVERSION=false
+if [ "$1" = "configure" ] && [ "$2" != "" ] &&
+	dpkg --compare-versions "$2" lt "0.6.7ubuntu7"
 then
-  if [ ! -e /etc/network/run/ifstate ] || ! diff /etc/network/ifstate /etc/network/run/ifstate >/dev/null
-  then
-    echo "Moving /etc/network/ifstate to /etc/network/run/ifstate"
-    if [ ! -L /etc/network/ifstate ]; then
-      mv /etc/network/ifstate /etc/network/run/ifstate
+  # Get answers to questions
+  db_get ifupdown/convert-interfaces-hotplug;    ATTEMPT_CONVERSION="$RET"
+fi
+
+# Update /etc/network/interfaces from "mapping hotplug" to "auto"
+if [ "$ATTEMPT_CONVERSION" = "true" ]; then
+  echo
+  echo -n "Automatically converting /etc/network/interfaces"
+  (
+    cd /etc/network;
+    if /usr/share/ifupdown/upgrade-from-hotplug.pl \
+      < interfaces > interfaces.dpkg-new 2>/dev/null
+    then
+      echo " succeeded."
+      mv interfaces interfaces.dpkg-old
+      mv interfaces.dpkg-new interfaces
+      echo "Old interfaces file saved as interfaces.dpkg-old."
     else
-      cat /etc/network/ifstate >/etc/network/run/ifstate
-      mv /etc/network/ifstate /etc/network/ifstate.dpkg-old
+      echo " failed."
+      echo
+      echo "If you wish to reattempt the conversion you may run"
+      echo "    cat /etc/network/interfaces |"
+      echo "         /usr/share/ifupdown/upgrade-from-hotplug.pl"
+      echo
     fi
-  fi
+  )
 fi
-   
+
+
+# For every active ifupdown-controlled dhclient interface, copy
+# /var/run/dhclient.pid, so that the new ifdown is able to kill
+# dhclient.
+#
+# the old version had a bug with more than one DHCP iface anyway,
+# so we don't know which one the PID file actually belongs to.
 if [ "$1" = "configure" -a "$2" != "" ] &&
      dpkg --compare-versions "$2" le "0.6.4-4.1" &&
      [ -f /etc/network/run/ifstate -a -x /sbin/dhclient ]
 then
-  # for every active ifupdown-controlled dhclient interface, copy
-  # /var/run/dhclient.pid, so that the new ifdown is able to kill
-  # dhclient.
-  #
-  # the old version had a bug with more than one DHCP iface anyway,
-  # so we don't know which one the PID file actually belongs to.
 
   sed -e 's/^.*=//' /etc/network/run/ifstate |
     while read iface; do
@@ -132,6 +103,36 @@ then
     done
 fi
 
+# Move /etc/network/ifstate or /etc/network/run/ifstate to
+# /var/run/network/ifstate if that has been turned into a tmpfs already
+if [ "$1" = configure -a "$2" != "" ] &&
+     dpkg --compare-versions "$2" lt "0.6.7ubuntu4"
+then
+    if mountpoint -q /var/run; then
+	[ -d /var/run/network ] || mkdir /var/run/network
+	[ ! -e /etc/network/ifstate ] || mv -f /etc/network/ifstate /var/run/network/ifstate
+	[ ! -e /etc/network/run/ifstate ] || mv -f /etc/network/run/ifstate /var/run/network/ifstate
+    else
+	# Yes, this will break things, but only until reboot <g>
+	rm -f /etc/network/ifstate /etc/network/run/ifstate
+	if [ -x /usr/share/update-notifier/notify-reboot-required ]; then
+	    /usr/share/update-notifier/notify-reboot-required
+	fi
+    fi
+    [ ! -d /etc/network/run ] || rmdir /etc/network/run 2>/dev/null || true
+fi
+
+# Remove the ifupdown and ifupdown-clean init script symlinks
+if [ "$1" = "configure" -a "$2" != "" ] &&
+     dpkg --compare-versions "$2" lt "0.6.7ubuntu4"
+then
+    rm -f /etc/init.d/ifupdown /etc/init.d/ifupdown-clean
+    rm -f /etc/default/ifupdown
+	
+    update-rc.d -f ifupdown remove
+    update-rc.d -f ifupdown-clean remove
+fi
+
 # Generic stuff done on all configurations
 if [ "$1" = "configure" ] ; then
   if [ -f /etc/network/interfaces ] ; then
diff -pruN 0.6.7/debian/rules 0.6.7ubuntu7/debian/rules
--- 0.6.7/debian/rules	2005-04-04 14:33:54.000000000 +0100
+++ 0.6.7ubuntu7/debian/rules	2006-01-23 18:42:20.000000000 +0000
@@ -123,6 +123,11 @@ install: build test
 
 	install -o $(ROOT_USER) -g $(ROOT_GROUP) -m 755 debian/upgrade-from-0.5.x.pl \
 		debian/tmp/usr/share/ifupdown/
+	install -o $(ROOT_USER) -g $(ROOT_GROUP) -m 755 debian/upgrade-from-hotplug.pl \
+		debian/tmp/usr/share/ifupdown/
+
+	install -o $(ROOT_USER) -g $(ROOT_GROUP) -m 644 debian/ifupdown.rules \
+		debian/tmp/etc/udev/rules.d/85-ifupdown.rules
 	touch install-stamp
 
 # Build architecture-independent files here.
@@ -142,8 +147,7 @@ binary-arch: build install
 	dh_installmenu
 #	dh_installemacsen
 #	dh_installpam
-	dh_installinit --name=ifupdown --no-start -- start 39 S .  start 36 0 6 .
-	dh_installinit --name=ifupdown-clean --no-start -- start 18 S .
+	dh_installinit --name=loopback --no-start -- start 08 S .
 	dh_installcron
 #	dh_installmanpages
 #	   ^-- can't do our symlink trick
diff -pruN 0.6.7/debian/templates 0.6.7ubuntu7/debian/templates
--- 0.6.7/debian/templates	2005-05-02 15:09:05.000000000 +0100
+++ 0.6.7ubuntu7/debian/templates	2006-01-30 13:06:01.000000000 +0000
@@ -6,82 +6,94 @@ Description: Update /etc/network/interfa
  change made between version 0.5.x and 0.6.x of ifupdown. It is however
  possible to automatically convert from the old format to the new in almost
  all cases.
-Description-ca: Voleu actualitzar el fitxer /etc/network/interfaces?
+Description-ca.UTF-8: Voleu actualitzar el fitxer /etc/network/interfaces?
  El format del fitxer /etc/network/interfaces de l'ifupdown s'ha modificat
- entre les versions 0.5.x i 0.6.x. Tot i aixÚ, en la majoria dels casos es
- pot actualitzar autom‡ticament del format vell al nou.
-Description-cs: Aktualizovat /etc/network/interfaces?
- Mezi verzemi 0.5.x a 0.6 programu ifupdown doπlo k malÈ, ale
- nekompatibilnÌ zmÏnÏ form·tu souboru /etc/network/interfaces. V tÈmÏ¯
- vπech p¯Ìpadech lze p¯evÈst data ze starÈho form·tu do novÈho zcela
- automaticky.
-Description-da: OpdatÈr /etc/network/interfaces?
- Formatet i filen /etc/network/interfaces har fÂet lavet en mindre men
- inkompatibel Êndring mellem version 0.5.x og 0.6.x af ifupdown. Det er dog
- muligt at automatisk konvertere fra det gamle format til det nye i nÊsten
- alle tilfÊlde.
-Description-de: Soll /etc/network/interfaces erneuert werden?
+ entre les versions 0.5.x i 0.6.x. Tot i aix√≤, en la majoria dels casos es
+ pot actualitzar autom√†ticament del format vell al nou.
+Description-cs.UTF-8: Aktualizovat /etc/network/interfaces?
+ Mezi verzemi 0.5.x a 0.6 programu ifupdown do≈°lo k mal√©, ale
+ nekompatibiln√≠ zmƒõnƒõ form√°tu souboru /etc/network/interfaces. V
+ t√©mƒõ≈ô v≈°ech p≈ô√≠padech lze p≈ôev√©st data ze star√©ho form√°tu do
+ nov√©ho zcela automaticky.
+Description-da.UTF-8: Opdat√©r /etc/network/interfaces?
+ Formatet i filen /etc/network/interfaces har f√•et lavet en mindre men
+ inkompatibel √¶ndring mellem version 0.5.x og 0.6.x af ifupdown. Det er
+ dog muligt at automatisk konvertere fra det gamle format til det nye i
+ n√¶sten alle tilf√¶lde.
+Description-de.UTF-8: Soll /etc/network/interfaces erneuert werden?
  Das Format von /etc/network/interfaces hat eine kleinere aber inkompatible
- ƒnderung zwischen Version 0.5.x und 0.6.x von ifupdown erfahren. Es ist
- jedoch in fast allen F‰llen mˆglich, automatisch vom alten in das neue
+ √Ñnderung zwischen Version 0.5.x und 0.6.x von ifupdown erfahren. Es ist
+ jedoch in fast allen F√§llen m√∂glich, automatisch vom alten in das neue
  Format zu konvertieren.
-Description-el: Õ· „ﬂÌÂÈ ‰È¸ÒË˘ÛÁ ÙÔı /etc/network/interfaces;
- « ‰ÔÏﬁ ÙÔı /etc/network/interfaces ‹ÎÎ·ÓÂ ÏÂ ›Ì· ÏÈÍÒ¸ ·ÎÎ‹ ·Û˝Ï‚·ÙÔ ÙÒ¸Ô
- ·¸ ÙÁÌ ›Í‰ÔÛÁ ÙÔı ·Í›ÙÔı ifupdown 0.5.x Í·È 0.6.x.  ŸÛÙ¸ÛÔ, ÂﬂÌ·È ‰ıÌ·Ùﬁ
- Á ·ıÙ¸Ï·ÙÁ ÏÂÙ·ÙÒÔﬁ ÙÁÚ ·ÎÈ‹Ú ‰ÔÏﬁÚ ÛÙÁ Ì›· „È· Û˜Â‰¸Ì ¸ÎÂÚ ÙÈÚ
- ÂÒÈÙ˛ÛÂÈÚ.
-Description-es: øActualizar /etc/network/interfaces
- El formato de /etc/network/interfaces ha sufrido un cambio pequeÒo pero
+Description-el.UTF-8: ŒùŒ± Œ≥ŒØŒΩŒµŒπ Œ¥ŒπœåœÅŒ∏œâœÉŒ∑ œÑŒøœÖ /etc/network/interfaces;
+ Œó Œ¥ŒøŒºŒÆ œÑŒøœÖ /etc/network/interfaces Œ¨ŒªŒªŒ±ŒæŒµ ŒºŒµ Œ≠ŒΩŒ±
+ ŒºŒπŒ∫œÅœå Œ±ŒªŒªŒ¨ Œ±œÉœçŒºŒ≤Œ±œÑŒø œÑœÅœåœÄŒø Œ±œÄœå œÑŒ∑ŒΩ Œ≠Œ∫Œ¥ŒøœÉŒ∑
+ œÑŒøœÖ œÄŒ±Œ∫Œ≠œÑŒøœÖ ifupdown 0.5.x Œ∫Œ±Œπ 0.6.x.  Œ©œÉœÑœåœÉŒø,
+ ŒµŒØŒΩŒ±Œπ Œ¥œÖŒΩŒ±œÑŒÆ Œ∑ Œ±œÖœÑœåŒºŒ±œÑŒ∑ ŒºŒµœÑŒ±œÑœÅŒøœÄŒÆ œÑŒ∑œÇ
+ œÄŒ±ŒªŒπŒ¨œÇ Œ¥ŒøŒºŒÆœÇ œÉœÑŒ∑ ŒΩŒ≠Œ± Œ≥ŒπŒ± œÉœáŒµŒ¥œåŒΩ œåŒªŒµœÇ œÑŒπœÇ
+ œÄŒµœÅŒπœÄœÑœéœÉŒµŒπœÇ.
+Description-es.UTF-8: ¬øActualizar /etc/network/interfaces
+ El formato de /etc/network/interfaces ha sufrido un cambio peque√±o pero
  incompatible entre las versiones 0.5.x y 0.6.x de ifupdown. No obstante,
- en casi todos los casos es posible realizar la conversiÛn autom·ticamente
- entre el formato antiguo y el nuevo.
-Description-fr: Mettre ‡ jour /etc/network/interfaces†?
+ en casi todos los casos es posible realizar la conversi√≥n
+ autom√°ticamente entre el formato antiguo y el nuevo.
+Description-fr.UTF-8: Mettre √† jour /etc/network/interfaces¬†?
  Le format du fichier /etc/network/interfaces a subi un changement mineur
  mais incompatible entre les versions 0.5.x et 0.6.x d'ifupdown. Il est
- nÈanmoins possible de convertir automatiquement ce fichier de l'ancien
+ n√©anmoins possible de convertir automatiquement ce fichier de l'ancien
  format au nouveau, dans la plupart des cas.
-Description-it: Aggiornare /etc/network/interfaces?
+Description-it.UTF-8: Aggiornare /etc/network/interfaces?
  Il formato del file /etc/network/interfaces ha subito un piccolo
  cambiamento che lo rende incompatibile fra le versioni 0.5.x e 0.6.x di
- ifupdown. Comunque, nella maggior parte dei casi, Ë possibile convertire
+ ifupdown. Comunque, nella maggior parte dei casi, √® possibile convertire
  automaticamente il file dal vecchio formato al nuovo.
-Description-ja: /etc/network/interfaces §Úππø∑§∑§ﬁ§π§´?
- /etc/network/interfaces §Œ∑¡º∞§œ°¢ifupdown §Œ 0.5.x §» 0.6.x
- §Œ§¢§§§¿§«∫Ÿ§´§ °¢§∑§´§∑»Û∏ﬂ¥π§Œ —ππ§¨π‘§Ô§Ï§ﬁ§∑§ø°£§€§‹§π§Ÿ§∆§ŒæÏπÁ°¢∏≈§§∑¡º∞§´§Èø∑§∑§§∑¡º∞§ÿº´∆∞≈™§À —¥π§«§≠§ﬁ§π°£
-Description-lt: Atnaujinti /etc/network/interfaces?
- Failo /etc/network/interfaces formatas ne˛ymiai, bet nesuderinamai
- skiriasi tarp ifupdown versij¯ 0.5.x ir 0.6.x, taËiau beveik visais
- atvejais galima automatikai konvertuoti i seno formato · nauj‡.
-Description-nl: /etc/network/interfaces bijwerken?
+Description-ja.UTF-8: /etc/network/interfaces „ÇíÊõ¥Êñ∞„Åó„Åæ„Åô„Åã?
+ /etc/network/interfaces „ÅÆÂΩ¢Âºè„ÅØ„ÄÅifupdown „ÅÆ 0.5.x „Å® 0.6.x
+ „ÅÆ„ÅÇ„ÅÑ„Å†„ÅßÁ¥∞„Åã„Å™„ÄÅ„Åó„Åã„ÅóÈùû‰∫íÊèõ„ÅÆÂ§âÊõ¥„ÅåË°å„Çè„Çå„Åæ„Åó„Åü„ÄÇ„Åª„Åº„Åô„Åπ„Å¶„ÅÆÂ†¥Âêà„ÄÅÂè§„ÅÑÂΩ¢Âºè„Åã„ÇâÊñ∞„Åó„ÅÑÂΩ¢Âºè„Å∏Ëá™ÂãïÁöÑ„Å´Â§âÊèõ„Åß„Åç„Åæ„Åô„ÄÇ
+Description-lt.UTF-8: Atnaujinti /etc/network/interfaces?
+ Failo /etc/network/interfaces formatas ne≈æymiai, bet nesuderinamai
+ skiriasi tarp ifupdown versij≈≥ 0.5.x ir 0.6.x, taƒçiau beveik visais
+ atvejais galima automati≈°kai konvertuoti i≈° seno formato ƒØ naujƒÖ.
+Description-nl.UTF-8: /etc/network/interfaces bijwerken?
  De indeling van /etc/network/interfaces heeft tussen versie 0.5.x en 0.6.x
  van ifupdown een kleine, maar incompatibele verandering ondergaan. In
  bijna alle gevallen is het echter mogelijk om automatisch het oude format
  naar het nieuwe om te zetten.
-Description-pl: UaktualniÊ /etc/network/interfaces?
- W porÛwnaniu z wersj± 0.5.x, wersja 0.6.x programu ifupdown wprowadza
- drobne zmiany, ktÛre jednak powoduj±, øe stara wersja pliku
- /etc/network/interfaces moøe nie pasowaÊ do nowej konfiguracji. Istnieje
- jednak moøliwo∂Ê automatycznej konwersji (w praktycznie wszystkich
+Description-pl.UTF-8: Uaktualniƒá /etc/network/interfaces?
+ W por√≥wnaniu z wersjƒÖ 0.5.x, wersja 0.6.x programu ifupdown wprowadza
+ drobne zmiany, kt√≥re jednak powodujƒÖ, ≈ºe stara wersja pliku
+ /etc/network/interfaces mo≈ºe nie pasowaƒá do nowej konfiguracji. Istnieje
+ jednak mo≈ºliwo≈õƒá automatycznej konwersji (w praktycznie wszystkich
  przypadkach) ze starego formatu do nowego.
-Description-pt_BR: Atualizar /etc/network/interfaces?
- O formato do arquivo /etc/network/interfaces sofreu uma mudanÁa menor mas
- incompatÌvel entre as versıes 0.5.x e 0.6.x do pacote ifupdown. PorÈm È
- possÌvel converter a partir do formato antigo para o novo formato na
+Description-pt_BR.UTF-8: Atualizar /etc/network/interfaces?
+ O formato do arquivo /etc/network/interfaces sofreu uma mudan√ßa menor mas
+ incompat√≠vel entre as vers√µes 0.5.x e 0.6.x do pacote ifupdown. Por√©m
+ √© poss√≠vel converter a partir do formato antigo para o novo formato na
  maioria dos casos.
-Description-ru: Ô¬Œœ◊…‘ÿ /etc/network/interfaces?
- Êœ“Õ¡‘ /etc/network/interfaces …Õ≈≈‘ Œ≈¬œÃÿ€…≈, Œœ Œ≈”œ◊Õ≈”‘…ÕŸ≈ …⁄Õ≈Œ≈Œ…—
- Õ≈÷ƒ’ ◊≈“”…—Õ… 0.5.x … 0.6.x ifupdown. ÔƒŒ¡Àœ ◊œ⁄Õœ÷Œœ ¡◊‘œÕ¡‘…ﬁ≈”À…
- –“≈œ¬“¡⁄œ◊¡‘ÿ ”‘¡“Ÿ  ∆œ“Õ¡‘ ” Œœ◊Ÿ  –œﬁ‘… ◊œ ◊”≈» ”Ã’ﬁ¡—».
-Description-sv: Uppdatera /etc/network/interfaces?
- Formatet pÂ /etc/network/interfaces genomgick en liten men inkompatibel
- ‰ndring mellan version 0.5.x och 0.6.x av ifupdown. Det ‰r dock mˆjligt
- att n‰stan alltid automatiskt konvertera frÂn det gamla formatet till det
- nya.
-Description-tr: /etc/network/interfaces g¸ncellensin mi?
- /etc/network/interfaces dosya biÁeminde 0.5.x'den 0.6.x s¸r¸m¸ne geÁi˛te
- k¸Á¸k fakat uyumsuzluk yaratan bir dei˛iklik oldu. Bununla birlikte eski
- biÁemin otomatik olarak yenisine dˆn¸˛t¸r¸lmesi neredeyse her durumda
- m¸mk¸nd¸r.
-Description-zh_CN: ∏¸–¬ /etc/network/interfaces ¬£ø
- ifupdown 0.5.x ”Î 0.6.x À˘ π”√µƒ /etc/network/interfaces
- µƒŒƒº˛∏Ò Ω÷Æº‰”–“ª∏ˆΩœ–°µ´ª•≤ªºÊ»›µƒ∏ƒ±‰£¨»ª∂¯‘⁄æ¯¥Û∂‡ ˝«Èøˆœ¬≥Ã–Ú∂ºƒ‹◊‘∂ØΩ´æ…∏Ò Ω◊™ªªµΩ–¬∏Ò Ω°£
+Description-ru.UTF-8: –û–±–Ω–æ–≤–∏—Ç—å /etc/network/interfaces?
+ –§–æ—Ä–º–∞—Ç /etc/network/interfaces –∏–º–µ–µ—Ç –Ω–µ–±–æ–ª—å—à–∏–µ, –Ω–æ
+ –Ω–µ—Å–æ–≤–º–µ—Å—Ç–∏–º—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –º–µ–∂–¥—É –≤–µ—Ä—Å–∏—è–º–∏
+ 0.5.x –∏ 0.6.x ifupdown. –û–¥–Ω–∞–∫–æ –≤–æ–∑–º–æ–∂–Ω–æ
+ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞—Ç—å —Å—Ç–∞—Ä—ã–π
+ —Ñ–æ—Ä–º–∞—Ç —Å –Ω–æ–≤—ã–π –ø–æ—á—Ç–∏ –≤–æ –≤—Å–µ—Ö —Å–ª—É—á–∞—è—Ö.
+Description-sv.UTF-8: Uppdatera /etc/network/interfaces?
+ Formatet p√• /etc/network/interfaces genomgick en liten men inkompatibel
+ √§ndring mellan version 0.5.x och 0.6.x av ifupdown. Det √§r dock m√∂jligt
+ att n√§stan alltid automatiskt konvertera fr√•n det gamla formatet till
+ det nya.
+Description-tr.UTF-8: /etc/network/interfaces g√ºncellensin mi?
+ /etc/network/interfaces dosya bi√ßeminde 0.5.x'den 0.6.x s√ºr√ºm√ºne
+ ge√ßi≈üte k√º√ß√ºk fakat uyumsuzluk yaratan bir deƒüi≈üiklik oldu. Bununla
+ birlikte eski bi√ßemin otomatik olarak yenisine d√∂n√º≈üt√ºr√ºlmesi
+ neredeyse her durumda m√ºmk√ºnd√ºr.
+Description-zh_CN.UTF-8: Êõ¥Êñ∞ /etc/network/interfaces ÂêóÔºü
+ ifupdown 0.5.x ‰∏é 0.6.x ÊâÄ‰ΩøÁî®ÁöÑ /etc/network/interfaces
+ ÁöÑÊñá‰ª∂Ê†ºÂºè‰πãÈó¥Êúâ‰∏Ä‰∏™ËæÉÂ∞è‰ΩÜ‰∫í‰∏çÂÖºÂÆπÁöÑÊîπÂèòÔºåÁÑ∂ËÄåÂú®ÁªùÂ§ßÂ§öÊï∞ÊÉÖÂÜµ‰∏ãÁ®ãÂ∫èÈÉΩËÉΩËá™Âä®Â∞ÜÊóßÊ†ºÂºèËΩ¨Êç¢Âà∞Êñ∞Ê†ºÂºè„ÄÇ
+
+Template: ifupdown/convert-interfaces-hotplug
+Type: boolean
+Default: true
+Description: Update /etc/network/interfaces?
+ The format of /etc/network/interfaces has had a minor but incompatible
+ change made for dapper. It is however possible to automatically convert
+ from the old format to the new in almost all cases.
diff -pruN 0.6.7/debian/templates.master 0.6.7ubuntu7/debian/templates.master
--- 0.6.7/debian/templates.master	2005-04-04 14:33:54.000000000 +0100
+++ 0.6.7ubuntu7/debian/templates.master	2006-01-23 17:44:12.000000000 +0000
@@ -6,3 +6,11 @@ _Description: Update /etc/network/interf
  change made between version 0.5.x and 0.6.x of ifupdown. It is however
  possible to automatically convert from the old format to the new in almost
  all cases.
+
+Template: ifupdown/convert-interfaces-hotplug
+Type: boolean
+Default: true
+_Description: Update /etc/network/interfaces?
+ The format of /etc/network/interfaces has had a minor but incompatible
+ change made for dapper. It is however possible to automatically convert
+ from the old format to the new in almost all cases.
diff -pruN 0.6.7/debian/upgrade-from-hotplug.pl 0.6.7ubuntu7/debian/upgrade-from-hotplug.pl
--- 0.6.7/debian/upgrade-from-hotplug.pl	1970-01-01 01:00:00.000000000 +0100
+++ 0.6.7ubuntu7/debian/upgrade-from-hotplug.pl	2006-01-30 13:05:48.000000000 +0000
@@ -0,0 +1,79 @@
+#!/usr/bin/perl -w
+
+use strict;
+
+my %doneifaces = ();
+my @orig = ();   # original interfaces file
+my $line;
+
+while($line = <STDIN>) {
+	if ($line =~ m/^\s*#/) {
+		push @orig, $line;
+		next;
+	}
+
+	my $tmp;
+	while ($line =~ m/\\\n$/ and $tmp = <>) {
+		$line .= $tmp;
+	}
+	push @orig, $line;
+}
+
+my @autos = ();
+sub upgrade
+{
+	my $block = shift;
+	$block =~ s/^(\s*)//s;
+	my $pre = $1;
+
+	$block =~ s/(\s*)$//s;
+	my $post = $1;
+	$post = $1 . $post while $block =~ s/(\s*\n\#[^\n]*)$//s;
+
+	my $out = "";
+	if ($block =~ m/^mapping\s+hotplug\b/) {
+		while ($block =~ m/^\s*map\s+(\S+)/mg) {
+			unless (grep { $_ eq $1 } @autos) {
+				$out .= "auto $1\n";
+				push @autos, $1;
+			}
+		}
+		$out =~ s/\n$//;
+	} elsif ($block =~ m/^auto\b/) {
+		$block =~ s/^auto\b//;
+		$pre .= "auto";
+	
+		while ($block =~ m/\s*(\S+)/sg) {
+			unless (grep { $_ eq $1 } @autos) {
+				$out .= " $1";
+				push @autos, $1;
+			}
+		}
+
+		return "" unless length $out;
+	} else {
+		$out = $block;
+	}
+
+	return $pre . $out . $post;
+}
+
+my $out = "";
+my $block = "";
+for my $x (@orig) {
+	my $y = $x;
+	$y =~ s/^\s*//s;
+	$y =~ s/\\\n//sg;
+	$y =~ s/\s*$//s;
+
+	if ($y =~ m/^(iface|auto|allow-\W+|mapping)\b/) {
+		$out .= upgrade $block;
+		$block = $x;
+	} else {
+		$block .= $x;
+	}
+}
+
+$out .= upgrade $block;
+
+print $out;
diff -pruN 0.6.7/ifup.8 0.6.7ubuntu7/ifup.8
--- 0.6.7/ifup.8	2005-04-04 14:33:54.000000000 +0100
+++ 0.6.7ubuntu7/ifup.8	2006-01-23 18:55:48.000000000 +0000
@@ -108,7 +108,7 @@ See
 .BR interfaces (5)
 for more information.
 .TP
-.I /etc/network/run/ifstate
+.I /var/run/network/ifstate
 current state of network interfaces
 .SH KNOWN BUGS/LIMITATIONS
 The program keeps records of whether network interfaces are up or down.
@@ -129,19 +129,15 @@ to run configuration or deconfiguration 
 it considers the current state of the interface to be.
 .P
 The file
-.I /etc/network/run/ifstate
+.I /var/run/network/ifstate
 must be writable for
 .B ifup
 or
 .B ifdown
-to work properly.
-If that location is not writable
-(for example, because the root filesystem is mounted read-only
-for system recovery)
-then
-.I /etc/network/run/ifstate
-should be made a symbolic link to a writable location.
-If that is not possible then you can use the
+to work properly.  On Ubuntu the
+.I /var/run
+location is a temporary filesystem which is always writable and thrown
+away on shutdown.  You can also use the
 .B \-\-force
 option to run configuration or deconfiguration commands
 without updating the file.
diff -pruN 0.6.7/ifupdown.nw 0.6.7ubuntu7/ifupdown.nw
--- 0.6.7/ifupdown.nw	2005-04-05 18:31:29.000000000 +0100
+++ 0.6.7ubuntu7/ifupdown.nw	2006-01-26 15:56:05.000000000 +0000
@@ -3165,6 +3165,8 @@ extern int verbose;
 <<main global variables>>=
 int no_act = 0;
 int verbose = 0;
+char *statefile = "/var/run/network/ifstate";
+char *tmpstatefile = "/var/run/network/.ifstate.tmp";
 @
 
 <<variables local to main>>=
@@ -3173,7 +3175,6 @@ int run_mappings = 1;
 int force = 0;
 char *allow_class = NULL;
 char *interfaces = "/etc/network/interfaces";
-char *statefile = "/etc/network/run/ifstate";
 char *excludeint = NULL ;
 @ 
 
@@ -3352,14 +3353,15 @@ if ( !defn ) {
 A broad overview of what we'll actually be doing is as follows:
 
 <<run commands for appropriate interfaces>>=
-<<lock 'n load ifupdown state>>
 <<determine target interfaces>>
 {
 	int i;
 	for (<<each target interface, [[i]]>>) {
 		char iface[80], liface[80];
+		const char *current_state;
 
 		<<initialize [[iface]] to [[i]]th target interface>>
+		current_state = read_state(argv[0], iface);
 		if (!force) {
 			<<check ifupdown state (possibly [[continue]])>>
 		}
@@ -3376,10 +3378,8 @@ A broad overview of what we'll actually 
 		}
 
 		<<bring interface up/down and update ifupdown state>>
-		<<commit ifupdown state>>
 	}
 }
-<<close ifupdown state>>
 @
 
 We'll leave determining the appropriate target interfaces and dealing
@@ -3432,6 +3432,9 @@ Bringing an interface up or taking it do
 	interface_defn *currif;
 	int okay = 0;
 	int failed = 0; 
+	
+	<<update ifupdown state>>
+
 	for (currif = defn->ifaces; currif; currif = currif->next) {
 		if (strcmp(liface, currif->logical_iface) == 0) {
 			okay = 1;
@@ -3447,6 +3450,7 @@ Bringing an interface up or taking it do
 	if (!okay && !force) {
 		fprintf(stderr, "Ignoring unknown interface %s=%s.\n", 
 			iface, liface);
+		update_state (argv[0], iface, NULL);
 	} else {
 		<<update ifupdown state>>
 	}
@@ -3511,8 +3515,7 @@ if (do_all) {
 		target_iface = autos ? autos->interfaces : NULL;
 		n_target_ifaces = autos ? autos->n_interfaces : 0;
 	} else if (<<we're taking interfaces down>>) {
-		target_iface = state;
-		n_target_ifaces = n_state;
+		read_all_state(argv[0], &target_iface, &n_target_ifaces);
 	} else {
 		assert(0);
 	}	
@@ -3545,58 +3548,131 @@ Since it's generally not feasible to rer
 interface is configured (since a mapping script may well bring the
 interface down while it's investigating matters), we need to maintain a
 statefile between invocations to keep track of which physical interfaces
-were mapped to which logical ones. We ought to use 
-[[/var/run/ifupdown.state]] or something similar for this, but [[/var]]
-isn't guaranteed to be available until the network's up, so we'll use
-[[/etc/network/run/ifstate]] instead.
-
-<<variables local to main>>=
-char **state = NULL; /* list of iface=liface */
-int n_state = 0;
-int max_state = 0;
-@ 
-
-We'll also use two helper functions: one to lookup an interface, and one to
-add an interface.
+were mapped to which logical ones.  This file also serves to record which
+interfaces have been configured so far, and which haven't.  On Ubuntu we
+use [[/var/run/network/ifstate]] as that filesystem is guaranteed to be
+a tmpfs, meaning we don't have to worry about cleaning up after a reboot.
+
+Because different interfaces may be brought up and down at the same time,
+it's important that all updates to the state file are atomic and that we
+aren't confused by any changes made by another running process.  For this
+reason we use functions to examine or modify the state file at the point
+necessary rather than holding it all in memory.
 
 <<main function declarations>>=
-static int lookfor_iface(char **ifaces, int n_ifaces, char *iface);
+static const char *read_state(const char *argv0, const char *iface);
+static void read_all_state(const char *argv0, char ***ifaces, int *n_ifaces);
+static void update_state(const char *argv0, const char *iface, const char *liface);
 @ 
 
+The first of these functions reads the state file to look for an interface
+and returns the current state of it as a pointer to a static buffer which
+should be copied if it's needed for any duration.  If the interface has no
+current state (ie. is down) then NULL is returned.
+
 <<main functions>>=
-static int lookfor_iface(char **ifaces, int n_ifaces, char *iface) {
-	int i;
-	for (i = 0; i < n_ifaces; i++) {
-		if (strncmp(iface, ifaces[i], strlen(iface)) == 0) {
-			if (ifaces[i][strlen(iface)] == '=') {
-				return i;
+static const char *
+read_state (const char *argv0, const char *iface)
+{
+	char *ret = NULL;
+
+	<<open ifupdown state>>
+
+	while((p = fgets(buf, sizeof buf, state_fp)) != NULL) {
+		<<parse ifupdown state line>>
+
+		if (strncmp(iface, pch, strlen(iface)) == 0) {
+			if (pch[strlen(iface)] == '=') {
+				ret = pch + strlen(iface) + 1;
+				break;
 			}
 		}
 	}
-	return -1;
+
+	<<close ifupdown state>>
+
+	return ret;
 }
-@ 
+@
 
-<<main function declarations>>=
-static void add_to_state(char ***ifaces, int *n_ifaces, int *max_ifaces, 
-                         char *new_iface);
-@ 
+The second of these functions is a variant on the above used to grab a list
+of all currently up interfaces so we can tear them all down.
 
 <<main functions>>=
-static void add_to_state(char ***ifaces, int *n_ifaces, int *max_ifaces, 
-                         char *new_iface)
+static void
+read_all_state (const char *argv0, char ***ifaces, int *n_ifaces)
 {
-	assert(*max_ifaces >= *n_ifaces);
-	if (*max_ifaces == *n_ifaces) {
-		*max_ifaces = (*max_ifaces * 2) + 1;
-		*ifaces = realloc(*ifaces, sizeof(**ifaces) * *max_ifaces);
-		if (*ifaces == NULL) {
-			perror("realloc");
-			exit(1);
+	<<open ifupdown state>>
+
+	*n_ifaces = 0;
+	*ifaces = NULL;
+
+	while((p = fgets(buf, sizeof buf, state_fp)) != NULL) {
+		<<parse ifupdown state line>>
+
+		(*n_ifaces)++;
+		*ifaces = realloc (*ifaces, sizeof (**ifaces) * *n_ifaces);
+		(*ifaces)[(*n_ifaces)-1] = strdup (pch);
+	}
+
+	<<close ifupdown state>>
+}
+@
+
+The last of these functions is used to modify a state file, specifically
+for the interface given as the first argument.  If the second argument is
+NULL then any existing state for that interface is removed from the file,
+otherwise any existing state is changed to the new state or a new state
+line is appended.
+
+<<main functions>>=
+static void update_state(const char *argv0, const char *iface, const char *state)
+{
+	FILE *tmp_fp;
+
+	<<open ifupdown state>>
+
+	if (no_act)
+		goto noact;
+
+	tmp_fp = fopen(tmpstatefile, "w");
+	if (tmp_fp == NULL) {
+		fprintf(stderr, 
+			"%s: failed to open temporary statefile %s: %s\n",
+			argv0, tmpstatefile, strerror(errno));
+		exit (1);
+	}
+
+	while((p = fgets(buf, sizeof buf, state_fp)) != NULL) {
+		<<parse ifupdown state line>>
+
+		if (strncmp(iface, pch, strlen(iface)) == 0) {
+			if (pch[strlen(iface)] == '=') {
+				if (state != NULL) {
+					fprintf (tmp_fp, "%s=%s\n",
+						 iface, state);
+					state = NULL;
+				}
+
+				continue;
+			}
 		}
+
+		fprintf (tmp_fp, "%s\n", pch);
 	}
 
-	(*ifaces)[(*n_ifaces)++] = new_iface;
+	if (state != NULL)
+		fprintf (tmp_fp, "%s=%s\n", iface, state);
+
+	fclose (tmp_fp);
+	if (rename (tmpstatefile, statefile)) {
+		fprintf(stderr, 
+			"%s: failed to overwrite statefile %s: %s\n",
+			argv0, statefile, strerror(errno));
+		exit (1);
+	}
+
+	<<close ifupdown state>>
 }
 @ 
 
@@ -3623,112 +3699,86 @@ static int lock_fd (int fd) {
 }
 @ 
 
-
-<<variables local to main>>=
-static FILE *state_fp = NULL;
-@
-
-<<lock 'n load ifupdown state>>=
-{
-	state_fp = fopen(statefile, no_act ? "r" : "a+");
-	if (state_fp == NULL && !no_act) {
+<<open ifupdown state>>=
+FILE *state_fp;
+char buf[80];
+char *p;
+
+state_fp = fopen(statefile, no_act ? "r" : "a+");
+if (state_fp == NULL) {
+	if (!no_act) {
 		fprintf(stderr, 
 			"%s: failed to open statefile %s: %s\n",
-			argv[0], statefile, strerror(errno));
+			argv0, statefile, strerror(errno));
 		exit (1);
+	} else {
+		goto noact;
 	}
+}
 
-	if (state_fp != NULL) {
-		char buf[80];
-		char *p;
-
-		if (!no_act) {
-			int flags;
-
-			if ((flags = fcntl(fileno(state_fp), F_GETFD)) < 0
-			    || fcntl(fileno(state_fp), F_SETFD, flags | FD_CLOEXEC) < 0) {
-				fprintf(stderr, 
-					"%s: failed to set FD_CLOEXEC on statefile %s: %s\n",
-					argv[0], statefile, strerror(errno));
-				exit(1);
-			}
-
-			if (lock_fd (fileno(state_fp)) < 0) {
-				fprintf(stderr, 
-					"%s: failed to lock statefile %s: %s\n",
-					argv[0], statefile, strerror(errno));
-				exit(1);
-			}
-
-		}
-
-		rewind (state_fp);
-		while((p = fgets(buf, sizeof buf, state_fp)) != NULL) {
-			char *pch;
-
-			pch = buf + strlen(buf) - 1;
-			while(pch > buf && isspace(*pch)) pch--;
-			*(pch+1) = '\0';
+if (!no_act) {
+	int flags;
 
-			pch = buf;
-			while(isspace(*pch)) pch++;
+	if ((flags = fcntl(fileno(state_fp), F_GETFD)) < 0
+	    || fcntl(fileno(state_fp), F_SETFD, flags | FD_CLOEXEC) < 0) {
+		fprintf(stderr, 
+			"%s: failed to set FD_CLOEXEC on statefile %s: %s\n",
+			argv0, statefile, strerror(errno));
+		exit(1);
+	}
 
-			add_to_state(&state, &n_state, &max_state, strdup(pch));
-		}
+	if (lock_fd (fileno(state_fp)) < 0) {
+		fprintf(stderr, 
+			"%s: failed to lock statefile %s: %s\n",
+			argv0, statefile, strerror(errno));
+		exit(1);
 	}
 }
 @
 
+<<parse ifupdown state line>>=
+char *pch;
+
+pch = buf + strlen(buf) - 1;
+while(pch > buf && isspace(*pch)) pch--;
+*(pch+1) = '\0';
+
+pch = buf;
+while(isspace(*pch)) pch++;
+@ 
+
 <<close ifupdown state>>=
+noact:
 if (state_fp != NULL) {
 	fclose(state_fp);
 	state_fp = NULL;
 }
 @
 
-
-<<commit ifupdown state>>=
-if (state_fp != NULL && !no_act) {
-	int i;
-
-	if (ftruncate(fileno(state_fp), 0) < 0)
-	{
-		fprintf(stderr, 
-			"%s: failed to truncate statefile %s: %s\n",
-			argv[0], statefile, strerror(errno));
-		exit(1);
-	}
-
-	rewind(state_fp);
-	for (i = 0; i < n_state; i++) {
-		fprintf(state_fp, "%s\n", state[i]);
-	}
-	fflush(state_fp);
-}
-@
-
 This leaves our two useful chunks. The first checks to ensure what we're
 proposing to do is reasonable (ie, we're not downing an interface that's
 not up, or uping one that's not down).
 
 <<check ifupdown state (possibly [[continue]])>>=
 {
-	int already_up = lookfor_iface(state, n_state, iface);;
-
 	if (<<we're bringing interfaces up>>) {
-		if (already_up != -1) {
-			fprintf(stderr, 
-				"%s: interface %s already configured\n",
-				argv[0], iface);
+		if (current_state != NULL) {
+			if (!do_all) {
+				fprintf(stderr, 
+					"%s: interface %s already configured\n",
+					argv[0], iface);
+			}
 			continue;
 		}
 	} else if (<<we're taking interfaces down>>) {
-		if (already_up == -1) {
-			fprintf(stderr, "%s: interface %s not configured\n",
-				argv[0], iface);
+		if (current_state == NULL) {
+			if (!do_all) {
+				fprintf(stderr, "%s: interface %s not configured\n",
+					argv[0], iface);
+			}
 			continue;
 		}
-		strncpy(liface, strchr(state[already_up], '=') + 1, 80);
+		strncpy(liface, current_state, 80);
 		liface[79] = 0;
 	} else {
 		assert(0);
@@ -3741,27 +3791,19 @@ interfaces up and down.
 
 <<update ifupdown state>>=
 {
-	int already_up = lookfor_iface(state, n_state, iface);
-
 	if (<<we're bringing interfaces up>>) {
-		char *newiface = 
-			malloc(strlen(iface) + 1 + strlen(liface) + 1);
-		sprintf(newiface, "%s=%s", iface, liface);
-
-		if (already_up == -1) {
+		if (current_state == NULL) {
 			if (failed == 1) {
 				printf("Failed to bring up %s.\n", liface);
+				update_state (argv[0], iface, NULL);
 			} else {
-				add_to_state(&state, &n_state, &max_state, newiface);
+				update_state (argv[0], iface, liface);
 			}
 		} else {
-			free(state[already_up]);
-			state[already_up] = newiface;
+			update_state (argv[0], iface, liface);
 		}
 	} else if (<<we're taking interfaces down>>) {
-		if (already_up != -1) {
-			state[already_up] = state[--n_state];
-		}
+		update_state (argv[0], iface, NULL);
 	} else {
 		assert(0);
 	}
@@ -3920,7 +3962,7 @@ method dhcp
 
   up
     [[ifconfig %iface% hw %hwaddress%]]
-    dhclient3 -pf /var/run/dhclient.%iface%.pid -lf /var/run/dhclient.%iface%.leases %iface% \
+    dhclient3 -pf /var/run/dhclient.%iface%.pid -lf /var/lib/dhcp3/dhclient.%iface%.leases %iface% \
         if (execable("/sbin/dhclient3"))
     dhclient -e -pf /var/run/dhclient.%iface%.pid -lf /var/run/dhclient.%iface%.leases %iface% \
         elsif (execable("/sbin/dhclient"))
@@ -3934,7 +3976,7 @@ method dhcp
         elsif (execable("/sbin/dhcpcd"))
 
   down
-    dhclient3 -r -pf /var/run/dhclient.%iface%.pid -lf /var/run/dhclient.%iface%.leases %iface% \
+    dhclient3 -r -pf /var/run/dhclient.%iface%.pid -lf /var/lib/dhcp3/dhclient.%iface%.leases %iface% \
         if (execable("/sbin/dhclient3"))
     cat /var/run/dhclient.%iface%.pid | xargs -i kill -TERM {} \
         elsif (execable("/sbin/dhclient"))
diff -pruN 0.6.7/inet.defn 0.6.7ubuntu7/inet.defn
--- 0.6.7/inet.defn	2005-05-02 14:58:08.000000000 +0100
+++ 0.6.7ubuntu7/inet.defn	2006-01-26 15:59:36.000000000 +0000
@@ -75,7 +75,7 @@ method dhcp
 
   up
     [[ifconfig %iface% hw %hwaddress%]]
-    dhclient3 -pf /var/run/dhclient.%iface%.pid -lf /var/run/dhclient.%iface%.leases %iface% \
+    dhclient3 -pf /var/run/dhclient.%iface%.pid -lf /var/lib/dhcp3/dhclient.%iface%.leases %iface% \
         if (execable("/sbin/dhclient3"))
     dhclient -e -pf /var/run/dhclient.%iface%.pid -lf /var/run/dhclient.%iface%.leases %iface% \
         elsif (execable("/sbin/dhclient"))
@@ -89,7 +89,7 @@ method dhcp
         elsif (execable("/sbin/dhcpcd"))
 
   down
-    dhclient3 -r -pf /var/run/dhclient.%iface%.pid -lf /var/run/dhclient.%iface%.leases %iface% \
+    dhclient3 -r -pf /var/run/dhclient.%iface%.pid -lf /var/lib/dhcp3/dhclient.%iface%.leases %iface% \
         if (execable("/sbin/dhclient3"))
     cat /var/run/dhclient.%iface%.pid | xargs -i kill -TERM {} \
         elsif (execable("/sbin/dhclient"))
diff -pruN 0.6.7/main.c 0.6.7ubuntu7/main.c
--- 0.6.7/main.c	2005-05-02 14:58:05.000000000 +0100
+++ 0.6.7ubuntu7/main.c	2006-01-26 15:59:34.000000000 +0000
@@ -17,23 +17,24 @@
 #line 3166 "ifupdown.nw"
 int no_act = 0;
 int verbose = 0;
-#line 3184 "ifupdown.nw"
+char *statefile = "/var/run/network/ifstate";
+char *tmpstatefile = "/var/run/network/.ifstate.tmp";
+#line 3185 "ifupdown.nw"
 static void usage(char *execname);
 static void help(char *execname);
 static void version(char *execname);
 #line 3563 "ifupdown.nw"
-static int lookfor_iface(char **ifaces, int n_ifaces, char *iface);
-#line 3581 "ifupdown.nw"
-static void add_to_state(char ***ifaces, int *n_ifaces, int *max_ifaces, 
-                         char *new_iface);
-#line 3606 "ifupdown.nw"
+static const char *read_state(const char *argv0, const char *iface);
+static void read_all_state(const char *argv0, char ***ifaces, int *n_ifaces);
+static void update_state(const char *argv0, const char *iface, const char *liface);
+#line 3682 "ifupdown.nw"
 static int lock_fd (int fd);
-#line 3190 "ifupdown.nw"
+#line 3191 "ifupdown.nw"
 static void usage(char *execname) {
 	fprintf(stderr, "%s: Use --help for help\n", execname);
 	exit(1);
 }
-#line 3197 "ifupdown.nw"
+#line 3198 "ifupdown.nw"
 static void version(char *execname) {
 	printf("%s version " IFUPDOWN_VERSION "\n", execname);
 	printf("Copyright (c) 1999-2005 Anthony Towns\n\n");
@@ -47,7 +48,7 @@ static void version(char *execname) {
 	);
 	exit(0);
 }
-#line 3213 "ifupdown.nw"
+#line 3214 "ifupdown.nw"
 static void help(char *execname) {
 	printf("Usage: %s <options> <ifaces...>\n\n", execname);
 	printf("Options:\n");
@@ -63,35 +64,257 @@ static void help(char *execname) {
 	printf("\t--force\t\t\tforce de/configuration\n");
 	exit(0);
 }
-#line 3567 "ifupdown.nw"
-static int lookfor_iface(char **ifaces, int n_ifaces, char *iface) {
-	int i;
-	for (i = 0; i < n_ifaces; i++) {
-		if (strncmp(iface, ifaces[i], strlen(iface)) == 0) {
-			if (ifaces[i][strlen(iface)] == '=') {
-				return i;
+#line 3574 "ifupdown.nw"
+static const char *
+read_state (const char *argv0, const char *iface)
+{
+	char *ret = NULL;
+
+	
+#line 3703 "ifupdown.nw"
+FILE *state_fp;
+char buf[80];
+char *p;
+
+state_fp = fopen(statefile, no_act ? "r" : "a+");
+if (state_fp == NULL) {
+	if (!no_act) {
+		fprintf(stderr, 
+			"%s: failed to open statefile %s: %s\n",
+			argv0, statefile, strerror(errno));
+		exit (1);
+	} else {
+		goto noact;
+	}
+}
+
+if (!no_act) {
+	int flags;
+
+	if ((flags = fcntl(fileno(state_fp), F_GETFD)) < 0
+	    || fcntl(fileno(state_fp), F_SETFD, flags | FD_CLOEXEC) < 0) {
+		fprintf(stderr, 
+			"%s: failed to set FD_CLOEXEC on statefile %s: %s\n",
+			argv0, statefile, strerror(errno));
+		exit(1);
+	}
+
+	if (lock_fd (fileno(state_fp)) < 0) {
+		fprintf(stderr, 
+			"%s: failed to lock statefile %s: %s\n",
+			argv0, statefile, strerror(errno));
+		exit(1);
+	}
+}
+
+#line 3581 "ifupdown.nw"
+	while((p = fgets(buf, sizeof buf, state_fp)) != NULL) {
+		
+#line 3740 "ifupdown.nw"
+char *pch;
+
+pch = buf + strlen(buf) - 1;
+while(pch > buf && isspace(*pch)) pch--;
+*(pch+1) = '\0';
+
+pch = buf;
+while(isspace(*pch)) pch++;
+
+#line 3584 "ifupdown.nw"
+		if (strncmp(iface, pch, strlen(iface)) == 0) {
+			if (pch[strlen(iface)] == '=') {
+				ret = pch + strlen(iface) + 1;
+				break;
 			}
 		}
 	}
-	return -1;
+
+	
+#line 3751 "ifupdown.nw"
+noact:
+if (state_fp != NULL) {
+	fclose(state_fp);
+	state_fp = NULL;
+}
+
+#line 3594 "ifupdown.nw"
+	return ret;
+}
+#line 3602 "ifupdown.nw"
+static void
+read_all_state (const char *argv0, char ***ifaces, int *n_ifaces)
+{
+	
+#line 3703 "ifupdown.nw"
+FILE *state_fp;
+char buf[80];
+char *p;
+
+state_fp = fopen(statefile, no_act ? "r" : "a+");
+if (state_fp == NULL) {
+	if (!no_act) {
+		fprintf(stderr, 
+			"%s: failed to open statefile %s: %s\n",
+			argv0, statefile, strerror(errno));
+		exit (1);
+	} else {
+		goto noact;
+	}
+}
+
+if (!no_act) {
+	int flags;
+
+	if ((flags = fcntl(fileno(state_fp), F_GETFD)) < 0
+	    || fcntl(fileno(state_fp), F_SETFD, flags | FD_CLOEXEC) < 0) {
+		fprintf(stderr, 
+			"%s: failed to set FD_CLOEXEC on statefile %s: %s\n",
+			argv0, statefile, strerror(errno));
+		exit(1);
+	}
+
+	if (lock_fd (fileno(state_fp)) < 0) {
+		fprintf(stderr, 
+			"%s: failed to lock statefile %s: %s\n",
+			argv0, statefile, strerror(errno));
+		exit(1);
+	}
+}
+
+#line 3607 "ifupdown.nw"
+	*n_ifaces = 0;
+	*ifaces = NULL;
+
+	while((p = fgets(buf, sizeof buf, state_fp)) != NULL) {
+		
+#line 3740 "ifupdown.nw"
+char *pch;
+
+pch = buf + strlen(buf) - 1;
+while(pch > buf && isspace(*pch)) pch--;
+*(pch+1) = '\0';
+
+pch = buf;
+while(isspace(*pch)) pch++;
+
+#line 3613 "ifupdown.nw"
+		(*n_ifaces)++;
+		*ifaces = realloc (*ifaces, sizeof (**ifaces) * *n_ifaces);
+		(*ifaces)[(*n_ifaces)-1] = strdup (pch);
+	}
+
+	
+#line 3751 "ifupdown.nw"
+noact:
+if (state_fp != NULL) {
+	fclose(state_fp);
+	state_fp = NULL;
 }
-#line 3586 "ifupdown.nw"
-static void add_to_state(char ***ifaces, int *n_ifaces, int *max_ifaces, 
-                         char *new_iface)
+#line 3619 "ifupdown.nw"
+}
+#line 3629 "ifupdown.nw"
+static void update_state(const char *argv0, const char *iface, const char *state)
 {
-	assert(*max_ifaces >= *n_ifaces);
-	if (*max_ifaces == *n_ifaces) {
-		*max_ifaces = (*max_ifaces * 2) + 1;
-		*ifaces = realloc(*ifaces, sizeof(**ifaces) * *max_ifaces);
-		if (*ifaces == NULL) {
-			perror("realloc");
-			exit(1);
+	FILE *tmp_fp;
+
+	
+#line 3703 "ifupdown.nw"
+FILE *state_fp;
+char buf[80];
+char *p;
+
+state_fp = fopen(statefile, no_act ? "r" : "a+");
+if (state_fp == NULL) {
+	if (!no_act) {
+		fprintf(stderr, 
+			"%s: failed to open statefile %s: %s\n",
+			argv0, statefile, strerror(errno));
+		exit (1);
+	} else {
+		goto noact;
+	}
+}
+
+if (!no_act) {
+	int flags;
+
+	if ((flags = fcntl(fileno(state_fp), F_GETFD)) < 0
+	    || fcntl(fileno(state_fp), F_SETFD, flags | FD_CLOEXEC) < 0) {
+		fprintf(stderr, 
+			"%s: failed to set FD_CLOEXEC on statefile %s: %s\n",
+			argv0, statefile, strerror(errno));
+		exit(1);
+	}
+
+	if (lock_fd (fileno(state_fp)) < 0) {
+		fprintf(stderr, 
+			"%s: failed to lock statefile %s: %s\n",
+			argv0, statefile, strerror(errno));
+		exit(1);
+	}
+}
+
+#line 3635 "ifupdown.nw"
+	if (no_act)
+		goto noact;
+
+	tmp_fp = fopen(tmpstatefile, "w");
+	if (tmp_fp == NULL) {
+		fprintf(stderr, 
+			"%s: failed to open temporary statefile %s: %s\n",
+			argv0, tmpstatefile, strerror(errno));
+		exit (1);
+	}
+
+	while((p = fgets(buf, sizeof buf, state_fp)) != NULL) {
+		
+#line 3740 "ifupdown.nw"
+char *pch;
+
+pch = buf + strlen(buf) - 1;
+while(pch > buf && isspace(*pch)) pch--;
+*(pch+1) = '\0';
+
+pch = buf;
+while(isspace(*pch)) pch++;
+
+#line 3649 "ifupdown.nw"
+		if (strncmp(iface, pch, strlen(iface)) == 0) {
+			if (pch[strlen(iface)] == '=') {
+				if (state != NULL) {
+					fprintf (tmp_fp, "%s=%s\n",
+						 iface, state);
+					state = NULL;
+				}
+
+				continue;
+			}
 		}
+
+		fprintf (tmp_fp, "%s\n", pch);
 	}
 
-	(*ifaces)[(*n_ifaces)++] = new_iface;
+	if (state != NULL)
+		fprintf (tmp_fp, "%s=%s\n", iface, state);
+
+	fclose (tmp_fp);
+	if (rename (tmpstatefile, statefile)) {
+		fprintf(stderr, 
+			"%s: failed to overwrite statefile %s: %s\n",
+			argv0, statefile, strerror(errno));
+		exit (1);
+	}
+
+	
+#line 3751 "ifupdown.nw"
+noact:
+if (state_fp != NULL) {
+	fclose(state_fp);
+	state_fp = NULL;
+}
+#line 3676 "ifupdown.nw"
 }
-#line 3610 "ifupdown.nw"
+#line 3686 "ifupdown.nw"
 static int lock_fd (int fd) {
 	struct flock lock;
 
@@ -125,25 +348,18 @@ struct option long_opts[] = {
 	{"force",       no_argument,       NULL,  2 },
 	{0,0,0,0}
 };
-#line 3171 "ifupdown.nw"
+#line 3173 "ifupdown.nw"
 int do_all = 0;
 int run_mappings = 1;
 int force = 0;
 char *allow_class = NULL;
 char *interfaces = "/etc/network/interfaces";
-char *statefile = "/etc/network/run/ifstate";
 char *excludeint = NULL ;
-#line 3338 "ifupdown.nw"
+#line 3339 "ifupdown.nw"
 interfaces_file *defn;
-#line 3497 "ifupdown.nw"
+#line 3501 "ifupdown.nw"
 int n_target_ifaces;
 char **target_iface;
-#line 3554 "ifupdown.nw"
-char **state = NULL; /* list of iface=liface */
-int n_state = 0;
-int max_state = 0;
-#line 3628 "ifupdown.nw"
-static FILE *state_fp = NULL;
 
 #line 2992 "ifupdown.nw"
 	
@@ -196,7 +412,7 @@ if (strcmp(command, "ifup")==0) {
 }
 #line 2995 "ifupdown.nw"
 	
-#line 3234 "ifupdown.nw"
+#line 3235 "ifupdown.nw"
 for(;;) {
 	int c;
 	c = getopt_long(argc, argv, "e:s:i:hVvna", long_opts, NULL);
@@ -204,66 +420,66 @@ for(;;) {
 
 	switch(c) {
 		
-#line 3252 "ifupdown.nw"
+#line 3253 "ifupdown.nw"
 case 'i':
 	interfaces = strdup(optarg);
 	break;
-#line 3257 "ifupdown.nw"
+#line 3258 "ifupdown.nw"
 case 'v':
 	verbose = 1;
 	break;
-#line 3262 "ifupdown.nw"
+#line 3263 "ifupdown.nw"
 case 'a':
 	do_all = 1;
 	break;
-#line 3267 "ifupdown.nw"
+#line 3268 "ifupdown.nw"
 case 3:
 	allow_class = strdup(optarg);
 	break;
-#line 3272 "ifupdown.nw"
+#line 3273 "ifupdown.nw"
 case 'n':
 	no_act = 1;
 	break;
-#line 3277 "ifupdown.nw"
+#line 3278 "ifupdown.nw"
 case 1:
 	run_mappings = 0;
 	break;
-#line 3282 "ifupdown.nw"
+#line 3283 "ifupdown.nw"
 case 2:
 	force = 1;
 	break;
-#line 3287 "ifupdown.nw"
+#line 3288 "ifupdown.nw"
 case 'e':
 	excludeint = strdup(optarg);
 	break;
-#line 3295 "ifupdown.nw"
+#line 3296 "ifupdown.nw"
 case 'h':
 	help(argv[0]);
 	break;
-#line 3300 "ifupdown.nw"
+#line 3301 "ifupdown.nw"
 case 'V':
 	version(argv[0]);
 	break;
-#line 3309 "ifupdown.nw"
+#line 3310 "ifupdown.nw"
 default:
 	usage(argv[0]);
 	break;
-#line 3241 "ifupdown.nw"
+#line 3242 "ifupdown.nw"
 	}
 }
 
-#line 3321 "ifupdown.nw"
+#line 3322 "ifupdown.nw"
 if (argc - optind > 0 && do_all) {
 	usage(argv[0]);
 }
-#line 3327 "ifupdown.nw"
+#line 3328 "ifupdown.nw"
 if (argc - optind == 0 && !do_all) {
 	usage(argv[0]);
 }
 
 #line 2997 "ifupdown.nw"
 	
-#line 3342 "ifupdown.nw"
+#line 3343 "ifupdown.nw"
 defn = read_interfaces(interfaces);
 if ( !defn ) {
 	fprintf(stderr, "%s: couldn't read interfaces file \"%s\"\n",
@@ -273,61 +489,12 @@ if ( !defn ) {
 
 #line 2999 "ifupdown.nw"
 	
-#line 3632 "ifupdown.nw"
-{
-	state_fp = fopen(statefile, no_act ? "r" : "a+");
-	if (state_fp == NULL && !no_act) {
-		fprintf(stderr, 
-			"%s: failed to open statefile %s: %s\n",
-			argv[0], statefile, strerror(errno));
-		exit (1);
-	}
-
-	if (state_fp != NULL) {
-		char buf[80];
-		char *p;
-
-		if (!no_act) {
-			int flags;
-
-			if ((flags = fcntl(fileno(state_fp), F_GETFD)) < 0
-			    || fcntl(fileno(state_fp), F_SETFD, flags | FD_CLOEXEC) < 0) {
-				fprintf(stderr, 
-					"%s: failed to set FD_CLOEXEC on statefile %s: %s\n",
-					argv[0], statefile, strerror(errno));
-				exit(1);
-			}
-
-			if (lock_fd (fileno(state_fp)) < 0) {
-				fprintf(stderr, 
-					"%s: failed to lock statefile %s: %s\n",
-					argv[0], statefile, strerror(errno));
-				exit(1);
-			}
-
-		}
-
-		rewind (state_fp);
-		while((p = fgets(buf, sizeof buf, state_fp)) != NULL) {
-			char *pch;
-
-			pch = buf + strlen(buf) - 1;
-			while(pch > buf && isspace(*pch)) pch--;
-			*(pch+1) = '\0';
-
-			pch = buf;
-			while(isspace(*pch)) pch++;
-
-			add_to_state(&state, &n_state, &max_state, strdup(pch));
-		}
-	}
-}
-#line 3508 "ifupdown.nw"
+#line 3512 "ifupdown.nw"
 if (do_all) {
 	if (
 #line 3087 "ifupdown.nw"
 (cmds == iface_up)
-#line 3509 "ifupdown.nw"
+#line 3513 "ifupdown.nw"
                                      ) {
 		allowup_defn *autos = find_allowup(defn, "auto");
 		target_iface = autos ? autos->interfaces : NULL;
@@ -335,10 +502,9 @@ if (do_all) {
 	} else if (
 #line 3091 "ifupdown.nw"
 (cmds == iface_down)
-#line 3513 "ifupdown.nw"
+#line 3517 "ifupdown.nw"
                                             ) {
-		target_iface = state;
-		n_target_ifaces = n_state;
+		read_all_state(argv[0], &target_iface, &n_target_ifaces);
 	} else {
 		assert(0);
 	}	
@@ -350,14 +516,15 @@ if (do_all) {
 {
 	int i;
 	for (
-#line 3502 "ifupdown.nw"
+#line 3506 "ifupdown.nw"
 i = 0; i < n_target_ifaces; i++
 #line 3359 "ifupdown.nw"
                                       ) {
 		char iface[80], liface[80];
+		const char *current_state;
 
 		
-#line 3526 "ifupdown.nw"
+#line 3529 "ifupdown.nw"
 strncpy(iface, target_iface[i], sizeof(iface));
 iface[sizeof(iface)-1] = '\0';
 
@@ -372,48 +539,51 @@ iface[sizeof(iface)-1] = '\0';
 		liface[sizeof(liface)-1] = '\0';
 	}
 }
-#line 3363 "ifupdown.nw"
+#line 3364 "ifupdown.nw"
+		current_state = read_state(argv[0], iface);
 		if (!force) {
 			
-#line 3715 "ifupdown.nw"
+#line 3763 "ifupdown.nw"
 {
-	int already_up = lookfor_iface(state, n_state, iface);;
-
 	if (
 #line 3087 "ifupdown.nw"
 (cmds == iface_up)
-#line 3718 "ifupdown.nw"
+#line 3764 "ifupdown.nw"
                                      ) {
-		if (already_up != -1) {
-			fprintf(stderr, 
-				"%s: interface %s already configured\n",
-				argv[0], iface);
+		if (current_state != NULL) {
+			if (!do_all) {
+				fprintf(stderr, 
+					"%s: interface %s already configured\n",
+					argv[0], iface);
+			}
 			continue;
 		}
 	} else if (
 #line 3091 "ifupdown.nw"
 (cmds == iface_down)
-#line 3725 "ifupdown.nw"
+#line 3773 "ifupdown.nw"
                                             ) {
-		if (already_up == -1) {
-			fprintf(stderr, "%s: interface %s not configured\n",
-				argv[0], iface);
+		if (current_state == NULL) {
+			if (!do_all) {
+				fprintf(stderr, "%s: interface %s not configured\n",
+					argv[0], iface);
+			}
 			continue;
 		}
-		strncpy(liface, strchr(state[already_up], '=') + 1, 80);
+		strncpy(liface, current_state, 80);
 		liface[79] = 0;
 	} else {
 		assert(0);
 	}
 }
-#line 3365 "ifupdown.nw"
+#line 3367 "ifupdown.nw"
 		}
 
 		if (
 #line 3100 "ifupdown.nw"
 (allow_class != NULL)
 
-#line 3367 "ifupdown.nw"
+#line 3369 "ifupdown.nw"
                                                     ) {
 			
 #line 3103 "ifupdown.nw"
@@ -430,20 +600,20 @@ iface[sizeof(iface)-1] = '\0';
 	if (i >= allowup->n_interfaces)
 		continue;
 }
-#line 3369 "ifupdown.nw"
+#line 3371 "ifupdown.nw"
 		}
 
 		if (
 #line 3125 "ifupdown.nw"
 (excludeint != NULL && strstr(iface,excludeint) != NULL)
-#line 3371 "ifupdown.nw"
+#line 3373 "ifupdown.nw"
                                                )  
 			continue;
 
 		if (
 #line 3087 "ifupdown.nw"
 (cmds == iface_up)
-#line 3374 "ifupdown.nw"
+#line 3376 "ifupdown.nw"
                                        && run_mappings) {
 			
 #line 3392 "ifupdown.nw"
@@ -469,7 +639,7 @@ run_mapping(iface, liface, sizeof(liface
 		}
 	}
 }
-#line 3376 "ifupdown.nw"
+#line 3378 "ifupdown.nw"
 		}
 
 		
@@ -478,12 +648,43 @@ run_mapping(iface, liface, sizeof(liface
 	interface_defn *currif;
 	int okay = 0;
 	int failed = 0; 
+	
+	
+#line 3793 "ifupdown.nw"
+{
+	if (
+#line 3087 "ifupdown.nw"
+(cmds == iface_up)
+#line 3794 "ifupdown.nw"
+                                     ) {
+		if (current_state == NULL) {
+			if (failed == 1) {
+				printf("Failed to bring up %s.\n", liface);
+				update_state (argv[0], iface, NULL);
+			} else {
+				update_state (argv[0], iface, liface);
+			}
+		} else {
+			update_state (argv[0], iface, liface);
+		}
+	} else if (
+#line 3091 "ifupdown.nw"
+(cmds == iface_down)
+#line 3805 "ifupdown.nw"
+                                            ) {
+		update_state (argv[0], iface, NULL);
+	} else {
+		assert(0);
+	}
+}
+
+#line 3438 "ifupdown.nw"
 	for (currif = defn->ifaces; currif; currif = currif->next) {
 		if (strcmp(liface, currif->logical_iface) == 0) {
 			okay = 1;
 
 			
-#line 3457 "ifupdown.nw"
+#line 3461 "ifupdown.nw"
 {
 	currif->real_iface = iface;
 
@@ -515,7 +716,7 @@ run_mapping(iface, liface, sizeof(liface
 	currif->real_iface = NULL;
 }
 
-#line 3441 "ifupdown.nw"
+#line 3444 "ifupdown.nw"
 			if (failed) break;
 			/* Otherwise keep going: this interface may have
 			 * match with other address families */
@@ -525,74 +726,42 @@ run_mapping(iface, liface, sizeof(liface
 	if (!okay && !force) {
 		fprintf(stderr, "Ignoring unknown interface %s=%s.\n", 
 			iface, liface);
+		update_state (argv[0], iface, NULL);
 	} else {
 		
-#line 3743 "ifupdown.nw"
+#line 3793 "ifupdown.nw"
 {
-	int already_up = lookfor_iface(state, n_state, iface);
-
 	if (
 #line 3087 "ifupdown.nw"
 (cmds == iface_up)
-#line 3746 "ifupdown.nw"
+#line 3794 "ifupdown.nw"
                                      ) {
-		char *newiface = 
-			malloc(strlen(iface) + 1 + strlen(liface) + 1);
-		sprintf(newiface, "%s=%s", iface, liface);
-
-		if (already_up == -1) {
+		if (current_state == NULL) {
 			if (failed == 1) {
 				printf("Failed to bring up %s.\n", liface);
+				update_state (argv[0], iface, NULL);
 			} else {
-				add_to_state(&state, &n_state, &max_state, newiface);
+				update_state (argv[0], iface, liface);
 			}
 		} else {
-			free(state[already_up]);
-			state[already_up] = newiface;
+			update_state (argv[0], iface, liface);
 		}
 	} else if (
 #line 3091 "ifupdown.nw"
 (cmds == iface_down)
-#line 3761 "ifupdown.nw"
+#line 3805 "ifupdown.nw"
                                             ) {
-		if (already_up != -1) {
-			state[already_up] = state[--n_state];
-		}
+		update_state (argv[0], iface, NULL);
 	} else {
 		assert(0);
 	}
 }
-#line 3452 "ifupdown.nw"
+#line 3456 "ifupdown.nw"
 	}
 }
-#line 3379 "ifupdown.nw"
-		
-#line 3691 "ifupdown.nw"
-if (state_fp != NULL && !no_act) {
-	int i;
-
-	if (ftruncate(fileno(state_fp), 0) < 0)
-	{
-		fprintf(stderr, 
-			"%s: failed to truncate statefile %s: %s\n",
-			argv[0], statefile, strerror(errno));
-		exit(1);
-	}
-
-	rewind(state_fp);
-	for (i = 0; i < n_state; i++) {
-		fprintf(state_fp, "%s\n", state[i]);
-	}
-	fflush(state_fp);
-}
-#line 3380 "ifupdown.nw"
+#line 3381 "ifupdown.nw"
 	}
 }
-#line 3683 "ifupdown.nw"
-if (state_fp != NULL) {
-	fclose(state_fp);
-	state_fp = NULL;
-}
 
 #line 3001 "ifupdown.nw"
 	return 0;
