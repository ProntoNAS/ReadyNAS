diff -ru mod_auth_pam/mod_auth_pam.c mod_auth_pam.debian/mod_auth_pam.c
--- mod_auth_pam/mod_auth_pam.c	2002-08-24 16:22:23.000000000 +0200
+++ mod_auth_pam.debian/mod_auth_pam.c	2004-08-17 14:32:41.000000000 +0200
@@ -324,6 +324,7 @@
     /* PAM specific  */
     struct pam_conv conv_info = {&auth_pam_talker, (void *) &userinfo};
     pam_handle_t *pamh = NULL;
+    int str_is_ip;
 
 #if SOLARIS2 == 260
     global_userinfo = &userinfo;
@@ -358,11 +359,10 @@
 #endif
 
     /* set remote user information */
-    /*
-     * this seems to cause segfaults in lots of cases -- disabled for now
-     * pam_set_item(pamh, PAM_USER, userinfo.name); pam_set_item(pamh,
-     * PAM_RHOST, get_remote_host(r->connection, conf, REMOTE_NAME));
-     */
+    /* this seems to cause segfaults in lots of cases */
+    pam_set_item(pamh, PAM_USER, userinfo.name);
+    pam_set_item(pamh, PAM_RHOST, ap_get_remote_host(r->connection,
+	r->per_dir_config, REMOTE_NAME, &str_is_ip));
 
     /* try to authenticate user, log error on failure */
     if ((res = pam_authenticate(pamh, PAM_DISALLOW_NULL_AUTHTOK)) !=
