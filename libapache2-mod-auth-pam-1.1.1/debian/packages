# $Id: /trunk/debian/dists/libapache2-mod-auth-pam/debian/packages 25 2005-02-28T13:52:14.403583Z dexter  $

# If the debian/rules or debian/control file is missing, rebuild the file:
#
#   $ yada rebuild control
#   $ yada rebuild rules

%define apache2_version %`dpkg -s apache2-prefork-dev|grep ^Version|sed 's/^Version: //'`

# Other macros:
#   apache2_version=%{apache2_version}

Source: libapache2-mod-auth-pam
Section: web
Priority: extra
Maintainer: Piotr Roszatycki <dexter@debian.org>
Standards-Version: 3.6.1
Upstream-Source: <URL:http://pam.sourceforge.net/mod_auth_pam/dist/mod_auth_pam-2.0-(.*)\.tar\.gz>
Home-Page: <URL:http://pam.sourceforge.net/mod_auth_pam/>
Description: module for Apache2 which authenticate using PAM
Copyright: .
 Copyright (c) 2000 Ingo Luetkebohle, All rights reserved.
 .
 Redistribution and use in source and binary forms, with or without
 modification, are permitted provided that the following conditions
 are met:
 .
 1. Redistributions of source code must retain the above copyright
    notice, this list of conditions and the following disclaimer.
 .
 2. Redistributions in binary form must reproduce the above copyright
    notice, this list of conditions and the following disclaimer in
    the documentation and/or other materials provided with the
    distribution.
 .
 THIS SOFTWARE IS PROVIDED ``AS IS'' AND ANY EXPRESSED OR IMPLIED
 WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
 OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
 DISCLAIMED.  IN NO EVENT SHALL THE AUTHOR OR OTHER CODE CONTRIBUTORS
 BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY,
 OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT
 OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS;
 OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF
 LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT
 OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
 SUCH DAMAGE.
Patches: patches/*.diff
Major-Changes:
 [001] renamed PAM service name to "apache2"
 [002] set PAM_RHOST and PAM_USER variables
Build-Depends: apache2-prefork-dev (>= 2.0.50-9), libpam0g-dev
Build: sh
 CC=${CC:-gcc}
 CFLAGS=${CFLAGS:--g -Wall}
 APXS2=${APXS2:-apxs2}
 if [ "${DEB_BUILD_OPTIONS#*noopt}" != "$DEB_BUILD_OPTIONS" ]; then
      CFLAGS="$CFLAGS -O0"
 else
      CFLAGS="$CFLAGS -O2"
 fi
 make mod_auth_pam.la CC="$CC" CFLAGS="$CFLAGS" APXS="$APXS2" LIBS="-lpam"
 make mod_auth_sys_group.la CC="$CC" CFLAGS="$CFLAGS" APXS="$APXS2" LIBS=""
Clean: sh
 make clean || true
 rm -rf .libs/

Package: libapache2-mod-auth-pam
Architecture: any
Depends: apache2.2-common (>= %{apache2_version}), []
Description: module for Apache2 which authenticate using PAM
 mod_auth_pam implements authentication routines using PAM (Plugable
 Authentication Modules) for apache's authentication protocol.
 .
 This package provides the module for Apache 2.0 server.
Install: sh
 yada install -lib -into /usr/lib/apache2/modules .libs/mod_auth_pam.so
 yada install -conf -into /etc/apache2/mods-available debian/conf/auth_pam.load
 yada install -conf -into /etc/pam.d -as apache2 debian/conf/apache2.pam.conf
 yada install -doc doc/faq.html doc/configure.html
 yada install -doc debian/doc/README.Debian
Postinst: sh
 reload_apache()
 {
     if apache2ctl configtest 2>/dev/null; then
         invoke-rc.d apache2 force-reload || true
     else
         echo "Your apache2 configuration is broken, so we're not restarting it for you."
     fi
 }
 .
 if [ -n "$2" ]; then
     # we're upgrading. test if we're enabled, and if so, restart to reload the module.
     if [ -e /etc/apache2/mods-enabled/auth_pam.load ]; then
         reload_apache
     fi
     exit 0
 elif [ -e /etc/apache2/apache2.conf ]; then
     a2enmod auth_pam >/dev/null || true
     reload_apache
 fi
Prerm: sh
 if [ "$1" = "remove" ] || [ "$1" = "purge" ]; then
     if [ -e /etc/apache2/apache2.conf ]; then
         a2dismod auth_pam || true
     fi
 fi

Package: libapache2-mod-auth-sys-group
Architecture: any
Depends: apache2.2-common (>= %{apache2_version}), []
Description: Module for Apache2 which checks user against system group
 mod_auth_pam implements 'require group' functionality against system group
 database. 
 .
 This package provides the module for Apache 2.0 server.
Install: sh
 yada install -lib -into /usr/lib/apache2/modules .libs/mod_auth_sys_group.so
 yada install -conf -into /etc/apache2/mods-available debian/conf/auth_sys_group.load
 yada install -doc debian/doc/README.Debian.libapache2-mod-auth-sys-group
Postinst: sh
 reload_apache()
 {
     if apache2ctl configtest 2>/dev/null; then
         invoke-rc.d apache2 force-reload || true
     else
         echo "Your apache2 configuration is broken, so we're not restarting it for you."
     fi
 }
 .
 if [ -n "$2" ]; then
     # we're upgrading. test if we're enabled, and if so, restart to reload the module.
     if [ -e /etc/apache2/mods-enabled/auth_sys_group.load ]; then
         reload_apache
     fi
     exit 0
 elif [ -e /etc/apache2/apache2.conf ]; then
     a2enmod auth_sys_group >/dev/null || true
     reload_apache
 fi
Prerm: sh
 if [ "$1" = "remove" ] || [ "$1" = "purge" ]; then
     if [ -e /etc/apache2/apache2.conf ]; then
         a2dismod auth_sys_group || true
     fi
 fi
