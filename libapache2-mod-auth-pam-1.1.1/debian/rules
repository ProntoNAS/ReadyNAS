#!/usr/bin/make -f
# Generated automatically from debian/packages
# by yada v0.34, of Mon, 25 Apr 2005

DEB_HOST_ARCH        := $(shell dpkg-architecture -qDEB_HOST_ARCH)
DEB_HOST_GNU_CPU     := $(shell dpkg-architecture -qDEB_HOST_GNU_CPU)
DEB_HOST_GNU_TYPE    := $(shell dpkg-architecture -qDEB_HOST_GNU_TYPE)
DEB_HOST_GNU_SYSTEM  := $(shell dpkg-architecture -qDEB_HOST_GNU_SYSTEM)

DEB_BUILD_ARCH       := $(shell dpkg-architecture -qDEB_BUILD_ARCH)
DEB_BUILD_GNU_CPU    := $(shell dpkg-architecture -qDEB_BUILD_GNU_CPU)
DEB_BUILD_GNU_TYPE   := $(shell dpkg-architecture -qDEB_BUILD_GNU_TYPE)
DEB_BUILD_GNU_SYSTEM := $(shell dpkg-architecture -qDEB_BUILD_GNU_SYSTEM)

VERSION:=$(shell LC_ALL=C dpkg-parsechangelog | sed -ne 's/^Version: *\([^2]*\)/\1/p')

SHELL=/bin/bash

.PHONY: default
default:
	@echo "Specify a target:"; \
	echo " build              compile the package"; \
	echo " build-arch         compile the architecture-dependent package"; \
	echo " build-indep        compile the architecture-independent package"; \
	echo " binary             make all binary packages"; \
	echo " binary-arch        make all architecture-dependent binary packages"; \
	echo " binary-indep       make all architecture-independent binary packages"; \
	echo " clean              clean up the source package"; \
	echo; \
	echo " clean-install-tree clean up only under debian/"; \
	echo

# Build the package and prepare the install tree

.PHONY: build-only build
build-only: debian/build-stamp
build: build-only

.PHONY: build-arch-only build-arch
build-arch-only: debian/build-arch-stamp
build-arch: build-arch-only

.PHONY: build-indep-only build-indep
build-indep-only: debian/build-indep-stamp
build-indep: build-indep-only

# Make sure these rules and the control file are up-to-date

.PHONY: rules control templates
rules: debian/rules
debian/rules: $(shell which yada) debian/packages-tmp
	yada rebuild rules

control: debian/control
debian/control: $(shell which yada) debian/packages-tmp
	yada rebuild control

templates: debian/templates
debian/templates: $(shell which yada) debian/packages-tmp
	yada rebuild templates

debian/build-stamp: debian/build-arch-stamp debian/build-indep-stamp
	@[ -f $(shell which yada) -a -f debian/rules ]
	yada patch "debian/patches/*.diff"
	@umask 022 \
	  && export pwd="$$(pwd)" \
	  && export TMPROOT="$$(pwd)/debian/tmp" \
	  && export SOURCE="libapache2-mod-auth-pam" \
	  && export VERSION="$(VERSION)" \
	  && export DEB_HOST_GNU_CPU="$(DEB_HOST_GNU_CPU)" \
	  && export DEB_HOST_GNU_TYPE="$(DEB_HOST_GNU_TYPE)" \
	  && export DEB_HOST_GNU_SYSTEM="$(DEB_HOST_GNU_SYSTEM)" \
	  && export DEB_BUILD_GNU_CPU="$(DEB_BUILD_GNU_CPU)" \
	  && export DEB_BUILD_GNU_TYPE="$(DEB_BUILD_GNU_TYPE)" \
	  && export DEB_BUILD_GNU_SYSTEM="$(DEB_BUILD_GNU_SYSTEM)" && (\
	echo -E 'eval "yada () { perl $$(which yada) \"\$$@\"; }"; set -e; set -v';\
	echo -E 'CC=$${CC:-gcc}';\
	echo -E 'CFLAGS=$${CFLAGS:--g -Wall}';\
	echo -E 'APXS2=$${APXS2:-apxs2}';\
	echo -E 'if [ "$${DEB_BUILD_OPTIONS#*noopt}" != "$$DEB_BUILD_OPTIONS" ]; then';\
	echo -E '     CFLAGS="$$CFLAGS -O0"';\
	echo -E 'else';\
	echo -E '     CFLAGS="$$CFLAGS -O2"';\
	echo -E 'fi';\
	echo -E 'make mod_auth_pam.la CC="$$CC" CFLAGS="$$CFLAGS" APXS="$$APXS2" LIBS="-lpam"';\
	echo -E 'make mod_auth_sys_group.la CC="$$CC" CFLAGS="$$CFLAGS" APXS="$$APXS2" LIBS=""') | /bin/sh
	touch debian/build-stamp

debian/build-arch-stamp:
	@[ -f $(shell which yada) -a -f debian/rules ]
	yada patch "debian/patches/*.diff"
	touch debian/build-arch-stamp

debian/build-indep-stamp:
	@[ -f $(shell which yada) -a -f debian/rules ]
	yada patch "debian/patches/*.diff"
	touch debian/build-indep-stamp

.PHONY: install-tree
install-tree: install-tree-any
install-tree-any: \
	debian/tmp-libapache2-mod-auth-sys-group/DEBIAN/control \
	debian/tmp-libapache2-mod-auth-pam/DEBIAN/control

debian/tmp-libapache2-mod-auth-sys-group/DEBIAN/control: debian/build-stamp debian/control
	rm -rf debian/tmp-libapache2-mod-auth-sys-group
	umask 022 && install -d debian/tmp-libapache2-mod-auth-sys-group/DEBIAN
	install -d debian/tmp-libapache2-mod-auth-sys-group/usr/share/doc/libapache2-mod-auth-sys-group
	umask 022; yada generate copyright \
	  > debian/tmp-libapache2-mod-auth-sys-group/usr/share/doc/libapache2-mod-auth-sys-group/copyright
	install -m 644 -p debian/changelog \
	  debian/tmp-libapache2-mod-auth-sys-group/usr/share/doc/libapache2-mod-auth-sys-group/changelog.Debian
	@umask 022 \
	  && export pwd="$$(pwd)" \
	  && export ROOT="$$(pwd)/debian/tmp-libapache2-mod-auth-sys-group" \
	  && export TMPROOT="$$(pwd)/debian/tmp" \
	  && export CONTROL="$$(pwd)/debian/tmp-libapache2-mod-auth-sys-group/DEBIAN" \
	  && export PACKAGE="libapache2-mod-auth-sys-group" \
	  && export SOURCE="libapache2-mod-auth-pam" \
	  && export VERSION="$(VERSION)" \
	  && export DEB_HOST_GNU_CPU="$(DEB_HOST_GNU_CPU)" \
	  && export DEB_HOST_GNU_TYPE="$(DEB_HOST_GNU_TYPE)" \
	  && export DEB_HOST_GNU_SYSTEM="$(DEB_HOST_GNU_SYSTEM)" \
	  && export DEB_BUILD_GNU_CPU="$(DEB_BUILD_GNU_CPU)" \
	  && export DEB_BUILD_GNU_TYPE="$(DEB_BUILD_GNU_TYPE)" \
	  && export DEB_BUILD_GNU_SYSTEM="$(DEB_BUILD_GNU_SYSTEM)" && (\
	echo -E 'eval "yada () { perl $$(which yada) \"\$$@\"; }"; set -e; set -v';\
	echo -E 'yada install -lib -into /usr/lib/apache2/modules .libs/mod_auth_sys_group.so';\
	echo -E 'yada install -conf -into /etc/apache2/mods-available debian/conf/auth_sys_group.load';\
	echo -E 'yada install -doc debian/doc/README.Debian.libapache2-mod-auth-sys-group') | /bin/sh
	@umask 022 \
	  && export pwd="$$(pwd)" \
	  && export ROOT="$$(pwd)/debian/tmp-libapache2-mod-auth-sys-group" \
	  && export TMPROOT="$$(pwd)/debian/tmp" \
	  && export CONTROL="$$(pwd)/debian/tmp-libapache2-mod-auth-sys-group/DEBIAN" \
	  && export PACKAGE="libapache2-mod-auth-sys-group" \
	  && export SOURCE="libapache2-mod-auth-pam" \
	  && export VERSION="$(VERSION)" && (\
	echo -E 'eval "yada () { perl $$(which yada) \"\$$@\"; }"; set -e; set -v';\
	echo -E 'yada perl';\
	echo -E 'yada python';\
	echo -E 'yada strip';\
	echo -E 'yada shlibdeps') | /bin/sh
	yada compress libapache2-mod-auth-sys-group
	yada generate maintscripts libapache2-mod-auth-sys-group
	find debian/tmp-libapache2-mod-auth-sys-group -type f -print \
	  | sed -n 's/^debian\/tmp-libapache2-mod-auth-sys-group\(\/etc\/.*\)$$/\1/p' \
	  > debian/tmp-libapache2-mod-auth-sys-group/DEBIAN/conffiles
	if test ! -s debian/tmp-libapache2-mod-auth-sys-group/DEBIAN/conffiles; then rm -f debian/tmp-libapache2-mod-auth-sys-group/DEBIAN/conffiles; fi
	yada rebuild control
	yada generate substvars libapache2-mod-auth-sys-group
	umask 022 && dpkg-gencontrol -isp -plibapache2-mod-auth-sys-group -Pdebian/tmp-libapache2-mod-auth-sys-group

debian/tmp-libapache2-mod-auth-pam/DEBIAN/control: debian/build-stamp debian/control
	rm -rf debian/tmp-libapache2-mod-auth-pam
	umask 022 && install -d debian/tmp-libapache2-mod-auth-pam/DEBIAN
	install -d debian/tmp-libapache2-mod-auth-pam/usr/share/doc/libapache2-mod-auth-pam
	umask 022; yada generate copyright \
	  > debian/tmp-libapache2-mod-auth-pam/usr/share/doc/libapache2-mod-auth-pam/copyright
	install -m 644 -p debian/changelog \
	  debian/tmp-libapache2-mod-auth-pam/usr/share/doc/libapache2-mod-auth-pam/changelog.Debian
	@umask 022 \
	  && export pwd="$$(pwd)" \
	  && export ROOT="$$(pwd)/debian/tmp-libapache2-mod-auth-pam" \
	  && export TMPROOT="$$(pwd)/debian/tmp" \
	  && export CONTROL="$$(pwd)/debian/tmp-libapache2-mod-auth-pam/DEBIAN" \
	  && export PACKAGE="libapache2-mod-auth-pam" \
	  && export SOURCE="libapache2-mod-auth-pam" \
	  && export VERSION="$(VERSION)" \
	  && export DEB_HOST_GNU_CPU="$(DEB_HOST_GNU_CPU)" \
	  && export DEB_HOST_GNU_TYPE="$(DEB_HOST_GNU_TYPE)" \
	  && export DEB_HOST_GNU_SYSTEM="$(DEB_HOST_GNU_SYSTEM)" \
	  && export DEB_BUILD_GNU_CPU="$(DEB_BUILD_GNU_CPU)" \
	  && export DEB_BUILD_GNU_TYPE="$(DEB_BUILD_GNU_TYPE)" \
	  && export DEB_BUILD_GNU_SYSTEM="$(DEB_BUILD_GNU_SYSTEM)" && (\
	echo -E 'eval "yada () { perl $$(which yada) \"\$$@\"; }"; set -e; set -v';\
	echo -E 'yada install -lib -into /usr/lib/apache2/modules .libs/mod_auth_pam.so';\
	echo -E 'yada install -conf -into /etc/apache2/mods-available debian/conf/auth_pam.load';\
	echo -E 'yada install -conf -into /etc/pam.d -as apache2 debian/conf/apache2.pam.conf';\
	echo -E 'yada install -doc doc/faq.html doc/configure.html';\
	echo -E 'yada install -doc debian/doc/README.Debian') | /bin/sh
	@umask 022 \
	  && export pwd="$$(pwd)" \
	  && export ROOT="$$(pwd)/debian/tmp-libapache2-mod-auth-pam" \
	  && export TMPROOT="$$(pwd)/debian/tmp" \
	  && export CONTROL="$$(pwd)/debian/tmp-libapache2-mod-auth-pam/DEBIAN" \
	  && export PACKAGE="libapache2-mod-auth-pam" \
	  && export SOURCE="libapache2-mod-auth-pam" \
	  && export VERSION="$(VERSION)" && (\
	echo -E 'eval "yada () { perl $$(which yada) \"\$$@\"; }"; set -e; set -v';\
	echo -E 'yada perl';\
	echo -E 'yada python';\
	echo -E 'yada strip';\
	echo -E 'yada shlibdeps') | /bin/sh
	yada compress libapache2-mod-auth-pam
	yada generate maintscripts libapache2-mod-auth-pam
	find debian/tmp-libapache2-mod-auth-pam -type f -print \
	  | sed -n 's/^debian\/tmp-libapache2-mod-auth-pam\(\/etc\/.*\)$$/\1/p' \
	  > debian/tmp-libapache2-mod-auth-pam/DEBIAN/conffiles
	if test ! -s debian/tmp-libapache2-mod-auth-pam/DEBIAN/conffiles; then rm -f debian/tmp-libapache2-mod-auth-pam/DEBIAN/conffiles; fi
	yada rebuild control
	yada generate substvars libapache2-mod-auth-pam
	umask 022 && dpkg-gencontrol -isp -plibapache2-mod-auth-pam -Pdebian/tmp-libapache2-mod-auth-pam

# Build package files

.PHONY: binary binary-arch binary-indep
binary: binary-arch binary-indep
binary-arch: binary-arch-any

.PHONY: binary-arch-any
binary-arch-any: \
	binary-package-libapache2-mod-auth-sys-group \
	binary-package-libapache2-mod-auth-pam
binary-indep:

.PHONY: binary-package-libapache2-mod-auth-sys-group
binary-package-libapache2-mod-auth-sys-group: check-root debian/tmp-libapache2-mod-auth-sys-group/DEBIAN/control
	@[ -f $(shell which yada) -a -f debian/rules ]
	chown -R 0.0 debian/tmp-libapache2-mod-auth-sys-group
	chmod -R u=rwX,go=rX debian/tmp-libapache2-mod-auth-sys-group
	@if [ -d debian/tmp-libapache2-mod-auth-sys-group/usr/doc/libapache2-mod-auth-sys-group ]; then \
	  echo "*** Yada warning: /usr/doc/libapache2-mod-auth-sys-group should be /usr/share/doc/libapache2-mod-auth-sys-group";\
	fi
	dpkg-deb --build debian/tmp-libapache2-mod-auth-sys-group ..

.PHONY: binary-package-libapache2-mod-auth-pam
binary-package-libapache2-mod-auth-pam: check-root debian/tmp-libapache2-mod-auth-pam/DEBIAN/control
	@[ -f $(shell which yada) -a -f debian/rules ]
	chown -R 0.0 debian/tmp-libapache2-mod-auth-pam
	chmod -R u=rwX,go=rX debian/tmp-libapache2-mod-auth-pam
	@if [ -d debian/tmp-libapache2-mod-auth-pam/usr/doc/libapache2-mod-auth-pam ]; then \
	  echo "*** Yada warning: /usr/doc/libapache2-mod-auth-pam should be /usr/share/doc/libapache2-mod-auth-pam";\
	fi
	dpkg-deb --build debian/tmp-libapache2-mod-auth-pam ..

.PHONY: check-root
check-root:
	@[ `id -u` = 0 ] || (echo "You must be root to do this!"; false)

debian/packages-tmp: debian/packages 
	yada rebuild packages

## Clean up afterwards

.PHONY: clean clean-install-tree clean-build

clean: clean-install-tree clean-build debian/control debian/rules
	rm -f debian/packages-tmp debian/packages-tmp-new debian/packages-tmp-include

clean-build:
	@[ -f $(shell which yada) -a -f debian/rules ]
	rm -f debian/build-stamp debian/build-arch-stamp debian/build-indep-stamp
	@umask 022 \
	  && export pwd="$$(pwd)" \
	  && export TMPROOT="$$(pwd)/debian/tmp" \
	  && export SOURCE="libapache2-mod-auth-pam" \
	  && export VERSION="$(VERSION)" \
	  && export DEB_HOST_GNU_CPU="$(DEB_HOST_GNU_CPU)" \
	  && export DEB_HOST_GNU_TYPE="$(DEB_HOST_GNU_TYPE)" \
	  && export DEB_HOST_GNU_SYSTEM="$(DEB_HOST_GNU_SYSTEM)" \
	  && export DEB_BUILD_GNU_CPU="$(DEB_BUILD_GNU_CPU)" \
	  && export DEB_BUILD_GNU_TYPE="$(DEB_BUILD_GNU_TYPE)" \
	  && export DEB_BUILD_GNU_SYSTEM="$(DEB_BUILD_GNU_SYSTEM)" && (\
	echo -E 'eval "yada () { perl $$(which yada) \"\$$@\"; }"; set -e; set -v';\
	echo -E 'make clean || true';\
	echo -E 'rm -rf .libs/') | /bin/sh
	yada unpatch
	rm -rf debian/tmp

clean-install-tree: debian/rules
	@[ -f $(shell which yada) -a -f debian/rules ]
	rm -f debian/install-tree-stamp
	rm -rf debian/tmp-* debian/files* debian/substvars debian/shlibs.local debian/ucf
