#! /bin/sh /usr/share/dpatch/dpatch-run
## CVE-2007-6352.dpatch by Nico Golde <nion@debian.org>
##
## All lines beginning with `## DP:' are a description of the patch.
## DP: No description.

@DPATCH@
diff -urNad libexif-0.6.16~/libexif/exif-data.c libexif-0.6.16/libexif/exif-data.c
--- libexif-0.6.16~/libexif/exif-data.c	2007-06-12 15:01:54.000000000 +0200
+++ libexif-0.6.16/libexif/exif-data.c	2007-12-21 17:13:15.000000000 +0100
@@ -288,10 +288,9 @@
 exif_data_load_data_thumbnail (ExifData *data, const unsigned char *d,
 			       unsigned int ds, ExifLong offset, ExifLong size)
 {
-	if (ds < offset + size) {
+	if (ds < offset + size || (offset < 0) || (size < 0) || (offset + size < offset)) {
 		exif_log (data->priv->log, EXIF_LOG_CODE_DEBUG, "ExifData",
-			  "Bogus thumbnail offset and size: %i < %i + %i.",
-			  (int) ds, (int) offset, (int) size);
+			  "Bogus thumbnail offset and size");
 		return;
 	}
 	if (data->data) 
