LOGGING TIMEOUTS
================

Thomas Link <t.link@gmx.at> kindly contributed a method to keep track of
the default timeout noflushd currently uses. The script currently does not
take per-disk timeouts into account.

First you need to add the following lines to the 'start' target in noflushd's
init script (eg. /etc/init.d/noflushd, the exact location depends on your
distribution):

	NOFLUSHD_DIR=/var/lib/noflushd
	test -d ${NOFLUSHD_DIR} || mkdir -p ${NOFLUSHD_DIR}
	echo ${DEFAULT_TIMEOUT} > ${NOFLUSHD_DIR}/timeout
	echo ${DEFAULT_TIMEOUT} | \
		sed -e "s/\\([0-9]\\+\\).*/\\1/" > ${NOFLUSHD_DIR}/state
	cp ${NOFLUSHD_DIR}/state ${NOFLUSHD_DIR}/history

When noflushd is launched with this modified init script, you can use
switchNoflushd, provided in this directory, to switch noflushd to the next
timeout, and keep track of the history. The current default timeout is
logged to syslog, and can also be seen from /var/lib/noflushd/state.

SCSI PATCHES
============

This little tool is of equally little use right now as the SCSI layer
doesn't handle spun down disks gracefully enough. Brave souls might try
noflushd's SCSI support nevertheless, BUT ONLY WITH A KERNEL PATCH TO sd.c. 
Patches for several kernel versions are available in this directory. If you
don't know what a kernel patch is or how to apply it, you probably don't want
to use this feature yet. The patch actually is a cleaned up part of the quite
well-known scsi-idle patch. Unfortunately scsi-idle is also known for being not
100% rock solid. The failure cases are not well understood but it very likely 
isn't SMP-safe. You have been warned. The tiny tool scsi-startstop in this
directory will allow you to manually spin up and down your SCSI disks. Note 
that for spinup, scsi-startstop had better be in memory or on a different disk!

In short: This is testing area. Be careful!

scsi-idle has floating around the net for years and years without steady
longterm maintainership. Or copyright, even. To the best of my knowledge, it's
currently being worked on by Daniel Sterling <dan@lost-habit.com>. The full
scsi-idle package is available from his website at
http://www.lost-habit.com/scsi.html

INODE TRACING
=============

The patch in inode-tracing_2.6.3.diff for Linux kernel version 2.6.3 allows
you to trace disk accesses. Whenever data is read from or written to a
disk the corresponding inode number is logged. Unfortunately, matching
inode numbers to file names can be tedious, but eg. 'ls -i' is your
friend. 

As the tracing might generate huge amounts of data, you need to enable it
explicitly with:

	echo 1 > /proc/sys/fs/block_dump 

To disable, use:

	echo 0 > /proc/sys/fs/block_dump

This patch was contributed by Thomas Reifferscheid <reiffer@kph.uni-mainz.de>,
inspired by Jens Axboe's laptop-mode patches.

 -- Daniel Kobras <kobras@linux.de>  Wed,  3 Mar 2004 12:37:21 +0100

