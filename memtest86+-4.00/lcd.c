#include "io.h"

#define LCD_MAX_LINE 16


#define		LCD_HOME1     	0x02
#define		LCD_HOME2	    0xC0
#define 	LED_NUM  	6

#ifndef 	G2_BOOT
#define		LCD_DLY_INIT1 	4920000     /* 4100 	first init sequence:  4.1 msec */
#define		LCD_DLY_INIT2  	 120000     /* 100 	second init sequence: 100 usec */
#define		LCD_DLY_EXEC	  96000     /* 80      normal execution time */
#define		LCD_DLY_WRCG   	 144000     /* 120 	CG RAM Write */
#define		LCD_DLY_CLR   	2016000     /* 1680 	Clear Display */
#else
#define         LCD_DLY_INIT1   8733000     /* 4100     first init sequence:  4.1 msec */
#define         LCD_DLY_INIT2    213000     /* 100      second init sequence: 100 usec */
#define         LCD_DLY_EXEC     170400     /* 80      normal execution time */
#define         LCD_DLY_WRCG     255600     /* 120      CG RAM Write */
#define         LCD_DLY_CLR     3578400     /* 1680     Clear Display */
#endif

/* OLED GPIO definition */
#define OLED_SDIN		54
#define OLED_SCLK 		52
#define OLED_CS   		50
#define OLED_RESET 		 7
#define OLED_DC 		32
#define OLED_CTRL 		 6

//define GPIO operation
#define OLED_SCLK_SET 	hw_write_bit(GPIO_LVL, OLED_SCLK,1)
#define OLED_SCLK_CLR 	hw_write_bit(GPIO_LVL, OLED_SCLK,0)

#define OLED_CS_SET		hw_write_bit(GPIO_LVL, OLED_CS,1)
#define OLED_CS_CLR		hw_write_bit(GPIO_LVL, OLED_CS,0)

#define OLED_SDIN_SET	hw_write_bit(GPIO_LVL, OLED_SDIN,1)
#define OLED_SDIN_CLR	hw_write_bit(GPIO_LVL, OLED_SDIN,0)

#define OLED_RESET_SET	hw_write_bit(GPIO_LVL, OLED_RESET,1)
#define OLED_RESET_CLR	hw_write_bit(GPIO_LVL, OLED_RESET,0)

#define OLED_DC_SET		hw_write_bit(GPIO_LVL, OLED_DC,1)
#define OLED_DC_CLR		hw_write_bit(GPIO_LVL, OLED_DC,0)

#define OLED_CTRL_SET	hw_write_bit(GPIO_LVL, OLED_CTRL,1)
#define OLED_CTRL_CLR	hw_write_bit(GPIO_LVL, OLED_CTRL,0)

#define HW_LCD 		0
#define HW_OLED 	1


const unsigned char  ASCII16[]={
//  (0)  (1)  (2)  (3)  (4)  (5)  (6)  (7)  (8)  (9)  (10)  (11)  (12)  (13)  
//  (14) (15) (16)  (17)  (18)  (19)  (20)  (21)  (22)  (23)  (24)  (25)  (26)  
//  (27) (28)  (29)  (30)  (31) (32) !(33)  (34) #(35) $(36) %(37) &(38) '(39) ((40)
// )(41) *(42) +(43) '(44) -(45) .(46) /(47) 0(48) 1(49) 2(50) 3(51) 4(52) 5(53)
// 6(54) 7(55) 8(56) 9(57) :(58) ;(59) <(60) =(61) >(62) ?(63) @(64) A(65) B(66)
// C(67) D(68) E(69) F(70) G(71) H(72) I(73) J(74) K(75) L(76) M(77) N(78) O(79)
// P(80) Q(81) R(82) S(83) T(84) U(85) V(86) W(87) X(88) Y(89) Z(90) [(91) \(92)
// ](93) ^(94) _(95) `(96) a(97) b(98) c(99) d(100) e(101) f(102) g(103) h(104) 
// i(105) j(106) k(107) l(108) m(109) n(110) o(111) p(112) q(113) r(114) s(115)
// t(116) u(117) v(118) w(119) x(120) y(121) z(122) {(123) |(124) }(125) ~(126)																 */
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,/*" ",0*/

0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,/*" ",1*/

0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,/*" ",2*/

0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,/*" ",3*/

0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,/*" ",4*/

0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,/*" ",5*/

0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,/*" ",6*/

0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,/*" ",7*/

0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,/*" ",8*/

0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,/*" ",9*/

0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,/*" ",10*/

0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,/*" ",11*/

0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,/*" ",12*/

0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,/*" ",13*/

0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,/*" ",14*/

0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,/*" ",15*/

0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,/*" ",16*/

0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,/*" ",17*/

0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,/*" ",18*/

0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,/*" ",19*/

0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,/*" ",20*/

0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,/*" ",21*/

0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,/*" ",22*/

0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,/*" ",23*/

0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,/*" ",24*/

0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,/*" ",25*/

0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,/*" ",26*/

0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,/*" ",27*/

0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,/*" ",28*/

0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,/*" ",29*/

0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,/*" ",30*/

0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,/*" ",31*/

0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,/*" ",32*/

0x00,0x00,0x00,0xF8,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x33,0x30,0x00,0x00,0x00,/*"!",33*/

0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,/*" ",34*/

0x40,0xC0,0x78,0x40,0xC0,0x78,0x40,0x00,0x04,0x3F,0x04,0x04,0x3F,0x04,0x04,0x00,/*"#",35*/

0x00,0x70,0x88,0xFC,0x08,0x30,0x00,0x00,0x00,0x18,0x20,0xFF,0x21,0x1E,0x00,0x00,/*"$",36*/

0xF0,0x08,0xF0,0x00,0xE0,0x18,0x00,0x00,0x00,0x21,0x1C,0x03,0x1E,0x21,0x1E,0x00,/*"%",37*/

0x00,0xF0,0x08,0x88,0x70,0x00,0x00,0x00,0x1E,0x21,0x23,0x24,0x19,0x27,0x21,0x10,/*"&",38*/

0x10,0x16,0x0E,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,/*"'",39*/

0x00,0x00,0x00,0xE0,0x18,0x04,0x02,0x00,0x00,0x00,0x00,0x07,0x18,0x20,0x40,0x00,/*"(",40*/

0x00,0x02,0x04,0x18,0xE0,0x00,0x00,0x00,0x00,0x40,0x20,0x18,0x07,0x00,0x00,0x00,/*")",41*/

0x40,0x40,0x80,0xF0,0x80,0x40,0x40,0x00,0x02,0x02,0x01,0x0F,0x01,0x02,0x02,0x00,/*"*",42*/

0x00,0x00,0x00,0xF0,0x00,0x00,0x00,0x00,0x01,0x01,0x01,0x1F,0x01,0x01,0x01,0x00,/*"+",43*/

0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0X00,0x10,0x16,0x0E,/*",",44*/

0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x01,0x01,0x01,0x01,0x01,0x01,0x01,/*"-",45*/

0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x30,0x30,0x00,0x00,0x00,0x00,0x00,/*".",46*/

0x00,0x00,0x00,0x00,0x80,0x60,0x18,0x04,0x00,0x60,0x18,0x06,0x01,0x00,0x00,0x00,/*"/",47*/

0x00,0xE0,0x10,0x08,0x08,0x10,0xE0,0x00,0x00,0x0F,0x10,0x20,0x20,0x10,0x0F,0x00,/*"0",48*/

0x00,0x10,0x10,0xF8,0x00,0x00,0x00,0x00,0x00,0x20,0x20,0x3F,0x20,0x20,0x00,0x00,/*"1",49*/

0x00,0x70,0x08,0x08,0x08,0x88,0x70,0x00,0x00,0x30,0x28,0x24,0x22,0x21,0x30,0x00,/*"2",50*/

0x00,0x30,0x08,0x88,0x88,0x48,0x30,0x00,0x00,0x18,0x20,0x20,0x20,0x11,0x0E,0x00,/*"3",51*/

0x00,0x00,0xC0,0x20,0x10,0xF8,0x00,0x00,0x00,0x07,0x04,0x24,0x24,0x3F,0x24,0x00,/*"4",52*/

0x00,0xF8,0x08,0x88,0x88,0x08,0x08,0x00,0x00,0x19,0x21,0x20,0x20,0x11,0x0E,0x00,/*"5",53*/

0x00,0xE0,0x10,0x88,0x88,0x18,0x00,0x00,0x00,0x0F,0x11,0x20,0x20,0x11,0x0E,0x00,/*"6",54*/

0x00,0x38,0x08,0x08,0xC8,0x38,0x08,0x00,0x00,0x00,0x00,0x3F,0x00,0x00,0x00,0x00,/*"7",55*/

0x00,0x70,0x88,0x08,0x08,0x88,0x70,0x00,0x00,0x1C,0x22,0x21,0x21,0x22,0x1C,0x00,/*"8",56*/

0x00,0xE0,0x10,0x08,0x08,0x10,0xE0,0x00,0x00,0x00,0x31,0x22,0x22,0x11,0x0F,0x00,/*"9",57*/

0x00,0x00,0x00,0xC0,0xC0,0x00,0x00,0x00,0x00,0x00,0x00,0x30,0x30,0x00,0x00,0x00,/*":",58*/

0x00,0x00,0x00,0x80,0x00,0x00,0x00,0x00,0x00,0x00,0x80,0x60,0x00,0x00,0x00,0x00,/*";",59*/

0x00,0x00,0x80,0x40,0x20,0x10,0x08,0x00,0x00,0x01,0x02,0x04,0x08,0x10,0x20,0x00,/*"<",60*/

0x40,0x40,0x40,0x40,0x40,0x40,0x40,0x00,0x04,0x04,0x04,0x04,0x04,0x04,0x04,0x00,/*"=",61*/

0x00,0x08,0x10,0x20,0x40,0x80,0x00,0x00,0x00,0x20,0x10,0x08,0x04,0x02,0x01,0x00,/*">",62*/

0x00,0x70,0x48,0x08,0x08,0x08,0xF0,0x00,0x00,0x00,0x00,0x30,0x36,0x01,0x00,0x00,/*"?",63*/

0xC0,0x30,0xC8,0x28,0xE8,0x10,0xE0,0x00,0x07,0x18,0x27,0x24,0x23,0x14,0x0B,0x00,/*"@",64*/

0x00,0x00,0xC0,0x38,0xE0,0x00,0x00,0x00,0x20,0x3C,0x23,0x02,0x02,0x27,0x38,0x20,/*"A",65*/

0x08,0xF8,0x88,0x88,0x88,0x70,0x00,0x00,0x20,0x3F,0x20,0x20,0x20,0x11,0x0E,0x00,/*"B",66*/

0xC0,0x30,0x08,0x08,0x08,0x08,0x38,0x00,0x07,0x18,0x20,0x20,0x20,0x10,0x08,0x00,/*"C",67*/

0x08,0xF8,0x08,0x08,0x08,0x10,0xE0,0x00,0x20,0x3F,0x20,0x20,0x20,0x10,0x0F,0x00,/*"D",68*/

0x08,0xF8,0x88,0x88,0xE8,0x08,0x10,0x00,0x20,0x3F,0x20,0x20,0x23,0x20,0x18,0x00,/*"E",69*/

0x08,0xF8,0x88,0x88,0xE8,0x08,0x10,0x00,0x20,0x3F,0x20,0x00,0x03,0x00,0x00,0x00,/*"F",70*/

0xC0,0x30,0x08,0x08,0x08,0x38,0x00,0x00,0x07,0x18,0x20,0x20,0x22,0x1E,0x02,0x00,/*"G",71*/

0x08,0xF8,0x08,0x00,0x00,0x08,0xF8,0x08,0x20,0x3F,0x21,0x01,0x01,0x21,0x3F,0x20,/*"H",72*/

0x00,0x08,0x08,0xF8,0x08,0x08,0x00,0x00,0x00,0x20,0x20,0x3F,0x20,0x20,0x00,0x00,/*"I",73*/

0x00,0x00,0x08,0x08,0xF8,0x08,0x08,0x00,0xC0,0x80,0x80,0x80,0x7F,0x00,0x00,0x00,/*"J",74*/

0x08,0xF8,0x88,0xC0,0x28,0x18,0x08,0x00,0x20,0x3F,0x20,0x01,0x26,0x38,0x20,0x00,/*"K",75*/

0x08,0xF8,0x08,0x00,0x00,0x00,0x00,0x00,0x20,0x3F,0x20,0x20,0x20,0x20,0x30,0x00,/*"L",76*/

0x08,0xF8,0xF8,0x00,0xF8,0xF8,0x08,0x00,0x20,0x3F,0x00,0x3F,0x00,0x3F,0x20,0x00,/*"M",77*/

0x08,0xF8,0x30,0xC0,0x00,0x08,0xF8,0x08,0x20,0x3F,0x20,0x00,0x07,0x18,0x3F,0x00,/*"N",78*/

0xE0,0x10,0x08,0x08,0x08,0x10,0xE0,0x00,0x0F,0x10,0x20,0x20,0x20,0x10,0x0F,0x00,/*"O",79*/

0x08,0xF8,0x08,0x08,0x08,0x08,0xF0,0x00,0x20,0x3F,0x21,0x01,0x01,0x01,0x00,0x00,/*"P",80*/

0xE0,0x10,0x08,0x08,0x08,0x10,0xE0,0x00,0x0F,0x18,0x24,0x24,0x38,0x50,0x4F,0x00,/*"Q",81*/

0x08,0xF8,0x88,0x88,0x88,0x88,0x70,0x00,0x20,0x3F,0x20,0x00,0x03,0x0C,0x30,0x20,/*"R",82*/

0x00,0x70,0x88,0x08,0x08,0x08,0x38,0x00,0x00,0x38,0x20,0x21,0x21,0x22,0x1C,0x00,/*"S",83*/

0x18,0x08,0x08,0xF8,0x08,0x08,0x18,0x00,0x00,0x00,0x20,0x3F,0x20,0x00,0x00,0x00,/*"T",84*/

0x08,0xF8,0x08,0x00,0x00,0x08,0xF8,0x08,0x00,0x1F,0x20,0x20,0x20,0x20,0x1F,0x00,/*"U",85*/

0x08,0x78,0x88,0x00,0x00,0xC8,0x38,0x08,0x00,0x00,0x07,0x38,0x0E,0x01,0x00,0x00,/*"V",86*/

0xF8,0x08,0x00,0xF8,0x00,0x08,0xF8,0x00,0x03,0x3C,0x07,0x00,0x07,0x3C,0x03,0x00,/*"W",87*/

0x08,0x18,0x68,0x80,0x80,0x68,0x18,0x08,0x20,0x30,0x2C,0x03,0x03,0x2C,0x30,0x20,/*"X",88*/

0x08,0x38,0xC8,0x00,0xC8,0x38,0x08,0x00,0x00,0x00,0x20,0x3F,0x20,0x00,0x00,0x00,/*"Y",89*/

0x10,0x08,0x08,0x08,0xC8,0x38,0x08,0x00,0x20,0x38,0x26,0x21,0x20,0x20,0x18,0x00,/*"Z",90*/

0x00,0x00,0x00,0xFE,0x02,0x02,0x02,0x00,0x00,0x00,0x00,0x7F,0x40,0x40,0x40,0x00,/*"[",91*/

0x00,0x0C,0x30,0xC0,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x01,0x06,0x38,0xC0,0x00,/*"\",92*/

0x00,0x02,0x02,0x02,0xFE,0x00,0x00,0x00,0x00,0x40,0x40,0x40,0x7F,0x00,0x00,0x00,/*"]",93*/

0x00,0x00,0x04,0x02,0x02,0x02,0x04,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,/*"^",94*/

0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,/*"_",95*/

0x00,0x02,0x02,0x04,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,/*"`",96*/

0x00,0x00,0x80,0x80,0x80,0x80,0x00,0x00,0x00,0x19,0x24,0x22,0x22,0x22,0x3F,0x20,/*"a",97*/

0x08,0xF8,0x00,0x80,0x80,0x00,0x00,0x00,0x00,0x3F,0x11,0x20,0x20,0x11,0x0E,0x00,/*"b",98*/

0x00,0x00,0x00,0x80,0x80,0x80,0x00,0x00,0x00,0x0E,0x11,0x20,0x20,0x20,0x11,0x00,/*"c",99*/

0x00,0x00,0x00,0x80,0x80,0x88,0xF8,0x00,0x00,0x0E,0x11,0x20,0x20,0x10,0x3F,0x20,/*"d",100*/

0x00,0x00,0x80,0x80,0x80,0x80,0x00,0x00,0x00,0x1F,0x22,0x22,0x22,0x22,0x13,0x00,/*"e",101*/

0x00,0x80,0x80,0xF0,0x88,0x88,0x88,0x18,0x00,0x20,0x20,0x3F,0x20,0x20,0x00,0x00,/*"f",102*/

0x00,0x00,0x80,0x80,0x80,0x80,0x80,0x00,0x00,0x6B,0x94,0x94,0x94,0x93,0x60,0x00,/*"g",103*/

0x08,0xF8,0x00,0x80,0x80,0x80,0x00,0x00,0x20,0x3F,0x21,0x00,0x00,0x20,0x3F,0x20,/*"h",104*/

0x00,0x80,0x98,0x98,0x00,0x00,0x00,0x00,0x00,0x20,0x20,0x3F,0x20,0x20,0x00,0x00,/*"i",105*/

0x00,0x00,0x00,0x80,0x98,0x98,0x00,0x00,0x00,0xC0,0x80,0x80,0x80,0x7F,0x00,0x00,/*"j",106*/

0x08,0xF8,0x00,0x00,0x80,0x80,0x80,0x00,0x20,0x3F,0x24,0x02,0x2D,0x30,0x20,0x00,/*"k",107*/

0x00,0x08,0x08,0xF8,0x00,0x00,0x00,0x00,0x00,0x20,0x20,0x3F,0x20,0x20,0x00,0x00,/*"l",108*/

0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x00,0x20,0x3F,0x20,0x00,0x3F,0x20,0x00,0x3F,/*"m",109*/

0x80,0x80,0x00,0x80,0x80,0x80,0x00,0x00,0x20,0x3F,0x21,0x00,0x00,0x20,0x3F,0x20,/*"n",110*/

0x00,0x00,0x80,0x80,0x80,0x80,0x00,0x00,0x00,0x1F,0x20,0x20,0x20,0x20,0x1F,0x00,/*"o",111*/

0x80,0x80,0x00,0x80,0x80,0x00,0x00,0x00,0x80,0xFF,0xA1,0x20,0x20,0x11,0x0E,0x00,/*"p",112*/

0x00,0x00,0x00,0x80,0x80,0x80,0x80,0x00,0x00,0x0E,0x11,0x20,0x20,0xA0,0xFF,0x80,/*"q",113*/

0x80,0x80,0x80,0x00,0x80,0x80,0x80,0x00,0x20,0x20,0x3F,0x21,0x20,0x00,0x01,0x00,/*"r",114*/

0x00,0x00,0x80,0x80,0x80,0x80,0x80,0x00,0x00,0x33,0x24,0x24,0x24,0x24,0x19,0x00,/*"s",115*/

0x00,0x80,0x80,0xE0,0x80,0x80,0x00,0x00,0x00,0x00,0x00,0x1F,0x20,0x20,0x00,0x00,/*"t",116*/

0x80,0x80,0x00,0x00,0x00,0x80,0x80,0x00,0x00,0x1F,0x20,0x20,0x20,0x10,0x3F,0x20,/*"u",117*/

0x80,0x80,0x80,0x00,0x00,0x80,0x80,0x80,0x00,0x01,0x0E,0x30,0x08,0x06,0x01,0x00,/*"v",118*/

0x80,0x80,0x00,0x80,0x00,0x80,0x80,0x80,0x0F,0x30,0x0C,0x03,0x0C,0x30,0x0F,0x00,/*"w",119*/

0x00,0x80,0x80,0x00,0x80,0x80,0x80,0x00,0x00,0x20,0x31,0x2E,0x0E,0x31,0x20,0x00,/*"x",120*/

0x80,0x80,0x80,0x00,0x00,0x80,0x80,0x80,0x80,0x81,0x8E,0x70,0x18,0x06,0x01,0x00,/*"y",121*/

0x00,0x80,0x80,0x80,0x80,0x80,0x80,0x00,0x00,0x21,0x30,0x2C,0x22,0x21,0x30,0x00,/*"z",122*/

0x00,0x00,0x00,0x00,0x80,0x7C,0x02,0x02,0x00,0x00,0x00,0x00,0x00,0x3F,0x40,0x40,/*"{",123*/

0x00,0x00,0x00,0x00,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xFF,0x00,0x00,0x00,/*"|",124*/

0x00,0x02,0x02,0x7C,0x80,0x00,0x00,0x00,0x00,0x40,0x40,0x3F,0x00,0x00,0x00,0x00,/*"}",125*/

0x00,0x06,0x01,0x01,0x02,0x02,0x04,0x04,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,/*"~",126*/

};

unsigned int GPIO_USE_SEL1,GP_IO_SEL1,GP_LVL1,GPO_BLINK,GPI_INV,GPIO_USE_SEL2,GP_IO_SEL2,GP_LVL2;
unsigned int LED_STATUS, LED_USB, LED_DISK_1, LED_DISK_2, LED_DISK_3, LED_DISK_4, LED_MASK;
unsigned char RS, RW, EN, D4, D5, D6, D7, BL;
unsigned int BL_BIT;
static int systype = 0;
unsigned int     iow1, iow2;
unsigned int all_io_addr[8]; 
unsigned int leds[LED_NUM];


static void send_spi_data(unsigned char data);
static void send_spi_cmd(unsigned char data);
static void oled_write_str_n(const unsigned char *str, int n, int line);

static void out_port_lw(unsigned int data, unsigned int addr)
{
    outl(data, addr);
}

static void set_bit(int bit)
{
    if (bit > 31)
    {
        bit -= 32;
        iow2 |= (1 << bit);
    }
    else            
        iow1 |= (1 << bit);
}


static void clear_bit(int bit)
{
    if (bit > 31)
    {
        bit -= 32;
        iow2 &= (~(1 << bit));
    }
    else            
        iow1 &= (~(1 << bit));
}

static void set_clear_bit(int b, int bit)
{
    if (b)
        set_bit(bit);
    else            
        clear_bit(bit);
}


void set_all_leds_off(void)
{

  if(systype == HW_OLED)
	  return;//if G2 OLED no gpio leds


  iow1 &= ~LED_MASK - BL_BIT;
  outl(iow1, GP_LVL1);
}

void set_all_leds_on(void)
{
   if(systype == HW_OLED)
		return;//if G2 OLED no gpio leds

   iow1 |= LED_MASK;
   outl(iow1, GP_LVL1);
}

void set_led_oppsite(int count)
{
	if(systype == HW_OLED)
		return;//if G2 OLED no gpio leds

    if(iow1 & leds[count%LED_NUM])
        iow1 &= ~leds[count % LED_NUM] - BL_BIT;
    else
		iow1 |= leds[count % LED_NUM] - BL_BIT;	

    outl(iow1, GP_LVL1);		
}


static void tick_delay(unsigned long long tick)
{
    //unsigned long long start;	
    unsigned long a1, a2, d1, d2;

    asm __volatile__("rdtsc;" : "=a"(a1), "=d"(d1));
   
    while (1) {
        asm __volatile__("rdtsc;" : "=a"(a2), "=d"(d2));

        if (d2 > d1)
            a2 += (~a1 + 1);
        else
            a2 -= a1;

        if (a2 > tick)
            return;
    }

}


static void lcd_write_nibble(int rs, int val)
{
    set_clear_bit(rs, RS);

    clear_bit(RW);

    set_clear_bit((val&1), D4);
    set_clear_bit((val&2), D5);
    set_clear_bit((val&4), D6);
    set_clear_bit((val&8), D7);

    clear_bit(EN);
    out_port_lw(iow1, GP_LVL1);;
    out_port_lw(iow2, GP_LVL2);
    tick_delay(600000);

    set_bit(EN);
    out_port_lw(iow1, GP_LVL1);
    out_port_lw(iow2, GP_LVL2);
    tick_delay(600000);

    clear_bit(EN);
    out_port_lw(iow1, GP_LVL1);
    out_port_lw(iow2, GP_LVL2);
    tick_delay(600000);
}

static void lcd_write_byte(int rs, int val)
{
    lcd_write_nibble(rs, (val>>4) & 0xf);
    lcd_write_nibble(rs, val & 0xf);
}

static void lcd_write_nibble_dly(int rs, int val, long tick)
{
    lcd_write_nibble(rs, val);
    tick_delay(tick);
}

static void lcd_write_byte_dly(int rs, int val, long tick)
{
    lcd_write_byte(rs, val);
    tick_delay(tick);
}

static void lcd_clear_str()
{
    int i;

   for (i=0; i<LCD_MAX_LINE; i++)
        lcd_write_byte_dly(1, ' ', LCD_DLY_EXEC);
}

static void lcd_write_str(char *c)
{
    int i;

    for (i=0; i<LCD_MAX_LINE; i++)
        lcd_write_byte_dly(1, *c++, LCD_DLY_EXEC);
}

void lcd_reset(void)
{
    //printf("%s\n",__FUNCTION__);

    lcd_write_nibble_dly(0, 0x3, LCD_DLY_INIT1);
    lcd_write_nibble_dly(0, 0x3, LCD_DLY_INIT2);
    lcd_write_nibble_dly(0, 0x3, LCD_DLY_INIT1);             // now its 8bit mode
    lcd_write_nibble_dly(0, 0x2, LCD_DLY_INIT2);             // now 4bit mode

    lcd_write_byte_dly(0, 0x2C, LCD_DLY_EXEC);             // 2-line 4bit/40x2/5x7
    //lcd_write_byte_dly(0, 0x20, LCD_DLY_EXEC);               // 1-line 4bit/40x2/5x7

    lcd_write_byte_dly(0, 0x08, LCD_DLY_EXEC);                  // DISP-OFF
    lcd_write_byte_dly(0, 0x01, LCD_DLY_CLR);                   // CLR

    lcd_write_byte_dly(0, 0x04|0x2, LCD_DLY_EXEC);              // move mode
    lcd_write_byte_dly(0, 0x08|0x4, LCD_DLY_EXEC);              // disp-on, cursor-off, no-blink
}

static void backlight(int on)
{
    //printf("%s\n",__FUNCTION__);

    set_clear_bit(on, BL);
	if(BL>31)
    	out_port_lw(iow2, GP_LVL2);	
	else
    	out_port_lw(iow1, GP_LVL2);
}


void show_lcd_line(int line, char *c)
{
	if(systype == HW_LCD)
	{
		lcd_write_byte(0, (line == 1) ? LCD_HOME1 : LCD_HOME2);
    	lcd_write_str(c);
	}
	else if(systype == HW_OLED)
	{
		oled_write_str_n((const unsigned char *)c,15,line);
	}

	return;
}

void lcd_main(int devid)
{
    unsigned int data, port;
	extern unsigned int GPIO_BASE_ADDR;

	if(data||port){}; //avoid warning;

	systype = HW_LCD;

    if (devid == 0x5020) {

        GPIO_BASE_ADDR = 0x500;

        LED_STATUS = 1 << 18;
        LED_USB    = 1 << 24;
        LED_DISK_1 = 1 << 19;
        LED_DISK_2 = 1 << 25;
        LED_DISK_3 = 1 << 27;
        LED_DISK_4 = 1 << 28;

        RS = 16;
        RW = 17;
        EN = 48;
        D4 = 20;
        D5 = 21;
        D6 = 33;
        D7 = 34;
        BL = 23;
        BL_BIT = 1 << BL;

    } else {

        GPIO_BASE_ADDR = 0x480;

        LED_STATUS = 1 << 28;
        LED_USB    = 1 << 22;
        LED_DISK_1 = 1 << 16;
        LED_DISK_2 = 1 << 20;
        LED_DISK_3 = 1 << 6;
        LED_DISK_4 = 1 << 7;

        RS = 33;
        RW = 34;
        EN = 32;
        D4 = 36;
        D5 = 37;
        D6 = 38;
        D7 = 39;
        BL = 48;
        BL_BIT = 0;
    }

    LED_MASK = LED_STATUS + LED_USB + LED_DISK_1 + LED_DISK_2 + LED_DISK_3 + LED_DISK_4;

    leds[0] = LED_STATUS;
    leds[1] = LED_USB;
    leds[2] = LED_DISK_1;
    leds[3] = LED_DISK_2;
    leds[4] = LED_DISK_3;
    leds[5] = LED_DISK_4;

    GPIO_USE_SEL1   = GPIO_BASE_ADDR + 0x00;
    GP_IO_SEL1      = GPIO_BASE_ADDR + 0x04;
    GP_LVL1         = GPIO_BASE_ADDR + 0x0c;
    GPO_BLINK       = GPIO_BASE_ADDR + 0x18;
    GPI_INV         = GPIO_BASE_ADDR + 0x2c;
    GPIO_USE_SEL2   = GPIO_BASE_ADDR + 0x30;
    GP_IO_SEL2      = GPIO_BASE_ADDR + 0x34;
    GP_LVL2         = GPIO_BASE_ADDR + 0x38;
 
    iow1 = inl(GP_LVL1);
    iow2 = inl(GP_LVL2);

    /* Set the data signals (D0-7) of the port to all low (0) */
    for (port = 0; port < sizeof(all_io_addr) / sizeof(port); port++)
    {
        data = inl(all_io_addr[port]);
		data = data;
    }


    lcd_reset();
    /* Sleep for a while (100 ms) */
    tick_delay(200000000);
    backlight(0); //backlight
}

void G2_4bay_lcd_main(int devid)
{
	extern unsigned int GPIO_BASE_ADDR;

	systype = HW_LCD;

    if (devid == 0x0BF3) {

        GPIO_BASE_ADDR = 0x500;

		LED_STATUS = 1 << 28;
        LED_USB    = 1 << 22;
        LED_DISK_1 = 1 << 7;
        LED_DISK_2 = 1 << 6;
        LED_DISK_3 = 1 << 20;
        LED_DISK_4 = 1 << 16;

        RS = 33;
        RW = 34;
        EN = 32;
        D4 = 36;
        D5 = 37;
        D6 = 38;
        D7 = 39;
        BL = 48;
		BL_BIT = 0;
    }  

    LED_MASK = LED_STATUS + LED_USB + LED_DISK_1 + LED_DISK_2 + LED_DISK_3 + LED_DISK_4;

 	leds[0] = LED_STATUS;
    leds[1] = LED_USB;
    leds[2] = LED_DISK_4;
    leds[3] = LED_DISK_3;
    leds[4] = LED_DISK_2;
    leds[5] = LED_DISK_1;

    GPIO_USE_SEL1   = GPIO_BASE_ADDR + 0x00;
    GP_IO_SEL1      = GPIO_BASE_ADDR + 0x04;
    GP_LVL1         = GPIO_BASE_ADDR + 0x0c;
    GPO_BLINK       = GPIO_BASE_ADDR + 0x18;
    GPI_INV         = GPIO_BASE_ADDR + 0x2c;
    GPIO_USE_SEL2   = GPIO_BASE_ADDR + 0x30;
    GP_IO_SEL2      = GPIO_BASE_ADDR + 0x34;
    GP_LVL2         = GPIO_BASE_ADDR + 0x38;


    iow1 = inl(GP_LVL1);
    iow2 = inl(GP_LVL2);

    lcd_reset();
    /* Sleep for a while (100 ms) */
    tick_delay(120000000);
    backlight(0); //backlight
}



/***********************************************
 * function: send data/cmd via spi for oled;
 * GPIO54=SDIN, 
 * GPIO52=SCLK, 
 * GPIO50=CS#, 
 * GPIO07=RESET#, 
 * GPIO32=D/C#, 
 * GPIO06=Control(3v-->12v)
 ***********************************************/
static void send_spi(unsigned char data,int cmd_flag)
{
	int i = 0;
	
	OLED_CS_CLR;	// SC = 0 

	if(cmd_flag)
		OLED_DC_CLR; //D/C# = 0;
	else
		OLED_DC_SET; //D/C# = 1;

	/* transfer data */
	for(i = 0;i<8;i++)
	{
		OLED_SCLK_CLR; //sck = 0;

		if(data & 0x80)
			OLED_SDIN_SET;//data
		else
			OLED_SDIN_CLR;

		OLED_SCLK_SET; //sck = 1;
		
		data<<=1;
	}
	OLED_DC_SET; // D/C#=1;

	OLED_CS_SET; //CS = 1

	return;
}


static void send_spi_cmd(unsigned char data)
{
	return send_spi(data,1);
}

static void send_spi_data(unsigned char data)
{
	return send_spi(data,0);
}

void oled_clear(void)
{
	int i = 0,j = 0; 

	send_spi_cmd(0x40);	//start position;
	
	for(i=0;i<4;i++)				//4 pages
		{			
			OLED_CS_CLR; 			//CS = 0;
			OLED_DC_CLR;			//D/C=0
			send_spi_cmd(0xb0+i);
			send_spi_cmd(0x10);
			send_spi_cmd(0x04);		//adjust 4 pbits at x

			OLED_DC_SET; 			//D/C=1

			for(j=0;j<128;j++)		//128 columes
				send_spi_data(0x0);
		}	
}

/************************* 	
*	oled on/off 	
*	non-zero - on 
*   0 		 - off
***************************/

void oled_on(int flag)
{	
	send_spi_cmd(flag?(0xaf):(0xae));
}


/**********************************
*
* initialize the oled function;
* clear the full screen;
* switch on oled;
*
**********************************/
void oled_init(void)
{

	systype = HW_OLED;

	extern unsigned int GPIO_BASE_ADDR;

	GPIO_BASE_ADDR = 0x500;

	//reset gpio7 clear
	OLED_RESET_CLR;

	tick_delay(10000);//low pulse min = 3us;
	//reset gpio 7 set
	OLED_RESET_SET;

	tick_delay(10000);//low pulse min = 3us;

	/* turn off oled at first */
	oled_on(0);	

	send_spi_cmd(0xae);		// display off
	
	send_spi_cmd(0xd5);		//Set Display ClocDivide Ratio/Oscillator Frequency 
	send_spi_cmd(0x71);		//105HZ
	
	send_spi_cmd(0xa8);		//Set Multiplex Ratio
	send_spi_cmd(0x1f);		//set 32mux
	
	send_spi_cmd(0xd9);		//Set Pre-charge Period 
	send_spi_cmd(0x22);		
	
	send_spi_cmd(0x20);		//Set Memory Addressing Mode
	send_spi_cmd(0x02);
	
	send_spi_cmd(0xa1);		//seg re-map 127->0
	
	send_spi_cmd(0xc8);		//COM scan direction COM(N-1)-->COM0
	
	send_spi_cmd(0xda);		//Set COM Pins Hardware Configuration 
	send_spi_cmd(0x12);
	
	send_spi_cmd(0xd8);		// color_mode_set
	send_spi_cmd(0x00);		// monochrome mode & normal power mode
	//send_spi_cmd(0x30);	// Area Color enable & normal power mode  
	//send_spi_cmd(0x05);	// monochrome mode & lower power display mode 
	//send_spi_cmd(0x35);	// Area Color enable & lower power display mode	
	
	send_spi_cmd(0x81);		//Set Contrast Control
	send_spi_cmd(0xcf);			
	
	send_spi_cmd(0xb0);		//Set Page Start Address for Page Addressing Mode 

	send_spi_cmd(0xd3);		//Set Display offset
	send_spi_cmd(0x00);		
	
	send_spi_cmd(0x21);		//Set Column Address
	send_spi_cmd(0x02);		//Colum address start
	send_spi_cmd(0x81);		//Colum address end
	
	send_spi_cmd(0x22);		//Set page Address
	send_spi_cmd(0x00);		//Page address start
	send_spi_cmd(0x03);		//Page address end
	
	send_spi_cmd(0x10);		//Set Higher Column Start Address for Page Addressing Mode 
	send_spi_cmd(0x00);		//Set Lower Column Start Address for Page Addressing Mode 
	
	send_spi_cmd(0x40);		//Set Display Start Line 

	send_spi_cmd(0xa6);		//Display Normal
	//send_spi_cmd(0xa7);	//Display Inverse
	
	send_spi_cmd(0xa4);		//Entire Display Off
	//send_spi_cmd(0xa5);	//Entire Display On
		
	send_spi_cmd(0xdb);		//Set VCOMH Level 
	send_spi_cmd(0x3c);		//0.83*VCC
		
	//send_spi_cmd(0xe0);	//Enter Read Modify Write 
	//send_spi_cmd(0xee);	//Exit	Read Modify Write	

	oled_clear();

	OLED_CTRL_SET;

	oled_on(1); //switch on OLED	

	return;
}

static void oled_show_bitmap(int x, int y, unsigned char *pbit)
{

	int page = 0,col = 0;/* 8 pbits width *16 pbits height */
	int x_low = 0,x_high = 0;
	const unsigned char *pb = pbit;

	/* x offset should be seperated in high and low part  */
	x_low = x & 0x0F;
	x_high = (x >> 4) & 0xF; 
	x_high |= 0x10;

	/* set offset y */	
	switch(y){
		case 1:
			 y = 0xb0;/* line 1 */
			break;
		case 2:
			 y = 0xb2;/* line 2 */
			break;
		default:
			return;
			break;
		}
		
	//page = ((disp.y == 2)?2:0) + 0xb0; 	

	send_spi_cmd(0x40);/* set start line; */

	/* line1:page 0,1  line2:page 2,3  */
	/* one char takes 2 page 16 pbits height; */
	for(page = 0; page<2; page++)
	{
		OLED_CS_CLR;
		OLED_DC_CLR;		
	
		send_spi_cmd(y + page);
		send_spi_cmd(x_high);
		send_spi_cmd(x_low);

		OLED_DC_SET;

		for(col = 0;col<8;col++)
		{
			/* each page 8 bytes */
			send_spi_data(*pb++);			
		}
	}

	return;
}

/*****************************************
 *  function: display one character on oled;
 *  param:
 *		line: 0,1
 *  	offset: x position in line;
 *  	ch: character should be shown on oled *
 ****************************************/
static void oled_show_char(int line,int offset,unsigned char ch)
{
	int x = 0;	
	unsigned char *pbit = 0;
	//int valid = 1;

	/* we check font valid here */
	//valid &= (ch < 127)?1:0; 	/* so far we only support ascii 16 (0-127) char font */
	//valid &= (offset <= 15)?1:0;/* each line contains 16 characters */ 
	//valid &= (line>=1)?((line<=2)?1:0):0; /* only line1 and line2 */

	//if(!valid)
	//	return;
	
	/* each character has 8 pbits width */	
	/* adjust offset of 4 pbits at ahead of line*/
	x = offset * 8 + 4; 

	/* get char from bitmap */		
	pbit = (unsigned char*)&ASCII16[0];	
	if(ch>=127)
		ch = '?'; /* if out of ascii 16, we only show a '?' instead; */
	pbit = pbit + (ch<<4); /* each character takes 16bytes in font lib; */

	oled_show_bitmap(x,line,pbit);
	
	tick_delay(10000);	

	return;
}

static void oled_write_str_n(const unsigned char *str, int n, int line)
{
	int num = 0, i;
	unsigned char buf[LCD_MAX_LINE] = {0};

	n = (n>=16)?16:n;
	while (num < n && str[num] && str[num] != '\n' && str[num] != '\r') {
		buf[num] = str[num];
		num++;
	}

	for (i = 0; i < num; i++) {
		oled_show_char(line,i,buf[i]);
	}
}




