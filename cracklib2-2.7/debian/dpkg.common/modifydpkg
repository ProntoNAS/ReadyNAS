#!/bin/sh
#
# source:
#   /var/cvs/projects/debian/dpkg.common/modifydpkg,v
#
# revision:
#   @(#) modifydpkg,v 1.9 1999/03/20 19:44:10 jplejacq Exp
#
# copyright:
#   Copyright (C) 1999 Jean Pierre LeJacq <jplejacq@quoininc.com>
#
#   Distributed under the GNU GENERAL PUBLIC LICENSE.
#
# synopsis:
#   modifydpkg
#
# description:
#   Modification program for debian package source
#
#   This program is package independent and should work unmodified
#   with any package.  Package overrides can be implemented by
#   providing a file with the name "debian/dpkg.scripts/modifydpkg"
#   with a function "modify_dpkg_override()".



modify_dpkg()
# postconditions:
#   Return 0 if successful, non-zero if not.
#
# description:
#   Modify debian package source.
{
  echo "${0}: modifying debian files..."
    sed_cmd=""

    for sed_var in\
      $(grep = debian/dpkg.common/substfiles | cut -f 1 -d = | grep -v subtmp)
    do
      sed_value=$(eval echo "\${${sed_var}}")
      sed_cmd="${sed_cmd}s^@@${sed_var}@@^${sed_value}^g;"
    done

    for sed_var in\
      $(grep = debian/dpkg.scripts/substfiles | cut -f 1 -d = | grep -v subtmp)
    do
      sed_value=$(eval echo "\${${sed_var}}")
      sed_cmd="${sed_cmd}s^@@${sed_var}@@^${sed_value}^g;"
    done

    for file in $(ls ./debian/dpkg.src/*.in)
    do
      sed -e "\
        ${sed_cmd}\
      "\
      ${file} > ${file%.in}
    done


  return 0
}



# main:
  set -e

  . debian/dpkg.common/substfiles 
  . debian/dpkg.scripts/substfiles


  if [ -f "./debian/dpkg.scripts/modifydpkg" ]
  then
    echo "${0}: include overrides..."
      . ./debian/dpkg.scripts/modifydpkg

    modify_dpkg_override
  else
    modify_dpkg
  fi


  exit 0
