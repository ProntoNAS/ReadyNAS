From 73be9f9ab67842cfbec36ee99e8d2301434c84ca Mon Sep 17 00:00:00 2001
From: Werner Lemberg <wl@gnu.org>
Date: Mon, 24 Nov 2014 06:30:05 +0000
Subject: [type1, type42] Another fix for Savannah bug #43655.

* src/type1/t1load.c (parse_charstrings), src/type42/t42parse.c
(t42_parse_charstrings): Add another boundary testing.
---
Index: freetype-2.4.8/src/type1/t1load.c
===================================================================
--- freetype-2.4.8.orig/src/type1/t1load.c	2015-02-24 10:05:06.351024392 -0500
+++ freetype-2.4.8/src/type1/t1load.c	2015-02-24 10:05:06.347024361 -0500
@@ -1578,6 +1578,11 @@
       }
 
       T1_Skip_PS_Token( parser );
+      if ( parser->root.cursor >= limit )
+      {
+        error = T1_Err_Invalid_File_Format;
+        goto Fail;
+      }
       if ( parser->root.error )
         return;
 
Index: freetype-2.4.8/src/type42/t42parse.c
===================================================================
--- freetype-2.4.8.orig/src/type42/t42parse.c	2015-02-24 10:05:06.351024392 -0500
+++ freetype-2.4.8/src/type42/t42parse.c	2015-02-24 10:05:06.347024361 -0500
@@ -824,6 +824,12 @@
         break;
 
       T1_Skip_PS_Token( parser );
+      if ( parser->root.cursor >= limit )
+      {
+        FT_ERROR(( "t42_parse_charstrings: out of bounds\n" ));
+        error = T42_Err_Invalid_File_Format;
+        goto Fail;
+      }
       if ( parser->root.error )
         return;
 
