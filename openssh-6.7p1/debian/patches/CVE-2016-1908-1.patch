Origin: ubuntu, https://launchpad.net/ubuntu/+source/openssh/1:6.6p1-2ubuntu2.10
Reviewed-By: Santiago R.R. <santiagorr@riseup.net>

Backport of:

From f98a09cacff7baad8748c9aa217afd155a4d493f Mon Sep 17 00:00:00 2001
From: "mmcc@openbsd.org" <mmcc@openbsd.org>
Date: Tue, 20 Oct 2015 03:36:35 +0000
Subject: upstream commit

Replace a function-local allocation with stack memory.

ok djm@

Upstream-ID: c09fbbab637053a2ab9f33ca142b4e20a4c5a17e
---
 clientloop.c | 9 ++-------
 1 file changed, 2 insertions(+), 7 deletions(-)

Index: openssh-6.6p1/clientloop.c
===================================================================
--- openssh-6.6p1.orig/clientloop.c	2016-05-05 08:09:50.075917830 -0400
+++ openssh-6.6p1/clientloop.c	2016-05-05 08:10:30.336380407 -0400
@@ -314,11 +314,10 @@
 	static char proto[512], data[512];
 	FILE *f;
 	int got_data = 0, generated = 0, do_unlink = 0, i;
-	char *xauthdir, *xauthfile;
+	char xauthdir[MAXPATHLEN] = "", xauthfile[MAXPATHLEN] = "";
 	struct stat st;
 	u_int now, x11_timeout_real;
 
-	xauthdir = xauthfile = NULL;
 	*_proto = proto;
 	*_data = data;
 	proto[0] = data[0] = '\0';
@@ -346,8 +345,6 @@
 			display = xdisplay;
 		}
 		if (trusted == 0) {
-			xauthdir = xmalloc(MAXPATHLEN);
-			xauthfile = xmalloc(MAXPATHLEN);
 			mktemp_proto(xauthdir, MAXPATHLEN);
 			/*
 			 * The authentication cookie should briefly outlive
@@ -410,8 +407,6 @@
 		unlink(xauthfile);
 		rmdir(xauthdir);
 	}
-	free(xauthdir);
-	free(xauthfile);
 
 	/*
 	 * If we didn't get authentication data, just make up some
