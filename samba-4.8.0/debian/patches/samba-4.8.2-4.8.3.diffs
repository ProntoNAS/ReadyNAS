diff -Npur samba-4.8.2/.gitlab-ci-private.yml samba-4.8.3/.gitlab-ci-private.yml
--- samba-4.8.2/.gitlab-ci-private.yml	1970-01-01 01:00:00.000000000 +0100
+++ samba-4.8.3/.gitlab-ci-private.yml	2018-06-26 16:42:46.000000000 +0200
@@ -0,0 +1,53 @@
+# see https://docs.gitlab.com/ce/ci/yaml/README.html for all available options
+
+image: registry.gitlab.com/samba-team/samba:latest
+
+before_script:
+  - echo "Build starting ..."
+
+build_samba:
+  stage: build
+  tags:
+    - docker
+    - private
+  script:
+    # this one takes about 4 hours to finish
+    - python script/autobuild.py samba            --verbose --tail --testbase /tmp/samba-testbase
+
+build_samba_others:
+  stage: build
+  tags:
+    - docker
+    - private
+  script:
+    - python script/autobuild.py samba-nopython   --verbose --tail --testbase /tmp/samba-testbase
+    - python script/autobuild.py samba-systemkrb5 --verbose --tail --testbase /tmp/samba-testbase
+    - python script/autobuild.py samba-xc         --verbose --tail --testbase /tmp/samba-testbase
+    - python script/autobuild.py samba-o3         --verbose --tail --testbase /tmp/samba-testbase
+    - python script/autobuild.py samba-libs       --verbose --tail --testbase /tmp/samba-testbase
+    - python script/autobuild.py samba-static     --verbose --tail --testbase /tmp/samba-testbase
+
+build_ctdb:
+  stage: build
+  tags:
+    - docker
+    - private
+  script:
+    - python script/autobuild.py samba-ctdb       --verbose --tail --testbase /tmp/samba-testbase
+    - python script/autobuild.py ctdb             --verbose --tail --testbase /tmp/samba-testbase
+
+build_others:
+  stage: build
+  tags:
+    - docker
+    - private
+  script:
+    - python script/autobuild.py ldb              --verbose --tail --testbase /tmp/samba-testbase
+    - python script/autobuild.py pidl             --verbose --tail --testbase /tmp/samba-testbase
+    - python script/autobuild.py replace          --verbose --tail --testbase /tmp/samba-testbase
+    - python script/autobuild.py talloc           --verbose --tail --testbase /tmp/samba-testbase
+    - python script/autobuild.py tdb              --verbose --tail --testbase /tmp/samba-testbase
+    - python script/autobuild.py tevent           --verbose --tail --testbase /tmp/samba-testbase
+
+after_script:
+  - echo "Build finished!"
diff -Npur samba-4.8.2/.gitlab-ci.yml samba-4.8.3/.gitlab-ci.yml
--- samba-4.8.2/.gitlab-ci.yml	2018-01-17 09:08:39.000000000 +0100
+++ samba-4.8.3/.gitlab-ci.yml	1970-01-01 01:00:00.000000000 +0100
@@ -1,47 +0,0 @@
-# see https://docs.gitlab.com/ce/ci/yaml/README.html for all available options
-
-before_script:
-  - echo "Build starting ..."
-
-build_samba:
-  stage: build
-  tags:
-    - autobuild
-  script:
-    # this one takes about 4 hours to finish
-    - python script/autobuild.py samba            --verbose --tail --testbase /tmp/samba-testbase
-
-build_samba_others:
-  stage: build
-  tags:
-    - autobuild
-  script:
-    - python script/autobuild.py samba-nopython   --verbose --tail --testbase /tmp/samba-testbase
-    - python script/autobuild.py samba-systemkrb5 --verbose --tail --testbase /tmp/samba-testbase
-    - python script/autobuild.py samba-xc         --verbose --tail --testbase /tmp/samba-testbase
-    - python script/autobuild.py samba-o3         --verbose --tail --testbase /tmp/samba-testbase
-    - python script/autobuild.py samba-libs       --verbose --tail --testbase /tmp/samba-testbase
-    - python script/autobuild.py samba-static     --verbose --tail --testbase /tmp/samba-testbase
-
-build_ctdb:
-  stage: build
-  tags:
-    - autobuild
-  script:
-    - python script/autobuild.py samba-ctdb       --verbose --tail --testbase /tmp/samba-testbase
-    - python script/autobuild.py ctdb             --verbose --tail --testbase /tmp/samba-testbase
-
-build_others:
-  stage: build
-  tags:
-    - autobuild
-  script:
-    - python script/autobuild.py ldb              --verbose --tail --testbase /tmp/samba-testbase
-    - python script/autobuild.py pidl             --verbose --tail --testbase /tmp/samba-testbase
-    - python script/autobuild.py replace          --verbose --tail --testbase /tmp/samba-testbase
-    - python script/autobuild.py talloc           --verbose --tail --testbase /tmp/samba-testbase
-    - python script/autobuild.py tdb              --verbose --tail --testbase /tmp/samba-testbase
-    - python script/autobuild.py tevent           --verbose --tail --testbase /tmp/samba-testbase
-
-after_script:
-  - echo "Build finished!"
diff -Npur samba-4.8.2/WHATSNEW.txt samba-4.8.3/WHATSNEW.txt
--- samba-4.8.2/WHATSNEW.txt	2018-05-16 12:09:25.000000000 +0200
+++ samba-4.8.3/WHATSNEW.txt	2018-06-26 16:42:46.000000000 +0200
@@ -1,4 +1,93 @@
                    =============================
+                   Release Notes for Samba 4.8.3
+                            June 26, 2018
+                   =============================
+
+
+This is the latest stable release of the Samba 4.8 release series.
+
+
+Changes since 4.8.2:
+--------------------
+
+o  Jeremy Allison <jra@samba.org>
+   * BUG 13428: s3: smbd: Fix SMB2-FLUSH against directories.
+   * BUG 13457: s3: smbd: printing: Re-implement delete-on-close semantics for
+     print files missing since 3.5.x.
+   * BUG 13474: python: Fix talloc frame use in make_simple_acl().
+
+o  Jeffrey Altman <jaltman@secure-endpoints.com>
+   * BUG 11573: heimdal: lib/krb5: Do not fail set_config_files due to parse
+     error.
+
+o  Andrew Bartlett <abartlet@samba.org>
+   * ldb: version 1.3.4
+   * BUG 13448: ldb: One-level search was incorrectly falling back to full DB
+     scan.
+   * BUG 13452: ldb: Save a copy of the index result before calling the
+     callbacks.
+   * BUG 13454: No Backtrace given by Samba's AD DC by default.
+   * BUG 13471: ldb_tdb: Use mem_ctx and so avoid leak onto long-term memory
+     on duplicated add.
+
+o  Ralph Boehme <slow@samba.org>
+   * BUG 13432: s3:smbd: Fix interaction between chown and SD flags.
+
+o  GÃ¼nther Deschner <gd@samba.org>
+   * BUG 13437: Fix building Samba with gcc 8.1.
+
+o  Andrej Gessel <Andrej.Gessel@janztec.com>
+   * BUG 13475: Fix several mem leaks in ldb_index ldb_search ldb_tdb.
+
+o  Volker Lendecke <vl@samba.org>
+   * BUG 13331: libgpo: Fix the build --without-ads.
+
+o  Stefan Metzmacher <metze@samba.org>
+   * BUG 13369: Looking up the user using the UPN results in user name with the
+     REALM instead of the DOMAIN.
+   * BUG 13427: Fix broken server side GENSEC_FEATURE_LDAP_STYLE handling
+     (NTLMSSP NTLM2 packet check failed due to invalid signature!).
+
+o  Christof Schmitt <cs@samba.org>
+   * BUG 13446: smbd: Flush dfree memcache on service reload.
+   * BUG 13478: krb5_wrap: Fix keep_old_entries logic for older Kerberos
+     libraries.
+
+o  Andreas Schneider <asn@samba.org>
+   * BUG 13369: Looking up the user using the UPN results in user name with the
+     REALM instead of the DOMAIN.
+   * BUG 13437: Fix building Samba with gcc 8.1.
+   * BUG 13440: s3:utils: Do not segfault on error in DoDNSUpdate().
+   * BUG 13480: krb5_plugin: Add winbind localauth plugin for MIT Kerberos.
+
+o  Lukas Slebodnik <lslebodn@fedoraproject.org>
+   * BUG 13459: ldb: Fix memory leak on module context.
+
+
+#######################################
+Reporting bugs & Development Discussion
+#######################################
+
+Please discuss this release on the samba-technical mailing list or by
+joining the #samba-technical IRC channel on irc.freenode.net.
+
+If you do report problems then please try to send high quality
+feedback. If you don't provide vital information to help us track down
+the problem then you will probably be ignored.  All bug reports should
+be filed under the "Samba 4.1 and newer" product in the project's Bugzilla
+database (https://bugzilla.samba.org/).
+
+
+======================================================================
+== Our Code, Our Bugs, Our Responsibility.
+== The Samba Team
+======================================================================
+
+
+Release notes for older releases follow:
+----------------------------------------
+
+                   =============================
                    Release Notes for Samba 4.8.2
                             May 16, 2018
                    =============================
@@ -86,8 +175,8 @@ database (https://bugzilla.samba.org/).
 ======================================================================
 
 
-Release notes for older releases follow:
-----------------------------------------
+----------------------------------------------------------------------
+
 
                    =============================
                    Release Notes for Samba 4.8.1
@@ -450,6 +539,19 @@ This new module integrates with Sophos,
 software to provide scanning and filtering of files on a Samba share.
 
 
+Local authorization plugin for MIT Kerberos
+-------------------------------------------
+
+This plugin controls the relationship between Kerberos principals and AD
+accounts through winbind. The module receives the Kerberos principal and the
+local account name as inputs and can then check if they match. This can resolve
+issues with canonicalized names returned by Kerberos within AD. If the user
+tries to log in as 'alice', but the samAccountName is set to ALICE (uppercase),
+Kerberos would return ALICE as the username. Kerberos would not be able to map
+'alice' to 'ALICE' in this case and auth would fail.  With this plugin account
+names can be correctly mapped. This only applies to GSSAPI authentication,
+not for the geting the initial ticket granting ticket.
+
 REMOVED FEATURES
 ================
 
diff -Npur samba-4.8.2/auth/auth_log.c samba-4.8.3/auth/auth_log.c
--- samba-4.8.2/auth/auth_log.c	2018-01-17 09:08:39.000000000 +0100
+++ samba-4.8.3/auth/auth_log.c	2018-06-26 16:42:46.000000000 +0200
@@ -350,7 +350,7 @@ static void add_version(struct json_cont
 static void add_timestamp(struct json_context *context)
 {
 	char buffer[40];	/* formatted time less usec and timezone */
-	char timestamp[50];	/* the formatted ISO 8601 time stamp	 */
+	char timestamp[65];	/* the formatted ISO 8601 time stamp	 */
 	char tz[10];		/* formatted time zone			 */
 	struct tm* tm_info;	/* current local time			 */
 	struct timeval tv;	/* current system time			 */
diff -Npur samba-4.8.2/auth/ntlmssp/gensec_ntlmssp_server.c samba-4.8.3/auth/ntlmssp/gensec_ntlmssp_server.c
--- samba-4.8.2/auth/ntlmssp/gensec_ntlmssp_server.c	2018-01-17 09:08:39.000000000 +0100
+++ samba-4.8.3/auth/ntlmssp/gensec_ntlmssp_server.c	2018-06-26 16:42:46.000000000 +0200
@@ -179,25 +179,6 @@ NTSTATUS gensec_ntlmssp_server_start(str
 	ntlmssp_state->neg_flags |= NTLMSSP_NEGOTIATE_SIGN;
 	ntlmssp_state->neg_flags |= NTLMSSP_NEGOTIATE_SEAL;
 
-	if (gensec_security->want_features & GENSEC_FEATURE_SESSION_KEY) {
-		ntlmssp_state->neg_flags |= NTLMSSP_NEGOTIATE_SIGN;
-	}
-	if (gensec_security->want_features & GENSEC_FEATURE_SIGN) {
-		ntlmssp_state->neg_flags |= NTLMSSP_NEGOTIATE_SIGN;
-
-		if (gensec_security->want_features & GENSEC_FEATURE_LDAP_STYLE) {
-			/*
-			 * We need to handle NTLMSSP_NEGOTIATE_SIGN as
-			 * NTLMSSP_NEGOTIATE_SEAL if GENSEC_FEATURE_LDAP_STYLE
-			 * is requested.
-			 */
-			ntlmssp_state->force_wrap_seal = true;
-		}
-	}
-	if (gensec_security->want_features & GENSEC_FEATURE_SEAL) {
-		ntlmssp_state->neg_flags |= NTLMSSP_NEGOTIATE_SIGN;
-		ntlmssp_state->neg_flags |= NTLMSSP_NEGOTIATE_SEAL;
-	}
 
 	if (role == ROLE_STANDALONE) {
 		ntlmssp_state->server.is_standalone = true;
diff -Npur samba-4.8.2/auth/ntlmssp/ntlmssp_client.c samba-4.8.3/auth/ntlmssp/ntlmssp_client.c
--- samba-4.8.2/auth/ntlmssp/ntlmssp_client.c	2018-01-17 09:08:39.000000000 +0100
+++ samba-4.8.3/auth/ntlmssp/ntlmssp_client.c	2018-06-26 16:42:46.000000000 +0200
@@ -865,13 +865,23 @@ NTSTATUS gensec_ntlmssp_client_start(str
 			 * is requested.
 			 */
 			ntlmssp_state->force_wrap_seal = true;
-			/*
-			 * We want also work against old Samba servers
-			 * which didn't had GENSEC_FEATURE_LDAP_STYLE
-			 * we negotiate SEAL too. We may remove this
-			 * in a few years. As all servers should have
-			 * GENSEC_FEATURE_LDAP_STYLE by then.
-			 */
+		}
+	}
+	if (ntlmssp_state->force_wrap_seal) {
+		bool ret;
+
+		/*
+		 * We want also work against old Samba servers
+		 * which didn't had GENSEC_FEATURE_LDAP_STYLE
+		 * we negotiate SEAL too. We may remove this
+		 * in a few years. As all servers should have
+		 * GENSEC_FEATURE_LDAP_STYLE by then.
+		 */
+		ret = gensec_setting_bool(gensec_security->settings,
+					  "ntlmssp_client",
+					  "ldap_style_send_seal",
+					  true);
+		if (ret) {
 			ntlmssp_state->required_flags |= NTLMSSP_NEGOTIATE_SEAL;
 		}
 	}
diff -Npur samba-4.8.2/auth/ntlmssp/ntlmssp_server.c samba-4.8.3/auth/ntlmssp/ntlmssp_server.c
--- samba-4.8.2/auth/ntlmssp/ntlmssp_server.c	2018-01-17 09:08:39.000000000 +0100
+++ samba-4.8.3/auth/ntlmssp/ntlmssp_server.c	2018-06-26 16:42:46.000000000 +0200
@@ -1080,6 +1080,14 @@ static NTSTATUS ntlmssp_server_postauth(
 	data_blob_free(&ntlmssp_state->challenge_blob);
 
 	if (gensec_ntlmssp_have_feature(gensec_security, GENSEC_FEATURE_SIGN)) {
+		if (gensec_security->want_features & GENSEC_FEATURE_LDAP_STYLE) {
+			/*
+			 * We need to handle NTLMSSP_NEGOTIATE_SIGN as
+			 * NTLMSSP_NEGOTIATE_SEAL if GENSEC_FEATURE_LDAP_STYLE
+			 * is requested.
+			 */
+			ntlmssp_state->force_wrap_seal = true;
+		}
 		nt_status = ntlmssp_sign_init(ntlmssp_state);
 	}
 
diff -Npur samba-4.8.2/ctdb/doc/ctdb-etcd.7 samba-4.8.3/ctdb/doc/ctdb-etcd.7
--- samba-4.8.2/ctdb/doc/ctdb-etcd.7	2018-05-16 12:14:56.000000000 +0200
+++ samba-4.8.3/ctdb/doc/ctdb-etcd.7	2018-06-26 16:49:36.000000000 +0200
@@ -2,12 +2,12 @@
 .\"     Title: ctdb-etcd
 .\"    Author: 
 .\" Generator: DocBook XSL Stylesheets v1.79.1 <http://docbook.sf.net/>
-.\"      Date: 05/16/2018
+.\"      Date: 06/26/2018
 .\"    Manual: CTDB - clustered TDB database
 .\"    Source: ctdb
 .\"  Language: English
 .\"
-.TH "CTDB\-ETCD" "7" "05/16/2018" "ctdb" "CTDB \- clustered TDB database"
+.TH "CTDB\-ETCD" "7" "06/26/2018" "ctdb" "CTDB \- clustered TDB database"
 .\" -----------------------------------------------------------------
 .\" * Define some portability stuff
 .\" -----------------------------------------------------------------
diff -Npur samba-4.8.2/ctdb/doc/ctdb-statistics.7 samba-4.8.3/ctdb/doc/ctdb-statistics.7
--- samba-4.8.2/ctdb/doc/ctdb-statistics.7	2018-05-16 12:14:55.000000000 +0200
+++ samba-4.8.3/ctdb/doc/ctdb-statistics.7	2018-06-26 16:49:35.000000000 +0200
@@ -2,12 +2,12 @@
 .\"     Title: ctdb-statistics
 .\"    Author: 
 .\" Generator: DocBook XSL Stylesheets v1.79.1 <http://docbook.sf.net/>
-.\"      Date: 05/16/2018
+.\"      Date: 06/26/2018
 .\"    Manual: CTDB - clustered TDB database
 .\"    Source: ctdb
 .\"  Language: English
 .\"
-.TH "CTDB\-STATISTICS" "7" "05/16/2018" "ctdb" "CTDB \- clustered TDB database"
+.TH "CTDB\-STATISTICS" "7" "06/26/2018" "ctdb" "CTDB \- clustered TDB database"
 .\" -----------------------------------------------------------------
 .\" * Define some portability stuff
 .\" -----------------------------------------------------------------
diff -Npur samba-4.8.2/ctdb/doc/ctdb-tunables.7 samba-4.8.3/ctdb/doc/ctdb-tunables.7
--- samba-4.8.2/ctdb/doc/ctdb-tunables.7	2018-05-16 12:14:55.000000000 +0200
+++ samba-4.8.3/ctdb/doc/ctdb-tunables.7	2018-06-26 16:49:35.000000000 +0200
@@ -2,12 +2,12 @@
 .\"     Title: ctdb-tunables
 .\"    Author: 
 .\" Generator: DocBook XSL Stylesheets v1.79.1 <http://docbook.sf.net/>
-.\"      Date: 05/16/2018
+.\"      Date: 06/26/2018
 .\"    Manual: CTDB - clustered TDB database
 .\"    Source: ctdb
 .\"  Language: English
 .\"
-.TH "CTDB\-TUNABLES" "7" "05/16/2018" "ctdb" "CTDB \- clustered TDB database"
+.TH "CTDB\-TUNABLES" "7" "06/26/2018" "ctdb" "CTDB \- clustered TDB database"
 .\" -----------------------------------------------------------------
 .\" * Define some portability stuff
 .\" -----------------------------------------------------------------
diff -Npur samba-4.8.2/ctdb/doc/ctdb.1 samba-4.8.3/ctdb/doc/ctdb.1
--- samba-4.8.2/ctdb/doc/ctdb.1	2018-05-16 12:14:51.000000000 +0200
+++ samba-4.8.3/ctdb/doc/ctdb.1	2018-06-26 16:49:32.000000000 +0200
@@ -2,12 +2,12 @@
 .\"     Title: ctdb
 .\"    Author: 
 .\" Generator: DocBook XSL Stylesheets v1.79.1 <http://docbook.sf.net/>
-.\"      Date: 05/16/2018
+.\"      Date: 06/26/2018
 .\"    Manual: CTDB - clustered TDB database
 .\"    Source: ctdb
 .\"  Language: English
 .\"
-.TH "CTDB" "1" "05/16/2018" "ctdb" "CTDB \- clustered TDB database"
+.TH "CTDB" "1" "06/26/2018" "ctdb" "CTDB \- clustered TDB database"
 .\" -----------------------------------------------------------------
 .\" * Define some portability stuff
 .\" -----------------------------------------------------------------
diff -Npur samba-4.8.2/ctdb/doc/ctdb.7 samba-4.8.3/ctdb/doc/ctdb.7
--- samba-4.8.2/ctdb/doc/ctdb.7	2018-05-16 12:14:54.000000000 +0200
+++ samba-4.8.3/ctdb/doc/ctdb.7	2018-06-26 16:49:35.000000000 +0200
@@ -2,12 +2,12 @@
 .\"     Title: ctdb
 .\"    Author: 
 .\" Generator: DocBook XSL Stylesheets v1.79.1 <http://docbook.sf.net/>
-.\"      Date: 05/16/2018
+.\"      Date: 06/26/2018
 .\"    Manual: CTDB - clustered TDB database
 .\"    Source: ctdb
 .\"  Language: English
 .\"
-.TH "CTDB" "7" "05/16/2018" "ctdb" "CTDB \- clustered TDB database"
+.TH "CTDB" "7" "06/26/2018" "ctdb" "CTDB \- clustered TDB database"
 .\" -----------------------------------------------------------------
 .\" * Define some portability stuff
 .\" -----------------------------------------------------------------
diff -Npur samba-4.8.2/ctdb/doc/ctdb_diagnostics.1 samba-4.8.3/ctdb/doc/ctdb_diagnostics.1
--- samba-4.8.2/ctdb/doc/ctdb_diagnostics.1	2018-05-16 12:14:53.000000000 +0200
+++ samba-4.8.3/ctdb/doc/ctdb_diagnostics.1	2018-06-26 16:49:33.000000000 +0200
@@ -2,12 +2,12 @@
 .\"     Title: ctdb_diagnostics
 .\"    Author: 
 .\" Generator: DocBook XSL Stylesheets v1.79.1 <http://docbook.sf.net/>
-.\"      Date: 05/16/2018
+.\"      Date: 06/26/2018
 .\"    Manual: CTDB - clustered TDB database
 .\"    Source: ctdb
 .\"  Language: English
 .\"
-.TH "CTDB_DIAGNOSTICS" "1" "05/16/2018" "ctdb" "CTDB \- clustered TDB database"
+.TH "CTDB_DIAGNOSTICS" "1" "06/26/2018" "ctdb" "CTDB \- clustered TDB database"
 .\" -----------------------------------------------------------------
 .\" * Define some portability stuff
 .\" -----------------------------------------------------------------
diff -Npur samba-4.8.2/ctdb/doc/ctdb_mutex_ceph_rados_helper.7 samba-4.8.3/ctdb/doc/ctdb_mutex_ceph_rados_helper.7
--- samba-4.8.2/ctdb/doc/ctdb_mutex_ceph_rados_helper.7	2018-05-16 12:14:56.000000000 +0200
+++ samba-4.8.3/ctdb/doc/ctdb_mutex_ceph_rados_helper.7	2018-06-26 16:49:36.000000000 +0200
@@ -2,12 +2,12 @@
 .\"     Title: Ceph RADOS Mutex
 .\"    Author: 
 .\" Generator: DocBook XSL Stylesheets v1.79.1 <http://docbook.sf.net/>
-.\"      Date: 05/16/2018
+.\"      Date: 06/26/2018
 .\"    Manual: CTDB - clustered TDB database
 .\"    Source: ctdb
 .\"  Language: English
 .\"
-.TH "CEPH RADOS MUTEX" "7" "05/16/2018" "ctdb" "CTDB \- clustered TDB database"
+.TH "CEPH RADOS MUTEX" "7" "06/26/2018" "ctdb" "CTDB \- clustered TDB database"
 .\" -----------------------------------------------------------------
 .\" * Define some portability stuff
 .\" -----------------------------------------------------------------
diff -Npur samba-4.8.2/ctdb/doc/ctdbd.1 samba-4.8.3/ctdb/doc/ctdbd.1
--- samba-4.8.2/ctdb/doc/ctdbd.1	2018-05-16 12:14:52.000000000 +0200
+++ samba-4.8.3/ctdb/doc/ctdbd.1	2018-06-26 16:49:32.000000000 +0200
@@ -2,12 +2,12 @@
 .\"     Title: ctdbd
 .\"    Author: 
 .\" Generator: DocBook XSL Stylesheets v1.79.1 <http://docbook.sf.net/>
-.\"      Date: 05/16/2018
+.\"      Date: 06/26/2018
 .\"    Manual: CTDB - clustered TDB database
 .\"    Source: ctdb
 .\"  Language: English
 .\"
-.TH "CTDBD" "1" "05/16/2018" "ctdb" "CTDB \- clustered TDB database"
+.TH "CTDBD" "1" "06/26/2018" "ctdb" "CTDB \- clustered TDB database"
 .\" -----------------------------------------------------------------
 .\" * Define some portability stuff
 .\" -----------------------------------------------------------------
diff -Npur samba-4.8.2/ctdb/doc/ctdbd.conf.5 samba-4.8.3/ctdb/doc/ctdbd.conf.5
--- samba-4.8.2/ctdb/doc/ctdbd.conf.5	2018-05-16 12:14:54.000000000 +0200
+++ samba-4.8.3/ctdb/doc/ctdbd.conf.5	2018-06-26 16:49:34.000000000 +0200
@@ -2,12 +2,12 @@
 .\"     Title: ctdbd.conf
 .\"    Author: 
 .\" Generator: DocBook XSL Stylesheets v1.79.1 <http://docbook.sf.net/>
-.\"      Date: 05/16/2018
+.\"      Date: 06/26/2018
 .\"    Manual: CTDB - clustered TDB database
 .\"    Source: ctdb
 .\"  Language: English
 .\"
-.TH "CTDBD\&.CONF" "5" "05/16/2018" "ctdb" "CTDB \- clustered TDB database"
+.TH "CTDBD\&.CONF" "5" "06/26/2018" "ctdb" "CTDB \- clustered TDB database"
 .\" -----------------------------------------------------------------
 .\" * Define some portability stuff
 .\" -----------------------------------------------------------------
diff -Npur samba-4.8.2/ctdb/doc/ctdbd_wrapper.1 samba-4.8.3/ctdb/doc/ctdbd_wrapper.1
--- samba-4.8.2/ctdb/doc/ctdbd_wrapper.1	2018-05-16 12:14:53.000000000 +0200
+++ samba-4.8.3/ctdb/doc/ctdbd_wrapper.1	2018-06-26 16:49:34.000000000 +0200
@@ -2,12 +2,12 @@
 .\"     Title: ctdbd_wrapper
 .\"    Author: 
 .\" Generator: DocBook XSL Stylesheets v1.79.1 <http://docbook.sf.net/>
-.\"      Date: 05/16/2018
+.\"      Date: 06/26/2018
 .\"    Manual: CTDB - clustered TDB database
 .\"    Source: ctdb
 .\"  Language: English
 .\"
-.TH "CTDBD_WRAPPER" "1" "05/16/2018" "ctdb" "CTDB \- clustered TDB database"
+.TH "CTDBD_WRAPPER" "1" "06/26/2018" "ctdb" "CTDB \- clustered TDB database"
 .\" -----------------------------------------------------------------
 .\" * Define some portability stuff
 .\" -----------------------------------------------------------------
diff -Npur samba-4.8.2/ctdb/doc/ltdbtool.1 samba-4.8.3/ctdb/doc/ltdbtool.1
--- samba-4.8.2/ctdb/doc/ltdbtool.1	2018-05-16 12:14:52.000000000 +0200
+++ samba-4.8.3/ctdb/doc/ltdbtool.1	2018-06-26 16:49:33.000000000 +0200
@@ -2,12 +2,12 @@
 .\"     Title: ltdbtool
 .\"    Author: 
 .\" Generator: DocBook XSL Stylesheets v1.79.1 <http://docbook.sf.net/>
-.\"      Date: 05/16/2018
+.\"      Date: 06/26/2018
 .\"    Manual: CTDB - clustered TDB database
 .\"    Source: ctdb
 .\"  Language: English
 .\"
-.TH "LTDBTOOL" "1" "05/16/2018" "ctdb" "CTDB \- clustered TDB database"
+.TH "LTDBTOOL" "1" "06/26/2018" "ctdb" "CTDB \- clustered TDB database"
 .\" -----------------------------------------------------------------
 .\" * Define some portability stuff
 .\" -----------------------------------------------------------------
diff -Npur samba-4.8.2/ctdb/doc/onnode.1 samba-4.8.3/ctdb/doc/onnode.1
--- samba-4.8.2/ctdb/doc/onnode.1	2018-05-16 12:14:54.000000000 +0200
+++ samba-4.8.3/ctdb/doc/onnode.1	2018-06-26 16:49:34.000000000 +0200
@@ -2,12 +2,12 @@
 .\"     Title: onnode
 .\"    Author: 
 .\" Generator: DocBook XSL Stylesheets v1.79.1 <http://docbook.sf.net/>
-.\"      Date: 05/16/2018
+.\"      Date: 06/26/2018
 .\"    Manual: CTDB - clustered TDB database
 .\"    Source: ctdb
 .\"  Language: English
 .\"
-.TH "ONNODE" "1" "05/16/2018" "ctdb" "CTDB \- clustered TDB database"
+.TH "ONNODE" "1" "06/26/2018" "ctdb" "CTDB \- clustered TDB database"
 .\" -----------------------------------------------------------------
 .\" * Define some portability stuff
 .\" -----------------------------------------------------------------
diff -Npur samba-4.8.2/ctdb/doc/ping_pong.1 samba-4.8.3/ctdb/doc/ping_pong.1
--- samba-4.8.2/ctdb/doc/ping_pong.1	2018-05-16 12:14:53.000000000 +0200
+++ samba-4.8.3/ctdb/doc/ping_pong.1	2018-06-26 16:49:33.000000000 +0200
@@ -2,12 +2,12 @@
 .\"     Title: ping_pong
 .\"    Author: 
 .\" Generator: DocBook XSL Stylesheets v1.79.1 <http://docbook.sf.net/>
-.\"      Date: 05/16/2018
+.\"      Date: 06/26/2018
 .\"    Manual: CTDB - clustered TDB database
 .\"    Source: ctdb
 .\"  Language: English
 .\"
-.TH "PING_PONG" "1" "05/16/2018" "ctdb" "CTDB \- clustered TDB database"
+.TH "PING_PONG" "1" "06/26/2018" "ctdb" "CTDB \- clustered TDB database"
 .\" -----------------------------------------------------------------
 .\" * Define some portability stuff
 .\" -----------------------------------------------------------------
diff -Npur samba-4.8.2/docs/manpages/cifsdd.8 samba-4.8.3/docs/manpages/cifsdd.8
--- samba-4.8.2/docs/manpages/cifsdd.8	2018-05-16 12:14:57.000000000 +0200
+++ samba-4.8.3/docs/manpages/cifsdd.8	2018-06-26 16:49:38.000000000 +0200
@@ -2,12 +2,12 @@
 .\"     Title: cifsdd
 .\"    Author: [see the "AUTHOR" section]
 .\" Generator: DocBook XSL Stylesheets v1.79.1 <http://docbook.sf.net/>
-.\"      Date: 05/16/2018
+.\"      Date: 06/26/2018
 .\"    Manual: System Administration tools
-.\"    Source: Samba 4.8.2
+.\"    Source: Samba 4.8.3
 .\"  Language: English
 .\"
-.TH "CIFSDD" "8" "05/16/2018" "Samba 4\&.8\&.2" "System Administration tools"
+.TH "CIFSDD" "8" "06/26/2018" "Samba 4\&.8\&.3" "System Administration tools"
 .\" -----------------------------------------------------------------
 .\" * Define some portability stuff
 .\" -----------------------------------------------------------------
diff -Npur samba-4.8.2/docs/manpages/dbwrap_tool.1 samba-4.8.3/docs/manpages/dbwrap_tool.1
--- samba-4.8.2/docs/manpages/dbwrap_tool.1	2018-05-16 12:14:58.000000000 +0200
+++ samba-4.8.3/docs/manpages/dbwrap_tool.1	2018-06-26 16:49:38.000000000 +0200
@@ -2,12 +2,12 @@
 .\"     Title: dbwrap_tool
 .\"    Author: [see the "AUTHOR" section]
 .\" Generator: DocBook XSL Stylesheets v1.79.1 <http://docbook.sf.net/>
-.\"      Date: 05/16/2018
+.\"      Date: 06/26/2018
 .\"    Manual: System Administration tools
-.\"    Source: Samba 4.8.2
+.\"    Source: Samba 4.8.3
 .\"  Language: English
 .\"
-.TH "DBWRAP_TOOL" "1" "05/16/2018" "Samba 4\&.8\&.2" "System Administration tools"
+.TH "DBWRAP_TOOL" "1" "06/26/2018" "Samba 4\&.8\&.3" "System Administration tools"
 .\" -----------------------------------------------------------------
 .\" * Define some portability stuff
 .\" -----------------------------------------------------------------
@@ -301,7 +301,7 @@ dbwrap_tool
 Use with caution!
 .SH "VERSION"
 .PP
-This man page is part of version 4\&.8\&.2 of the Samba suite\&.
+This man page is part of version 4\&.8\&.3 of the Samba suite\&.
 .SH "SEE ALSO"
 .PP
 \fBsmbd\fR(8),
diff -Npur samba-4.8.2/docs/manpages/eventlogadm.8 samba-4.8.3/docs/manpages/eventlogadm.8
--- samba-4.8.2/docs/manpages/eventlogadm.8	2018-05-16 12:14:58.000000000 +0200
+++ samba-4.8.3/docs/manpages/eventlogadm.8	2018-06-26 16:49:38.000000000 +0200
@@ -2,12 +2,12 @@
 .\"     Title: eventlogadm
 .\"    Author: [see the "AUTHOR" section]
 .\" Generator: DocBook XSL Stylesheets v1.79.1 <http://docbook.sf.net/>
-.\"      Date: 05/16/2018
+.\"      Date: 06/26/2018
 .\"    Manual: System Administration tools
-.\"    Source: Samba 4.8.2
+.\"    Source: Samba 4.8.3
 .\"  Language: English
 .\"
-.TH "EVENTLOGADM" "8" "05/16/2018" "Samba 4\&.8\&.2" "System Administration tools"
+.TH "EVENTLOGADM" "8" "06/26/2018" "Samba 4\&.8\&.3" "System Administration tools"
 .\" -----------------------------------------------------------------
 .\" * Define some portability stuff
 .\" -----------------------------------------------------------------
@@ -339,7 +339,7 @@ Filter messages from the system log into
 .\}
 .SH "VERSION"
 .PP
-This man page is part of version 4\&.8\&.2 of the Samba suite\&.
+This man page is part of version 4\&.8\&.3 of the Samba suite\&.
 .SH "AUTHOR"
 .PP
 The original Samba software and related utilities were created by Andrew Tridgell\&. Samba is now developed by the Samba Team as an Open Source project similar to the way the Linux kernel is developed\&.
diff -Npur samba-4.8.2/docs/manpages/findsmb.1 samba-4.8.3/docs/manpages/findsmb.1
--- samba-4.8.2/docs/manpages/findsmb.1	2018-05-16 12:14:58.000000000 +0200
+++ samba-4.8.3/docs/manpages/findsmb.1	2018-06-26 16:49:38.000000000 +0200
@@ -2,12 +2,12 @@
 .\"     Title: findsmb
 .\"    Author: [see the "AUTHOR" section]
 .\" Generator: DocBook XSL Stylesheets v1.79.1 <http://docbook.sf.net/>
-.\"      Date: 05/16/2018
+.\"      Date: 06/26/2018
 .\"    Manual: User Commands
-.\"    Source: Samba 4.8.2
+.\"    Source: Samba 4.8.3
 .\"  Language: English
 .\"
-.TH "FINDSMB" "1" "05/16/2018" "Samba 4\&.8\&.2" "User Commands"
+.TH "FINDSMB" "1" "06/26/2018" "Samba 4\&.8\&.3" "User Commands"
 .\" -----------------------------------------------------------------
 .\" * Define some portability stuff
 .\" -----------------------------------------------------------------
@@ -119,7 +119,7 @@ IP ADDR         NETBIOS NAME   WORKGROUP
 .\}
 .SH "VERSION"
 .PP
-This man page is part of version 4\&.8\&.2 of the Samba suite\&.
+This man page is part of version 4\&.8\&.3 of the Samba suite\&.
 .SH "SEE ALSO"
 .PP
 \fBnmbd\fR(8),
diff -Npur samba-4.8.2/docs/manpages/idmap_ad.8 samba-4.8.3/docs/manpages/idmap_ad.8
--- samba-4.8.2/docs/manpages/idmap_ad.8	2018-05-16 12:14:58.000000000 +0200
+++ samba-4.8.3/docs/manpages/idmap_ad.8	2018-06-26 16:49:39.000000000 +0200
@@ -2,12 +2,12 @@
 .\"     Title: idmap_ad
 .\"    Author: [see the "AUTHOR" section]
 .\" Generator: DocBook XSL Stylesheets v1.79.1 <http://docbook.sf.net/>
-.\"      Date: 05/16/2018
+.\"      Date: 06/26/2018
 .\"    Manual: System Administration tools
-.\"    Source: Samba 4.8.2
+.\"    Source: Samba 4.8.3
 .\"  Language: English
 .\"
-.TH "IDMAP_AD" "8" "05/16/2018" "Samba 4\&.8\&.2" "System Administration tools"
+.TH "IDMAP_AD" "8" "06/26/2018" "Samba 4\&.8\&.3" "System Administration tools"
 .\" -----------------------------------------------------------------
 .\" * Define some portability stuff
 .\" -----------------------------------------------------------------
diff -Npur samba-4.8.2/docs/manpages/idmap_autorid.8 samba-4.8.3/docs/manpages/idmap_autorid.8
--- samba-4.8.2/docs/manpages/idmap_autorid.8	2018-05-16 12:14:58.000000000 +0200
+++ samba-4.8.3/docs/manpages/idmap_autorid.8	2018-06-26 16:49:39.000000000 +0200
@@ -2,12 +2,12 @@
 .\"     Title: idmap_autorid
 .\"    Author: [see the "AUTHOR" section]
 .\" Generator: DocBook XSL Stylesheets v1.79.1 <http://docbook.sf.net/>
-.\"      Date: 05/16/2018
+.\"      Date: 06/26/2018
 .\"    Manual: System Administration tools
-.\"    Source: Samba 4.8.2
+.\"    Source: Samba 4.8.3
 .\"  Language: English
 .\"
-.TH "IDMAP_AUTORID" "8" "05/16/2018" "Samba 4\&.8\&.2" "System Administration tools"
+.TH "IDMAP_AUTORID" "8" "06/26/2018" "Samba 4\&.8\&.3" "System Administration tools"
 .\" -----------------------------------------------------------------
 .\" * Define some portability stuff
 .\" -----------------------------------------------------------------
diff -Npur samba-4.8.2/docs/manpages/idmap_hash.8 samba-4.8.3/docs/manpages/idmap_hash.8
--- samba-4.8.2/docs/manpages/idmap_hash.8	2018-05-16 12:14:59.000000000 +0200
+++ samba-4.8.3/docs/manpages/idmap_hash.8	2018-06-26 16:49:39.000000000 +0200
@@ -2,12 +2,12 @@
 .\"     Title: idmap_hash
 .\"    Author: [see the "AUTHOR" section]
 .\" Generator: DocBook XSL Stylesheets v1.79.1 <http://docbook.sf.net/>
-.\"      Date: 05/16/2018
+.\"      Date: 06/26/2018
 .\"    Manual: System Administration tools
-.\"    Source: Samba 4.8.2
+.\"    Source: Samba 4.8.3
 .\"  Language: English
 .\"
-.TH "IDMAP_HASH" "8" "05/16/2018" "Samba 4\&.8\&.2" "System Administration tools"
+.TH "IDMAP_HASH" "8" "06/26/2018" "Samba 4\&.8\&.3" "System Administration tools"
 .\" -----------------------------------------------------------------
 .\" * Define some portability stuff
 .\" -----------------------------------------------------------------
diff -Npur samba-4.8.2/docs/manpages/idmap_ldap.8 samba-4.8.3/docs/manpages/idmap_ldap.8
--- samba-4.8.2/docs/manpages/idmap_ldap.8	2018-05-16 12:14:59.000000000 +0200
+++ samba-4.8.3/docs/manpages/idmap_ldap.8	2018-06-26 16:49:39.000000000 +0200
@@ -2,12 +2,12 @@
 .\"     Title: idmap_ldap
 .\"    Author: [see the "AUTHOR" section]
 .\" Generator: DocBook XSL Stylesheets v1.79.1 <http://docbook.sf.net/>
-.\"      Date: 05/16/2018
+.\"      Date: 06/26/2018
 .\"    Manual: System Administration tools
-.\"    Source: Samba 4.8.2
+.\"    Source: Samba 4.8.3
 .\"  Language: English
 .\"
-.TH "IDMAP_LDAP" "8" "05/16/2018" "Samba 4\&.8\&.2" "System Administration tools"
+.TH "IDMAP_LDAP" "8" "06/26/2018" "Samba 4\&.8\&.3" "System Administration tools"
 .\" -----------------------------------------------------------------
 .\" * Define some portability stuff
 .\" -----------------------------------------------------------------
diff -Npur samba-4.8.2/docs/manpages/idmap_nss.8 samba-4.8.3/docs/manpages/idmap_nss.8
--- samba-4.8.2/docs/manpages/idmap_nss.8	2018-05-16 12:14:59.000000000 +0200
+++ samba-4.8.3/docs/manpages/idmap_nss.8	2018-06-26 16:49:39.000000000 +0200
@@ -2,12 +2,12 @@
 .\"     Title: idmap_nss
 .\"    Author: [see the "AUTHOR" section]
 .\" Generator: DocBook XSL Stylesheets v1.79.1 <http://docbook.sf.net/>
-.\"      Date: 05/16/2018
+.\"      Date: 06/26/2018
 .\"    Manual: System Administration tools
-.\"    Source: Samba 4.8.2
+.\"    Source: Samba 4.8.3
 .\"  Language: English
 .\"
-.TH "IDMAP_NSS" "8" "05/16/2018" "Samba 4\&.8\&.2" "System Administration tools"
+.TH "IDMAP_NSS" "8" "06/26/2018" "Samba 4\&.8\&.3" "System Administration tools"
 .\" -----------------------------------------------------------------
 .\" * Define some portability stuff
 .\" -----------------------------------------------------------------
diff -Npur samba-4.8.2/docs/manpages/idmap_rfc2307.8 samba-4.8.3/docs/manpages/idmap_rfc2307.8
--- samba-4.8.2/docs/manpages/idmap_rfc2307.8	2018-05-16 12:14:59.000000000 +0200
+++ samba-4.8.3/docs/manpages/idmap_rfc2307.8	2018-06-26 16:49:40.000000000 +0200
@@ -2,12 +2,12 @@
 .\"     Title: idmap_rfc2307
 .\"    Author: [see the "AUTHOR" section]
 .\" Generator: DocBook XSL Stylesheets v1.79.1 <http://docbook.sf.net/>
-.\"      Date: 05/16/2018
+.\"      Date: 06/26/2018
 .\"    Manual: System Administration tools
-.\"    Source: Samba 4.8.2
+.\"    Source: Samba 4.8.3
 .\"  Language: English
 .\"
-.TH "IDMAP_RFC2307" "8" "05/16/2018" "Samba 4\&.8\&.2" "System Administration tools"
+.TH "IDMAP_RFC2307" "8" "06/26/2018" "Samba 4\&.8\&.3" "System Administration tools"
 .\" -----------------------------------------------------------------
 .\" * Define some portability stuff
 .\" -----------------------------------------------------------------
diff -Npur samba-4.8.2/docs/manpages/idmap_rid.8 samba-4.8.3/docs/manpages/idmap_rid.8
--- samba-4.8.2/docs/manpages/idmap_rid.8	2018-05-16 12:15:00.000000000 +0200
+++ samba-4.8.3/docs/manpages/idmap_rid.8	2018-06-26 16:49:40.000000000 +0200
@@ -2,12 +2,12 @@
 .\"     Title: idmap_rid
 .\"    Author: [see the "AUTHOR" section]
 .\" Generator: DocBook XSL Stylesheets v1.79.1 <http://docbook.sf.net/>
-.\"      Date: 05/16/2018
+.\"      Date: 06/26/2018
 .\"    Manual: System Administration tools
-.\"    Source: Samba 4.8.2
+.\"    Source: Samba 4.8.3
 .\"  Language: English
 .\"
-.TH "IDMAP_RID" "8" "05/16/2018" "Samba 4\&.8\&.2" "System Administration tools"
+.TH "IDMAP_RID" "8" "06/26/2018" "Samba 4\&.8\&.3" "System Administration tools"
 .\" -----------------------------------------------------------------
 .\" * Define some portability stuff
 .\" -----------------------------------------------------------------
diff -Npur samba-4.8.2/docs/manpages/idmap_script.8 samba-4.8.3/docs/manpages/idmap_script.8
--- samba-4.8.2/docs/manpages/idmap_script.8	2018-05-16 12:15:00.000000000 +0200
+++ samba-4.8.3/docs/manpages/idmap_script.8	2018-06-26 16:49:40.000000000 +0200
@@ -2,12 +2,12 @@
 .\"     Title: idmap_script
 .\"    Author: [see the "AUTHOR" section]
 .\" Generator: DocBook XSL Stylesheets v1.79.1 <http://docbook.sf.net/>
-.\"      Date: 05/16/2018
+.\"      Date: 06/26/2018
 .\"    Manual: System Administration tools
-.\"    Source: Samba 4.8.2
+.\"    Source: Samba 4.8.3
 .\"  Language: English
 .\"
-.TH "IDMAP_SCRIPT" "8" "05/16/2018" "Samba 4\&.8\&.2" "System Administration tools"
+.TH "IDMAP_SCRIPT" "8" "06/26/2018" "Samba 4\&.8\&.3" "System Administration tools"
 .\" -----------------------------------------------------------------
 .\" * Define some portability stuff
 .\" -----------------------------------------------------------------
diff -Npur samba-4.8.2/docs/manpages/idmap_tdb.8 samba-4.8.3/docs/manpages/idmap_tdb.8
--- samba-4.8.2/docs/manpages/idmap_tdb.8	2018-05-16 12:15:00.000000000 +0200
+++ samba-4.8.3/docs/manpages/idmap_tdb.8	2018-06-26 16:49:40.000000000 +0200
@@ -2,12 +2,12 @@
 .\"     Title: idmap_tdb
 .\"    Author: [see the "AUTHOR" section]
 .\" Generator: DocBook XSL Stylesheets v1.79.1 <http://docbook.sf.net/>
-.\"      Date: 05/16/2018
+.\"      Date: 06/26/2018
 .\"    Manual: System Administration tools
-.\"    Source: Samba 4.8.2
+.\"    Source: Samba 4.8.3
 .\"  Language: English
 .\"
-.TH "IDMAP_TDB" "8" "05/16/2018" "Samba 4\&.8\&.2" "System Administration tools"
+.TH "IDMAP_TDB" "8" "06/26/2018" "Samba 4\&.8\&.3" "System Administration tools"
 .\" -----------------------------------------------------------------
 .\" * Define some portability stuff
 .\" -----------------------------------------------------------------
diff -Npur samba-4.8.2/docs/manpages/idmap_tdb2.8 samba-4.8.3/docs/manpages/idmap_tdb2.8
--- samba-4.8.2/docs/manpages/idmap_tdb2.8	2018-05-16 12:15:00.000000000 +0200
+++ samba-4.8.3/docs/manpages/idmap_tdb2.8	2018-06-26 16:49:40.000000000 +0200
@@ -2,12 +2,12 @@
 .\"     Title: idmap_tdb2
 .\"    Author: [see the "AUTHOR" section]
 .\" Generator: DocBook XSL Stylesheets v1.79.1 <http://docbook.sf.net/>
-.\"      Date: 05/16/2018
+.\"      Date: 06/26/2018
 .\"    Manual: System Administration tools
-.\"    Source: Samba 4.8.2
+.\"    Source: Samba 4.8.3
 .\"  Language: English
 .\"
-.TH "IDMAP_TDB2" "8" "05/16/2018" "Samba 4\&.8\&.2" "System Administration tools"
+.TH "IDMAP_TDB2" "8" "06/26/2018" "Samba 4\&.8\&.3" "System Administration tools"
 .\" -----------------------------------------------------------------
 .\" * Define some portability stuff
 .\" -----------------------------------------------------------------
diff -Npur samba-4.8.2/docs/manpages/libsmbclient.7 samba-4.8.3/docs/manpages/libsmbclient.7
--- samba-4.8.2/docs/manpages/libsmbclient.7	2018-05-16 12:15:00.000000000 +0200
+++ samba-4.8.3/docs/manpages/libsmbclient.7	2018-06-26 16:49:41.000000000 +0200
@@ -2,12 +2,12 @@
 .\"     Title: libsmbclient
 .\"    Author: [see the "AUTHOR" section]
 .\" Generator: DocBook XSL Stylesheets v1.79.1 <http://docbook.sf.net/>
-.\"      Date: 05/16/2018
+.\"      Date: 06/26/2018
 .\"    Manual: 7
-.\"    Source: Samba 4.8.2
+.\"    Source: Samba 4.8.3
 .\"  Language: English
 .\"
-.TH "LIBSMBCLIENT" "7" "05/16/2018" "Samba 4\&.8\&.2" "7"
+.TH "LIBSMBCLIENT" "7" "06/26/2018" "Samba 4\&.8\&.3" "7"
 .\" -----------------------------------------------------------------
 .\" * Define some portability stuff
 .\" -----------------------------------------------------------------
@@ -86,7 +86,7 @@ parameter was not included in the URL\&.
 Watch this space for future updates\&.
 .SH "VERSION"
 .PP
-This man page is part of version 4\&.8\&.2 of the Samba suite\&.
+This man page is part of version 4\&.8\&.3 of the Samba suite\&.
 .SH "AUTHOR"
 .PP
 The original Samba software and related utilities were created by Andrew Tridgell\&. Samba is now developed by the Samba Team as an Open Source project similar to the way the Linux kernel is developed\&.
diff -Npur samba-4.8.2/docs/manpages/lmhosts.5 samba-4.8.3/docs/manpages/lmhosts.5
--- samba-4.8.2/docs/manpages/lmhosts.5	2018-05-16 12:15:01.000000000 +0200
+++ samba-4.8.3/docs/manpages/lmhosts.5	2018-06-26 16:49:41.000000000 +0200
@@ -2,12 +2,12 @@
 .\"     Title: lmhosts
 .\"    Author: [see the "AUTHOR" section]
 .\" Generator: DocBook XSL Stylesheets v1.79.1 <http://docbook.sf.net/>
-.\"      Date: 05/16/2018
+.\"      Date: 06/26/2018
 .\"    Manual: File Formats and Conventions
-.\"    Source: Samba 4.8.2
+.\"    Source: Samba 4.8.3
 .\"  Language: English
 .\"
-.TH "LMHOSTS" "5" "05/16/2018" "Samba 4\&.8\&.2" "File Formats and Conventions"
+.TH "LMHOSTS" "5" "06/26/2018" "Samba 4\&.8\&.3" "File Formats and Conventions"
 .\" -----------------------------------------------------------------
 .\" * Define some portability stuff
 .\" -----------------------------------------------------------------
@@ -112,7 +112,7 @@ or
 /usr/local/samba/lib\&.
 .SH "VERSION"
 .PP
-This man page is part of version 4\&.8\&.2 of the Samba suite\&.
+This man page is part of version 4\&.8\&.3 of the Samba suite\&.
 .SH "SEE ALSO"
 .PP
 \fBsmbclient\fR(1),
diff -Npur samba-4.8.2/docs/manpages/log2pcap.1 samba-4.8.3/docs/manpages/log2pcap.1
--- samba-4.8.2/docs/manpages/log2pcap.1	2018-05-16 12:15:01.000000000 +0200
+++ samba-4.8.3/docs/manpages/log2pcap.1	2018-06-26 16:49:41.000000000 +0200
@@ -2,12 +2,12 @@
 .\"     Title: log2pcap
 .\"    Author: [see the "AUTHOR" section]
 .\" Generator: DocBook XSL Stylesheets v1.79.1 <http://docbook.sf.net/>
-.\"      Date: 05/16/2018
+.\"      Date: 06/26/2018
 .\"    Manual: User Commands
-.\"    Source: Samba 4.8.2
+.\"    Source: Samba 4.8.3
 .\"  Language: English
 .\"
-.TH "LOG2PCAP" "1" "05/16/2018" "Samba 4\&.8\&.2" "User Commands"
+.TH "LOG2PCAP" "1" "06/26/2018" "Samba 4\&.8\&.3" "User Commands"
 .\" -----------------------------------------------------------------
 .\" * Define some portability stuff
 .\" -----------------------------------------------------------------
@@ -107,7 +107,7 @@ Convert to pcap using text2pcap:
 .\}
 .SH "VERSION"
 .PP
-This man page is part of version 4\&.8\&.2 of the Samba suite\&.
+This man page is part of version 4\&.8\&.3 of the Samba suite\&.
 .SH "BUGS"
 .PP
 Only SMB data is extracted from the samba logs, no LDAP, NetBIOS lookup or other data\&.
diff -Npur samba-4.8.2/docs/manpages/mvxattr.1 samba-4.8.3/docs/manpages/mvxattr.1
--- samba-4.8.2/docs/manpages/mvxattr.1	2018-05-16 12:15:01.000000000 +0200
+++ samba-4.8.3/docs/manpages/mvxattr.1	2018-06-26 16:49:41.000000000 +0200
@@ -2,12 +2,12 @@
 .\"     Title: mvxattr
 .\"    Author: [see the "AUTHOR" section]
 .\" Generator: DocBook XSL Stylesheets v1.79.1 <http://docbook.sf.net/>
-.\"      Date: 05/16/2018
+.\"      Date: 06/26/2018
 .\"    Manual: User Commands
-.\"    Source: Samba 4.8.2
+.\"    Source: Samba 4.8.3
 .\"  Language: English
 .\"
-.TH "MVXATTR" "1" "05/16/2018" "Samba 4\&.8\&.2" "User Commands"
+.TH "MVXATTR" "1" "06/26/2018" "Samba 4\&.8\&.3" "User Commands"
 .\" -----------------------------------------------------------------
 .\" * Define some portability stuff
 .\" -----------------------------------------------------------------
@@ -76,7 +76,7 @@ Force overwriting of destination xattr\&
 .RE
 .SH "VERSION"
 .PP
-This man page is part of version 4\&.8\&.2 of the Samba suite\&.
+This man page is part of version 4\&.8\&.3 of the Samba suite\&.
 .SH "AUTHOR"
 .PP
 The original Samba software and related utilities were created by Andrew Tridgell\&. Samba is now developed by the Samba Team as an Open Source project similar to the way the Linux kernel is developed\&.
diff -Npur samba-4.8.2/docs/manpages/net.8 samba-4.8.3/docs/manpages/net.8
--- samba-4.8.2/docs/manpages/net.8	2018-05-16 12:15:01.000000000 +0200
+++ samba-4.8.3/docs/manpages/net.8	2018-06-26 16:49:42.000000000 +0200
@@ -2,12 +2,12 @@
 .\"     Title: net
 .\"    Author: [see the "AUTHOR" section]
 .\" Generator: DocBook XSL Stylesheets v1.79.1 <http://docbook.sf.net/>
-.\"      Date: 05/16/2018
+.\"      Date: 06/26/2018
 .\"    Manual: System Administration tools
-.\"    Source: Samba 4.8.2
+.\"    Source: Samba 4.8.3
 .\"  Language: English
 .\"
-.TH "NET" "8" "05/16/2018" "Samba 4\&.8\&.2" "System Administration tools"
+.TH "NET" "8" "06/26/2018" "Samba 4\&.8\&.3" "System Administration tools"
 .\" -----------------------------------------------------------------
 .\" * Define some portability stuff
 .\" -----------------------------------------------------------------
diff -Npur samba-4.8.2/docs/manpages/nmbd.8 samba-4.8.3/docs/manpages/nmbd.8
--- samba-4.8.2/docs/manpages/nmbd.8	2018-05-16 12:15:02.000000000 +0200
+++ samba-4.8.3/docs/manpages/nmbd.8	2018-06-26 16:49:42.000000000 +0200
@@ -2,12 +2,12 @@
 .\"     Title: nmbd
 .\"    Author: [see the "AUTHOR" section]
 .\" Generator: DocBook XSL Stylesheets v1.79.1 <http://docbook.sf.net/>
-.\"      Date: 05/16/2018
+.\"      Date: 06/26/2018
 .\"    Manual: System Administration tools
-.\"    Source: Samba 4.8.2
+.\"    Source: Samba 4.8.3
 .\"  Language: English
 .\"
-.TH "NMBD" "8" "05/16/2018" "Samba 4\&.8\&.2" "System Administration tools"
+.TH "NMBD" "8" "06/26/2018" "Samba 4\&.8\&.3" "System Administration tools"
 .\" -----------------------------------------------------------------
 .\" * Define some portability stuff
 .\" -----------------------------------------------------------------
@@ -278,7 +278,7 @@ The debug log level of nmbd may be raise
 (SIGUSR[1|2] signals are no longer used since Samba 2\&.2)\&. This is to allow transient problems to be diagnosed, whilst still running at a normally low log level\&.
 .SH "VERSION"
 .PP
-This man page is part of version 4\&.8\&.2 of the Samba suite\&.
+This man page is part of version 4\&.8\&.3 of the Samba suite\&.
 .SH "SEE ALSO"
 .PP
 \fBinetd\fR(8),
diff -Npur samba-4.8.2/docs/manpages/nmblookup.1 samba-4.8.3/docs/manpages/nmblookup.1
--- samba-4.8.2/docs/manpages/nmblookup.1	2018-05-16 12:15:02.000000000 +0200
+++ samba-4.8.3/docs/manpages/nmblookup.1	2018-06-26 16:49:42.000000000 +0200
@@ -2,12 +2,12 @@
 .\"     Title: nmblookup
 .\"    Author: [see the "AUTHOR" section]
 .\" Generator: DocBook XSL Stylesheets v1.79.1 <http://docbook.sf.net/>
-.\"      Date: 05/16/2018
+.\"      Date: 06/26/2018
 .\"    Manual: User Commands
-.\"    Source: Samba 4.8.2
+.\"    Source: Samba 4.8.3
 .\"  Language: English
 .\"
-.TH "NMBLOOKUP" "1" "05/16/2018" "Samba 4\&.8\&.2" "User Commands"
+.TH "NMBLOOKUP" "1" "06/26/2018" "Samba 4\&.8\&.3" "User Commands"
 .\" -----------------------------------------------------------------
 .\" * Define some portability stuff
 .\" -----------------------------------------------------------------
@@ -214,7 +214,7 @@ nmblookup \-U samba\&.org \-R \*(AqIRIX#
 would query the WINS server samba\&.org for the domain master browser (1B name type) for the IRIX workgroup\&.
 .SH "VERSION"
 .PP
-This man page is part of version 4\&.8\&.2 of the Samba suite\&.
+This man page is part of version 4\&.8\&.3 of the Samba suite\&.
 .SH "SEE ALSO"
 .PP
 \fBnmbd\fR(8),
diff -Npur samba-4.8.2/docs/manpages/ntlm_auth.1 samba-4.8.3/docs/manpages/ntlm_auth.1
--- samba-4.8.2/docs/manpages/ntlm_auth.1	2018-05-16 12:15:02.000000000 +0200
+++ samba-4.8.3/docs/manpages/ntlm_auth.1	2018-06-26 16:49:42.000000000 +0200
@@ -2,12 +2,12 @@
 .\"     Title: ntlm_auth
 .\"    Author: [see the "AUTHOR" section]
 .\" Generator: DocBook XSL Stylesheets v1.79.1 <http://docbook.sf.net/>
-.\"      Date: 05/16/2018
+.\"      Date: 06/26/2018
 .\"    Manual: User Commands
-.\"    Source: Samba 4.8.2
+.\"    Source: Samba 4.8.3
 .\"  Language: English
 .\"
-.TH "NTLM_AUTH" "1" "05/16/2018" "Samba 4\&.8\&.2" "User Commands"
+.TH "NTLM_AUTH" "1" "06/26/2018" "Samba 4\&.8\&.3" "User Commands"
 .\" -----------------------------------------------------------------
 .\" * Define some portability stuff
 .\" -----------------------------------------------------------------
@@ -421,7 +421,7 @@ If you\*(Aqre experiencing problems with
 the Microsoft Knowledge Base article #239869 and follow instructions described there\&.
 .SH "VERSION"
 .PP
-This man page is part of version 4\&.8\&.2 of the Samba suite\&.
+This man page is part of version 4\&.8\&.3 of the Samba suite\&.
 .SH "AUTHOR"
 .PP
 The original Samba software and related utilities were created by Andrew Tridgell\&. Samba is now developed by the Samba Team as an Open Source project similar to the way the Linux kernel is developed\&.
diff -Npur samba-4.8.2/docs/manpages/pam_winbind.8 samba-4.8.3/docs/manpages/pam_winbind.8
--- samba-4.8.2/docs/manpages/pam_winbind.8	2018-05-16 12:15:02.000000000 +0200
+++ samba-4.8.3/docs/manpages/pam_winbind.8	2018-06-26 16:49:42.000000000 +0200
@@ -2,12 +2,12 @@
 .\"     Title: pam_winbind
 .\"    Author: [see the "AUTHOR" section]
 .\" Generator: DocBook XSL Stylesheets v1.79.1 <http://docbook.sf.net/>
-.\"      Date: 05/16/2018
+.\"      Date: 06/26/2018
 .\"    Manual: 8
-.\"    Source: Samba 4.8.2
+.\"    Source: Samba 4.8.3
 .\"  Language: English
 .\"
-.TH "PAM_WINBIND" "8" "05/16/2018" "Samba 4\&.8\&.2" "8"
+.TH "PAM_WINBIND" "8" "06/26/2018" "Samba 4\&.8\&.3" "8"
 .\" -----------------------------------------------------------------
 .\" * Define some portability stuff
 .\" -----------------------------------------------------------------
@@ -172,7 +172,7 @@ This is the profile path set in the prof
 \fBsmb.conf\fR(5)
 .SH "VERSION"
 .PP
-This man page is part of version 4\&.8\&.2 of Samba\&.
+This man page is part of version 4\&.8\&.3 of Samba\&.
 .SH "AUTHOR"
 .PP
 The original Samba software and related utilities were created by Andrew Tridgell\&. Samba is now developed by the Samba Team as an Open Source project similar to the way the Linux kernel is developed\&.
diff -Npur samba-4.8.2/docs/manpages/pam_winbind.conf.5 samba-4.8.3/docs/manpages/pam_winbind.conf.5
--- samba-4.8.2/docs/manpages/pam_winbind.conf.5	2018-05-16 12:15:02.000000000 +0200
+++ samba-4.8.3/docs/manpages/pam_winbind.conf.5	2018-06-26 16:49:43.000000000 +0200
@@ -2,12 +2,12 @@
 .\"     Title: pam_winbind.conf
 .\"    Author: [see the "AUTHOR" section]
 .\" Generator: DocBook XSL Stylesheets v1.79.1 <http://docbook.sf.net/>
-.\"      Date: 05/16/2018
+.\"      Date: 06/26/2018
 .\"    Manual: 5
-.\"    Source: Samba 4.8.2
+.\"    Source: Samba 4.8.3
 .\"  Language: English
 .\"
-.TH "PAM_WINBIND\&.CONF" "5" "05/16/2018" "Samba 4\&.8\&.2" "5"
+.TH "PAM_WINBIND\&.CONF" "5" "06/26/2018" "Samba 4\&.8\&.3" "5"
 .\" -----------------------------------------------------------------
 .\" * Define some portability stuff
 .\" -----------------------------------------------------------------
@@ -137,7 +137,7 @@ Defines number of days before pam_winbin
 \fBsmb.conf\fR(5)
 .SH "VERSION"
 .PP
-This man page is part of version 4\&.8\&.2 of Samba\&.
+This man page is part of version 4\&.8\&.3 of Samba\&.
 .SH "AUTHOR"
 .PP
 The original Samba software and related utilities were created by Andrew Tridgell\&. Samba is now developed by the Samba Team as an Open Source project similar to the way the Linux kernel is developed\&.
diff -Npur samba-4.8.2/docs/manpages/pdbedit.8 samba-4.8.3/docs/manpages/pdbedit.8
--- samba-4.8.2/docs/manpages/pdbedit.8	2018-05-16 12:15:03.000000000 +0200
+++ samba-4.8.3/docs/manpages/pdbedit.8	2018-06-26 16:49:43.000000000 +0200
@@ -2,12 +2,12 @@
 .\"     Title: pdbedit
 .\"    Author: [see the "AUTHOR" section]
 .\" Generator: DocBook XSL Stylesheets v1.79.1 <http://docbook.sf.net/>
-.\"      Date: 05/16/2018
+.\"      Date: 06/26/2018
 .\"    Manual: System Administration tools
-.\"    Source: Samba 4.8.2
+.\"    Source: Samba 4.8.3
 .\"  Language: English
 .\"
-.TH "PDBEDIT" "8" "05/16/2018" "Samba 4\&.8\&.2" "System Administration tools"
+.TH "PDBEDIT" "8" "06/26/2018" "Samba 4\&.8\&.3" "System Administration tools"
 .\" -----------------------------------------------------------------
 .\" * Define some portability stuff
 .\" -----------------------------------------------------------------
@@ -619,7 +619,7 @@ option "<name>" to value "<value>" from
 This command may be used only by root\&.
 .SH "VERSION"
 .PP
-This man page is part of version 4\&.8\&.2 of the Samba suite\&.
+This man page is part of version 4\&.8\&.3 of the Samba suite\&.
 .SH "SEE ALSO"
 .PP
 \fBsmbpasswd\fR(5),
diff -Npur samba-4.8.2/docs/manpages/profiles.1 samba-4.8.3/docs/manpages/profiles.1
--- samba-4.8.2/docs/manpages/profiles.1	2018-05-16 12:15:03.000000000 +0200
+++ samba-4.8.3/docs/manpages/profiles.1	2018-06-26 16:49:43.000000000 +0200
@@ -2,12 +2,12 @@
 .\"     Title: profiles
 .\"    Author: [see the "AUTHOR" section]
 .\" Generator: DocBook XSL Stylesheets v1.79.1 <http://docbook.sf.net/>
-.\"      Date: 05/16/2018
+.\"      Date: 06/26/2018
 .\"    Manual: User Commands
-.\"    Source: Samba 4.8.2
+.\"    Source: Samba 4.8.3
 .\"  Language: English
 .\"
-.TH "PROFILES" "1" "05/16/2018" "Samba 4\&.8\&.2" "User Commands"
+.TH "PROFILES" "1" "06/26/2018" "Samba 4\&.8\&.3" "User Commands"
 .\" -----------------------------------------------------------------
 .\" * Define some portability stuff
 .\" -----------------------------------------------------------------
@@ -112,7 +112,7 @@ Display brief usage message\&.
 .RE
 .SH "VERSION"
 .PP
-This man page is part of version 4\&.8\&.2 of the Samba suite\&.
+This man page is part of version 4\&.8\&.3 of the Samba suite\&.
 .SH "AUTHOR"
 .PP
 The original Samba software and related utilities were created by Andrew Tridgell\&. Samba is now developed by the Samba Team as an Open Source project similar to the way the Linux kernel is developed\&.
diff -Npur samba-4.8.2/docs/manpages/rpcclient.1 samba-4.8.3/docs/manpages/rpcclient.1
--- samba-4.8.2/docs/manpages/rpcclient.1	2018-05-16 12:15:03.000000000 +0200
+++ samba-4.8.3/docs/manpages/rpcclient.1	2018-06-26 16:49:43.000000000 +0200
@@ -2,12 +2,12 @@
 .\"     Title: rpcclient
 .\"    Author: [see the "AUTHOR" section]
 .\" Generator: DocBook XSL Stylesheets v1.79.1 <http://docbook.sf.net/>
-.\"      Date: 05/16/2018
+.\"      Date: 06/26/2018
 .\"    Manual: User Commands
-.\"    Source: Samba 4.8.2
+.\"    Source: Samba 4.8.3
 .\"  Language: English
 .\"
-.TH "RPCCLIENT" "1" "05/16/2018" "Samba 4\&.8\&.2" "User Commands"
+.TH "RPCCLIENT" "1" "06/26/2018" "Samba 4\&.8\&.3" "User Commands"
 .\" -----------------------------------------------------------------
 .\" * Define some portability stuff
 .\" -----------------------------------------------------------------
@@ -803,7 +803,7 @@ and
 that are incompatible for some commands or services\&. Additionally, the developers are sending reports to Microsoft, and problems found or reported to Microsoft are fixed in Service Packs, which may result in incompatibilities\&.
 .SH "VERSION"
 .PP
-This man page is part of version 4\&.8\&.2 of the Samba suite\&.
+This man page is part of version 4\&.8\&.3 of the Samba suite\&.
 .SH "AUTHOR"
 .PP
 The original Samba software and related utilities were created by Andrew Tridgell\&. Samba is now developed by the Samba Team as an Open Source project similar to the way the Linux kernel is developed\&.
diff -Npur samba-4.8.2/docs/manpages/samba-regedit.8 samba-4.8.3/docs/manpages/samba-regedit.8
--- samba-4.8.2/docs/manpages/samba-regedit.8	2018-05-16 12:15:04.000000000 +0200
+++ samba-4.8.3/docs/manpages/samba-regedit.8	2018-06-26 16:49:44.000000000 +0200
@@ -2,12 +2,12 @@
 .\"     Title: samba-regedit
 .\"    Author: [see the "AUTHOR" section]
 .\" Generator: DocBook XSL Stylesheets v1.79.1 <http://docbook.sf.net/>
-.\"      Date: 05/16/2018
+.\"      Date: 06/26/2018
 .\"    Manual: System Administration tools
-.\"    Source: Samba 4.8.2
+.\"    Source: Samba 4.8.3
 .\"  Language: English
 .\"
-.TH "SAMBA\-REGEDIT" "8" "05/16/2018" "Samba 4\&.8\&.2" "System Administration tools"
+.TH "SAMBA\-REGEDIT" "8" "06/26/2018" "Samba 4\&.8\&.3" "System Administration tools"
 .\" -----------------------------------------------------------------
 .\" * Define some portability stuff
 .\" -----------------------------------------------------------------
@@ -207,7 +207,7 @@ The supplied password is the NT hash\&.
 .RE
 .SH "VERSION"
 .PP
-This man page is part of version 4\&.8\&.2 of the Samba suite\&.
+This man page is part of version 4\&.8\&.3 of the Samba suite\&.
 .SH "SEE ALSO"
 .PP
 \fBsmbd\fR(8),
diff -Npur samba-4.8.2/docs/manpages/samba-tool.8 samba-4.8.3/docs/manpages/samba-tool.8
--- samba-4.8.2/docs/manpages/samba-tool.8	2018-05-16 12:15:04.000000000 +0200
+++ samba-4.8.3/docs/manpages/samba-tool.8	2018-06-26 16:49:44.000000000 +0200
@@ -2,12 +2,12 @@
 .\"     Title: samba-tool
 .\"    Author: [see the "AUTHOR" section]
 .\" Generator: DocBook XSL Stylesheets v1.79.1 <http://docbook.sf.net/>
-.\"      Date: 05/16/2018
+.\"      Date: 06/26/2018
 .\"    Manual: System Administration tools
-.\"    Source: Samba 4.8.2
+.\"    Source: Samba 4.8.3
 .\"  Language: English
 .\"
-.TH "SAMBA\-TOOL" "8" "05/16/2018" "Samba 4\&.8\&.2" "System Administration tools"
+.TH "SAMBA\-TOOL" "8" "06/26/2018" "Samba 4\&.8\&.3" "System Administration tools"
 .\" -----------------------------------------------------------------
 .\" * Define some portability stuff
 .\" -----------------------------------------------------------------
@@ -470,7 +470,7 @@ because the repsFrom/To objects are not
 Gives usage information\&.
 .SH "VERSION"
 .PP
-This man page is complete for version 4\&.8\&.2 of the Samba suite\&.
+This man page is complete for version 4\&.8\&.3 of the Samba suite\&.
 .SH "AUTHOR"
 .PP
 The original Samba software and related utilities were created by Andrew Tridgell\&. Samba is now developed by the Samba Team as an Open Source project similar to the way the Linux kernel is developed\&.
diff -Npur samba-4.8.2/docs/manpages/samba.7 samba-4.8.3/docs/manpages/samba.7
--- samba-4.8.2/docs/manpages/samba.7	2018-05-16 12:15:04.000000000 +0200
+++ samba-4.8.3/docs/manpages/samba.7	2018-06-26 16:49:44.000000000 +0200
@@ -2,12 +2,12 @@
 .\"     Title: samba
 .\"    Author: [see the "AUTHOR" section]
 .\" Generator: DocBook XSL Stylesheets v1.79.1 <http://docbook.sf.net/>
-.\"      Date: 05/16/2018
+.\"      Date: 06/26/2018
 .\"    Manual: Miscellanea
-.\"    Source: Samba 4.8.2
+.\"    Source: Samba 4.8.3
 .\"  Language: English
 .\"
-.TH "SAMBA" "7" "05/16/2018" "Samba 4\&.8\&.2" "Miscellanea"
+.TH "SAMBA" "7" "06/26/2018" "Samba 4\&.8\&.3" "Miscellanea"
 .\" -----------------------------------------------------------------
 .\" * Define some portability stuff
 .\" -----------------------------------------------------------------
@@ -237,7 +237,7 @@ https://lists\&.samba\&.org
 you can find a lot of information in the archives and you can subscribe to the samba list and ask for help or discuss things\&.
 .SH "VERSION"
 .PP
-This man page is part of version 4\&.8\&.2 of the Samba suite\&.
+This man page is part of version 4\&.8\&.3 of the Samba suite\&.
 .SH "CONTRIBUTIONS"
 .PP
 If you wish to contribute to the Samba project, then I suggest you join the Samba mailing list at
diff -Npur samba-4.8.2/docs/manpages/samba.8 samba-4.8.3/docs/manpages/samba.8
--- samba-4.8.2/docs/manpages/samba.8	2018-05-16 12:15:04.000000000 +0200
+++ samba-4.8.3/docs/manpages/samba.8	2018-06-26 16:49:44.000000000 +0200
@@ -2,12 +2,12 @@
 .\"     Title: samba
 .\"    Author: [see the "AUTHOR" section]
 .\" Generator: DocBook XSL Stylesheets v1.79.1 <http://docbook.sf.net/>
-.\"      Date: 05/16/2018
+.\"      Date: 06/26/2018
 .\"    Manual: System Administration tools
-.\"    Source: Samba 4.8.2
+.\"    Source: Samba 4.8.3
 .\"  Language: English
 .\"
-.TH "SAMBA" "8" "05/16/2018" "Samba 4\&.8\&.2" "System Administration tools"
+.TH "SAMBA" "8" "06/26/2018" "Samba 4\&.8\&.3" "System Administration tools"
 .\" -----------------------------------------------------------------
 .\" * Define some portability stuff
 .\" -----------------------------------------------------------------
@@ -198,7 +198,7 @@ The number and nature of diagnostics ava
 Most messages are reasonably self\-explanatory\&. Unfortunately, at the time this man page was created, there are too many diagnostics available in the source code to warrant describing each and every diagnostic\&. At this stage your best bet is still to grep the source code and inspect the conditions that gave rise to the diagnostics you are seeing\&.
 .SH "VERSION"
 .PP
-This man page is part of version 4\&.8\&.2 of the Samba suite\&.
+This man page is part of version 4\&.8\&.3 of the Samba suite\&.
 .SH "SEE ALSO"
 .PP
 \fBhosts_access\fR(5)
diff -Npur samba-4.8.2/docs/manpages/sharesec.1 samba-4.8.3/docs/manpages/sharesec.1
--- samba-4.8.2/docs/manpages/sharesec.1	2018-05-16 12:15:04.000000000 +0200
+++ samba-4.8.3/docs/manpages/sharesec.1	2018-06-26 16:49:44.000000000 +0200
@@ -2,12 +2,12 @@
 .\"     Title: sharesec
 .\"    Author: [see the "AUTHOR" section]
 .\" Generator: DocBook XSL Stylesheets v1.79.1 <http://docbook.sf.net/>
-.\"      Date: 05/16/2018
+.\"      Date: 06/26/2018
 .\"    Manual: User Commands
-.\"    Source: Samba 4.8.2
+.\"    Source: Samba 4.8.3
 .\"  Language: English
 .\"
-.TH "SHARESEC" "1" "05/16/2018" "Samba 4\&.8\&.2" "User Commands"
+.TH "SHARESEC" "1" "06/26/2018" "Samba 4\&.8\&.3" "User Commands"
 .\" -----------------------------------------------------------------
 .\" * Define some portability stuff
 .\" -----------------------------------------------------------------
@@ -337,7 +337,7 @@ List all ACEs for
 .\}
 .SH "VERSION"
 .PP
-This man page is part of version 4\&.8\&.2 of the Samba suite\&.
+This man page is part of version 4\&.8\&.3 of the Samba suite\&.
 .SH "AUTHOR"
 .PP
 The original Samba software and related utilities were created by Andrew Tridgell\&. Samba is now developed by the Samba Team as an Open Source project similar to the way the Linux kernel is developed\&.
diff -Npur samba-4.8.2/docs/manpages/smb.conf.5 samba-4.8.3/docs/manpages/smb.conf.5
--- samba-4.8.2/docs/manpages/smb.conf.5	2018-05-16 12:15:06.000000000 +0200
+++ samba-4.8.3/docs/manpages/smb.conf.5	2018-06-26 16:49:46.000000000 +0200
@@ -2,12 +2,12 @@
 .\"     Title: smb.conf
 .\"    Author: [see the "AUTHOR" section]
 .\" Generator: DocBook XSL Stylesheets v1.79.1 <http://docbook.sf.net/>
-.\"      Date: 05/16/2018
+.\"      Date: 06/26/2018
 .\"    Manual: File Formats and Conventions
-.\"    Source: Samba 4.8.2
+.\"    Source: Samba 4.8.3
 .\"  Language: English
 .\"
-.TH "SMB\&.CONF" "5" "05/16/2018" "Samba 4\&.8\&.2" "File Formats and Conventions"
+.TH "SMB\&.CONF" "5" "06/26/2018" "Samba 4\&.8\&.3" "File Formats and Conventions"
 .\" -----------------------------------------------------------------
 .\" * Define some portability stuff
 .\" -----------------------------------------------------------------
@@ -12953,7 +12953,7 @@ and
 special sections make life for an administrator easy, but the various combinations of default attributes can be tricky\&. Take extreme care when designing these sections\&. In particular, ensure that the permissions on spool directories are correct\&.
 .SH "VERSION"
 .PP
-This man page is part of version 4\&.8\&.2 of the Samba suite\&.
+This man page is part of version 4\&.8\&.3 of the Samba suite\&.
 .SH "SEE ALSO"
 .PP
 \fBsamba\fR(7),
diff -Npur samba-4.8.2/docs/manpages/smbcacls.1 samba-4.8.3/docs/manpages/smbcacls.1
--- samba-4.8.2/docs/manpages/smbcacls.1	2018-05-16 12:15:06.000000000 +0200
+++ samba-4.8.3/docs/manpages/smbcacls.1	2018-06-26 16:49:46.000000000 +0200
@@ -2,12 +2,12 @@
 .\"     Title: smbcacls
 .\"    Author: [see the "AUTHOR" section]
 .\" Generator: DocBook XSL Stylesheets v1.79.1 <http://docbook.sf.net/>
-.\"      Date: 05/16/2018
+.\"      Date: 06/26/2018
 .\"    Manual: User Commands
-.\"    Source: Samba 4.8.2
+.\"    Source: Samba 4.8.3
 .\"  Language: English
 .\"
-.TH "SMBCACLS" "1" "05/16/2018" "Samba 4\&.8\&.2" "User Commands"
+.TH "SMBCACLS" "1" "06/26/2018" "Samba 4\&.8\&.3" "User Commands"
 .\" -----------------------------------------------------------------
 .\" * Define some portability stuff
 .\" -----------------------------------------------------------------
@@ -491,7 +491,7 @@ smbcacls
 couldn\*(Aqt connect to the specified server, or there was an error getting or setting the ACLs, an exit status of 1 is returned\&. If there was an error parsing any command line arguments, an exit status of 2 is returned\&.
 .SH "VERSION"
 .PP
-This man page is part of version 4\&.8\&.2 of the Samba suite\&.
+This man page is part of version 4\&.8\&.3 of the Samba suite\&.
 .SH "AUTHOR"
 .PP
 The original Samba software and related utilities were created by Andrew Tridgell\&. Samba is now developed by the Samba Team as an Open Source project similar to the way the Linux kernel is developed\&.
diff -Npur samba-4.8.2/docs/manpages/smbclient.1 samba-4.8.3/docs/manpages/smbclient.1
--- samba-4.8.2/docs/manpages/smbclient.1	2018-05-16 12:15:07.000000000 +0200
+++ samba-4.8.3/docs/manpages/smbclient.1	2018-06-26 16:49:46.000000000 +0200
@@ -2,12 +2,12 @@
 .\"     Title: smbclient
 .\"    Author: [see the "AUTHOR" section]
 .\" Generator: DocBook XSL Stylesheets v1.79.1 <http://docbook.sf.net/>
-.\"      Date: 05/16/2018
+.\"      Date: 06/26/2018
 .\"    Manual: User Commands
-.\"    Source: Samba 4.8.2
+.\"    Source: Samba 4.8.3
 .\"  Language: English
 .\"
-.TH "SMBCLIENT" "1" "05/16/2018" "Samba 4\&.8\&.2" "User Commands"
+.TH "SMBCLIENT" "1" "06/26/2018" "Samba 4\&.8\&.3" "User Commands"
 .\" -----------------------------------------------------------------
 .\" * Define some portability stuff
 .\" -----------------------------------------------------------------
@@ -1151,7 +1151,7 @@ Most diagnostics issued by the client ar
 The number and nature of diagnostics available depends on the debug level used by the client\&. If you have problems, set the debug level to 3 and peruse the log files\&.
 .SH "VERSION"
 .PP
-This man page is part of version 4\&.8\&.2 of the Samba suite\&.
+This man page is part of version 4\&.8\&.3 of the Samba suite\&.
 .SH "AUTHOR"
 .PP
 The original Samba software and related utilities were created by Andrew Tridgell\&. Samba is now developed by the Samba Team as an Open Source project similar to the way the Linux kernel is developed\&.
diff -Npur samba-4.8.2/docs/manpages/smbcontrol.1 samba-4.8.3/docs/manpages/smbcontrol.1
--- samba-4.8.2/docs/manpages/smbcontrol.1	2018-05-16 12:15:07.000000000 +0200
+++ samba-4.8.3/docs/manpages/smbcontrol.1	2018-06-26 16:49:47.000000000 +0200
@@ -2,12 +2,12 @@
 .\"     Title: smbcontrol
 .\"    Author: [see the "AUTHOR" section]
 .\" Generator: DocBook XSL Stylesheets v1.79.1 <http://docbook.sf.net/>
-.\"      Date: 05/16/2018
+.\"      Date: 06/26/2018
 .\"    Manual: User Commands
-.\"    Source: Samba 4.8.2
+.\"    Source: Samba 4.8.3
 .\"  Language: English
 .\"
-.TH "SMBCONTROL" "1" "05/16/2018" "Samba 4\&.8\&.2" "User Commands"
+.TH "SMBCONTROL" "1" "06/26/2018" "Samba 4\&.8\&.3" "User Commands"
 .\" -----------------------------------------------------------------
 .\" * Define some portability stuff
 .\" -----------------------------------------------------------------
@@ -309,7 +309,7 @@ Query the number of smbd child processes
 .RE
 .SH "VERSION"
 .PP
-This man page is part of version 4\&.8\&.2 of the Samba suite\&.
+This man page is part of version 4\&.8\&.3 of the Samba suite\&.
 .SH "SEE ALSO"
 .PP
 \fBnmbd\fR(8)
diff -Npur samba-4.8.2/docs/manpages/smbcquotas.1 samba-4.8.3/docs/manpages/smbcquotas.1
--- samba-4.8.2/docs/manpages/smbcquotas.1	2018-05-16 12:15:07.000000000 +0200
+++ samba-4.8.3/docs/manpages/smbcquotas.1	2018-06-26 16:49:47.000000000 +0200
@@ -2,12 +2,12 @@
 .\"     Title: smbcquotas
 .\"    Author: [see the "AUTHOR" section]
 .\" Generator: DocBook XSL Stylesheets v1.79.1 <http://docbook.sf.net/>
-.\"      Date: 05/16/2018
+.\"      Date: 06/26/2018
 .\"    Manual: User Commands
-.\"    Source: Samba 4.8.2
+.\"    Source: Samba 4.8.3
 .\"  Language: English
 .\"
-.TH "SMBCQUOTAS" "1" "05/16/2018" "Samba 4\&.8\&.2" "User Commands"
+.TH "SMBCQUOTAS" "1" "06/26/2018" "Samba 4\&.8\&.3" "User Commands"
 .\" -----------------------------------------------------------------
 .\" * Define some portability stuff
 .\" -----------------------------------------------------------------
@@ -247,7 +247,7 @@ smbcquotas
 couldn\*(Aqt connect to the specified server, or when there was an error getting or setting the quota(s), an exit status of 1 is returned\&. If there was an error parsing any command line arguments, an exit status of 2 is returned\&.
 .SH "VERSION"
 .PP
-This man page is part of version 4\&.8\&.2 of the Samba suite\&.
+This man page is part of version 4\&.8\&.3 of the Samba suite\&.
 .SH "AUTHOR"
 .PP
 The original Samba software and related utilities were created by Andrew Tridgell\&. Samba is now developed by the Samba Team as an Open Source project similar to the way the Linux kernel is developed\&.
diff -Npur samba-4.8.2/docs/manpages/smbd.8 samba-4.8.3/docs/manpages/smbd.8
--- samba-4.8.2/docs/manpages/smbd.8	2018-05-16 12:15:07.000000000 +0200
+++ samba-4.8.3/docs/manpages/smbd.8	2018-06-26 16:49:47.000000000 +0200
@@ -2,12 +2,12 @@
 .\"     Title: smbd
 .\"    Author: [see the "AUTHOR" section]
 .\" Generator: DocBook XSL Stylesheets v1.79.1 <http://docbook.sf.net/>
-.\"      Date: 05/16/2018
+.\"      Date: 06/26/2018
 .\"    Manual: System Administration tools
-.\"    Source: Samba 4.8.2
+.\"    Source: Samba 4.8.3
 .\"  Language: English
 .\"
-.TH "SMBD" "8" "05/16/2018" "Samba 4\&.8\&.2" "System Administration tools"
+.TH "SMBD" "8" "06/26/2018" "Samba 4\&.8\&.3" "System Administration tools"
 .\" -----------------------------------------------------------------
 .\" * Define some portability stuff
 .\" -----------------------------------------------------------------
@@ -252,7 +252,7 @@ parameter\&. When this is set, the follo
 .RE
 .SH "VERSION"
 .PP
-This man page is part of version 4\&.8\&.2 of the Samba suite\&.
+This man page is part of version 4\&.8\&.3 of the Samba suite\&.
 .SH "DIAGNOSTICS"
 .PP
 Most diagnostics issued by the server are logged in a specified log file\&. The log file name is specified at compile time, but may be overridden on the command line\&.
diff -Npur samba-4.8.2/docs/manpages/smbget.1 samba-4.8.3/docs/manpages/smbget.1
--- samba-4.8.2/docs/manpages/smbget.1	2018-05-16 12:15:08.000000000 +0200
+++ samba-4.8.3/docs/manpages/smbget.1	2018-06-26 16:49:47.000000000 +0200
@@ -2,12 +2,12 @@
 .\"     Title: smbget
 .\"    Author: [see the "AUTHOR" section]
 .\" Generator: DocBook XSL Stylesheets v1.79.1 <http://docbook.sf.net/>
-.\"      Date: 05/16/2018
+.\"      Date: 06/26/2018
 .\"    Manual: User Commands
-.\"    Source: Samba 4.8.2
+.\"    Source: Samba 4.8.3
 .\"  Language: English
 .\"
-.TH "SMBGET" "1" "05/16/2018" "Samba 4\&.8\&.2" "User Commands"
+.TH "SMBGET" "1" "06/26/2018" "Samba 4\&.8\&.3" "User Commands"
 .\" -----------------------------------------------------------------
 .\" * Define some portability stuff
 .\" -----------------------------------------------------------------
@@ -189,7 +189,7 @@ smbget \-Rr smb://rhonwyn/
 Permission denied is returned in some cases where the cause of the error is unknown (such as an illegally formatted smb:// url or trying to get a directory without \-R turned on)\&.
 .SH "VERSION"
 .PP
-This man page is part of version 4\&.8\&.2 of the Samba suite\&.
+This man page is part of version 4\&.8\&.3 of the Samba suite\&.
 .SH "AUTHOR"
 .PP
 The original Samba software and related utilities were created by Andrew Tridgell\&. Samba is now developed by the Samba Team as an Open Source project similar to the way the Linux kernel is developed\&.
diff -Npur samba-4.8.2/docs/manpages/smbgetrc.5 samba-4.8.3/docs/manpages/smbgetrc.5
--- samba-4.8.2/docs/manpages/smbgetrc.5	2018-05-16 12:15:08.000000000 +0200
+++ samba-4.8.3/docs/manpages/smbgetrc.5	2018-06-26 16:49:48.000000000 +0200
@@ -2,12 +2,12 @@
 .\"     Title: smbgetrc
 .\"    Author: [see the "AUTHOR" section]
 .\" Generator: DocBook XSL Stylesheets v1.79.1 <http://docbook.sf.net/>
-.\"      Date: 05/16/2018
+.\"      Date: 06/26/2018
 .\"    Manual: File Formats and Conventions
-.\"    Source: Samba 4.8.2
+.\"    Source: Samba 4.8.3
 .\"  Language: English
 .\"
-.TH "SMBGETRC" "5" "05/16/2018" "Samba 4\&.8\&.2" "File Formats and Conventions"
+.TH "SMBGETRC" "5" "06/26/2018" "Samba 4\&.8\&.3" "File Formats and Conventions"
 .\" -----------------------------------------------------------------
 .\" * Define some portability stuff
 .\" -----------------------------------------------------------------
@@ -87,7 +87,7 @@ Number of bytes to put in a block\&.
 .RE
 .SH "VERSION"
 .PP
-This man page is part of version 4\&.8\&.2 of the Samba suite\&.
+This man page is part of version 4\&.8\&.3 of the Samba suite\&.
 .SH "SEE ALSO"
 .PP
 \fBsmbget\fR(1)
diff -Npur samba-4.8.2/docs/manpages/smbpasswd.5 samba-4.8.3/docs/manpages/smbpasswd.5
--- samba-4.8.2/docs/manpages/smbpasswd.5	2018-05-16 12:15:08.000000000 +0200
+++ samba-4.8.3/docs/manpages/smbpasswd.5	2018-06-26 16:49:48.000000000 +0200
@@ -2,12 +2,12 @@
 .\"     Title: smbpasswd
 .\"    Author: [see the "AUTHOR" section]
 .\" Generator: DocBook XSL Stylesheets v1.79.1 <http://docbook.sf.net/>
-.\"      Date: 05/16/2018
+.\"      Date: 06/26/2018
 .\"    Manual: File Formats and Conventions
-.\"    Source: Samba 4.8.2
+.\"    Source: Samba 4.8.3
 .\"  Language: English
 .\"
-.TH "SMBPASSWD" "5" "05/16/2018" "Samba 4\&.8\&.2" "File Formats and Conventions"
+.TH "SMBPASSWD" "5" "06/26/2018" "Samba 4\&.8\&.3" "File Formats and Conventions"
 .\" -----------------------------------------------------------------
 .\" * Define some portability stuff
 .\" -----------------------------------------------------------------
@@ -165,7 +165,7 @@ This field consists of the time the acco
 All other colon separated fields are ignored at this time\&.
 .SH "VERSION"
 .PP
-This man page is part of version 4\&.8\&.2 of the Samba suite\&.
+This man page is part of version 4\&.8\&.3 of the Samba suite\&.
 .SH "SEE ALSO"
 .PP
 \fBsmbpasswd\fR(8),
diff -Npur samba-4.8.2/docs/manpages/smbpasswd.8 samba-4.8.3/docs/manpages/smbpasswd.8
--- samba-4.8.2/docs/manpages/smbpasswd.8	2018-05-16 12:15:08.000000000 +0200
+++ samba-4.8.3/docs/manpages/smbpasswd.8	2018-06-26 16:49:48.000000000 +0200
@@ -2,12 +2,12 @@
 .\"     Title: smbpasswd
 .\"    Author: [see the "AUTHOR" section]
 .\" Generator: DocBook XSL Stylesheets v1.79.1 <http://docbook.sf.net/>
-.\"      Date: 05/16/2018
+.\"      Date: 06/26/2018
 .\"    Manual: System Administration tools
-.\"    Source: Samba 4.8.2
+.\"    Source: Samba 4.8.3
 .\"  Language: English
 .\"
-.TH "SMBPASSWD" "8" "05/16/2018" "Samba 4\&.8\&.2" "System Administration tools"
+.TH "SMBPASSWD" "8" "06/26/2018" "Samba 4\&.8\&.3" "System Administration tools"
 .\" -----------------------------------------------------------------
 .\" * Define some portability stuff
 .\" -----------------------------------------------------------------
@@ -316,7 +316,7 @@ file and neglecting to allow "localhost"
 In addition, the smbpasswd command is only useful if Samba has been set up to use encrypted passwords\&.
 .SH "VERSION"
 .PP
-This man page is part of version 4\&.8\&.2 of the Samba suite\&.
+This man page is part of version 4\&.8\&.3 of the Samba suite\&.
 .SH "SEE ALSO"
 .PP
 \fBsmbpasswd\fR(5),
diff -Npur samba-4.8.2/docs/manpages/smbspool.8 samba-4.8.3/docs/manpages/smbspool.8
--- samba-4.8.2/docs/manpages/smbspool.8	2018-05-16 12:15:08.000000000 +0200
+++ samba-4.8.3/docs/manpages/smbspool.8	2018-06-26 16:49:48.000000000 +0200
@@ -2,12 +2,12 @@
 .\"     Title: smbspool
 .\"    Author: [see the "AUTHOR" section]
 .\" Generator: DocBook XSL Stylesheets v1.79.1 <http://docbook.sf.net/>
-.\"      Date: 05/16/2018
+.\"      Date: 06/26/2018
 .\"    Manual: System Administration tools
-.\"    Source: Samba 4.8.2
+.\"    Source: Samba 4.8.3
 .\"  Language: English
 .\"
-.TH "SMBSPOOL" "8" "05/16/2018" "Samba 4\&.8\&.2" "System Administration tools"
+.TH "SMBSPOOL" "8" "06/26/2018" "Samba 4\&.8\&.3" "System Administration tools"
 .\" -----------------------------------------------------------------
 .\" * Define some portability stuff
 .\" -----------------------------------------------------------------
@@ -173,7 +173,7 @@ The filename argument (argv[6]) contains
 .RE
 .SH "VERSION"
 .PP
-This man page is part of version 4\&.8\&.2 of the Samba suite\&.
+This man page is part of version 4\&.8\&.3 of the Samba suite\&.
 .SH "SEE ALSO"
 .PP
 \fBsmbd\fR(8)
diff -Npur samba-4.8.2/docs/manpages/smbspool_krb5_wrapper.8 samba-4.8.3/docs/manpages/smbspool_krb5_wrapper.8
--- samba-4.8.2/docs/manpages/smbspool_krb5_wrapper.8	2018-05-16 12:15:09.000000000 +0200
+++ samba-4.8.3/docs/manpages/smbspool_krb5_wrapper.8	2018-06-26 16:49:48.000000000 +0200
@@ -2,12 +2,12 @@
 .\"     Title: smbspool_krb5_wrapper
 .\"    Author: [see the "AUTHOR" section]
 .\" Generator: DocBook XSL Stylesheets v1.79.1 <http://docbook.sf.net/>
-.\"      Date: 05/16/2018
+.\"      Date: 06/26/2018
 .\"    Manual: System Administration tools
-.\"    Source: Samba 4.8.2
+.\"    Source: Samba 4.8.3
 .\"  Language: English
 .\"
-.TH "SMBSPOOL_KRB5_WRAPPE" "8" "05/16/2018" "Samba 4\&.8\&.2" "System Administration tools"
+.TH "SMBSPOOL_KRB5_WRAPPE" "8" "06/26/2018" "Samba 4\&.8\&.3" "System Administration tools"
 .\" -----------------------------------------------------------------
 .\" * Define some portability stuff
 .\" -----------------------------------------------------------------
diff -Npur samba-4.8.2/docs/manpages/smbstatus.1 samba-4.8.3/docs/manpages/smbstatus.1
--- samba-4.8.2/docs/manpages/smbstatus.1	2018-05-16 12:15:09.000000000 +0200
+++ samba-4.8.3/docs/manpages/smbstatus.1	2018-06-26 16:49:49.000000000 +0200
@@ -2,12 +2,12 @@
 .\"     Title: smbstatus
 .\"    Author: [see the "AUTHOR" section]
 .\" Generator: DocBook XSL Stylesheets v1.79.1 <http://docbook.sf.net/>
-.\"      Date: 05/16/2018
+.\"      Date: 06/26/2018
 .\"    Manual: User Commands
-.\"    Source: Samba 4.8.2
+.\"    Source: Samba 4.8.3
 .\"  Language: English
 .\"
-.TH "SMBSTATUS" "1" "05/16/2018" "Samba 4\&.8\&.2" "User Commands"
+.TH "SMBSTATUS" "1" "06/26/2018" "Samba 4\&.8\&.3" "User Commands"
 .\" -----------------------------------------------------------------
 .\" * Define some portability stuff
 .\" -----------------------------------------------------------------
@@ -154,7 +154,7 @@ causes smbstatus to display numeric UIDs
 .RE
 .SH "VERSION"
 .PP
-This man page is part of version 4\&.8\&.2 of the Samba suite\&.
+This man page is part of version 4\&.8\&.3 of the Samba suite\&.
 .SH "SEE ALSO"
 .PP
 \fBsmbd\fR(8)
diff -Npur samba-4.8.2/docs/manpages/smbtar.1 samba-4.8.3/docs/manpages/smbtar.1
--- samba-4.8.2/docs/manpages/smbtar.1	2018-05-16 12:15:09.000000000 +0200
+++ samba-4.8.3/docs/manpages/smbtar.1	2018-06-26 16:49:49.000000000 +0200
@@ -2,12 +2,12 @@
 .\"     Title: smbtar
 .\"    Author: [see the "AUTHOR" section]
 .\" Generator: DocBook XSL Stylesheets v1.79.1 <http://docbook.sf.net/>
-.\"      Date: 05/16/2018
+.\"      Date: 06/26/2018
 .\"    Manual: User Commands
-.\"    Source: Samba 4.8.2
+.\"    Source: Samba 4.8.3
 .\"  Language: English
 .\"
-.TH "SMBTAR" "1" "05/16/2018" "Samba 4\&.8\&.2" "User Commands"
+.TH "SMBTAR" "1" "06/26/2018" "Samba 4\&.8\&.3" "User Commands"
 .\" -----------------------------------------------------------------
 .\" * Define some portability stuff
 .\" -----------------------------------------------------------------
@@ -145,7 +145,7 @@ section for the
 command\&.
 .SH "VERSION"
 .PP
-This man page is part of version 4\&.8\&.2 of the Samba suite\&.
+This man page is part of version 4\&.8\&.3 of the Samba suite\&.
 .SH "SEE ALSO"
 .PP
 \fBsmbd\fR(8),
diff -Npur samba-4.8.2/docs/manpages/smbtree.1 samba-4.8.3/docs/manpages/smbtree.1
--- samba-4.8.2/docs/manpages/smbtree.1	2018-05-16 12:15:09.000000000 +0200
+++ samba-4.8.3/docs/manpages/smbtree.1	2018-06-26 16:49:49.000000000 +0200
@@ -2,12 +2,12 @@
 .\"     Title: smbtree
 .\"    Author: [see the "AUTHOR" section]
 .\" Generator: DocBook XSL Stylesheets v1.79.1 <http://docbook.sf.net/>
-.\"      Date: 05/16/2018
+.\"      Date: 06/26/2018
 .\"    Manual: User Commands
-.\"    Source: Samba 4.8.2
+.\"    Source: Samba 4.8.3
 .\"  Language: English
 .\"
-.TH "SMBTREE" "1" "05/16/2018" "Samba 4\&.8\&.2" "User Commands"
+.TH "SMBTREE" "1" "06/26/2018" "Samba 4\&.8\&.3" "User Commands"
 .\" -----------------------------------------------------------------
 .\" * Define some portability stuff
 .\" -----------------------------------------------------------------
@@ -191,7 +191,7 @@ Display brief usage message\&.
 .RE
 .SH "VERSION"
 .PP
-This man page is part of version 4\&.8\&.2 of the Samba suite\&.
+This man page is part of version 4\&.8\&.3 of the Samba suite\&.
 .SH "AUTHOR"
 .PP
 The original Samba software and related utilities were created by Andrew Tridgell\&. Samba is now developed by the Samba Team as an Open Source project similar to the way the Linux kernel is developed\&.
diff -Npur samba-4.8.2/docs/manpages/testparm.1 samba-4.8.3/docs/manpages/testparm.1
--- samba-4.8.2/docs/manpages/testparm.1	2018-05-16 12:15:10.000000000 +0200
+++ samba-4.8.3/docs/manpages/testparm.1	2018-06-26 16:49:49.000000000 +0200
@@ -2,12 +2,12 @@
 .\"     Title: testparm
 .\"    Author: [see the "AUTHOR" section]
 .\" Generator: DocBook XSL Stylesheets v1.79.1 <http://docbook.sf.net/>
-.\"      Date: 05/16/2018
+.\"      Date: 06/26/2018
 .\"    Manual: User Commands
-.\"    Source: Samba 4.8.2
+.\"    Source: Samba 4.8.3
 .\"  Language: English
 .\"
-.TH "TESTPARM" "1" "05/16/2018" "Samba 4\&.8\&.2" "User Commands"
+.TH "TESTPARM" "1" "06/26/2018" "Samba 4\&.8\&.3" "User Commands"
 .\" -----------------------------------------------------------------
 .\" * Define some portability stuff
 .\" -----------------------------------------------------------------
@@ -169,7 +169,7 @@ This is usually the name of the configur
 The program will issue a message saying whether the configuration file loaded OK or not\&. This message may be preceded by errors and warnings if the file did not load\&. If the file was loaded OK, the program then dumps all known service details to stdout\&.
 .SH "VERSION"
 .PP
-This man page is part of version 4\&.8\&.2 of the Samba suite\&.
+This man page is part of version 4\&.8\&.3 of the Samba suite\&.
 .SH "SEE ALSO"
 .PP
 \fBsmb.conf\fR(5),
diff -Npur samba-4.8.2/docs/manpages/traffic_learner.7 samba-4.8.3/docs/manpages/traffic_learner.7
--- samba-4.8.2/docs/manpages/traffic_learner.7	2018-05-16 12:15:10.000000000 +0200
+++ samba-4.8.3/docs/manpages/traffic_learner.7	2018-06-26 16:49:50.000000000 +0200
@@ -2,12 +2,12 @@
 .\"     Title: traffic_learner
 .\"    Author: [see the "AUTHOR" section]
 .\" Generator: DocBook XSL Stylesheets v1.79.1 <http://docbook.sf.net/>
-.\"      Date: 05/16/2018
+.\"      Date: 06/26/2018
 .\"    Manual: User Commands
-.\"    Source: Samba 4.8.2
+.\"    Source: Samba 4.8.3
 .\"  Language: English
 .\"
-.TH "TRAFFIC_LEARNER" "7" "05/16/2018" "Samba 4\&.8\&.2" "User Commands"
+.TH "TRAFFIC_LEARNER" "7" "06/26/2018" "Samba 4\&.8\&.3" "User Commands"
 .\" -----------------------------------------------------------------
 .\" * Define some portability stuff
 .\" -----------------------------------------------------------------
@@ -115,7 +115,7 @@ There are two special packet types here\
 The other special packet is "\-", which represents the limit of the conversation\&. In the example, this indicates that one observed conversation ended after this particular ngram\&. This special opcode is also used at the beginning of conversations, which are indicated by the ngram "\-\et\-"\&.
 .SH "VERSION"
 .PP
-This man page is complete for version 4\&.8\&.2 of the Samba suite\&.
+This man page is complete for version 4\&.8\&.3 of the Samba suite\&.
 .SH "SEE ALSO"
 .PP
 \fBtraffic_replay\fR(7)\&.
diff -Npur samba-4.8.2/docs/manpages/traffic_replay.7 samba-4.8.3/docs/manpages/traffic_replay.7
--- samba-4.8.2/docs/manpages/traffic_replay.7	2018-05-16 12:15:10.000000000 +0200
+++ samba-4.8.3/docs/manpages/traffic_replay.7	2018-06-26 16:49:50.000000000 +0200
@@ -2,12 +2,12 @@
 .\"     Title: traffic_replay
 .\"    Author: [see the "AUTHOR" section]
 .\" Generator: DocBook XSL Stylesheets v1.79.1 <http://docbook.sf.net/>
-.\"      Date: 05/16/2018
+.\"      Date: 06/26/2018
 .\"    Manual: User Commands
-.\"    Source: Samba 4.8.2
+.\"    Source: Samba 4.8.3
 .\"  Language: English
 .\"
-.TH "TRAFFIC_REPLAY" "7" "05/16/2018" "Samba 4\&.8\&.2" "User Commands"
+.TH "TRAFFIC_REPLAY" "7" "06/26/2018" "Samba 4\&.8\&.3" "User Commands"
 .\" -----------------------------------------------------------------
 .\" * Define some portability stuff
 .\" -----------------------------------------------------------------
@@ -327,7 +327,7 @@ traffic_replay traffic\-model\&.txt my\-
 The users created by the test will have names like STGU\-0\-xyz\&. The groups generated have names like STGG\-0\-xyz\&.
 .SH "VERSION"
 .PP
-This man page is complete for version 4\&.8\&.2 of the Samba suite\&.
+This man page is complete for version 4\&.8\&.3 of the Samba suite\&.
 .SH "SEE ALSO"
 .PP
 \fBtraffic_learner\fR(7)\&.
diff -Npur samba-4.8.2/docs/manpages/vfs_acl_tdb.8 samba-4.8.3/docs/manpages/vfs_acl_tdb.8
--- samba-4.8.2/docs/manpages/vfs_acl_tdb.8	2018-05-16 12:15:10.000000000 +0200
+++ samba-4.8.3/docs/manpages/vfs_acl_tdb.8	2018-06-26 16:49:50.000000000 +0200
@@ -2,12 +2,12 @@
 .\"     Title: vfs_acl_tdb
 .\"    Author: [see the "AUTHOR" section]
 .\" Generator: DocBook XSL Stylesheets v1.79.1 <http://docbook.sf.net/>
-.\"      Date: 05/16/2018
+.\"      Date: 06/26/2018
 .\"    Manual: System Administration tools
-.\"    Source: Samba 4.8.2
+.\"    Source: Samba 4.8.3
 .\"  Language: English
 .\"
-.TH "VFS_ACL_TDB" "8" "05/16/2018" "Samba 4\&.8\&.2" "System Administration tools"
+.TH "VFS_ACL_TDB" "8" "06/26/2018" "Samba 4\&.8\&.3" "System Administration tools"
 .\" -----------------------------------------------------------------
 .\" * Define some portability stuff
 .\" -----------------------------------------------------------------
diff -Npur samba-4.8.2/docs/manpages/vfs_acl_xattr.8 samba-4.8.3/docs/manpages/vfs_acl_xattr.8
--- samba-4.8.2/docs/manpages/vfs_acl_xattr.8	2018-05-16 12:15:10.000000000 +0200
+++ samba-4.8.3/docs/manpages/vfs_acl_xattr.8	2018-06-26 16:49:50.000000000 +0200
@@ -2,12 +2,12 @@
 .\"     Title: vfs_acl_xattr
 .\"    Author: [see the "AUTHOR" section]
 .\" Generator: DocBook XSL Stylesheets v1.79.1 <http://docbook.sf.net/>
-.\"      Date: 05/16/2018
+.\"      Date: 06/26/2018
 .\"    Manual: System Administration tools
-.\"    Source: Samba 4.8.2
+.\"    Source: Samba 4.8.3
 .\"  Language: English
 .\"
-.TH "VFS_ACL_XATTR" "8" "05/16/2018" "Samba 4\&.8\&.2" "System Administration tools"
+.TH "VFS_ACL_XATTR" "8" "06/26/2018" "Samba 4\&.8\&.3" "System Administration tools"
 .\" -----------------------------------------------------------------
 .\" * Define some portability stuff
 .\" -----------------------------------------------------------------
diff -Npur samba-4.8.2/docs/manpages/vfs_aio_fork.8 samba-4.8.3/docs/manpages/vfs_aio_fork.8
--- samba-4.8.2/docs/manpages/vfs_aio_fork.8	2018-05-16 12:15:11.000000000 +0200
+++ samba-4.8.3/docs/manpages/vfs_aio_fork.8	2018-06-26 16:49:50.000000000 +0200
@@ -2,12 +2,12 @@
 .\"     Title: vfs_aio_fork
 .\"    Author: [see the "AUTHOR" section]
 .\" Generator: DocBook XSL Stylesheets v1.79.1 <http://docbook.sf.net/>
-.\"      Date: 05/16/2018
+.\"      Date: 06/26/2018
 .\"    Manual: System Administration tools
-.\"    Source: Samba 4.8.2
+.\"    Source: Samba 4.8.3
 .\"  Language: English
 .\"
-.TH "VFS_AIO_FORK" "8" "05/16/2018" "Samba 4\&.8\&.2" "System Administration tools"
+.TH "VFS_AIO_FORK" "8" "06/26/2018" "Samba 4\&.8\&.3" "System Administration tools"
 .\" -----------------------------------------------------------------
 .\" * Define some portability stuff
 .\" -----------------------------------------------------------------
@@ -62,7 +62,7 @@ Straight forward use:
 .\}
 .SH "VERSION"
 .PP
-This man page is part of version 4\&.8\&.2 of the Samba suite\&.
+This man page is part of version 4\&.8\&.3 of the Samba suite\&.
 .SH "AUTHOR"
 .PP
 The original Samba software and related utilities were created by Andrew Tridgell\&. Samba is now developed by the Samba Team as an Open Source project similar to the way the Linux kernel is developed\&.
diff -Npur samba-4.8.2/docs/manpages/vfs_aio_pthread.8 samba-4.8.3/docs/manpages/vfs_aio_pthread.8
--- samba-4.8.2/docs/manpages/vfs_aio_pthread.8	2018-05-16 12:15:11.000000000 +0200
+++ samba-4.8.3/docs/manpages/vfs_aio_pthread.8	2018-06-26 16:49:51.000000000 +0200
@@ -2,12 +2,12 @@
 .\"     Title: vfs_aio_pthread
 .\"    Author: [see the "AUTHOR" section]
 .\" Generator: DocBook XSL Stylesheets v1.79.1 <http://docbook.sf.net/>
-.\"      Date: 05/16/2018
+.\"      Date: 06/26/2018
 .\"    Manual: System Administration tools
-.\"    Source: Samba 4.8.2
+.\"    Source: Samba 4.8.3
 .\"  Language: English
 .\"
-.TH "VFS_AIO_PTHREAD" "8" "05/16/2018" "Samba 4\&.8\&.2" "System Administration tools"
+.TH "VFS_AIO_PTHREAD" "8" "06/26/2018" "Samba 4\&.8\&.3" "System Administration tools"
 .\" -----------------------------------------------------------------
 .\" * Define some portability stuff
 .\" -----------------------------------------------------------------
@@ -78,7 +78,7 @@ By default this is set to 100\&.
 .RE
 .SH "VERSION"
 .PP
-This man page is part of version 4\&.8\&.2 of the Samba suite\&.
+This man page is part of version 4\&.8\&.3 of the Samba suite\&.
 .SH "AUTHOR"
 .PP
 The original Samba software and related utilities were created by Andrew Tridgell\&. Samba is now developed by the Samba Team as an Open Source project similar to the way the Linux kernel is developed\&.
diff -Npur samba-4.8.2/docs/manpages/vfs_audit.8 samba-4.8.3/docs/manpages/vfs_audit.8
--- samba-4.8.2/docs/manpages/vfs_audit.8	2018-05-16 12:15:11.000000000 +0200
+++ samba-4.8.3/docs/manpages/vfs_audit.8	2018-06-26 16:49:51.000000000 +0200
@@ -2,12 +2,12 @@
 .\"     Title: vfs_audit
 .\"    Author: [see the "AUTHOR" section]
 .\" Generator: DocBook XSL Stylesheets v1.79.1 <http://docbook.sf.net/>
-.\"      Date: 05/16/2018
+.\"      Date: 06/26/2018
 .\"    Manual: System Administration tools
-.\"    Source: Samba 4.8.2
+.\"    Source: Samba 4.8.3
 .\"  Language: English
 .\"
-.TH "VFS_AUDIT" "8" "05/16/2018" "Samba 4\&.8\&.2" "System Administration tools"
+.TH "VFS_AUDIT" "8" "06/26/2018" "Samba 4\&.8\&.3" "System Administration tools"
 .\" -----------------------------------------------------------------
 .\" * Define some portability stuff
 .\" -----------------------------------------------------------------
@@ -118,7 +118,7 @@ Log operations on all shares using the L
 .\}
 .SH "VERSION"
 .PP
-This man page is part of version 4\&.8\&.2 of the Samba suite\&.
+This man page is part of version 4\&.8\&.3 of the Samba suite\&.
 .SH "AUTHOR"
 .PP
 The original Samba software and related utilities were created by Andrew Tridgell\&. Samba is now developed by the Samba Team as an Open Source project similar to the way the Linux kernel is developed\&.
diff -Npur samba-4.8.2/docs/manpages/vfs_btrfs.8 samba-4.8.3/docs/manpages/vfs_btrfs.8
--- samba-4.8.2/docs/manpages/vfs_btrfs.8	2018-05-16 12:15:11.000000000 +0200
+++ samba-4.8.3/docs/manpages/vfs_btrfs.8	2018-06-26 16:49:51.000000000 +0200
@@ -2,12 +2,12 @@
 .\"     Title: vfs_btrfs
 .\"    Author: [see the "AUTHOR" section]
 .\" Generator: DocBook XSL Stylesheets v1.79.1 <http://docbook.sf.net/>
-.\"      Date: 05/16/2018
+.\"      Date: 06/26/2018
 .\"    Manual: System Administration tools
-.\"    Source: Samba 4.8.2
+.\"    Source: Samba 4.8.3
 .\"  Language: English
 .\"
-.TH "VFS_BTRFS" "8" "05/16/2018" "Samba 4\&.8\&.2" "System Administration tools"
+.TH "VFS_BTRFS" "8" "06/26/2018" "Samba 4\&.8\&.3" "System Administration tools"
 .\" -----------------------------------------------------------------
 .\" * Define some portability stuff
 .\" -----------------------------------------------------------------
@@ -104,7 +104,7 @@ to Windows Explorer as file / directory
 .\}
 .SH "VERSION"
 .PP
-This man page is part of version 4\&.8\&.2 of the Samba suite\&.
+This man page is part of version 4\&.8\&.3 of the Samba suite\&.
 .SH "AUTHOR"
 .PP
 The original Samba software and related utilities were created by Andrew Tridgell\&. Samba is now developed by the Samba Team as an Open Source project similar to the way the Linux kernel is developed\&.
diff -Npur samba-4.8.2/docs/manpages/vfs_cacheprime.8 samba-4.8.3/docs/manpages/vfs_cacheprime.8
--- samba-4.8.2/docs/manpages/vfs_cacheprime.8	2018-05-16 12:15:12.000000000 +0200
+++ samba-4.8.3/docs/manpages/vfs_cacheprime.8	2018-06-26 16:49:51.000000000 +0200
@@ -2,12 +2,12 @@
 .\"     Title: vfs_cacheprime
 .\"    Author: [see the "AUTHOR" section]
 .\" Generator: DocBook XSL Stylesheets v1.79.1 <http://docbook.sf.net/>
-.\"      Date: 05/16/2018
+.\"      Date: 06/26/2018
 .\"    Manual: System Administration tools
-.\"    Source: Samba 4.8.2
+.\"    Source: Samba 4.8.3
 .\"  Language: English
 .\"
-.TH "VFS_CACHEPRIME" "8" "05/16/2018" "Samba 4\&.8\&.2" "System Administration tools"
+.TH "VFS_CACHEPRIME" "8" "06/26/2018" "Samba 4\&.8\&.3" "System Administration tools"
 .\" -----------------------------------------------------------------
 .\" * Define some portability stuff
 .\" -----------------------------------------------------------------
@@ -115,7 +115,7 @@ cacheprime
 is not a substitute for a general\-purpose readahead mechanism\&. It is intended for use only in very specific environments where disk operations must be aligned and sized to known values (as much as that is possible)\&.
 .SH "VERSION"
 .PP
-This man page is part of version 4\&.8\&.2 of the Samba suite\&.
+This man page is part of version 4\&.8\&.3 of the Samba suite\&.
 .SH "AUTHOR"
 .PP
 The original Samba software and related utilities were created by Andrew Tridgell\&. Samba is now developed by the Samba Team as an Open Source project similar to the way the Linux kernel is developed\&.
diff -Npur samba-4.8.2/docs/manpages/vfs_cap.8 samba-4.8.3/docs/manpages/vfs_cap.8
--- samba-4.8.2/docs/manpages/vfs_cap.8	2018-05-16 12:15:12.000000000 +0200
+++ samba-4.8.3/docs/manpages/vfs_cap.8	2018-06-26 16:49:51.000000000 +0200
@@ -2,12 +2,12 @@
 .\"     Title: vfs_cap
 .\"    Author: [see the "AUTHOR" section]
 .\" Generator: DocBook XSL Stylesheets v1.79.1 <http://docbook.sf.net/>
-.\"      Date: 05/16/2018
+.\"      Date: 06/26/2018
 .\"    Manual: System Administration tools
-.\"    Source: Samba 4.8.2
+.\"    Source: Samba 4.8.3
 .\"  Language: English
 .\"
-.TH "VFS_CAP" "8" "05/16/2018" "Samba 4\&.8\&.2" "System Administration tools"
+.TH "VFS_CAP" "8" "06/26/2018" "Samba 4\&.8\&.3" "System Administration tools"
 .\" -----------------------------------------------------------------
 .\" * Define some portability stuff
 .\" -----------------------------------------------------------------
@@ -63,7 +63,7 @@ On a system using GNU libiconv, use CAP
 .\}
 .SH "VERSION"
 .PP
-This man page is part of version 4\&.8\&.2 of the Samba suite\&.
+This man page is part of version 4\&.8\&.3 of the Samba suite\&.
 .SH "AUTHOR"
 .PP
 The original Samba software and related utilities were created by Andrew Tridgell\&. Samba is now developed by the Samba Team as an Open Source project similar to the way the Linux kernel is developed\&.
diff -Npur samba-4.8.2/docs/manpages/vfs_catia.8 samba-4.8.3/docs/manpages/vfs_catia.8
--- samba-4.8.2/docs/manpages/vfs_catia.8	2018-05-16 12:15:12.000000000 +0200
+++ samba-4.8.3/docs/manpages/vfs_catia.8	2018-06-26 16:49:52.000000000 +0200
@@ -2,12 +2,12 @@
 .\"     Title: vfs_catia
 .\"    Author: [see the "AUTHOR" section]
 .\" Generator: DocBook XSL Stylesheets v1.79.1 <http://docbook.sf.net/>
-.\"      Date: 05/16/2018
+.\"      Date: 06/26/2018
 .\"    Manual: System Administration tools
-.\"    Source: Samba 4.8.2
+.\"    Source: Samba 4.8.3
 .\"  Language: English
 .\"
-.TH "VFS_CATIA" "8" "05/16/2018" "Samba 4\&.8\&.2" "System Administration tools"
+.TH "VFS_CATIA" "8" "06/26/2018" "Samba 4\&.8\&.3" "System Administration tools"
 .\" -----------------------------------------------------------------
 .\" * Define some portability stuff
 .\" -----------------------------------------------------------------
diff -Npur samba-4.8.2/docs/manpages/vfs_ceph.8 samba-4.8.3/docs/manpages/vfs_ceph.8
--- samba-4.8.2/docs/manpages/vfs_ceph.8	2018-05-16 12:15:12.000000000 +0200
+++ samba-4.8.3/docs/manpages/vfs_ceph.8	2018-06-26 16:49:52.000000000 +0200
@@ -2,12 +2,12 @@
 .\"     Title: vfs_ceph
 .\"    Author: [see the "AUTHOR" section]
 .\" Generator: DocBook XSL Stylesheets v1.79.1 <http://docbook.sf.net/>
-.\"      Date: 05/16/2018
+.\"      Date: 06/26/2018
 .\"    Manual: System Administration tools
-.\"    Source: Samba 4.8.2
+.\"    Source: Samba 4.8.3
 .\"  Language: English
 .\"
-.TH "VFS_CEPH" "8" "05/16/2018" "Samba 4\&.8\&.2" "System Administration tools"
+.TH "VFS_CEPH" "8" "06/26/2018" "Samba 4\&.8\&.3" "System Administration tools"
 .\" -----------------------------------------------------------------
 .\" * Define some portability stuff
 .\" -----------------------------------------------------------------
@@ -80,7 +80,7 @@ Example: ceph:user_id = samba
 .RE
 .SH "VERSION"
 .PP
-This man page is part of version 4\&.8\&.2 of the Samba suite\&.
+This man page is part of version 4\&.8\&.3 of the Samba suite\&.
 .SH "AUTHOR"
 .PP
 The original Samba software and related utilities were created by Andrew Tridgell\&. Samba is now developed by the Samba Team as an Open Source project similar to the way the Linux kernel is developed\&.
diff -Npur samba-4.8.2/docs/manpages/vfs_commit.8 samba-4.8.3/docs/manpages/vfs_commit.8
--- samba-4.8.2/docs/manpages/vfs_commit.8	2018-05-16 12:15:13.000000000 +0200
+++ samba-4.8.3/docs/manpages/vfs_commit.8	2018-06-26 16:49:52.000000000 +0200
@@ -2,12 +2,12 @@
 .\"     Title: vfs_commit
 .\"    Author: [see the "AUTHOR" section]
 .\" Generator: DocBook XSL Stylesheets v1.79.1 <http://docbook.sf.net/>
-.\"      Date: 05/16/2018
+.\"      Date: 06/26/2018
 .\"    Manual: System Administration tools
-.\"    Source: Samba 4.8.2
+.\"    Source: Samba 4.8.3
 .\"  Language: English
 .\"
-.TH "VFS_COMMIT" "8" "05/16/2018" "Samba 4\&.8\&.2" "System Administration tools"
+.TH "VFS_COMMIT" "8" "06/26/2018" "Samba 4\&.8\&.3" "System Administration tools"
 .\" -----------------------------------------------------------------
 .\" * Define some portability stuff
 .\" -----------------------------------------------------------------
@@ -116,7 +116,7 @@ commit
 may reduce performance\&.
 .SH "VERSION"
 .PP
-This man page is part of version 4\&.8\&.2 of the Samba suite\&.
+This man page is part of version 4\&.8\&.3 of the Samba suite\&.
 .SH "AUTHOR"
 .PP
 The original Samba software and related utilities were created by Andrew Tridgell\&. Samba is now developed by the Samba Team as an Open Source project similar to the way the Linux kernel is developed\&.
diff -Npur samba-4.8.2/docs/manpages/vfs_crossrename.8 samba-4.8.3/docs/manpages/vfs_crossrename.8
--- samba-4.8.2/docs/manpages/vfs_crossrename.8	2018-05-16 12:15:13.000000000 +0200
+++ samba-4.8.3/docs/manpages/vfs_crossrename.8	2018-06-26 16:49:52.000000000 +0200
@@ -2,12 +2,12 @@
 .\"     Title: vfs_crossrename
 .\"    Author: [see the "AUTHOR" section]
 .\" Generator: DocBook XSL Stylesheets v1.79.1 <http://docbook.sf.net/>
-.\"      Date: 05/16/2018
+.\"      Date: 06/26/2018
 .\"    Manual: System Administration tools
-.\"    Source: Samba 4.8.2
+.\"    Source: Samba 4.8.3
 .\"  Language: English
 .\"
-.TH "VFS_CROSSRENAME" "8" "05/16/2018" "Samba 4\&.8\&.2" "System Administration tools"
+.TH "VFS_CROSSRENAME" "8" "06/26/2018" "Samba 4\&.8\&.3" "System Administration tools"
 .\" -----------------------------------------------------------------
 .\" * Define some portability stuff
 .\" -----------------------------------------------------------------
@@ -89,7 +89,7 @@ To add server\-side cross\-device rename
 .\}
 .SH "VERSION"
 .PP
-This man page is part of version 4\&.8\&.2 of the Samba suite\&.
+This man page is part of version 4\&.8\&.3 of the Samba suite\&.
 .SH "AUTHOR"
 .PP
 The original Samba software and related utilities were created by Andrew Tridgell\&. Samba is now developed by the Samba Team as an Open Source project similar to the way the Linux kernel is developed\&.
diff -Npur samba-4.8.2/docs/manpages/vfs_default_quota.8 samba-4.8.3/docs/manpages/vfs_default_quota.8
--- samba-4.8.2/docs/manpages/vfs_default_quota.8	2018-05-16 12:15:13.000000000 +0200
+++ samba-4.8.3/docs/manpages/vfs_default_quota.8	2018-06-26 16:49:53.000000000 +0200
@@ -2,12 +2,12 @@
 .\"     Title: vfs_default_quota
 .\"    Author: [see the "AUTHOR" section]
 .\" Generator: DocBook XSL Stylesheets v1.79.1 <http://docbook.sf.net/>
-.\"      Date: 05/16/2018
+.\"      Date: 06/26/2018
 .\"    Manual: System Administration tools
-.\"    Source: Samba 4.8.2
+.\"    Source: Samba 4.8.3
 .\"  Language: English
 .\"
-.TH "VFS_DEFAULT_QUOTA" "8" "05/16/2018" "Samba 4\&.8\&.2" "System Administration tools"
+.TH "VFS_DEFAULT_QUOTA" "8" "06/26/2018" "Samba 4\&.8\&.3" "System Administration tools"
 .\" -----------------------------------------------------------------
 .\" * Define some portability stuff
 .\" -----------------------------------------------------------------
@@ -86,7 +86,7 @@ Store the default quota record in the qu
 .\}
 .SH "VERSION"
 .PP
-This man page is part of version 4\&.8\&.2 of the Samba suite\&.
+This man page is part of version 4\&.8\&.3 of the Samba suite\&.
 .SH "AUTHOR"
 .PP
 The original Samba software and related utilities were created by Andrew Tridgell\&. Samba is now developed by the Samba Team as an Open Source project similar to the way the Linux kernel is developed\&.
diff -Npur samba-4.8.2/docs/manpages/vfs_dirsort.8 samba-4.8.3/docs/manpages/vfs_dirsort.8
--- samba-4.8.2/docs/manpages/vfs_dirsort.8	2018-05-16 12:15:13.000000000 +0200
+++ samba-4.8.3/docs/manpages/vfs_dirsort.8	2018-06-26 16:49:53.000000000 +0200
@@ -2,12 +2,12 @@
 .\"     Title: vfs_dirsort
 .\"    Author: [see the "AUTHOR" section]
 .\" Generator: DocBook XSL Stylesheets v1.79.1 <http://docbook.sf.net/>
-.\"      Date: 05/16/2018
+.\"      Date: 06/26/2018
 .\"    Manual: System Administration tools
-.\"    Source: Samba 4.8.2
+.\"    Source: Samba 4.8.3
 .\"  Language: English
 .\"
-.TH "VFS_DIRSORT" "8" "05/16/2018" "Samba 4\&.8\&.2" "System Administration tools"
+.TH "VFS_DIRSORT" "8" "06/26/2018" "Samba 4\&.8\&.3" "System Administration tools"
 .\" -----------------------------------------------------------------
 .\" * Define some portability stuff
 .\" -----------------------------------------------------------------
@@ -59,7 +59,7 @@ Sort directories for all shares:
 .\}
 .SH "VERSION"
 .PP
-This man page is part of version 4\&.8\&.2 of the Samba suite\&.
+This man page is part of version 4\&.8\&.3 of the Samba suite\&.
 .SH "AUTHOR"
 .PP
 The original Samba software and related utilities were created by Andrew Tridgell\&. Samba is now developed by the Samba Team as an Open Source project similar to the way the Linux kernel is developed\&.
diff -Npur samba-4.8.2/docs/manpages/vfs_extd_audit.8 samba-4.8.3/docs/manpages/vfs_extd_audit.8
--- samba-4.8.2/docs/manpages/vfs_extd_audit.8	2018-05-16 12:15:13.000000000 +0200
+++ samba-4.8.3/docs/manpages/vfs_extd_audit.8	2018-06-26 16:49:53.000000000 +0200
@@ -2,12 +2,12 @@
 .\"     Title: vfs_extd_audit
 .\"    Author: [see the "AUTHOR" section]
 .\" Generator: DocBook XSL Stylesheets v1.79.1 <http://docbook.sf.net/>
-.\"      Date: 05/16/2018
+.\"      Date: 06/26/2018
 .\"    Manual: System Administration tools
-.\"    Source: Samba 4.8.2
+.\"    Source: Samba 4.8.3
 .\"  Language: English
 .\"
-.TH "VFS_EXTD_AUDIT" "8" "05/16/2018" "Samba 4\&.8\&.2" "System Administration tools"
+.TH "VFS_EXTD_AUDIT" "8" "06/26/2018" "Samba 4\&.8\&.3" "System Administration tools"
 .\" -----------------------------------------------------------------
 .\" * Define some portability stuff
 .\" -----------------------------------------------------------------
@@ -55,7 +55,7 @@ is identical to
 This module is stackable\&.
 .SH "VERSION"
 .PP
-This man page is part of version 4\&.8\&.2 of the Samba suite\&.
+This man page is part of version 4\&.8\&.3 of the Samba suite\&.
 .SH "AUTHOR"
 .PP
 The original Samba software and related utilities were created by Andrew Tridgell\&. Samba is now developed by the Samba Team as an Open Source project similar to the way the Linux kernel is developed\&.
diff -Npur samba-4.8.2/docs/manpages/vfs_fake_perms.8 samba-4.8.3/docs/manpages/vfs_fake_perms.8
--- samba-4.8.2/docs/manpages/vfs_fake_perms.8	2018-05-16 12:15:14.000000000 +0200
+++ samba-4.8.3/docs/manpages/vfs_fake_perms.8	2018-06-26 16:49:53.000000000 +0200
@@ -2,12 +2,12 @@
 .\"     Title: vfs_fake_perms
 .\"    Author: [see the "AUTHOR" section]
 .\" Generator: DocBook XSL Stylesheets v1.79.1 <http://docbook.sf.net/>
-.\"      Date: 05/16/2018
+.\"      Date: 06/26/2018
 .\"    Manual: System Administration tools
-.\"    Source: Samba 4.8.2
+.\"    Source: Samba 4.8.3
 .\"  Language: English
 .\"
-.TH "VFS_FAKE_PERMS" "8" "05/16/2018" "Samba 4\&.8\&.2" "System Administration tools"
+.TH "VFS_FAKE_PERMS" "8" "06/26/2018" "Samba 4\&.8\&.3" "System Administration tools"
 .\" -----------------------------------------------------------------
 .\" * Define some portability stuff
 .\" -----------------------------------------------------------------
@@ -58,7 +58,7 @@ This module is stackable\&.
 .\}
 .SH "VERSION"
 .PP
-This man page is part of version 4\&.8\&.2 of the Samba suite\&.
+This man page is part of version 4\&.8\&.3 of the Samba suite\&.
 .SH "AUTHOR"
 .PP
 The original Samba software and related utilities were created by Andrew Tridgell\&. Samba is now developed by the Samba Team as an Open Source project similar to the way the Linux kernel is developed\&.
diff -Npur samba-4.8.2/docs/manpages/vfs_fileid.8 samba-4.8.3/docs/manpages/vfs_fileid.8
--- samba-4.8.2/docs/manpages/vfs_fileid.8	2018-05-16 12:15:14.000000000 +0200
+++ samba-4.8.3/docs/manpages/vfs_fileid.8	2018-06-26 16:49:53.000000000 +0200
@@ -2,12 +2,12 @@
 .\"     Title: vfs_fileid
 .\"    Author: [see the "AUTHOR" section]
 .\" Generator: DocBook XSL Stylesheets v1.79.1 <http://docbook.sf.net/>
-.\"      Date: 05/16/2018
+.\"      Date: 06/26/2018
 .\"    Manual: System Administration tools
-.\"    Source: Samba 4.8.2
+.\"    Source: Samba 4.8.3
 .\"  Language: English
 .\"
-.TH "VFS_FILEID" "8" "05/16/2018" "Samba 4\&.8\&.2" "System Administration tools"
+.TH "VFS_FILEID" "8" "06/26/2018" "Samba 4\&.8\&.3" "System Administration tools"
 .\" -----------------------------------------------------------------
 .\" * Define some portability stuff
 .\" -----------------------------------------------------------------
@@ -138,7 +138,7 @@ algorithm:
 .\}
 .SH "VERSION"
 .PP
-This man page is part of version 4\&.8\&.2 of the Samba suite\&.
+This man page is part of version 4\&.8\&.3 of the Samba suite\&.
 .SH "AUTHOR"
 .PP
 The original Samba software and related utilities were created by Andrew Tridgell\&. Samba is now developed by the Samba Team as an Open Source project similar to the way the Linux kernel is developed\&.
diff -Npur samba-4.8.2/docs/manpages/vfs_fruit.8 samba-4.8.3/docs/manpages/vfs_fruit.8
--- samba-4.8.2/docs/manpages/vfs_fruit.8	2018-05-16 12:15:14.000000000 +0200
+++ samba-4.8.3/docs/manpages/vfs_fruit.8	2018-06-26 16:49:54.000000000 +0200
@@ -2,12 +2,12 @@
 .\"     Title: vfs_fruit
 .\"    Author: [see the "AUTHOR" section]
 .\" Generator: DocBook XSL Stylesheets v1.79.1 <http://docbook.sf.net/>
-.\"      Date: 05/16/2018
+.\"      Date: 06/26/2018
 .\"    Manual: System Administration tools
-.\"    Source: Samba 4.8.2
+.\"    Source: Samba 4.8.3
 .\"  Language: English
 .\"
-.TH "VFS_FRUIT" "8" "05/16/2018" "Samba 4\&.8\&.2" "System Administration tools"
+.TH "VFS_FRUIT" "8" "06/26/2018" "Samba 4\&.8\&.3" "System Administration tools"
 .\" -----------------------------------------------------------------
 .\" * Define some portability stuff
 .\" -----------------------------------------------------------------
diff -Npur samba-4.8.2/docs/manpages/vfs_full_audit.8 samba-4.8.3/docs/manpages/vfs_full_audit.8
--- samba-4.8.2/docs/manpages/vfs_full_audit.8	2018-05-16 12:15:14.000000000 +0200
+++ samba-4.8.3/docs/manpages/vfs_full_audit.8	2018-06-26 16:49:54.000000000 +0200
@@ -2,12 +2,12 @@
 .\"     Title: vfs_full_audit
 .\"    Author: [see the "AUTHOR" section]
 .\" Generator: DocBook XSL Stylesheets v1.79.1 <http://docbook.sf.net/>
-.\"      Date: 05/16/2018
+.\"      Date: 06/26/2018
 .\"    Manual: System Administration tools
-.\"    Source: Samba 4.8.2
+.\"    Source: Samba 4.8.3
 .\"  Language: English
 .\"
-.TH "VFS_FULL_AUDIT" "8" "05/16/2018" "Samba 4\&.8\&.2" "System Administration tools"
+.TH "VFS_FULL_AUDIT" "8" "06/26/2018" "Samba 4\&.8\&.3" "System Administration tools"
 .\" -----------------------------------------------------------------
 .\" * Define some portability stuff
 .\" -----------------------------------------------------------------
@@ -400,7 +400,7 @@ Log file and directory open operations o
 .\}
 .SH "VERSION"
 .PP
-This man page is part of version 4\&.8\&.2 of the Samba suite\&.
+This man page is part of version 4\&.8\&.3 of the Samba suite\&.
 .SH "AUTHOR"
 .PP
 The original Samba software and related utilities were created by Andrew Tridgell\&. Samba is now developed by the Samba Team as an Open Source project similar to the way the Linux kernel is developed\&.
diff -Npur samba-4.8.2/docs/manpages/vfs_glusterfs.8 samba-4.8.3/docs/manpages/vfs_glusterfs.8
--- samba-4.8.2/docs/manpages/vfs_glusterfs.8	2018-05-16 12:15:14.000000000 +0200
+++ samba-4.8.3/docs/manpages/vfs_glusterfs.8	2018-06-26 16:49:54.000000000 +0200
@@ -2,12 +2,12 @@
 .\"     Title: vfs_glusterfs
 .\"    Author: [see the "AUTHOR" section]
 .\" Generator: DocBook XSL Stylesheets v1.79.1 <http://docbook.sf.net/>
-.\"      Date: 05/16/2018
+.\"      Date: 06/26/2018
 .\"    Manual: System Administration tools
-.\"    Source: Samba 4.8.2
+.\"    Source: Samba 4.8.3
 .\"  Language: English
 .\"
-.TH "VFS_GLUSTERFS" "8" "05/16/2018" "Samba 4\&.8\&.2" "System Administration tools"
+.TH "VFS_GLUSTERFS" "8" "06/26/2018" "Samba 4\&.8\&.3" "System Administration tools"
 .\" -----------------------------------------------------------------
 .\" * Define some portability stuff
 .\" -----------------------------------------------------------------
@@ -109,7 +109,7 @@ Defines the glusterfs volumename to use
 .RE
 .SH "VERSION"
 .PP
-This man page is part of version 4\&.8\&.2 of the Samba suite\&.
+This man page is part of version 4\&.8\&.3 of the Samba suite\&.
 .SH "AUTHOR"
 .PP
 The original Samba software and related utilities were created by Andrew Tridgell\&. Samba is now developed by the Samba Team as an Open Source project similar to the way the Linux kernel is developed\&.
diff -Npur samba-4.8.2/docs/manpages/vfs_gpfs.8 samba-4.8.3/docs/manpages/vfs_gpfs.8
--- samba-4.8.2/docs/manpages/vfs_gpfs.8	2018-05-16 12:15:15.000000000 +0200
+++ samba-4.8.3/docs/manpages/vfs_gpfs.8	2018-06-26 16:49:54.000000000 +0200
@@ -2,12 +2,12 @@
 .\"     Title: vfs_gpfs
 .\"    Author: [see the "AUTHOR" section]
 .\" Generator: DocBook XSL Stylesheets v1.79.1 <http://docbook.sf.net/>
-.\"      Date: 05/16/2018
+.\"      Date: 06/26/2018
 .\"    Manual: System Administration tools
-.\"    Source: Samba 4.8.2
+.\"    Source: Samba 4.8.3
 .\"  Language: English
 .\"
-.TH "VFS_GPFS" "8" "05/16/2018" "Samba 4\&.8\&.2" "System Administration tools"
+.TH "VFS_GPFS" "8" "06/26/2018" "Samba 4\&.8\&.3" "System Administration tools"
 .\" -----------------------------------------------------------------
 .\" * Define some portability stuff
 .\" -----------------------------------------------------------------
@@ -692,7 +692,7 @@ gpfs\&.h
 in gpfs versions newer than 3\&.2\&.1 PTF8\&.
 .SH "VERSION"
 .PP
-This man page is part of version 4\&.8\&.2 of the Samba suite\&.
+This man page is part of version 4\&.8\&.3 of the Samba suite\&.
 .SH "AUTHOR"
 .PP
 The original Samba software and related utilities were created by Andrew Tridgell\&. Samba is now developed by the Samba Team as an Open Source project similar to the way the Linux kernel is developed\&.
diff -Npur samba-4.8.2/docs/manpages/vfs_linux_xfs_sgid.8 samba-4.8.3/docs/manpages/vfs_linux_xfs_sgid.8
--- samba-4.8.2/docs/manpages/vfs_linux_xfs_sgid.8	2018-05-16 12:15:15.000000000 +0200
+++ samba-4.8.3/docs/manpages/vfs_linux_xfs_sgid.8	2018-06-26 16:49:54.000000000 +0200
@@ -2,12 +2,12 @@
 .\"     Title: vfs_syncops
 .\"    Author: [see the "AUTHOR" section]
 .\" Generator: DocBook XSL Stylesheets v1.79.1 <http://docbook.sf.net/>
-.\"      Date: 05/16/2018
+.\"      Date: 06/26/2018
 .\"    Manual: System Administration tools
-.\"    Source: Samba 4.8.2
+.\"    Source: Samba 4.8.3
 .\"  Language: English
 .\"
-.TH "VFS_SYNCOPS" "8" "05/16/2018" "Samba 4\&.8\&.2" "System Administration tools"
+.TH "VFS_SYNCOPS" "8" "06/26/2018" "Samba 4\&.8\&.3" "System Administration tools"
 .\" -----------------------------------------------------------------
 .\" * Define some portability stuff
 .\" -----------------------------------------------------------------
@@ -62,7 +62,7 @@ Add syncops functionality for [share]:
 .\}
 .SH "VERSION"
 .PP
-This man page is part of version 4\&.8\&.2 of the Samba suite\&.
+This man page is part of version 4\&.8\&.3 of the Samba suite\&.
 .SH "AUTHOR"
 .PP
 The original Samba software and related utilities were created by Andrew Tridgell\&. Samba is now developed by the Samba Team as an Open Source project similar to the way the Linux kernel is developed\&.
diff -Npur samba-4.8.2/docs/manpages/vfs_media_harmony.8 samba-4.8.3/docs/manpages/vfs_media_harmony.8
--- samba-4.8.2/docs/manpages/vfs_media_harmony.8	2018-05-16 12:15:15.000000000 +0200
+++ samba-4.8.3/docs/manpages/vfs_media_harmony.8	2018-06-26 16:49:55.000000000 +0200
@@ -2,12 +2,12 @@
 .\"     Title: vfs_media_harmony
 .\"    Author: [see the "AUTHOR" section]
 .\" Generator: DocBook XSL Stylesheets v1.79.1 <http://docbook.sf.net/>
-.\"      Date: 05/16/2018
+.\"      Date: 06/26/2018
 .\"    Manual: System Administration tools
-.\"    Source: Samba 4.8.2
+.\"    Source: Samba 4.8.3
 .\"  Language: English
 .\"
-.TH "VFS_MEDIA_HARMONY" "8" "05/16/2018" "Samba 4\&.8\&.2" "System Administration tools"
+.TH "VFS_MEDIA_HARMONY" "8" "06/26/2018" "Samba 4\&.8\&.3" "System Administration tools"
 .\" -----------------------------------------------------------------
 .\" * Define some portability stuff
 .\" -----------------------------------------------------------------
@@ -138,7 +138,7 @@ vfs_media_harmony
 is designed to work with Avid editing applications that look in the Avid MediaFiles or OMFI MediaFiles directories for media\&. It is not designed to work as expected in all circumstances for general use\&. For example: It is possible to open a client\-specific file such as msmMMOB\&.mdb_192\&.168\&.1\&.10_userx even though it doesn\*(Aqt show up in a directory listing\&.
 .SH "VERSION"
 .PP
-This man page is part of version 4\&.8\&.2 of the Samba suite\&.
+This man page is part of version 4\&.8\&.3 of the Samba suite\&.
 .SH "AUTHOR"
 .PP
 The original Samba software and related utilities were created by Andrew Tridgell\&. Samba is now developed by the Samba Team as an Open Source project similar to the way the Linux kernel is developed\&.
diff -Npur samba-4.8.2/docs/manpages/vfs_netatalk.8 samba-4.8.3/docs/manpages/vfs_netatalk.8
--- samba-4.8.2/docs/manpages/vfs_netatalk.8	2018-05-16 12:15:15.000000000 +0200
+++ samba-4.8.3/docs/manpages/vfs_netatalk.8	2018-06-26 16:49:55.000000000 +0200
@@ -2,12 +2,12 @@
 .\"     Title: vfs_netatalk
 .\"    Author: [see the "AUTHOR" section]
 .\" Generator: DocBook XSL Stylesheets v1.79.1 <http://docbook.sf.net/>
-.\"      Date: 05/16/2018
+.\"      Date: 06/26/2018
 .\"    Manual: System Administration tools
-.\"    Source: Samba 4.8.2
+.\"    Source: Samba 4.8.3
 .\"  Language: English
 .\"
-.TH "VFS_NETATALK" "8" "05/16/2018" "Samba 4\&.8\&.2" "System Administration tools"
+.TH "VFS_NETATALK" "8" "06/26/2018" "Samba 4\&.8\&.3" "System Administration tools"
 .\" -----------------------------------------------------------------
 .\" * Define some portability stuff
 .\" -----------------------------------------------------------------
@@ -62,7 +62,7 @@ Hide \&.AppleDouble files on the [data]
 This module is largely historic and unlikely to be of use in modern networks since current Apple systems are able to mount CIFS shares natively\&.
 .SH "VERSION"
 .PP
-This man page is part of version 4\&.8\&.2 of the Samba suite\&.
+This man page is part of version 4\&.8\&.3 of the Samba suite\&.
 .SH "AUTHOR"
 .PP
 The original Samba software and related utilities were created by Andrew Tridgell\&. Samba is now developed by the Samba Team as an Open Source project similar to the way the Linux kernel is developed\&.
diff -Npur samba-4.8.2/docs/manpages/vfs_nfs4acl_xattr.8 samba-4.8.3/docs/manpages/vfs_nfs4acl_xattr.8
--- samba-4.8.2/docs/manpages/vfs_nfs4acl_xattr.8	2018-05-16 12:15:16.000000000 +0200
+++ samba-4.8.3/docs/manpages/vfs_nfs4acl_xattr.8	2018-06-26 16:49:55.000000000 +0200
@@ -2,12 +2,12 @@
 .\"     Title: vfs_nfs4acl_xattr
 .\"    Author: [see the "AUTHOR" section]
 .\" Generator: DocBook XSL Stylesheets v1.79.1 <http://docbook.sf.net/>
-.\"      Date: 05/16/2018
+.\"      Date: 06/26/2018
 .\"    Manual: System Administration tools
-.\"    Source: Samba 4.8.2
+.\"    Source: Samba 4.8.3
 .\"  Language: English
 .\"
-.TH "VFS_NFS4ACL_XATTR" "8" "05/16/2018" "Samba 4\&.8\&.2" "System Administration tools"
+.TH "VFS_NFS4ACL_XATTR" "8" "06/26/2018" "Samba 4\&.8\&.3" "System Administration tools"
 .\" -----------------------------------------------------------------
 .\" * Define some portability stuff
 .\" -----------------------------------------------------------------
diff -Npur samba-4.8.2/docs/manpages/vfs_offline.8 samba-4.8.3/docs/manpages/vfs_offline.8
--- samba-4.8.2/docs/manpages/vfs_offline.8	2018-05-16 12:15:16.000000000 +0200
+++ samba-4.8.3/docs/manpages/vfs_offline.8	2018-06-26 16:49:55.000000000 +0200
@@ -2,12 +2,12 @@
 .\"     Title: vfs_offline
 .\"    Author: [see the "AUTHOR" section]
 .\" Generator: DocBook XSL Stylesheets v1.79.1 <http://docbook.sf.net/>
-.\"      Date: 05/16/2018
+.\"      Date: 06/26/2018
 .\"    Manual: System Administration tools
-.\"    Source: Samba 4.8.2
+.\"    Source: Samba 4.8.3
 .\"  Language: English
 .\"
-.TH "VFS_OFFLINE" "8" "05/16/2018" "Samba 4\&.8\&.2" "System Administration tools"
+.TH "VFS_OFFLINE" "8" "06/26/2018" "Samba 4\&.8\&.3" "System Administration tools"
 .\" -----------------------------------------------------------------
 .\" * Define some portability stuff
 .\" -----------------------------------------------------------------
@@ -59,7 +59,7 @@ Mark all files in a share as offline:
 .\}
 .SH "VERSION"
 .PP
-This man page is part of version 4\&.8\&.2 of the Samba suite\&.
+This man page is part of version 4\&.8\&.3 of the Samba suite\&.
 .SH "AUTHOR"
 .PP
 The original Samba software and related utilities were created by Andrew Tridgell\&. Samba is now developed by the Samba Team as an Open Source project similar to the way the Linux kernel is developed\&.
diff -Npur samba-4.8.2/docs/manpages/vfs_prealloc.8 samba-4.8.3/docs/manpages/vfs_prealloc.8
--- samba-4.8.2/docs/manpages/vfs_prealloc.8	2018-05-16 12:15:16.000000000 +0200
+++ samba-4.8.3/docs/manpages/vfs_prealloc.8	2018-06-26 16:49:56.000000000 +0200
@@ -2,12 +2,12 @@
 .\"     Title: vfs_prealloc
 .\"    Author: [see the "AUTHOR" section]
 .\" Generator: DocBook XSL Stylesheets v1.79.1 <http://docbook.sf.net/>
-.\"      Date: 05/16/2018
+.\"      Date: 06/26/2018
 .\"    Manual: System Administration tools
-.\"    Source: Samba 4.8.2
+.\"    Source: Samba 4.8.3
 .\"  Language: English
 .\"
-.TH "VFS_PREALLOC" "8" "05/16/2018" "Samba 4\&.8\&.2" "System Administration tools"
+.TH "VFS_PREALLOC" "8" "06/26/2018" "Samba 4\&.8\&.3" "System Administration tools"
 .\" -----------------------------------------------------------------
 .\" * Define some portability stuff
 .\" -----------------------------------------------------------------
@@ -112,7 +112,7 @@ vfs_prealloc
 is not supported on all platforms and filesystems\&. Currently only XFS filesystems on Linux and IRIX are supported\&.
 .SH "VERSION"
 .PP
-This man page is part of version 4\&.8\&.2 of the Samba suite\&.
+This man page is part of version 4\&.8\&.3 of the Samba suite\&.
 .SH "AUTHOR"
 .PP
 The original Samba software and related utilities were created by Andrew Tridgell\&. Samba is now developed by the Samba Team as an Open Source project similar to the way the Linux kernel is developed\&.
diff -Npur samba-4.8.2/docs/manpages/vfs_preopen.8 samba-4.8.3/docs/manpages/vfs_preopen.8
--- samba-4.8.2/docs/manpages/vfs_preopen.8	2018-05-16 12:15:16.000000000 +0200
+++ samba-4.8.3/docs/manpages/vfs_preopen.8	2018-06-26 16:49:56.000000000 +0200
@@ -2,12 +2,12 @@
 .\"     Title: vfs_preopen
 .\"    Author: [see the "AUTHOR" section]
 .\" Generator: DocBook XSL Stylesheets v1.79.1 <http://docbook.sf.net/>
-.\"      Date: 05/16/2018
+.\"      Date: 06/26/2018
 .\"    Manual: System Administration tools
-.\"    Source: Samba 4.8.2
+.\"    Source: Samba 4.8.3
 .\"  Language: English
 .\"
-.TH "VFS_PREOPEN" "8" "05/16/2018" "Samba 4\&.8\&.2" "System Administration tools"
+.TH "VFS_PREOPEN" "8" "06/26/2018" "Samba 4\&.8\&.3" "System Administration tools"
 .\" -----------------------------------------------------------------
 .\" * Define some portability stuff
 .\" -----------------------------------------------------------------
@@ -67,7 +67,7 @@ Number of files that should be speculati
 .RE
 .SH "VERSION"
 .PP
-This man page is part of version 4\&.8\&.2 of the Samba suite\&.
+This man page is part of version 4\&.8\&.3 of the Samba suite\&.
 .SH "AUTHOR"
 .PP
 The original Samba software and related utilities were created by Andrew Tridgell\&. Samba is now developed by the Samba Team as an Open Source project similar to the way the Linux kernel is developed\&.
diff -Npur samba-4.8.2/docs/manpages/vfs_readahead.8 samba-4.8.3/docs/manpages/vfs_readahead.8
--- samba-4.8.2/docs/manpages/vfs_readahead.8	2018-05-16 12:15:16.000000000 +0200
+++ samba-4.8.3/docs/manpages/vfs_readahead.8	2018-06-26 16:49:56.000000000 +0200
@@ -2,12 +2,12 @@
 .\"     Title: vfs_readahead
 .\"    Author: [see the "AUTHOR" section]
 .\" Generator: DocBook XSL Stylesheets v1.79.1 <http://docbook.sf.net/>
-.\"      Date: 05/16/2018
+.\"      Date: 06/26/2018
 .\"    Manual: System Administration tools
-.\"    Source: Samba 4.8.2
+.\"    Source: Samba 4.8.3
 .\"  Language: English
 .\"
-.TH "VFS_READAHEAD" "8" "05/16/2018" "Samba 4\&.8\&.2" "System Administration tools"
+.TH "VFS_READAHEAD" "8" "06/26/2018" "Samba 4\&.8\&.3" "System Administration tools"
 .\" -----------------------------------------------------------------
 .\" * Define some portability stuff
 .\" -----------------------------------------------------------------
@@ -115,7 +115,7 @@ G
 .\}
 .SH "VERSION"
 .PP
-This man page is part of version 4\&.8\&.2 of the Samba suite\&.
+This man page is part of version 4\&.8\&.3 of the Samba suite\&.
 .SH "AUTHOR"
 .PP
 The original Samba software and related utilities were created by Andrew Tridgell\&. Samba is now developed by the Samba Team as an Open Source project similar to the way the Linux kernel is developed\&.
diff -Npur samba-4.8.2/docs/manpages/vfs_readonly.8 samba-4.8.3/docs/manpages/vfs_readonly.8
--- samba-4.8.2/docs/manpages/vfs_readonly.8	2018-05-16 12:15:17.000000000 +0200
+++ samba-4.8.3/docs/manpages/vfs_readonly.8	2018-06-26 16:49:56.000000000 +0200
@@ -2,12 +2,12 @@
 .\"     Title: vfs_readonly
 .\"    Author: [see the "AUTHOR" section]
 .\" Generator: DocBook XSL Stylesheets v1.79.1 <http://docbook.sf.net/>
-.\"      Date: 05/16/2018
+.\"      Date: 06/26/2018
 .\"    Manual: System Administration tools
-.\"    Source: Samba 4.8.2
+.\"    Source: Samba 4.8.3
 .\"  Language: English
 .\"
-.TH "VFS_READONLY" "8" "05/16/2018" "Samba 4\&.8\&.2" "System Administration tools"
+.TH "VFS_READONLY" "8" "06/26/2018" "Samba 4\&.8\&.3" "System Administration tools"
 .\" -----------------------------------------------------------------
 .\" * Define some portability stuff
 .\" -----------------------------------------------------------------
@@ -81,7 +81,7 @@ Mark the [backup] share as read only dur
 .\}
 .SH "VERSION"
 .PP
-This man page is part of version 4\&.8\&.2 of the Samba suite\&.
+This man page is part of version 4\&.8\&.3 of the Samba suite\&.
 .SH "AUTHOR"
 .PP
 The original Samba software and related utilities were created by Andrew Tridgell\&. Samba is now developed by the Samba Team as an Open Source project similar to the way the Linux kernel is developed\&.
diff -Npur samba-4.8.2/docs/manpages/vfs_recycle.8 samba-4.8.3/docs/manpages/vfs_recycle.8
--- samba-4.8.2/docs/manpages/vfs_recycle.8	2018-05-16 12:15:17.000000000 +0200
+++ samba-4.8.3/docs/manpages/vfs_recycle.8	2018-06-26 16:49:56.000000000 +0200
@@ -2,12 +2,12 @@
 .\"     Title: vfs_recycle
 .\"    Author: [see the "AUTHOR" section]
 .\" Generator: DocBook XSL Stylesheets v1.79.1 <http://docbook.sf.net/>
-.\"      Date: 05/16/2018
+.\"      Date: 06/26/2018
 .\"    Manual: System Administration tools
-.\"    Source: Samba 4.8.2
+.\"    Source: Samba 4.8.3
 .\"  Language: English
 .\"
-.TH "VFS_RECYCLE" "8" "05/16/2018" "Samba 4\&.8\&.2" "System Administration tools"
+.TH "VFS_RECYCLE" "8" "06/26/2018" "Samba 4\&.8\&.3" "System Administration tools"
 .\" -----------------------------------------------------------------
 .\" * Define some portability stuff
 .\" -----------------------------------------------------------------
@@ -136,7 +136,7 @@ instead of deleting them:
 .\}
 .SH "VERSION"
 .PP
-This man page is part of version 4\&.8\&.2 of the Samba suite\&.
+This man page is part of version 4\&.8\&.3 of the Samba suite\&.
 .SH "AUTHOR"
 .PP
 The original Samba software and related utilities were created by Andrew Tridgell\&. Samba is now developed by the Samba Team as an Open Source project similar to the way the Linux kernel is developed\&.
diff -Npur samba-4.8.2/docs/manpages/vfs_shadow_copy.8 samba-4.8.3/docs/manpages/vfs_shadow_copy.8
--- samba-4.8.2/docs/manpages/vfs_shadow_copy.8	2018-05-16 12:15:17.000000000 +0200
+++ samba-4.8.3/docs/manpages/vfs_shadow_copy.8	2018-06-26 16:49:57.000000000 +0200
@@ -2,12 +2,12 @@
 .\"     Title: vfs_shadow_copy
 .\"    Author: [see the "AUTHOR" section]
 .\" Generator: DocBook XSL Stylesheets v1.79.1 <http://docbook.sf.net/>
-.\"      Date: 05/16/2018
+.\"      Date: 06/26/2018
 .\"    Manual: System Administration tools
-.\"    Source: Samba 4.8.2
+.\"    Source: Samba 4.8.3
 .\"  Language: English
 .\"
-.TH "VFS_SHADOW_COPY" "8" "05/16/2018" "Samba 4\&.8\&.2" "System Administration tools"
+.TH "VFS_SHADOW_COPY" "8" "06/26/2018" "Samba 4\&.8\&.3" "System Administration tools"
 .\" -----------------------------------------------------------------
 .\" * Define some portability stuff
 .\" -----------------------------------------------------------------
@@ -167,7 +167,7 @@ vfs_shadow_copy
 is designed to be an end\-user tool only\&. It does not replace or enhance your backup and archival solutions and should in no way be considered as such\&. Additionally, if you need version control, implement a version control system\&.
 .SH "VERSION"
 .PP
-This man page is part of version 4\&.8\&.2 of the Samba suite\&.
+This man page is part of version 4\&.8\&.3 of the Samba suite\&.
 .SH "AUTHOR"
 .PP
 The original Samba software and related utilities were created by Andrew Tridgell\&. Samba is now developed by the Samba Team as an Open Source project similar to the way the Linux kernel is developed\&.
diff -Npur samba-4.8.2/docs/manpages/vfs_shadow_copy2.8 samba-4.8.3/docs/manpages/vfs_shadow_copy2.8
--- samba-4.8.2/docs/manpages/vfs_shadow_copy2.8	2018-05-16 12:15:17.000000000 +0200
+++ samba-4.8.3/docs/manpages/vfs_shadow_copy2.8	2018-06-26 16:49:57.000000000 +0200
@@ -2,12 +2,12 @@
 .\"     Title: vfs_shadow_copy2
 .\"    Author: [see the "AUTHOR" section]
 .\" Generator: DocBook XSL Stylesheets v1.79.1 <http://docbook.sf.net/>
-.\"      Date: 05/16/2018
+.\"      Date: 06/26/2018
 .\"    Manual: System Administration tools
-.\"    Source: Samba 4.8.2
+.\"    Source: Samba 4.8.3
 .\"  Language: English
 .\"
-.TH "VFS_SHADOW_COPY2" "8" "05/16/2018" "Samba 4\&.8\&.2" "System Administration tools"
+.TH "VFS_SHADOW_COPY2" "8" "06/26/2018" "Samba 4\&.8\&.3" "System Administration tools"
 .\" -----------------------------------------------------------------
 .\" * Define some portability stuff
 .\" -----------------------------------------------------------------
@@ -519,7 +519,7 @@ vfs_shadow_copy2
 is designed to be an end\-user tool only\&. It does not replace or enhance your backup and archival solutions and should in no way be considered as such\&. Additionally, if you need version control, implement a version control system\&.
 .SH "VERSION"
 .PP
-This man page is part of version 4\&.8\&.2 of the Samba suite\&.
+This man page is part of version 4\&.8\&.3 of the Samba suite\&.
 .SH "AUTHOR"
 .PP
 The original Samba software and related utilities were created by Andrew Tridgell\&. Samba is now developed by the Samba Team as an Open Source project similar to the way the Linux kernel is developed\&.
diff -Npur samba-4.8.2/docs/manpages/vfs_shell_snap.8 samba-4.8.3/docs/manpages/vfs_shell_snap.8
--- samba-4.8.2/docs/manpages/vfs_shell_snap.8	2018-05-16 12:15:18.000000000 +0200
+++ samba-4.8.3/docs/manpages/vfs_shell_snap.8	2018-06-26 16:49:57.000000000 +0200
@@ -2,12 +2,12 @@
 .\"     Title: vfs_shell_snap
 .\"    Author: [see the "AUTHOR" section]
 .\" Generator: DocBook XSL Stylesheets v1.79.1 <http://docbook.sf.net/>
-.\"      Date: 05/16/2018
+.\"      Date: 06/26/2018
 .\"    Manual: System Administration tools
-.\"    Source: Samba 4.8.2
+.\"    Source: Samba 4.8.3
 .\"  Language: English
 .\"
-.TH "VFS_SHELL_SNAP" "8" "05/16/2018" "Samba 4\&.8\&.2" "System Administration tools"
+.TH "VFS_SHELL_SNAP" "8" "06/26/2018" "Samba 4\&.8\&.3" "System Administration tools"
 .\" -----------------------------------------------------------------
 .\" * Define some portability stuff
 .\" -----------------------------------------------------------------
@@ -215,7 +215,7 @@ Samba\*(Aqs FSRVP server must be configu
 .\}
 .SH "VERSION"
 .PP
-This man page is part of version 4\&.8\&.2 of the Samba suite\&.
+This man page is part of version 4\&.8\&.3 of the Samba suite\&.
 .SH "AUTHOR"
 .PP
 The original Samba software and related utilities were created by Andrew Tridgell\&. Samba is now developed by the Samba Team as an Open Source project similar to the way the Linux kernel is developed\&.
diff -Npur samba-4.8.2/docs/manpages/vfs_snapper.8 samba-4.8.3/docs/manpages/vfs_snapper.8
--- samba-4.8.2/docs/manpages/vfs_snapper.8	2018-05-16 12:15:18.000000000 +0200
+++ samba-4.8.3/docs/manpages/vfs_snapper.8	2018-06-26 16:49:57.000000000 +0200
@@ -2,12 +2,12 @@
 .\"     Title: vfs_snapper
 .\"    Author: [see the "AUTHOR" section]
 .\" Generator: DocBook XSL Stylesheets v1.79.1 <http://docbook.sf.net/>
-.\"      Date: 05/16/2018
+.\"      Date: 06/26/2018
 .\"    Manual: System Administration tools
-.\"    Source: Samba 4.8.2
+.\"    Source: Samba 4.8.3
 .\"  Language: English
 .\"
-.TH "VFS_SNAPPER" "8" "05/16/2018" "Samba 4\&.8\&.2" "System Administration tools"
+.TH "VFS_SNAPPER" "8" "06/26/2018" "Samba 4\&.8\&.3" "System Administration tools"
 .\" -----------------------------------------------------------------
 .\" * Define some portability stuff
 .\" -----------------------------------------------------------------
@@ -85,7 +85,7 @@ Remote snapshot creation and deletion is
 The DiskShadow\&.exe FSRVP client initially authenticates as the Active Directory computer account\&. This account must therefore be granted the same permissions as the user account issuing the snapshot creation and deletion requests\&.
 .SH "VERSION"
 .PP
-This man page is part of version 4\&.8\&.2 of the Samba suite\&.
+This man page is part of version 4\&.8\&.3 of the Samba suite\&.
 .SH "AUTHOR"
 .PP
 The original Samba software and related utilities were created by Andrew Tridgell\&. Samba is now developed by the Samba Team as an Open Source project similar to the way the Linux kernel is developed\&.
diff -Npur samba-4.8.2/docs/manpages/vfs_streams_depot.8 samba-4.8.3/docs/manpages/vfs_streams_depot.8
--- samba-4.8.2/docs/manpages/vfs_streams_depot.8	2018-05-16 12:15:18.000000000 +0200
+++ samba-4.8.3/docs/manpages/vfs_streams_depot.8	2018-06-26 16:49:57.000000000 +0200
@@ -2,12 +2,12 @@
 .\"     Title: vfs_streams_depot
 .\"    Author: [see the "AUTHOR" section]
 .\" Generator: DocBook XSL Stylesheets v1.79.1 <http://docbook.sf.net/>
-.\"      Date: 05/16/2018
+.\"      Date: 06/26/2018
 .\"    Manual: System Administration tools
-.\"    Source: Samba 4.8.2
+.\"    Source: Samba 4.8.3
 .\"  Language: English
 .\"
-.TH "VFS_STREAMS_DEPOT" "8" "05/16/2018" "Samba 4\&.8\&.2" "System Administration tools"
+.TH "VFS_STREAMS_DEPOT" "8" "06/26/2018" "Samba 4\&.8\&.3" "System Administration tools"
 .\" -----------------------------------------------------------------
 .\" * Define some portability stuff
 .\" -----------------------------------------------------------------
diff -Npur samba-4.8.2/docs/manpages/vfs_streams_xattr.8 samba-4.8.3/docs/manpages/vfs_streams_xattr.8
--- samba-4.8.2/docs/manpages/vfs_streams_xattr.8	2018-05-16 12:15:18.000000000 +0200
+++ samba-4.8.3/docs/manpages/vfs_streams_xattr.8	2018-06-26 16:49:58.000000000 +0200
@@ -2,12 +2,12 @@
 .\"     Title: vfs_streams_xattr
 .\"    Author: [see the "AUTHOR" section]
 .\" Generator: DocBook XSL Stylesheets v1.79.1 <http://docbook.sf.net/>
-.\"      Date: 05/16/2018
+.\"      Date: 06/26/2018
 .\"    Manual: System Administration tools
-.\"    Source: Samba 4.8.2
+.\"    Source: Samba 4.8.3
 .\"  Language: English
 .\"
-.TH "VFS_STREAMS_XATTR" "8" "05/16/2018" "Samba 4\&.8\&.2" "System Administration tools"
+.TH "VFS_STREAMS_XATTR" "8" "06/26/2018" "Samba 4\&.8\&.3" "System Administration tools"
 .\" -----------------------------------------------------------------
 .\" * Define some portability stuff
 .\" -----------------------------------------------------------------
diff -Npur samba-4.8.2/docs/manpages/vfs_syncops.8 samba-4.8.3/docs/manpages/vfs_syncops.8
--- samba-4.8.2/docs/manpages/vfs_syncops.8	2018-05-16 12:15:18.000000000 +0200
+++ samba-4.8.3/docs/manpages/vfs_syncops.8	2018-06-26 16:49:58.000000000 +0200
@@ -2,12 +2,12 @@
 .\"     Title: vfs_syncops
 .\"    Author: [see the "AUTHOR" section]
 .\" Generator: DocBook XSL Stylesheets v1.79.1 <http://docbook.sf.net/>
-.\"      Date: 05/16/2018
+.\"      Date: 06/26/2018
 .\"    Manual: System Administration tools
-.\"    Source: Samba 4.8.2
+.\"    Source: Samba 4.8.3
 .\"  Language: English
 .\"
-.TH "VFS_SYNCOPS" "8" "05/16/2018" "Samba 4\&.8\&.2" "System Administration tools"
+.TH "VFS_SYNCOPS" "8" "06/26/2018" "Samba 4\&.8\&.3" "System Administration tools"
 .\" -----------------------------------------------------------------
 .\" * Define some portability stuff
 .\" -----------------------------------------------------------------
@@ -76,7 +76,7 @@ Add syncops functionality for [share]:
 .\}
 .SH "VERSION"
 .PP
-This man page is part of version 4\&.8\&.2 of the Samba suite\&.
+This man page is part of version 4\&.8\&.3 of the Samba suite\&.
 .SH "AUTHOR"
 .PP
 The original Samba software and related utilities were created by Andrew Tridgell\&. Samba is now developed by the Samba Team as an Open Source project similar to the way the Linux kernel is developed\&.
diff -Npur samba-4.8.2/docs/manpages/vfs_time_audit.8 samba-4.8.3/docs/manpages/vfs_time_audit.8
--- samba-4.8.2/docs/manpages/vfs_time_audit.8	2018-05-16 12:15:19.000000000 +0200
+++ samba-4.8.3/docs/manpages/vfs_time_audit.8	2018-06-26 16:49:58.000000000 +0200
@@ -2,12 +2,12 @@
 .\"     Title: vfs_time_audit
 .\"    Author: [see the "AUTHOR" section]
 .\" Generator: DocBook XSL Stylesheets v1.79.1 <http://docbook.sf.net/>
-.\"      Date: 05/16/2018
+.\"      Date: 06/26/2018
 .\"    Manual: System Administration tools
-.\"    Source: Samba 4.8.2
+.\"    Source: Samba 4.8.3
 .\"  Language: English
 .\"
-.TH "VFS_TIME_AUDIT" "8" "05/16/2018" "Samba 4\&.8\&.2" "System Administration tools"
+.TH "VFS_TIME_AUDIT" "8" "06/26/2018" "Samba 4\&.8\&.3" "System Administration tools"
 .\" -----------------------------------------------------------------
 .\" * Define some portability stuff
 .\" -----------------------------------------------------------------
@@ -72,7 +72,7 @@ This would log VFS calls that take longe
 .\}
 .SH "VERSION"
 .PP
-This man page is part of version 4\&.8\&.2 of the Samba suite\&.
+This man page is part of version 4\&.8\&.3 of the Samba suite\&.
 .SH "AUTHOR"
 .PP
 The original Samba software and related utilities were created by Andrew Tridgell\&. Samba is now developed by the Samba Team as an Open Source project similar to the way the Linux kernel is developed\&.
diff -Npur samba-4.8.2/docs/manpages/vfs_tsmsm.8 samba-4.8.3/docs/manpages/vfs_tsmsm.8
--- samba-4.8.2/docs/manpages/vfs_tsmsm.8	2018-05-16 12:15:19.000000000 +0200
+++ samba-4.8.3/docs/manpages/vfs_tsmsm.8	2018-06-26 16:49:58.000000000 +0200
@@ -2,12 +2,12 @@
 .\"     Title: vfs_tsmsm
 .\"    Author: [see the "AUTHOR" section]
 .\" Generator: DocBook XSL Stylesheets v1.79.1 <http://docbook.sf.net/>
-.\"      Date: 05/16/2018
+.\"      Date: 06/26/2018
 .\"    Manual: System Administration tools
-.\"    Source: Samba 4.8.2
+.\"    Source: Samba 4.8.3
 .\"  Language: English
 .\"
-.TH "VFS_TSMSM" "8" "05/16/2018" "Samba 4\&.8\&.2" "System Administration tools"
+.TH "VFS_TSMSM" "8" "06/26/2018" "Samba 4\&.8\&.3" "System Administration tools"
 .\" -----------------------------------------------------------------
 .\" * Define some portability stuff
 .\" -----------------------------------------------------------------
@@ -83,7 +83,7 @@ A GPFS mount with TSM support can be exp
 .\}
 .SH "VERSION"
 .PP
-This man page is part of version 4\&.8\&.2 of the Samba suite\&.
+This man page is part of version 4\&.8\&.3 of the Samba suite\&.
 .SH "AUTHOR"
 .PP
 The original Samba software and related utilities were created by Andrew Tridgell\&. Samba is now developed by the Samba Team as an Open Source project similar to the way the Linux kernel is developed\&.
diff -Npur samba-4.8.2/docs/manpages/vfs_unityed_media.8 samba-4.8.3/docs/manpages/vfs_unityed_media.8
--- samba-4.8.2/docs/manpages/vfs_unityed_media.8	2018-05-16 12:15:19.000000000 +0200
+++ samba-4.8.3/docs/manpages/vfs_unityed_media.8	2018-06-26 16:49:58.000000000 +0200
@@ -2,12 +2,12 @@
 .\"     Title: vfs_unityed_media
 .\"    Author: [see the "AUTHOR" section]
 .\" Generator: DocBook XSL Stylesheets v1.79.1 <http://docbook.sf.net/>
-.\"      Date: 05/16/2018
+.\"      Date: 06/26/2018
 .\"    Manual: System Administration tools
-.\"    Source: Samba 4.8.2
+.\"    Source: Samba 4.8.3
 .\"  Language: English
 .\"
-.TH "VFS_UNITYED_MEDIA" "8" "05/16/2018" "Samba 4\&.8\&.2" "System Administration tools"
+.TH "VFS_UNITYED_MEDIA" "8" "06/26/2018" "Samba 4\&.8\&.3" "System Administration tools"
 .\" -----------------------------------------------------------------
 .\" * Define some portability stuff
 .\" -----------------------------------------------------------------
@@ -111,7 +111,7 @@ Enable unityed_media for Mac and Windows
 .\}
 .SH "VERSION"
 .PP
-This man page is part of version 4\&.8\&.2 of the Samba suite\&.
+This man page is part of version 4\&.8\&.3 of the Samba suite\&.
 .SH "AUTHOR"
 .PP
 The original Samba software and related utilities were created by Andrew Tridgell\&. Samba is now developed by the Samba Team as an Open Source project similar to the way the Linux kernel is developed\&.
diff -Npur samba-4.8.2/docs/manpages/vfs_virusfilter.8 samba-4.8.3/docs/manpages/vfs_virusfilter.8
--- samba-4.8.2/docs/manpages/vfs_virusfilter.8	2018-05-16 12:15:19.000000000 +0200
+++ samba-4.8.3/docs/manpages/vfs_virusfilter.8	2018-06-26 16:49:59.000000000 +0200
@@ -2,12 +2,12 @@
 .\"     Title: vfs_virusfilter
 .\"    Author: [see the "AUTHOR" section]
 .\" Generator: DocBook XSL Stylesheets v1.79.1 <http://docbook.sf.net/>
-.\"      Date: 05/16/2018
+.\"      Date: 06/26/2018
 .\"    Manual: System Administration tools
 .\"    Source: Samba 4.8
 .\"  Language: English
 .\"
-.TH "VFS_VIRUSFILTER" "8" "05/16/2018" "Samba 4\&.8" "System Administration tools"
+.TH "VFS_VIRUSFILTER" "8" "06/26/2018" "Samba 4\&.8" "System Administration tools"
 .\" -----------------------------------------------------------------
 .\" * Define some portability stuff
 .\" -----------------------------------------------------------------
diff -Npur samba-4.8.2/docs/manpages/vfs_worm.8 samba-4.8.3/docs/manpages/vfs_worm.8
--- samba-4.8.2/docs/manpages/vfs_worm.8	2018-05-16 12:15:19.000000000 +0200
+++ samba-4.8.3/docs/manpages/vfs_worm.8	2018-06-26 16:49:59.000000000 +0200
@@ -2,12 +2,12 @@
 .\"     Title: vfs_worm
 .\"    Author: [see the "AUTHOR" section]
 .\" Generator: DocBook XSL Stylesheets v1.79.1 <http://docbook.sf.net/>
-.\"      Date: 05/16/2018
+.\"      Date: 06/26/2018
 .\"    Manual: System Administration tools
-.\"    Source: Samba 4.8.2
+.\"    Source: Samba 4.8.3
 .\"  Language: English
 .\"
-.TH "VFS_WORM" "8" "05/16/2018" "Samba 4\&.8\&.2" "System Administration tools"
+.TH "VFS_WORM" "8" "06/26/2018" "Samba 4\&.8\&.3" "System Administration tools"
 .\" -----------------------------------------------------------------
 .\" * Define some portability stuff
 .\" -----------------------------------------------------------------
@@ -68,7 +68,7 @@ Deny the write access to files and folde
 .\}
 .SH "VERSION"
 .PP
-This man page is part of version 4\&.8\&.2 of the Samba suite\&.
+This man page is part of version 4\&.8\&.3 of the Samba suite\&.
 .SH "AUTHOR"
 .PP
 The original Samba software and related utilities were created by Andrew Tridgell\&. Samba is now developed by the Samba Team as an Open Source project similar to the way the Linux kernel is developed\&.
diff -Npur samba-4.8.2/docs/manpages/vfs_xattr_tdb.8 samba-4.8.3/docs/manpages/vfs_xattr_tdb.8
--- samba-4.8.2/docs/manpages/vfs_xattr_tdb.8	2018-05-16 12:15:20.000000000 +0200
+++ samba-4.8.3/docs/manpages/vfs_xattr_tdb.8	2018-06-26 16:49:59.000000000 +0200
@@ -2,12 +2,12 @@
 .\"     Title: vfs_xattr_tdb
 .\"    Author: [see the "AUTHOR" section]
 .\" Generator: DocBook XSL Stylesheets v1.79.1 <http://docbook.sf.net/>
-.\"      Date: 05/16/2018
+.\"      Date: 06/26/2018
 .\"    Manual: System Administration tools
-.\"    Source: Samba 4.8.2
+.\"    Source: Samba 4.8.3
 .\"  Language: English
 .\"
-.TH "VFS_XATTR_TDB" "8" "05/16/2018" "Samba 4\&.8\&.2" "System Administration tools"
+.TH "VFS_XATTR_TDB" "8" "06/26/2018" "Samba 4\&.8\&.3" "System Administration tools"
 .\" -----------------------------------------------------------------
 .\" * Define some portability stuff
 .\" -----------------------------------------------------------------
diff -Npur samba-4.8.2/docs/manpages/vfs_zfsacl.8 samba-4.8.3/docs/manpages/vfs_zfsacl.8
--- samba-4.8.2/docs/manpages/vfs_zfsacl.8	2018-05-16 12:15:20.000000000 +0200
+++ samba-4.8.3/docs/manpages/vfs_zfsacl.8	2018-06-26 16:49:59.000000000 +0200
@@ -2,12 +2,12 @@
 .\"     Title: vfs_zfsacl
 .\"    Author: [see the "AUTHOR" section]
 .\" Generator: DocBook XSL Stylesheets v1.79.1 <http://docbook.sf.net/>
-.\"      Date: 05/16/2018
+.\"      Date: 06/26/2018
 .\"    Manual: System Administration tools
-.\"    Source: Samba 4.8.2
+.\"    Source: Samba 4.8.3
 .\"  Language: English
 .\"
-.TH "VFS_ZFSACL" "8" "05/16/2018" "Samba 4\&.8\&.2" "System Administration tools"
+.TH "VFS_ZFSACL" "8" "06/26/2018" "Samba 4\&.8\&.3" "System Administration tools"
 .\" -----------------------------------------------------------------
 .\" * Define some portability stuff
 .\" -----------------------------------------------------------------
@@ -215,7 +215,7 @@ A ZFS mount can be exported via Samba as
 .\}
 .SH "VERSION"
 .PP
-This man page is part of version 4\&.8\&.2 of the Samba suite\&.
+This man page is part of version 4\&.8\&.3 of the Samba suite\&.
 .SH "AUTHOR"
 .PP
 The original Samba software and related utilities were created by Andrew Tridgell\&. Samba is now developed by the Samba Team as an Open Source project similar to the way the Linux kernel is developed\&.
diff -Npur samba-4.8.2/docs/manpages/vfstest.1 samba-4.8.3/docs/manpages/vfstest.1
--- samba-4.8.2/docs/manpages/vfstest.1	2018-05-16 12:15:20.000000000 +0200
+++ samba-4.8.3/docs/manpages/vfstest.1	2018-06-26 16:50:00.000000000 +0200
@@ -2,12 +2,12 @@
 .\"     Title: vfstest
 .\"    Author: [see the "AUTHOR" section]
 .\" Generator: DocBook XSL Stylesheets v1.79.1 <http://docbook.sf.net/>
-.\"      Date: 05/16/2018
+.\"      Date: 06/26/2018
 .\"    Manual: User Commands
-.\"    Source: Samba 4.8.2
+.\"    Source: Samba 4.8.3
 .\"  Language: English
 .\"
-.TH "VFSTEST" "1" "05/16/2018" "Samba 4\&.8\&.2" "User Commands"
+.TH "VFSTEST" "1" "06/26/2018" "Samba 4\&.8\&.3" "User Commands"
 .\" -----------------------------------------------------------------
 .\" * Define some portability stuff
 .\" -----------------------------------------------------------------
@@ -807,7 +807,7 @@ exit
 .RE
 .SH "VERSION"
 .PP
-This man page is part of version 4\&.8\&.2 of the Samba suite\&.
+This man page is part of version 4\&.8\&.3 of the Samba suite\&.
 .SH "AUTHOR"
 .PP
 The original Samba software and related utilities were created by Andrew Tridgell\&. Samba is now developed by the Samba Team as an Open Source project similar to the way the Linux kernel is developed\&.
diff -Npur samba-4.8.2/docs/manpages/wbinfo.1 samba-4.8.3/docs/manpages/wbinfo.1
--- samba-4.8.2/docs/manpages/wbinfo.1	2018-05-16 12:15:20.000000000 +0200
+++ samba-4.8.3/docs/manpages/wbinfo.1	2018-06-26 16:50:00.000000000 +0200
@@ -2,12 +2,12 @@
 .\"     Title: wbinfo
 .\"    Author: [see the "AUTHOR" section]
 .\" Generator: DocBook XSL Stylesheets v1.79.1 <http://docbook.sf.net/>
-.\"      Date: 05/16/2018
+.\"      Date: 06/26/2018
 .\"    Manual: User Commands
-.\"    Source: Samba 4.8.2
+.\"    Source: Samba 4.8.3
 .\"  Language: English
 .\"
-.TH "WBINFO" "1" "05/16/2018" "Samba 4\&.8\&.2" "User Commands"
+.TH "WBINFO" "1" "06/26/2018" "Samba 4\&.8\&.3" "User Commands"
 .\" -----------------------------------------------------------------
 .\" * Define some portability stuff
 .\" -----------------------------------------------------------------
@@ -440,7 +440,7 @@ wbinfo
 will always return failure\&.
 .SH "VERSION"
 .PP
-This man page is part of version 4\&.8\&.2 of the Samba suite\&.
+This man page is part of version 4\&.8\&.3 of the Samba suite\&.
 .SH "SEE ALSO"
 .PP
 \fBwinbindd\fR(8)
diff -Npur samba-4.8.2/docs/manpages/winbind_krb5_locator.7 samba-4.8.3/docs/manpages/winbind_krb5_locator.7
--- samba-4.8.2/docs/manpages/winbind_krb5_locator.7	2018-05-16 12:15:20.000000000 +0200
+++ samba-4.8.3/docs/manpages/winbind_krb5_locator.7	2018-06-26 16:50:00.000000000 +0200
@@ -2,12 +2,12 @@
 .\"     Title: winbind_krb5_locator
 .\"    Author: [see the "AUTHOR" section]
 .\" Generator: DocBook XSL Stylesheets v1.79.1 <http://docbook.sf.net/>
-.\"      Date: 05/16/2018
+.\"      Date: 06/26/2018
 .\"    Manual: 7
-.\"    Source: Samba 4.8.2
+.\"    Source: Samba 4.8.3
 .\"  Language: English
 .\"
-.TH "WINBIND_KRB5_LOCATOR" "7" "05/16/2018" "Samba 4\&.8\&.2" "7"
+.TH "WINBIND_KRB5_LOCATOR" "7" "06/26/2018" "Samba 4\&.8\&.3" "7"
 .\" -----------------------------------------------------------------
 .\" * Define some portability stuff
 .\" -----------------------------------------------------------------
@@ -57,7 +57,7 @@ After copying the locator plugin to the
 /etc/krb5\&.conf\&.
 .SH "VERSION"
 .PP
-This man page is part of version 4\&.8\&.2 of the Samba suite\&.
+This man page is part of version 4\&.8\&.3 of the Samba suite\&.
 .SH "AUTHOR"
 .PP
 The original Samba software and related utilities were created by Andrew Tridgell\&. Samba is now developed by the Samba Team as an Open Source project similar to the way the Linux kernel is developed\&.
diff -Npur samba-4.8.2/docs/manpages/winbindd.8 samba-4.8.3/docs/manpages/winbindd.8
--- samba-4.8.2/docs/manpages/winbindd.8	2018-05-16 12:15:21.000000000 +0200
+++ samba-4.8.3/docs/manpages/winbindd.8	2018-06-26 16:50:00.000000000 +0200
@@ -2,12 +2,12 @@
 .\"     Title: winbindd
 .\"    Author: [see the "AUTHOR" section]
 .\" Generator: DocBook XSL Stylesheets v1.79.1 <http://docbook.sf.net/>
-.\"      Date: 05/16/2018
+.\"      Date: 06/26/2018
 .\"    Manual: System Administration tools
-.\"    Source: Samba 4.8.2
+.\"    Source: Samba 4.8.3
 .\"  Language: English
 .\"
-.TH "WINBINDD" "8" "05/16/2018" "Samba 4\&.8\&.2" "System Administration tools"
+.TH "WINBINDD" "8" "06/26/2018" "Samba 4\&.8\&.3" "System Administration tools"
 .\" -----------------------------------------------------------------
 .\" * Define some portability stuff
 .\" -----------------------------------------------------------------
@@ -579,7 +579,7 @@ Storage for cached user and group inform
 .RE
 .SH "VERSION"
 .PP
-This man page is part of version 4\&.8\&.2 of the Samba suite\&.
+This man page is part of version 4\&.8\&.3 of the Samba suite\&.
 .SH "SEE ALSO"
 .PP
 nsswitch\&.conf(5),
diff -Npur samba-4.8.2/lib/krb5_wrap/krb5_samba.c samba-4.8.3/lib/krb5_wrap/krb5_samba.c
--- samba-4.8.2/lib/krb5_wrap/krb5_samba.c	2018-01-17 09:08:39.000000000 +0100
+++ samba-4.8.3/lib/krb5_wrap/krb5_samba.c	2018-06-26 16:42:46.000000000 +0200
@@ -1549,7 +1549,7 @@ krb5_error_code smb_krb5_kt_seek_and_del
 		}
 
 		if (!flush &&
-		    (kt_entry.vno == kvno) &&
+		    ((kt_entry.vno & 0xff) == (kvno & 0xff)) &&
 		    (kt_entry_enctype != enctype))
 		{
 			DEBUG(5, (__location__ ": Saving entry with kvno [%d] "
diff -Npur samba-4.8.2/lib/ldb/ABI/ldb-1.3.4.sigs samba-4.8.3/lib/ldb/ABI/ldb-1.3.4.sigs
--- samba-4.8.2/lib/ldb/ABI/ldb-1.3.4.sigs	1970-01-01 01:00:00.000000000 +0100
+++ samba-4.8.3/lib/ldb/ABI/ldb-1.3.4.sigs	2018-06-26 16:42:46.000000000 +0200
@@ -0,0 +1,279 @@
+ldb_add: int (struct ldb_context *, const struct ldb_message *)
+ldb_any_comparison: int (struct ldb_context *, void *, ldb_attr_handler_t, const struct ldb_val *, const struct ldb_val *)
+ldb_asprintf_errstring: void (struct ldb_context *, const char *, ...)
+ldb_attr_casefold: char *(TALLOC_CTX *, const char *)
+ldb_attr_dn: int (const char *)
+ldb_attr_in_list: int (const char * const *, const char *)
+ldb_attr_list_copy: const char **(TALLOC_CTX *, const char * const *)
+ldb_attr_list_copy_add: const char **(TALLOC_CTX *, const char * const *, const char *)
+ldb_base64_decode: int (char *)
+ldb_base64_encode: char *(TALLOC_CTX *, const char *, int)
+ldb_binary_decode: struct ldb_val (TALLOC_CTX *, const char *)
+ldb_binary_encode: char *(TALLOC_CTX *, struct ldb_val)
+ldb_binary_encode_string: char *(TALLOC_CTX *, const char *)
+ldb_build_add_req: int (struct ldb_request **, struct ldb_context *, TALLOC_CTX *, const struct ldb_message *, struct ldb_control **, void *, ldb_request_callback_t, struct ldb_request *)
+ldb_build_del_req: int (struct ldb_request **, struct ldb_context *, TALLOC_CTX *, struct ldb_dn *, struct ldb_control **, void *, ldb_request_callback_t, struct ldb_request *)
+ldb_build_extended_req: int (struct ldb_request **, struct ldb_context *, TALLOC_CTX *, const char *, void *, struct ldb_control **, void *, ldb_request_callback_t, struct ldb_request *)
+ldb_build_mod_req: int (struct ldb_request **, struct ldb_context *, TALLOC_CTX *, const struct ldb_message *, struct ldb_control **, void *, ldb_request_callback_t, struct ldb_request *)
+ldb_build_rename_req: int (struct ldb_request **, struct ldb_context *, TALLOC_CTX *, struct ldb_dn *, struct ldb_dn *, struct ldb_control **, void *, ldb_request_callback_t, struct ldb_request *)
+ldb_build_search_req: int (struct ldb_request **, struct ldb_context *, TALLOC_CTX *, struct ldb_dn *, enum ldb_scope, const char *, const char * const *, struct ldb_control **, void *, ldb_request_callback_t, struct ldb_request *)
+ldb_build_search_req_ex: int (struct ldb_request **, struct ldb_context *, TALLOC_CTX *, struct ldb_dn *, enum ldb_scope, struct ldb_parse_tree *, const char * const *, struct ldb_control **, void *, ldb_request_callback_t, struct ldb_request *)
+ldb_casefold: char *(struct ldb_context *, TALLOC_CTX *, const char *, size_t)
+ldb_casefold_default: char *(void *, TALLOC_CTX *, const char *, size_t)
+ldb_check_critical_controls: int (struct ldb_control **)
+ldb_comparison_binary: int (struct ldb_context *, void *, const struct ldb_val *, const struct ldb_val *)
+ldb_comparison_fold: int (struct ldb_context *, void *, const struct ldb_val *, const struct ldb_val *)
+ldb_connect: int (struct ldb_context *, const char *, unsigned int, const char **)
+ldb_control_to_string: char *(TALLOC_CTX *, const struct ldb_control *)
+ldb_controls_except_specified: struct ldb_control **(struct ldb_control **, TALLOC_CTX *, struct ldb_control *)
+ldb_debug: void (struct ldb_context *, enum ldb_debug_level, const char *, ...)
+ldb_debug_add: void (struct ldb_context *, const char *, ...)
+ldb_debug_end: void (struct ldb_context *, enum ldb_debug_level)
+ldb_debug_set: void (struct ldb_context *, enum ldb_debug_level, const char *, ...)
+ldb_delete: int (struct ldb_context *, struct ldb_dn *)
+ldb_dn_add_base: bool (struct ldb_dn *, struct ldb_dn *)
+ldb_dn_add_base_fmt: bool (struct ldb_dn *, const char *, ...)
+ldb_dn_add_child: bool (struct ldb_dn *, struct ldb_dn *)
+ldb_dn_add_child_fmt: bool (struct ldb_dn *, const char *, ...)
+ldb_dn_alloc_casefold: char *(TALLOC_CTX *, struct ldb_dn *)
+ldb_dn_alloc_linearized: char *(TALLOC_CTX *, struct ldb_dn *)
+ldb_dn_canonical_ex_string: char *(TALLOC_CTX *, struct ldb_dn *)
+ldb_dn_canonical_string: char *(TALLOC_CTX *, struct ldb_dn *)
+ldb_dn_check_local: bool (struct ldb_module *, struct ldb_dn *)
+ldb_dn_check_special: bool (struct ldb_dn *, const char *)
+ldb_dn_compare: int (struct ldb_dn *, struct ldb_dn *)
+ldb_dn_compare_base: int (struct ldb_dn *, struct ldb_dn *)
+ldb_dn_copy: struct ldb_dn *(TALLOC_CTX *, struct ldb_dn *)
+ldb_dn_escape_value: char *(TALLOC_CTX *, struct ldb_val)
+ldb_dn_extended_add_syntax: int (struct ldb_context *, unsigned int, const struct ldb_dn_extended_syntax *)
+ldb_dn_extended_filter: void (struct ldb_dn *, const char * const *)
+ldb_dn_extended_syntax_by_name: const struct ldb_dn_extended_syntax *(struct ldb_context *, const char *)
+ldb_dn_from_ldb_val: struct ldb_dn *(TALLOC_CTX *, struct ldb_context *, const struct ldb_val *)
+ldb_dn_get_casefold: const char *(struct ldb_dn *)
+ldb_dn_get_comp_num: int (struct ldb_dn *)
+ldb_dn_get_component_name: const char *(struct ldb_dn *, unsigned int)
+ldb_dn_get_component_val: const struct ldb_val *(struct ldb_dn *, unsigned int)
+ldb_dn_get_extended_comp_num: int (struct ldb_dn *)
+ldb_dn_get_extended_component: const struct ldb_val *(struct ldb_dn *, const char *)
+ldb_dn_get_extended_linearized: char *(TALLOC_CTX *, struct ldb_dn *, int)
+ldb_dn_get_ldb_context: struct ldb_context *(struct ldb_dn *)
+ldb_dn_get_linearized: const char *(struct ldb_dn *)
+ldb_dn_get_parent: struct ldb_dn *(TALLOC_CTX *, struct ldb_dn *)
+ldb_dn_get_rdn_name: const char *(struct ldb_dn *)
+ldb_dn_get_rdn_val: const struct ldb_val *(struct ldb_dn *)
+ldb_dn_has_extended: bool (struct ldb_dn *)
+ldb_dn_is_null: bool (struct ldb_dn *)
+ldb_dn_is_special: bool (struct ldb_dn *)
+ldb_dn_is_valid: bool (struct ldb_dn *)
+ldb_dn_map_local: struct ldb_dn *(struct ldb_module *, void *, struct ldb_dn *)
+ldb_dn_map_rebase_remote: struct ldb_dn *(struct ldb_module *, void *, struct ldb_dn *)
+ldb_dn_map_remote: struct ldb_dn *(struct ldb_module *, void *, struct ldb_dn *)
+ldb_dn_minimise: bool (struct ldb_dn *)
+ldb_dn_new: struct ldb_dn *(TALLOC_CTX *, struct ldb_context *, const char *)
+ldb_dn_new_fmt: struct ldb_dn *(TALLOC_CTX *, struct ldb_context *, const char *, ...)
+ldb_dn_remove_base_components: bool (struct ldb_dn *, unsigned int)
+ldb_dn_remove_child_components: bool (struct ldb_dn *, unsigned int)
+ldb_dn_remove_extended_components: void (struct ldb_dn *)
+ldb_dn_replace_components: bool (struct ldb_dn *, struct ldb_dn *)
+ldb_dn_set_component: int (struct ldb_dn *, int, const char *, const struct ldb_val)
+ldb_dn_set_extended_component: int (struct ldb_dn *, const char *, const struct ldb_val *)
+ldb_dn_update_components: int (struct ldb_dn *, const struct ldb_dn *)
+ldb_dn_validate: bool (struct ldb_dn *)
+ldb_dump_results: void (struct ldb_context *, struct ldb_result *, FILE *)
+ldb_error_at: int (struct ldb_context *, int, const char *, const char *, int)
+ldb_errstring: const char *(struct ldb_context *)
+ldb_extended: int (struct ldb_context *, const char *, void *, struct ldb_result **)
+ldb_extended_default_callback: int (struct ldb_request *, struct ldb_reply *)
+ldb_filter_from_tree: char *(TALLOC_CTX *, const struct ldb_parse_tree *)
+ldb_get_config_basedn: struct ldb_dn *(struct ldb_context *)
+ldb_get_create_perms: unsigned int (struct ldb_context *)
+ldb_get_default_basedn: struct ldb_dn *(struct ldb_context *)
+ldb_get_event_context: struct tevent_context *(struct ldb_context *)
+ldb_get_flags: unsigned int (struct ldb_context *)
+ldb_get_opaque: void *(struct ldb_context *, const char *)
+ldb_get_root_basedn: struct ldb_dn *(struct ldb_context *)
+ldb_get_schema_basedn: struct ldb_dn *(struct ldb_context *)
+ldb_global_init: int (void)
+ldb_handle_get_event_context: struct tevent_context *(struct ldb_handle *)
+ldb_handle_new: struct ldb_handle *(TALLOC_CTX *, struct ldb_context *)
+ldb_handle_use_global_event_context: void (struct ldb_handle *)
+ldb_handler_copy: int (struct ldb_context *, void *, const struct ldb_val *, struct ldb_val *)
+ldb_handler_fold: int (struct ldb_context *, void *, const struct ldb_val *, struct ldb_val *)
+ldb_init: struct ldb_context *(TALLOC_CTX *, struct tevent_context *)
+ldb_ldif_message_redacted_string: char *(struct ldb_context *, TALLOC_CTX *, enum ldb_changetype, const struct ldb_message *)
+ldb_ldif_message_string: char *(struct ldb_context *, TALLOC_CTX *, enum ldb_changetype, const struct ldb_message *)
+ldb_ldif_parse_modrdn: int (struct ldb_context *, const struct ldb_ldif *, TALLOC_CTX *, struct ldb_dn **, struct ldb_dn **, bool *, struct ldb_dn **, struct ldb_dn **)
+ldb_ldif_read: struct ldb_ldif *(struct ldb_context *, int (*)(void *), void *)
+ldb_ldif_read_file: struct ldb_ldif *(struct ldb_context *, FILE *)
+ldb_ldif_read_file_state: struct ldb_ldif *(struct ldb_context *, struct ldif_read_file_state *)
+ldb_ldif_read_free: void (struct ldb_context *, struct ldb_ldif *)
+ldb_ldif_read_string: struct ldb_ldif *(struct ldb_context *, const char **)
+ldb_ldif_write: int (struct ldb_context *, int (*)(void *, const char *, ...), void *, const struct ldb_ldif *)
+ldb_ldif_write_file: int (struct ldb_context *, FILE *, const struct ldb_ldif *)
+ldb_ldif_write_redacted_trace_string: char *(struct ldb_context *, TALLOC_CTX *, const struct ldb_ldif *)
+ldb_ldif_write_string: char *(struct ldb_context *, TALLOC_CTX *, const struct ldb_ldif *)
+ldb_load_modules: int (struct ldb_context *, const char **)
+ldb_map_add: int (struct ldb_module *, struct ldb_request *)
+ldb_map_delete: int (struct ldb_module *, struct ldb_request *)
+ldb_map_init: int (struct ldb_module *, const struct ldb_map_attribute *, const struct ldb_map_objectclass *, const char * const *, const char *, const char *)
+ldb_map_modify: int (struct ldb_module *, struct ldb_request *)
+ldb_map_rename: int (struct ldb_module *, struct ldb_request *)
+ldb_map_search: int (struct ldb_module *, struct ldb_request *)
+ldb_match_message: int (struct ldb_context *, const struct ldb_message *, const struct ldb_parse_tree *, enum ldb_scope, bool *)
+ldb_match_msg: int (struct ldb_context *, const struct ldb_message *, const struct ldb_parse_tree *, struct ldb_dn *, enum ldb_scope)
+ldb_match_msg_error: int (struct ldb_context *, const struct ldb_message *, const struct ldb_parse_tree *, struct ldb_dn *, enum ldb_scope, bool *)
+ldb_match_msg_objectclass: int (const struct ldb_message *, const char *)
+ldb_mod_register_control: int (struct ldb_module *, const char *)
+ldb_modify: int (struct ldb_context *, const struct ldb_message *)
+ldb_modify_default_callback: int (struct ldb_request *, struct ldb_reply *)
+ldb_module_call_chain: char *(struct ldb_request *, TALLOC_CTX *)
+ldb_module_connect_backend: int (struct ldb_context *, const char *, const char **, struct ldb_module **)
+ldb_module_done: int (struct ldb_request *, struct ldb_control **, struct ldb_extended *, int)
+ldb_module_flags: uint32_t (struct ldb_context *)
+ldb_module_get_ctx: struct ldb_context *(struct ldb_module *)
+ldb_module_get_name: const char *(struct ldb_module *)
+ldb_module_get_ops: const struct ldb_module_ops *(struct ldb_module *)
+ldb_module_get_private: void *(struct ldb_module *)
+ldb_module_init_chain: int (struct ldb_context *, struct ldb_module *)
+ldb_module_load_list: int (struct ldb_context *, const char **, struct ldb_module *, struct ldb_module **)
+ldb_module_new: struct ldb_module *(TALLOC_CTX *, struct ldb_context *, const char *, const struct ldb_module_ops *)
+ldb_module_next: struct ldb_module *(struct ldb_module *)
+ldb_module_popt_options: struct poptOption **(struct ldb_context *)
+ldb_module_send_entry: int (struct ldb_request *, struct ldb_message *, struct ldb_control **)
+ldb_module_send_referral: int (struct ldb_request *, char *)
+ldb_module_set_next: void (struct ldb_module *, struct ldb_module *)
+ldb_module_set_private: void (struct ldb_module *, void *)
+ldb_modules_hook: int (struct ldb_context *, enum ldb_module_hook_type)
+ldb_modules_list_from_string: const char **(struct ldb_context *, TALLOC_CTX *, const char *)
+ldb_modules_load: int (const char *, const char *)
+ldb_msg_add: int (struct ldb_message *, const struct ldb_message_element *, int)
+ldb_msg_add_empty: int (struct ldb_message *, const char *, int, struct ldb_message_element **)
+ldb_msg_add_fmt: int (struct ldb_message *, const char *, const char *, ...)
+ldb_msg_add_linearized_dn: int (struct ldb_message *, const char *, struct ldb_dn *)
+ldb_msg_add_steal_string: int (struct ldb_message *, const char *, char *)
+ldb_msg_add_steal_value: int (struct ldb_message *, const char *, struct ldb_val *)
+ldb_msg_add_string: int (struct ldb_message *, const char *, const char *)
+ldb_msg_add_value: int (struct ldb_message *, const char *, const struct ldb_val *, struct ldb_message_element **)
+ldb_msg_canonicalize: struct ldb_message *(struct ldb_context *, const struct ldb_message *)
+ldb_msg_check_string_attribute: int (const struct ldb_message *, const char *, const char *)
+ldb_msg_copy: struct ldb_message *(TALLOC_CTX *, const struct ldb_message *)
+ldb_msg_copy_attr: int (struct ldb_message *, const char *, const char *)
+ldb_msg_copy_shallow: struct ldb_message *(TALLOC_CTX *, const struct ldb_message *)
+ldb_msg_diff: struct ldb_message *(struct ldb_context *, struct ldb_message *, struct ldb_message *)
+ldb_msg_difference: int (struct ldb_context *, TALLOC_CTX *, struct ldb_message *, struct ldb_message *, struct ldb_message **)
+ldb_msg_element_compare: int (struct ldb_message_element *, struct ldb_message_element *)
+ldb_msg_element_compare_name: int (struct ldb_message_element *, struct ldb_message_element *)
+ldb_msg_element_equal_ordered: bool (const struct ldb_message_element *, const struct ldb_message_element *)
+ldb_msg_find_attr_as_bool: int (const struct ldb_message *, const char *, int)
+ldb_msg_find_attr_as_dn: struct ldb_dn *(struct ldb_context *, TALLOC_CTX *, const struct ldb_message *, const char *)
+ldb_msg_find_attr_as_double: double (const struct ldb_message *, const char *, double)
+ldb_msg_find_attr_as_int: int (const struct ldb_message *, const char *, int)
+ldb_msg_find_attr_as_int64: int64_t (const struct ldb_message *, const char *, int64_t)
+ldb_msg_find_attr_as_string: const char *(const struct ldb_message *, const char *, const char *)
+ldb_msg_find_attr_as_uint: unsigned int (const struct ldb_message *, const char *, unsigned int)
+ldb_msg_find_attr_as_uint64: uint64_t (const struct ldb_message *, const char *, uint64_t)
+ldb_msg_find_common_values: int (struct ldb_context *, TALLOC_CTX *, struct ldb_message_element *, struct ldb_message_element *, uint32_t)
+ldb_msg_find_duplicate_val: int (struct ldb_context *, TALLOC_CTX *, const struct ldb_message_element *, struct ldb_val **, uint32_t)
+ldb_msg_find_element: struct ldb_message_element *(const struct ldb_message *, const char *)
+ldb_msg_find_ldb_val: const struct ldb_val *(const struct ldb_message *, const char *)
+ldb_msg_find_val: struct ldb_val *(const struct ldb_message_element *, struct ldb_val *)
+ldb_msg_new: struct ldb_message *(TALLOC_CTX *)
+ldb_msg_normalize: int (struct ldb_context *, TALLOC_CTX *, const struct ldb_message *, struct ldb_message **)
+ldb_msg_remove_attr: void (struct ldb_message *, const char *)
+ldb_msg_remove_element: void (struct ldb_message *, struct ldb_message_element *)
+ldb_msg_rename_attr: int (struct ldb_message *, const char *, const char *)
+ldb_msg_sanity_check: int (struct ldb_context *, const struct ldb_message *)
+ldb_msg_sort_elements: void (struct ldb_message *)
+ldb_next_del_trans: int (struct ldb_module *)
+ldb_next_end_trans: int (struct ldb_module *)
+ldb_next_init: int (struct ldb_module *)
+ldb_next_prepare_commit: int (struct ldb_module *)
+ldb_next_read_lock: int (struct ldb_module *)
+ldb_next_read_unlock: int (struct ldb_module *)
+ldb_next_remote_request: int (struct ldb_module *, struct ldb_request *)
+ldb_next_request: int (struct ldb_module *, struct ldb_request *)
+ldb_next_start_trans: int (struct ldb_module *)
+ldb_op_default_callback: int (struct ldb_request *, struct ldb_reply *)
+ldb_options_find: const char *(struct ldb_context *, const char **, const char *)
+ldb_pack_data: int (struct ldb_context *, const struct ldb_message *, struct ldb_val *)
+ldb_parse_control_from_string: struct ldb_control *(struct ldb_context *, TALLOC_CTX *, const char *)
+ldb_parse_control_strings: struct ldb_control **(struct ldb_context *, TALLOC_CTX *, const char **)
+ldb_parse_tree: struct ldb_parse_tree *(TALLOC_CTX *, const char *)
+ldb_parse_tree_attr_replace: void (struct ldb_parse_tree *, const char *, const char *)
+ldb_parse_tree_copy_shallow: struct ldb_parse_tree *(TALLOC_CTX *, const struct ldb_parse_tree *)
+ldb_parse_tree_walk: int (struct ldb_parse_tree *, int (*)(struct ldb_parse_tree *, void *), void *)
+ldb_qsort: void (void * const, size_t, size_t, void *, ldb_qsort_cmp_fn_t)
+ldb_register_backend: int (const char *, ldb_connect_fn, bool)
+ldb_register_extended_match_rule: int (struct ldb_context *, const struct ldb_extended_match_rule *)
+ldb_register_hook: int (ldb_hook_fn)
+ldb_register_module: int (const struct ldb_module_ops *)
+ldb_rename: int (struct ldb_context *, struct ldb_dn *, struct ldb_dn *)
+ldb_reply_add_control: int (struct ldb_reply *, const char *, bool, void *)
+ldb_reply_get_control: struct ldb_control *(struct ldb_reply *, const char *)
+ldb_req_get_custom_flags: uint32_t (struct ldb_request *)
+ldb_req_is_untrusted: bool (struct ldb_request *)
+ldb_req_location: const char *(struct ldb_request *)
+ldb_req_mark_trusted: void (struct ldb_request *)
+ldb_req_mark_untrusted: void (struct ldb_request *)
+ldb_req_set_custom_flags: void (struct ldb_request *, uint32_t)
+ldb_req_set_location: void (struct ldb_request *, const char *)
+ldb_request: int (struct ldb_context *, struct ldb_request *)
+ldb_request_add_control: int (struct ldb_request *, const char *, bool, void *)
+ldb_request_done: int (struct ldb_request *, int)
+ldb_request_get_control: struct ldb_control *(struct ldb_request *, const char *)
+ldb_request_get_status: int (struct ldb_request *)
+ldb_request_replace_control: int (struct ldb_request *, const char *, bool, void *)
+ldb_request_set_state: void (struct ldb_request *, int)
+ldb_reset_err_string: void (struct ldb_context *)
+ldb_save_controls: int (struct ldb_control *, struct ldb_request *, struct ldb_control ***)
+ldb_schema_attribute_add: int (struct ldb_context *, const char *, unsigned int, const char *)
+ldb_schema_attribute_add_with_syntax: int (struct ldb_context *, const char *, unsigned int, const struct ldb_schema_syntax *)
+ldb_schema_attribute_by_name: const struct ldb_schema_attribute *(struct ldb_context *, const char *)
+ldb_schema_attribute_fill_with_syntax: int (struct ldb_context *, TALLOC_CTX *, const char *, unsigned int, const struct ldb_schema_syntax *, struct ldb_schema_attribute *)
+ldb_schema_attribute_remove: void (struct ldb_context *, const char *)
+ldb_schema_attribute_remove_flagged: void (struct ldb_context *, unsigned int)
+ldb_schema_attribute_set_override_handler: void (struct ldb_context *, ldb_attribute_handler_override_fn_t, void *)
+ldb_schema_set_override_GUID_index: void (struct ldb_context *, const char *, const char *)
+ldb_schema_set_override_indexlist: void (struct ldb_context *, bool)
+ldb_search: int (struct ldb_context *, TALLOC_CTX *, struct ldb_result **, struct ldb_dn *, enum ldb_scope, const char * const *, const char *, ...)
+ldb_search_default_callback: int (struct ldb_request *, struct ldb_reply *)
+ldb_sequence_number: int (struct ldb_context *, enum ldb_sequence_type, uint64_t *)
+ldb_set_create_perms: void (struct ldb_context *, unsigned int)
+ldb_set_debug: int (struct ldb_context *, void (*)(void *, enum ldb_debug_level, const char *, va_list), void *)
+ldb_set_debug_stderr: int (struct ldb_context *)
+ldb_set_default_dns: void (struct ldb_context *)
+ldb_set_errstring: void (struct ldb_context *, const char *)
+ldb_set_event_context: void (struct ldb_context *, struct tevent_context *)
+ldb_set_flags: void (struct ldb_context *, unsigned int)
+ldb_set_modules_dir: void (struct ldb_context *, const char *)
+ldb_set_opaque: int (struct ldb_context *, const char *, void *)
+ldb_set_require_private_event_context: void (struct ldb_context *)
+ldb_set_timeout: int (struct ldb_context *, struct ldb_request *, int)
+ldb_set_timeout_from_prev_req: int (struct ldb_context *, struct ldb_request *, struct ldb_request *)
+ldb_set_utf8_default: void (struct ldb_context *)
+ldb_set_utf8_fns: void (struct ldb_context *, void *, char *(*)(void *, void *, const char *, size_t))
+ldb_setup_wellknown_attributes: int (struct ldb_context *)
+ldb_should_b64_encode: int (struct ldb_context *, const struct ldb_val *)
+ldb_standard_syntax_by_name: const struct ldb_schema_syntax *(struct ldb_context *, const char *)
+ldb_strerror: const char *(int)
+ldb_string_to_time: time_t (const char *)
+ldb_string_utc_to_time: time_t (const char *)
+ldb_timestring: char *(TALLOC_CTX *, time_t)
+ldb_timestring_utc: char *(TALLOC_CTX *, time_t)
+ldb_transaction_cancel: int (struct ldb_context *)
+ldb_transaction_cancel_noerr: int (struct ldb_context *)
+ldb_transaction_commit: int (struct ldb_context *)
+ldb_transaction_prepare_commit: int (struct ldb_context *)
+ldb_transaction_start: int (struct ldb_context *)
+ldb_unpack_data: int (struct ldb_context *, const struct ldb_val *, struct ldb_message *)
+ldb_unpack_data_only_attr_list: int (struct ldb_context *, const struct ldb_val *, struct ldb_message *, const char * const *, unsigned int, unsigned int *)
+ldb_unpack_data_only_attr_list_flags: int (struct ldb_context *, const struct ldb_val *, struct ldb_message *, const char * const *, unsigned int, unsigned int, unsigned int *)
+ldb_val_dup: struct ldb_val (TALLOC_CTX *, const struct ldb_val *)
+ldb_val_equal_exact: int (const struct ldb_val *, const struct ldb_val *)
+ldb_val_map_local: struct ldb_val (struct ldb_module *, void *, const struct ldb_map_attribute *, const struct ldb_val *)
+ldb_val_map_remote: struct ldb_val (struct ldb_module *, void *, const struct ldb_map_attribute *, const struct ldb_val *)
+ldb_val_string_cmp: int (const struct ldb_val *, const char *)
+ldb_val_to_time: int (const struct ldb_val *, time_t *)
+ldb_valid_attr_name: int (const char *)
+ldb_vdebug: void (struct ldb_context *, enum ldb_debug_level, const char *, va_list)
+ldb_wait: int (struct ldb_handle *, enum ldb_wait_type)
diff -Npur samba-4.8.2/lib/ldb/ABI/pyldb-util-1.3.4.sigs samba-4.8.3/lib/ldb/ABI/pyldb-util-1.3.4.sigs
--- samba-4.8.2/lib/ldb/ABI/pyldb-util-1.3.4.sigs	1970-01-01 01:00:00.000000000 +0100
+++ samba-4.8.3/lib/ldb/ABI/pyldb-util-1.3.4.sigs	2018-06-26 16:42:46.000000000 +0200
@@ -0,0 +1,2 @@
+pyldb_Dn_FromDn: PyObject *(struct ldb_dn *)
+pyldb_Object_AsDn: bool (TALLOC_CTX *, PyObject *, struct ldb_context *, struct ldb_dn **)
diff -Npur samba-4.8.2/lib/ldb/ABI/pyldb-util.py3-1.3.4.sigs samba-4.8.3/lib/ldb/ABI/pyldb-util.py3-1.3.4.sigs
--- samba-4.8.2/lib/ldb/ABI/pyldb-util.py3-1.3.4.sigs	1970-01-01 01:00:00.000000000 +0100
+++ samba-4.8.3/lib/ldb/ABI/pyldb-util.py3-1.3.4.sigs	2018-06-26 16:42:46.000000000 +0200
@@ -0,0 +1,2 @@
+pyldb_Dn_FromDn: PyObject *(struct ldb_dn *)
+pyldb_Object_AsDn: bool (TALLOC_CTX *, PyObject *, struct ldb_context *, struct ldb_dn **)
diff -Npur samba-4.8.2/lib/ldb/ldb_tdb/ldb_index.c samba-4.8.3/lib/ldb/ldb_tdb/ldb_index.c
--- samba-4.8.2/lib/ldb/ldb_tdb/ldb_index.c	2018-05-16 12:09:25.000000000 +0200
+++ samba-4.8.3/lib/ldb/ldb_tdb/ldb_index.c	2018-06-26 16:42:46.000000000 +0200
@@ -403,6 +403,7 @@ normal_index:
 				      "expected %d for %s",
 				      version, LTDB_INDEXING_VERSION,
 				      ldb_dn_get_linearized(dn));
+			talloc_free(msg);
 			return LDB_ERR_OPERATIONS_ERROR;
 		}
 
@@ -420,19 +421,26 @@ normal_index:
 				      "expected %d for %s",
 				      version, LTDB_GUID_INDEXING_VERSION,
 				      ldb_dn_get_linearized(dn));
+			talloc_free(msg);
 			return LDB_ERR_OPERATIONS_ERROR;
 		}
 
 		if (el->num_values != 1) {
+			talloc_free(msg);
 			return LDB_ERR_OPERATIONS_ERROR;
 		}
 
 		if ((el->values[0].length % LTDB_GUID_SIZE) != 0) {
+			talloc_free(msg);
 			return LDB_ERR_OPERATIONS_ERROR;
 		}
 
 		list->count = el->values[0].length / LTDB_GUID_SIZE;
 		list->dn = talloc_array(list, struct ldb_val, list->count);
+		if (list->dn == NULL) {
+			talloc_free(msg);
+			return LDB_ERR_OPERATIONS_ERROR;
+		}
 
 		/*
 		 * The actual data is on msg, due to
@@ -523,9 +531,9 @@ static int ltdb_dn_list_store_full(struc
 	if (list->count == 0) {
 		ret = ltdb_delete_noindex(module, msg);
 		if (ret == LDB_ERR_NO_SUCH_OBJECT) {
-			talloc_free(msg);
-			return LDB_SUCCESS;
+			ret = LDB_SUCCESS;
 		}
+		talloc_free(msg);
 		return ret;
 	}
 
@@ -621,6 +629,9 @@ static int ltdb_dn_list_store(struct ldb
 	}
 
 	key.dptr = discard_const_p(unsigned char, ldb_dn_get_linearized(dn));
+	if (key.dptr == NULL) {
+		return LDB_ERR_OPERATIONS_ERROR;
+	}
 	key.dsize = strlen((char *)key.dptr);
 
 	rec = tdb_fetch(ltdb->idxptr->itdb, key);
@@ -1120,6 +1131,9 @@ static bool list_union(struct ldb_contex
 	/*
 	 * Sort the lists (if not in GUID DN mode) so we can do
 	 * the de-duplication during the merge
+	 *
+	 * NOTE: This can sort the in-memory index values, as list or
+	 * list2 might not be a copy!
 	 */
 	ltdb_dn_list_sort(ltdb, list);
 	ltdb_dn_list_sort(ltdb, list2);
@@ -1522,27 +1536,64 @@ static int ltdb_index_filter(struct ltdb
 			     struct ltdb_context *ac,
 			     uint32_t *match_count)
 {
-	struct ldb_context *ldb;
+	struct ldb_context *ldb = ldb_module_get_ctx(ac->module);
 	struct ldb_message *msg;
 	struct ldb_message *filtered_msg;
 	unsigned int i;
+	unsigned int num_keys = 0;
 	uint8_t previous_guid_key[LTDB_GUID_KEY_SIZE] = {};
+	TDB_DATA *keys = NULL;
 
-	ldb = ldb_module_get_ctx(ac->module);
+	/*
+	 * We have to allocate the key list (rather than just walk the
+	 * caller supplied list) as the callback could change the list
+	 * (by modifying an indexed attribute hosted in the in-memory
+	 * index cache!)
+	 */
+	keys = talloc_array(ac, TDB_DATA, dn_list->count);
+	if (keys == NULL) {
+		return ldb_module_oom(ac->module);
+	}
+
+	if (ltdb->cache->GUID_index_attribute != NULL) {
+		/*
+		 * We speculate that the keys will be GUID based and so
+		 * pre-fill in enough space for a GUID (avoiding a pile of
+		 * small allocations)
+		 */
+		struct guid_tdb_key {
+			uint8_t guid_key[LTDB_GUID_KEY_SIZE];
+		} *key_values = NULL;
+
+		key_values = talloc_array(keys,
+					  struct guid_tdb_key,
+					  dn_list->count);
+
+		if (key_values == NULL) {
+			talloc_free(keys);
+			return ldb_module_oom(ac->module);
+		}
+		for (i = 0; i < dn_list->count; i++) {
+			keys[i].dptr = key_values[i].guid_key;
+			keys[i].dsize = sizeof(key_values[i].guid_key);
+		}
+	} else {
+		for (i = 0; i < dn_list->count; i++) {
+			keys[i].dptr = NULL;
+			keys[i].dsize = 0;
+		}
+	}
 
 	for (i = 0; i < dn_list->count; i++) {
-		uint8_t guid_key[LTDB_GUID_KEY_SIZE];
-		TDB_DATA tdb_key = {
-			.dptr = guid_key,
-			.dsize = sizeof(guid_key)
-		};
 		int ret;
-		bool matched;
 
-		ret = ltdb_idx_to_key(ac->module, ltdb,
-				      ac, &dn_list->dn[i],
-				      &tdb_key);
+		ret = ltdb_idx_to_key(ac->module,
+				      ltdb,
+				      keys,
+				      &dn_list->dn[i],
+				      &keys[num_keys]);
 		if (ret != LDB_SUCCESS) {
+			talloc_free(keys);
 			return ret;
 		}
 
@@ -1558,36 +1609,50 @@ static int ltdb_index_filter(struct ltdb
 			 * LDB_FLAG_INTERNAL_DISABLE_SINGLE_VALUE_CHECK
 			 */
 
-			if (memcmp(previous_guid_key, tdb_key.dptr,
+			if (memcmp(previous_guid_key,
+				   keys[num_keys].dptr,
 				   sizeof(previous_guid_key)) == 0) {
 				continue;
 			}
 
-			memcpy(previous_guid_key, tdb_key.dptr,
+			memcpy(previous_guid_key,
+			       keys[num_keys].dptr,
 			       sizeof(previous_guid_key));
 		}
+		num_keys++;
+	}
+
 
+	/*
+	 * Now that the list is a safe copy, send the callbacks
+	 */
+	for (i = 0; i < num_keys; i++) {
+		int ret;
+		bool matched;
 		msg = ldb_msg_new(ac);
 		if (!msg) {
+			talloc_free(keys);
 			return LDB_ERR_OPERATIONS_ERROR;
 		}
 
-
 		ret = ltdb_search_key(ac->module, ltdb,
-				      tdb_key, msg,
+				      keys[i], msg,
 				      LDB_UNPACK_DATA_FLAG_NO_DATA_ALLOC|
 				      LDB_UNPACK_DATA_FLAG_NO_VALUES_ALLOC);
-		if (tdb_key.dptr != guid_key) {
-			TALLOC_FREE(tdb_key.dptr);
-		}
 		if (ret == LDB_ERR_NO_SUCH_OBJECT) {
-			/* the record has disappeared? yes, this can happen */
+			/*
+			 * the record has disappeared? yes, this can
+			 * happen if the entry is deleted by something
+			 * operating in the callback (not another
+			 * process, as we have a read lock)
+			 */
 			talloc_free(msg);
 			continue;
 		}
 
 		if (ret != LDB_SUCCESS && ret != LDB_ERR_NO_SUCH_OBJECT) {
 			/* an internal error */
+			talloc_free(keys);
 			talloc_free(msg);
 			return LDB_ERR_OPERATIONS_ERROR;
 		}
@@ -1605,6 +1670,7 @@ static int ltdb_index_filter(struct ltdb
 		}
 
 		if (ret != LDB_SUCCESS) {
+			talloc_free(keys);
 			talloc_free(msg);
 			return ret;
 		}
@@ -1619,6 +1685,7 @@ static int ltdb_index_filter(struct ltdb
 		talloc_free(msg);
 
 		if (ret == -1) {
+			talloc_free(keys);
 			return LDB_ERR_OPERATIONS_ERROR;
 		}
 
@@ -1628,12 +1695,14 @@ static int ltdb_index_filter(struct ltdb
 			 * is the callbacks responsiblity, and should
 			 * not be talloc_free()'ed */
 			ac->request_terminated = true;
+			talloc_free(keys);
 			return ret;
 		}
 
 		(*match_count)++;
 	}
 
+	TALLOC_FREE(keys);
 	return LDB_SUCCESS;
 }
 
@@ -1748,20 +1817,21 @@ int ltdb_search_indexed(struct ltdb_cont
 			}
 			/*
 			 * Here we load the index for the tree.
+			 *
+			 * We only care if this is successful, if the
+			 * index can't trim the result list down then
+			 * the ONELEVEL index is still good enough.
 			 */
 			ret = ltdb_index_dn(ac->module, ltdb, ac->tree,
 					    idx_one_tree_list);
-			if (ret != LDB_SUCCESS) {
-				talloc_free(idx_one_tree_list);
-				talloc_free(dn_list);
-				return ret;
-			}
-
-			if (!list_intersect(ldb, ltdb,
-					    dn_list, idx_one_tree_list)) {
-				talloc_free(idx_one_tree_list);
-				talloc_free(dn_list);
-				return LDB_ERR_OPERATIONS_ERROR;
+			if (ret == LDB_SUCCESS) {
+				if (!list_intersect(ldb, ltdb,
+						    dn_list,
+						    idx_one_tree_list)) {
+					talloc_free(idx_one_tree_list);
+					talloc_free(dn_list);
+					return LDB_ERR_OPERATIONS_ERROR;
+				}
 			}
 		}
 		break;
diff -Npur samba-4.8.2/lib/ldb/ldb_tdb/ldb_search.c samba-4.8.3/lib/ldb/ldb_tdb/ldb_search.c
--- samba-4.8.2/lib/ldb/ldb_tdb/ldb_search.c	2018-01-17 09:08:39.000000000 +0100
+++ samba-4.8.3/lib/ldb/ldb_tdb/ldb_search.c	2018-06-26 16:42:46.000000000 +0200
@@ -102,8 +102,11 @@ static int msg_add_distinguished_name(st
 	el.values = &val;
 	el.flags = 0;
 	val.data = (uint8_t *)ldb_dn_alloc_linearized(msg, msg->dn);
+	if (val.data == NULL) {
+		return -1;
+	}
 	val.length = strlen((char *)val.data);
-	
+
 	ret = msg_add_element(msg, &el, 1);
 	return ret;
 }
@@ -405,7 +408,7 @@ int ltdb_filter_attrs(TALLOC_CTX *mem_ct
 	/* Shortcuts for the simple cases */
 	} else if (add_dn && i == 1) {
 		if (msg_add_distinguished_name(msg2) != 0) {
-			return -1;
+			goto failed;
 		}
 		*filtered_msg = msg2;
 		return 0;
@@ -471,7 +474,7 @@ int ltdb_filter_attrs(TALLOC_CTX *mem_ct
 
 	if (add_dn) {
 		if (msg_add_distinguished_name(msg2) != 0) {
-			return -1;
+			goto failed;
 		}
 	}
 
@@ -480,7 +483,7 @@ int ltdb_filter_attrs(TALLOC_CTX *mem_ct
 						struct ldb_message_element,
 						msg2->num_elements);
 		if (msg2->elements == NULL) {
-			return -1;
+			goto failed;
 		}
 	} else {
 		talloc_free(msg2->elements);
@@ -491,6 +494,7 @@ int ltdb_filter_attrs(TALLOC_CTX *mem_ct
 
 	return 0;
 failed:
+	TALLOC_FREE(msg2);
 	return -1;
 }
 
@@ -818,7 +822,7 @@ int ltdb_search(struct ltdb_context *ctx
 		 * callback error */
 		if ( ! ctx->request_terminated && ret != LDB_SUCCESS) {
 			/* Not indexed, so we need to do a full scan */
-			if (ltdb->warn_unindexed) {
+			if (ltdb->warn_unindexed || ltdb->disable_full_db_scan) {
 				/* useful for debugging when slow performance
 				 * is caused by unindexed searches */
 				char *expression = ldb_filter_from_tree(ctx, ctx->tree);
@@ -831,6 +835,7 @@ int ltdb_search(struct ltdb_context *ctx
 
 				talloc_free(expression);
 			}
+
 			if (match_count != 0) {
 				/* the indexing code gave an error
 				 * after having returned at least one
@@ -843,6 +848,14 @@ int ltdb_search(struct ltdb_context *ctx
 				ltdb_unlock_read(module);
 				return LDB_ERR_OPERATIONS_ERROR;
 			}
+
+			if (ltdb->disable_full_db_scan) {
+				ldb_set_errstring(ldb,
+						  "ldb FULL SEARCH disabled");
+				ltdb_unlock_read(module);
+				return LDB_ERR_INAPPROPRIATE_MATCHING;
+			}
+
 			ret = ltdb_search_full(ctx);
 			if (ret != LDB_SUCCESS) {
 				ldb_set_errstring(ldb, "Indexed and full searches both failed!\n");
diff -Npur samba-4.8.2/lib/ldb/ldb_tdb/ldb_tdb.c samba-4.8.3/lib/ldb/ldb_tdb/ldb_tdb.c
--- samba-4.8.2/lib/ldb/ldb_tdb/ldb_tdb.c	2018-05-16 12:09:25.000000000 +0200
+++ samba-4.8.3/lib/ldb/ldb_tdb/ldb_tdb.c	2018-06-26 16:42:46.000000000 +0200
@@ -434,6 +434,7 @@ int ltdb_store(struct ldb_module *module
 	}
 
 	if (ltdb->read_only) {
+		talloc_free(tdb_key_ctx);
 		return LDB_ERR_UNWILLING_TO_PERFORM;
 	}
 
@@ -575,7 +576,7 @@ static int ltdb_add_internal(struct ldb_
 			if (mem_ctx == NULL) {
 				return ldb_module_operr(module);
 			}
-			ret2 = ltdb_search_base(module, module,
+			ret2 = ltdb_search_base(module, mem_ctx,
 						msg->dn, &dn2);
 			TALLOC_FREE(mem_ctx);
 			if (ret2 == LDB_SUCCESS) {
@@ -657,6 +658,7 @@ int ltdb_delete_noindex(struct ldb_modul
 	}
 
 	if (ltdb->read_only) {
+		talloc_free(tdb_key_ctx);
 		return LDB_ERR_UNWILLING_TO_PERFORM;
 	}
 
@@ -1965,6 +1967,22 @@ static int ltdb_connect(struct ldb_conte
 
 	ltdb->sequence_number = 0;
 
+	/*
+	 * Override full DB scans
+	 *
+	 * A full DB scan is expensive on a large database.  This
+	 * option is for testing to show that the full DB scan is not
+	 * triggered.
+	 */
+	{
+		const char *len_str =
+			ldb_options_find(ldb, options,
+					 "disable_full_db_scan_for_self_test");
+		if (len_str != NULL) {
+			ltdb->disable_full_db_scan = true;
+		}
+	}
+
 	module = ldb_module_new(ldb, ldb, "ldb_tdb backend", &ltdb_ops);
 	if (!module) {
 		ldb_oom(ldb);
diff -Npur samba-4.8.2/lib/ldb/ldb_tdb/ldb_tdb.h samba-4.8.3/lib/ldb/ldb_tdb/ldb_tdb.h
--- samba-4.8.2/lib/ldb/ldb_tdb/ldb_tdb.h	2018-05-16 12:09:25.000000000 +0200
+++ samba-4.8.3/lib/ldb/ldb_tdb/ldb_tdb.h	2018-06-26 16:42:46.000000000 +0200
@@ -40,6 +40,12 @@ struct ltdb_private {
 	bool reindex_failed;
 
 	const struct ldb_schema_syntax *GUID_index_syntax;
+
+	/*
+	 * To allow testing that ensures the DB does not fall back
+	 * to a full scan
+	 */
+	bool disable_full_db_scan;
 };
 
 struct ltdb_context {
diff -Npur samba-4.8.2/lib/ldb/tests/ldb_mod_op_test.c samba-4.8.3/lib/ldb/tests/ldb_mod_op_test.c
--- samba-4.8.2/lib/ldb/tests/ldb_mod_op_test.c	2018-04-26 09:21:03.000000000 +0200
+++ samba-4.8.3/lib/ldb/tests/ldb_mod_op_test.c	2018-06-26 16:42:46.000000000 +0200
@@ -2384,6 +2384,269 @@ static void test_ldb_modify_before_ldb_w
 	assert_int_equal(res2->count, 1);
 }
 
+/*
+ * This test is also complex.
+ * The purpose is to test if a modify can occur during an ldb_search()
+ * This would be a failure if if in process
+ * (1) and (2):
+ *  - (1) ltdb_search() starts and calls back for one entry
+ *  - (2) one of the entries to be matched is modified
+ *  - (1) the indexed search tries to return the modified entry, but
+ *        it is no longer found, either:
+ *          - despite it still matching (dn changed)
+ *          - it no longer matching (attrs changed)
+ *
+ * We also try un-indexed to show that the behaviour differs on this
+ * point, which it should not (an index should only impact search
+ * speed).
+ */
+
+/*
+ * This purpose of this callback is to trigger a write in the callback
+ * so as to change in in-memory index code while looping over the
+ * index result.
+ */
+
+static int test_ldb_callback_modify_during_search_callback1(struct ldb_request *req,
+						   struct ldb_reply *ares)
+{
+	int ret;
+	struct modify_during_search_test_ctx *ctx = req->context;
+	struct ldb_dn *dn = NULL, *new_dn = NULL;
+	TALLOC_CTX *tmp_ctx = talloc_new(ctx->test_ctx);
+	struct ldb_message *msg = NULL;
+
+	assert_non_null(tmp_ctx);
+
+	switch (ares->type) {
+	case LDB_REPLY_ENTRY:
+	{
+		const struct ldb_val *cn_val
+			= ldb_dn_get_component_val(ares->message->dn, 0);
+		const char *cn = (char *)cn_val->data;
+		ctx->res_count++;
+		if (strcmp(cn, "test_search_cn") == 0) {
+			ctx->got_cn = true;
+		} else if (strcmp(cn, "test_search_2_cn") == 0) {
+			ctx->got_2_cn = true;
+		}
+		if (ctx->res_count == 2) {
+			return LDB_SUCCESS;
+		}
+		break;
+	}
+	case LDB_REPLY_REFERRAL:
+		return LDB_SUCCESS;
+
+	case LDB_REPLY_DONE:
+		return ldb_request_done(req, LDB_SUCCESS);
+	}
+
+	if (ctx->rename) {
+		if (ctx->got_2_cn) {
+			/* Modify this one */
+			dn = ldb_dn_new_fmt(tmp_ctx,
+					    ctx->test_ctx->ldb,
+					    "cn=test_search_2_cn,%s",
+					    ldb_dn_get_linearized(ctx->basedn));
+		} else {
+			dn = ldb_dn_new_fmt(tmp_ctx,
+					    ctx->test_ctx->ldb,
+					    "cn=test_search_cn,%s",
+					    ldb_dn_get_linearized(ctx->basedn));
+		}
+		assert_non_null(dn);
+
+		new_dn = ldb_dn_new_fmt(tmp_ctx,
+					ctx->test_ctx->ldb,
+					"cn=test_search_cn_renamed,"
+					"dc=not_search_test_entry");
+		assert_non_null(new_dn);
+
+		ret = ldb_rename(ctx->test_ctx->ldb, dn, new_dn);
+		assert_int_equal(ret, 0);
+
+	} else {
+		if (ctx->got_2_cn) {
+			/* Delete this one */
+			dn = ldb_dn_new_fmt(tmp_ctx,
+					    ctx->test_ctx->ldb,
+					    "cn=test_search_2_cn,%s",
+					    ldb_dn_get_linearized(ctx->basedn));
+		} else {
+			dn = ldb_dn_new_fmt(tmp_ctx,
+					    ctx->test_ctx->ldb,
+					    "cn=test_search_cn,%s",
+					    ldb_dn_get_linearized(ctx->basedn));
+		}
+		assert_non_null(dn);
+
+		ret = ldb_delete(ctx->test_ctx->ldb, dn);
+		assert_int_equal(ret, 0);
+	}
+
+	/*
+	 * Now fill in the position we just removed from the
+	 * index to ensure we fail the test (otherwise we just read
+	 * past the end of the array and find the value we wanted to
+	 * skip)
+	 */
+	msg = ldb_msg_new(tmp_ctx);
+	assert_non_null(msg);
+
+	/* We deliberatly use ou= not cn= here */
+	msg->dn = ldb_dn_new_fmt(msg,
+				 ctx->test_ctx->ldb,
+				 "ou=test_search_cn_extra,%s",
+				 ldb_dn_get_linearized(ctx->basedn));
+
+	ret = ldb_msg_add_string(msg,
+				 "objectUUID",
+				 "0123456789abcde3");
+
+	ret = ldb_add(ctx->test_ctx->ldb,
+		      msg);
+	assert_int_equal(ret, LDB_SUCCESS);
+
+	TALLOC_FREE(tmp_ctx);
+	return LDB_SUCCESS;
+}
+
+static void test_ldb_callback_modify_during_search(void **state, bool add_index,
+					  bool rename)
+{
+	struct search_test_ctx *search_test_ctx = talloc_get_type_abort(*state,
+			struct search_test_ctx);
+	struct modify_during_search_test_ctx
+		ctx =
+		{ .res_count = 0,
+		  .test_ctx = search_test_ctx->ldb_test_ctx,
+		  .rename = rename
+		};
+
+	int ret;
+	struct ldb_request *req;
+
+	ret = ldb_transaction_start(search_test_ctx->ldb_test_ctx->ldb);
+	assert_int_equal(ret, 0);
+
+	if (add_index) {
+		struct ldb_message *msg;
+		struct ldb_dn *indexlist = ldb_dn_new(search_test_ctx,
+						      search_test_ctx->ldb_test_ctx->ldb,
+						      "@INDEXLIST");
+		assert_non_null(indexlist);
+
+		msg = ldb_msg_new(search_test_ctx);
+		assert_non_null(msg);
+
+		msg->dn = indexlist;
+
+		ret = ldb_msg_add_string(msg, "@IDXONE", "1");
+		assert_int_equal(ret, LDB_SUCCESS);
+		ret = ldb_msg_add_string(msg, "@IDXATTR", "cn");
+		assert_int_equal(ret, LDB_SUCCESS);
+		ret = ldb_add(search_test_ctx->ldb_test_ctx->ldb,
+			      msg);
+		if (ret == LDB_ERR_ENTRY_ALREADY_EXISTS) {
+			msg->elements[0].flags = LDB_FLAG_MOD_ADD;
+			msg->elements[1].flags = LDB_FLAG_MOD_ADD;
+			ret = ldb_modify(search_test_ctx->ldb_test_ctx->ldb,
+					 msg);
+		}
+		assert_int_equal(ret, LDB_SUCCESS);
+
+		/*
+		 * Now bring the IDXONE index into memory by modifying
+		 * it.  This exposes an issue in ldb_tdb
+		 */
+		msg = ldb_msg_new(search_test_ctx);
+		assert_non_null(msg);
+
+		msg->dn = ldb_dn_new_fmt(search_test_ctx,
+					 search_test_ctx->ldb_test_ctx->ldb,
+					 "cn=test_search_cn_extra,%s",
+					 search_test_ctx->base_dn);
+
+		ret = ldb_msg_add_string(msg,
+					 "objectUUID",
+					 "0123456789abcde2");
+
+		ret = ldb_add(search_test_ctx->ldb_test_ctx->ldb,
+			      msg);
+		assert_int_equal(ret, LDB_SUCCESS);
+
+		ret = ldb_delete(search_test_ctx->ldb_test_ctx->ldb,
+				 msg->dn);
+		assert_int_equal(ret, LDB_SUCCESS);
+	}
+
+	tevent_loop_allow_nesting(search_test_ctx->ldb_test_ctx->ev);
+
+	ctx.basedn
+		= ldb_dn_new_fmt(search_test_ctx,
+				 search_test_ctx->ldb_test_ctx->ldb,
+				 "%s",
+				 search_test_ctx->base_dn);
+	assert_non_null(ctx.basedn);
+
+
+	/*
+	 * This search must be over multiple items, and should include
+	 * the new name after a rename, to show that it would match
+	 * both before and after that modify
+	 *
+	 * This needs to be a search that isn't matched by an index so
+	 * that we just use the one-level index.
+	 */
+	ret = ldb_build_search_req(&req,
+				   search_test_ctx->ldb_test_ctx->ldb,
+				   search_test_ctx,
+				   ctx.basedn,
+				   LDB_SCOPE_ONELEVEL,
+				   "(cn=*)",
+				   NULL,
+				   NULL,
+				   &ctx,
+				   test_ldb_callback_modify_during_search_callback1,
+				   NULL);
+	assert_int_equal(ret, 0);
+
+	ret = ldb_request(search_test_ctx->ldb_test_ctx->ldb, req);
+
+	if (ret == LDB_SUCCESS) {
+		ret = ldb_wait(req->handle, LDB_WAIT_ALL);
+	}
+	assert_int_equal(ret, 0);
+
+	ret = ldb_transaction_commit(search_test_ctx->ldb_test_ctx->ldb);
+	assert_int_equal(ret, 0);
+
+	assert_int_equal(ctx.res_count, 2);
+	assert_int_equal(ctx.got_cn, true);
+	assert_int_equal(ctx.got_2_cn, true);
+}
+
+static void test_ldb_callback_delete_during_indexed_search(void **state)
+{
+	test_ldb_callback_modify_during_search(state, true, false);
+}
+
+static void test_ldb_callback_delete_during_unindexed_search(void **state)
+{
+	test_ldb_callback_modify_during_search(state, false, false);
+}
+
+static void test_ldb_callback_rename_during_indexed_search(void **state)
+{
+	test_ldb_callback_modify_during_search(state, true, true);
+}
+
+static void test_ldb_callback_rename_during_unindexed_search(void **state)
+{
+	test_ldb_callback_modify_during_search(state, false, true);
+}
+
 static int ldb_case_test_setup(void **state)
 {
 	int ret;
@@ -3692,6 +3955,18 @@ int main(int argc, const char **argv)
 		cmocka_unit_test_setup_teardown(test_ldb_rename_during_indexed_search,
 						ldb_search_test_setup,
 						ldb_search_test_teardown),
+		cmocka_unit_test_setup_teardown(test_ldb_callback_rename_during_unindexed_search,
+						ldb_search_test_setup,
+						ldb_search_test_teardown),
+		cmocka_unit_test_setup_teardown(test_ldb_callback_rename_during_indexed_search,
+						ldb_search_test_setup,
+						ldb_search_test_teardown),
+		cmocka_unit_test_setup_teardown(test_ldb_callback_delete_during_unindexed_search,
+						ldb_search_test_setup,
+						ldb_search_test_teardown),
+		cmocka_unit_test_setup_teardown(test_ldb_callback_delete_during_indexed_search,
+						ldb_search_test_setup,
+						ldb_search_test_teardown),
 		cmocka_unit_test_setup_teardown(test_ldb_modify_during_whole_search,
 						ldb_search_test_setup,
 						ldb_search_test_teardown),
diff -Npur samba-4.8.2/lib/ldb/tests/python/api.py samba-4.8.3/lib/ldb/tests/python/api.py
--- samba-4.8.2/lib/ldb/tests/python/api.py	2018-05-16 12:09:25.000000000 +0200
+++ samba-4.8.3/lib/ldb/tests/python/api.py	2018-06-26 16:42:46.000000000 +0200
@@ -646,9 +646,16 @@ class SearchTests(LdbBaseTest):
         super(SearchTests, self).setUp()
         self.testdir = tempdir()
         self.filename = os.path.join(self.testdir, "search_test.ldb")
+        options = ["modules:rdn_name"]
+        if hasattr(self, 'IDXCHECK'):
+            options.append("disable_full_db_scan_for_self_test:1")
         self.l = ldb.Ldb(self.url(),
                          flags=self.flags(),
-                         options=["modules:rdn_name"])
+                         options=options)
+        try:
+            self.l.add(self.index)
+        except AttributeError:
+            pass
 
         self.l.add({"dn": "@ATTRIBUTES",
                     "DC": "CASE_INSENSITIVE"})
@@ -929,6 +936,47 @@ class SearchTests(LdbBaseTest):
                               expression="(|(x=y)(y=b))")
         self.assertEqual(len(res11), 20)
 
+    def test_one_unindexable(self):
+        """Testing a search"""
+
+        try:
+            res11 = self.l.search(base="DC=samba,DC=org",
+                                  scope=ldb.SCOPE_ONELEVEL,
+                                  expression="(y=b*)")
+            if hasattr(self, 'IDX') and \
+               not hasattr(self, 'IDXONE') and \
+               hasattr(self, 'IDXCHECK'):
+                self.fail("Should have failed as un-indexed search")
+
+            self.assertEqual(len(res11), 9)
+
+        except ldb.LdbError as err:
+            enum = err.args[0]
+            estr = err.args[1]
+            self.assertEqual(enum, ldb.ERR_INAPPROPRIATE_MATCHING)
+            self.assertIn(estr, "ldb FULL SEARCH disabled")
+
+    def test_one_unindexable_presence(self):
+        """Testing a search"""
+
+        try:
+            res11 = self.l.search(base="DC=samba,DC=org",
+                                  scope=ldb.SCOPE_ONELEVEL,
+                                  expression="(y=*)")
+            if hasattr(self, 'IDX') and \
+               not hasattr(self, 'IDXONE') and \
+               hasattr(self, 'IDXCHECK'):
+                self.fail("Should have failed as un-indexed search")
+
+            self.assertEqual(len(res11), 24)
+
+        except ldb.LdbError as err:
+            enum = err.args[0]
+            estr = err.args[1]
+            self.assertEqual(enum, ldb.ERR_INAPPROPRIATE_MATCHING)
+            self.assertIn(estr, "ldb FULL SEARCH disabled")
+
+
     def test_subtree_and_or(self):
         """Testing a search"""
 
@@ -1009,6 +1057,45 @@ class SearchTests(LdbBaseTest):
                               expression="(@IDXONE=DC=SAMBA,DC=ORG)")
         self.assertEqual(len(res11), 0)
 
+    def test_subtree_unindexable(self):
+        """Testing a search"""
+
+        try:
+            res11 = self.l.search(base="DC=samba,DC=org",
+                                  scope=ldb.SCOPE_SUBTREE,
+                                  expression="(y=b*)")
+            if hasattr(self, 'IDX') and \
+               hasattr(self, 'IDXCHECK'):
+                self.fail("Should have failed as un-indexed search")
+
+            self.assertEqual(len(res11), 9)
+
+        except ldb.LdbError as err:
+            enum = err.args[0]
+            estr = err.args[1]
+            self.assertEqual(enum, ldb.ERR_INAPPROPRIATE_MATCHING)
+            self.assertIn(estr, "ldb FULL SEARCH disabled")
+
+    def test_subtree_unindexable_presence(self):
+        """Testing a search"""
+
+        try:
+            res11 = self.l.search(base="DC=samba,DC=org",
+                                  scope=ldb.SCOPE_SUBTREE,
+                                  expression="(y=*)")
+            if hasattr(self, 'IDX') and \
+               hasattr(self, 'IDXCHECK'):
+                self.fail("Should have failed as un-indexed search")
+
+            self.assertEqual(len(res11), 24)
+
+        except ldb.LdbError as err:
+            enum = err.args[0]
+            estr = err.args[1]
+            self.assertEqual(enum, ldb.ERR_INAPPROPRIATE_MATCHING)
+            self.assertIn(estr, "ldb FULL SEARCH disabled")
+
+
     def test_dn_filter_one(self):
         """Testing that a dn= filter succeeds
         (or fails with disallowDNFilter
@@ -1066,6 +1153,13 @@ class IndexedSearchTests(SearchTests):
                     "@IDXATTR": [b"x", b"y", b"ou"]})
         self.IDX = True
 
+class IndexedCheckSearchTests(IndexedSearchTests):
+    """Test searches using the index, to ensure the index doesn't
+       break things (full scan disabled)"""
+    def setUp(self):
+        self.IDXCHECK = True
+        super(IndexedCheckSearchTests, self).setUp()
+
 class IndexedSearchDnFilterTests(SearchTests):
     """Test searches using the index, to ensure the index doesn't
        break things"""
@@ -1088,6 +1182,14 @@ class IndexedAndOneLevelSearchTests(Sear
                     "@IDXATTR": [b"x", b"y", b"ou"],
                     "@IDXONE": [b"1"]})
         self.IDX = True
+        self.IDXONE = True
+
+class IndexedCheckedAndOneLevelSearchTests(IndexedAndOneLevelSearchTests):
+    """Test searches using the index including @IDXONE, to ensure
+       the index doesn't break things (full scan disabled)"""
+    def setUp(self):
+        self.IDXCHECK = True
+        super(IndexedCheckedAndOneLevelSearchTests, self).setUp()
 
 class IndexedAndOneLevelDNFilterSearchTests(SearchTests):
     """Test searches using the index including @IDXONE, to ensure
diff -Npur samba-4.8.2/lib/ldb/wscript samba-4.8.3/lib/ldb/wscript
--- samba-4.8.2/lib/ldb/wscript	2018-05-16 12:09:25.000000000 +0200
+++ samba-4.8.3/lib/ldb/wscript	2018-06-26 16:42:46.000000000 +0200
@@ -1,7 +1,7 @@
 #!/usr/bin/env python
 
 APPNAME = 'ldb'
-VERSION = '1.3.3'
+VERSION = '1.3.4'
 
 blddir = 'bin'
 
diff -Npur samba-4.8.2/lib/util/debug.c samba-4.8.3/lib/util/debug.c
--- samba-4.8.2/lib/util/debug.c	2018-04-26 09:21:03.000000000 +0200
+++ samba-4.8.3/lib/util/debug.c	2018-06-26 16:42:46.000000000 +0200
@@ -480,8 +480,8 @@ static void debug_set_backends(const cha
 static void debug_backends_log(const char *msg, int msg_level)
 {
 	char msg_no_nl[FORMAT_BUFR_SIZE];
-	unsigned i;
-	int len;
+	size_t i;
+	size_t len;
 
 	/*
 	 * Some backends already add an extra newline, so also provide
@@ -551,7 +551,7 @@ static const char *default_classname_tab
  */
 static const int debug_class_list_initial[ARRAY_SIZE(default_classname_table)];
 
-static int debug_num_classes = 0;
+static size_t debug_num_classes = 0;
 int     *DEBUGLEVEL_CLASS = discard_const_p(int, debug_class_list_initial);
 
 
@@ -630,7 +630,7 @@ utility lists registered debug class nam
 char *debug_list_class_names_and_levels(void)
 {
 	char *buf = NULL;
-	int i;
+	size_t i;
 	/* prepare strings */
 	for (i = 0; i < debug_num_classes; i++) {
 		buf = talloc_asprintf_append(buf,
@@ -651,7 +651,7 @@ char *debug_list_class_names_and_levels(
 
 static int debug_lookup_classname_int(const char* classname)
 {
-	int i;
+	size_t i;
 
 	if (!classname) return -1;
 
@@ -741,7 +741,7 @@ static int debug_lookup_classname(const
 
 static void debug_dump_status(int level)
 {
-	int q;
+	size_t q;
 
 	DEBUG(level, ("INFO: Current debug levels:\n"));
 	for (q = 0; q < debug_num_classes; q++) {
@@ -790,7 +790,7 @@ bool debug_parse_levels(const char *para
 	size_t str_len = strlen(params_str);
 	char str[str_len+1];
 	char *tok, *saveptr;
-	int i;
+	size_t i;
 
 	/* Just in case */
 	debug_init();
diff -Npur samba-4.8.2/lib/util/fault.c samba-4.8.3/lib/util/fault.c
--- samba-4.8.2/lib/util/fault.c	2018-01-14 21:41:58.000000000 +0100
+++ samba-4.8.3/lib/util/fault.c	2018-06-26 16:42:46.000000000 +0200
@@ -3,6 +3,7 @@
    Critical Fault handling
    Copyright (C) Andrew Tridgell 1992-1998
    Copyright (C) Tim Prouty 2009
+   Copyright (C) James Peach 2006
 
    This program is free software; you can redistribute it and/or modify
    it under the terms of the GNU General Public License as published by
@@ -123,6 +124,10 @@ _PUBLIC_ const char *panic_action = NULL
 static void smb_panic_default(const char *why) _NORETURN_;
 static void smb_panic_default(const char *why)
 {
+	DBG_ERR("PANIC (pid %llu): %s\n",
+		    (unsigned long long)getpid(), why);
+	log_stack_trace();
+
 #if defined(HAVE_PRCTL) && defined(PR_SET_PTRACER)
 	/*
 	 * Make sure all children can attach a debugger.
@@ -148,7 +153,6 @@ static void smb_panic_default(const char
 					  WEXITSTATUS(result)));
 		}
 	}
-	DEBUG(0,("PANIC: %s\n", why));
 
 #ifdef SIGABRT
 	CatchSignal(SIGABRT, SIG_DFL);
@@ -168,3 +172,104 @@ _PUBLIC_ void smb_panic(const char *why)
 	}
 	smb_panic_default(why);
 }
+
+/*******************************************************************
+ Print a backtrace of the stack to the debug log. This function
+ DELIBERATELY LEAKS MEMORY. The expectation is that you should
+ exit shortly after calling it.
+********************************************************************/
+
+/* Buffer size to use when printing backtraces */
+#define BACKTRACE_STACK_SIZE 64
+
+
+#ifdef HAVE_LIBUNWIND_H
+#include <libunwind.h>
+#endif
+
+#ifdef HAVE_EXECINFO_H
+#include <execinfo.h>
+#endif
+
+void log_stack_trace(void)
+{
+#ifdef HAVE_LIBUNWIND
+	/* Try to use libunwind before any other technique since on ia64
+	 * libunwind correctly walks the stack in more circumstances than
+	 * backtrace.
+	 */
+	unw_cursor_t cursor;
+	unw_context_t uc;
+	unsigned i = 0;
+
+	char procname[256];
+	unw_word_t ip, sp, off;
+
+	procname[sizeof(procname) - 1] = '\0';
+
+	if (unw_getcontext(&uc) != 0) {
+		goto libunwind_failed;
+	}
+
+	if (unw_init_local(&cursor, &uc) != 0) {
+		goto libunwind_failed;
+	}
+
+	DEBUG(0, ("BACKTRACE:\n"));
+
+	do {
+	    ip = sp = 0;
+	    unw_get_reg(&cursor, UNW_REG_IP, &ip);
+	    unw_get_reg(&cursor, UNW_REG_SP, &sp);
+
+	    switch (unw_get_proc_name(&cursor,
+			procname, sizeof(procname) - 1, &off) ) {
+	    case 0:
+		    /* Name found. */
+	    case -UNW_ENOMEM:
+		    /* Name truncated. */
+		    DEBUGADD(0, (" #%u %s + %#llx [ip=%#llx] [sp=%#llx]\n",
+			    i, procname, (long long)off,
+			    (long long)ip, (long long) sp));
+		    break;
+	    default:
+	    /* case -UNW_ENOINFO: */
+	    /* case -UNW_EUNSPEC: */
+		    /* No symbol name found. */
+		    DEBUGADD(0, (" #%u %s [ip=%#llx] [sp=%#llx]\n",
+			    i, "<unknown symbol>",
+			    (long long)ip, (long long) sp));
+	    }
+	    ++i;
+	} while (unw_step(&cursor) > 0);
+
+	return;
+
+libunwind_failed:
+	DEBUG(0, ("unable to produce a stack trace with libunwind\n"));
+
+#elif HAVE_BACKTRACE_SYMBOLS
+	void *backtrace_stack[BACKTRACE_STACK_SIZE];
+	size_t backtrace_size;
+	char **backtrace_strings;
+
+	/* get the backtrace (stack frames) */
+	backtrace_size = backtrace(backtrace_stack,BACKTRACE_STACK_SIZE);
+	backtrace_strings = backtrace_symbols(backtrace_stack, backtrace_size);
+
+	DEBUG(0, ("BACKTRACE: %lu stack frames:\n",
+		  (unsigned long)backtrace_size));
+
+	if (backtrace_strings) {
+		int i;
+
+		for (i = 0; i < backtrace_size; i++)
+			DEBUGADD(0, (" #%u %s\n", i, backtrace_strings[i]));
+
+		/* Leak the backtrace_strings, rather than risk what free() might do */
+	}
+
+#else
+	DEBUG(0, ("unable to produce a stack trace on this platform\n"));
+#endif
+}
diff -Npur samba-4.8.2/lib/util/fault.h samba-4.8.3/lib/util/fault.h
--- samba-4.8.2/lib/util/fault.h	2018-01-14 21:41:58.000000000 +0100
+++ samba-4.8.3/lib/util/fault.h	2018-06-26 16:42:46.000000000 +0200
@@ -53,5 +53,6 @@ void fault_setup(void);
 void fault_setup_disable(void);
 _NORETURN_ void smb_panic(const char *reason);
 
+void log_stack_trace(void);
 
 #endif /* _SAMBA_FAULT_H_ */
diff -Npur samba-4.8.2/lib/util/memcache.h samba-4.8.3/lib/util/memcache.h
--- samba-4.8.2/lib/util/memcache.h	2018-02-12 11:27:16.000000000 +0100
+++ samba-4.8.3/lib/util/memcache.h	2018-06-26 16:42:46.000000000 +0200
@@ -45,7 +45,8 @@ enum memcache_number {
 	SINGLETON_CACHE,
 	SMB1_SEARCH_OFFSET_MAP,
 	SHARE_MODE_LOCK_CACHE,	/* talloc */
-	VIRUSFILTER_SCAN_RESULTS_CACHE_TALLOC /* talloc */
+	VIRUSFILTER_SCAN_RESULTS_CACHE_TALLOC, /* talloc */
+	DFREE_CACHE,
 };
 
 /*
diff -Npur samba-4.8.2/lib/util/mkdir_p.c samba-4.8.3/lib/util/mkdir_p.c
--- samba-4.8.2/lib/util/mkdir_p.c	2018-01-17 09:08:39.000000000 +0100
+++ samba-4.8.3/lib/util/mkdir_p.c	2018-06-26 16:42:46.000000000 +0200
@@ -49,11 +49,11 @@ int mkdir_p(const char *dir, int mode)
 
 	/* Create ancestors */
 	len = strlen(dir);
-	if (len >= PATH_MAX) {
+	ret = snprintf(t, sizeof(t), "%s", dir);
+	if (ret != len) {
 		errno = ENAMETOOLONG;
 		return -1;
 	}
-	strncpy(t, dir, len+1);
 
 	ret = mkdir_p(dirname(t), mode);
 	if (ret != 0) {
diff -Npur samba-4.8.2/lib/util/tests/tfork.c samba-4.8.3/lib/util/tests/tfork.c
--- samba-4.8.2/lib/util/tests/tfork.c	2018-04-26 09:21:03.000000000 +0200
+++ samba-4.8.3/lib/util/tests/tfork.c	2018-06-26 16:42:46.000000000 +0200
@@ -417,8 +417,7 @@ static void *tfork_thread(void *p)
 	struct tfork *t = NULL;
 	int status;
 	pid_t child;
-	pthread_t *ptid = (pthread_t *)p;
-	uint64_t tid;
+	uint64_t tid = (uint64_t)pthread_self();
 	uint64_t *result = NULL;
 	int up[2];
 	ssize_t nread;
@@ -429,8 +428,6 @@ static void *tfork_thread(void *p)
 		pthread_exit(NULL);
 	}
 
-	tid = (uint64_t)*ptid;
-
 	t = tfork_create();
 	if (t == NULL) {
 		pthread_exit(NULL);
@@ -480,7 +477,7 @@ static bool test_tfork_threads(struct to
 #endif
 
 	for (i = 0; i < num_threads; i++) {
-		ret = pthread_create(&threads[i], NULL, tfork_thread, &threads[i]);
+		ret = pthread_create(&threads[i], NULL, tfork_thread, NULL);
 		torture_assert_goto(tctx, ret == 0, ok, done,
 				    "pthread_create failed\n");
 	}
diff -Npur samba-4.8.2/lib/util/wscript_configure samba-4.8.3/lib/util/wscript_configure
--- samba-4.8.2/lib/util/wscript_configure	2018-01-17 09:08:39.000000000 +0100
+++ samba-4.8.3/lib/util/wscript_configure	2018-06-26 16:42:46.000000000 +0200
@@ -6,6 +6,7 @@ if Options.options.disable_fault_handlin
 
 # backtrace could be in libexecinfo or in libc
 conf.CHECK_FUNCS_IN('backtrace backtrace_symbols', 'execinfo', checklibc=True, headers='execinfo.h')
+conf.CHECK_HEADERS('execinfo.h libunwind.h')
 
 conf.CHECK_STRUCTURE_MEMBER('struct statvfs', 'f_frsize', define='HAVE_FRSIZE', headers='sys/statvfs.h')
 
diff -Npur samba-4.8.2/libgpo/pygpo.c samba-4.8.3/libgpo/pygpo.c
--- samba-4.8.2/libgpo/pygpo.c	2018-01-17 09:08:39.000000000 +0100
+++ samba-4.8.3/libgpo/pygpo.c	2018-06-26 16:42:46.000000000 +0200
@@ -319,6 +319,7 @@ static PyObject *py_gpo_get_sysvol_gpt_v
 	return result;
 }
 
+#ifdef HAVE_ADS
 static ADS_STATUS find_samaccount(ADS_STRUCT *ads, TALLOC_CTX *mem_ctx,
 				  const char *samaccountname,
 				  uint32_t *uac_ret, const char **dn_ret)
@@ -468,11 +469,15 @@ out:
 	return ret;
 }
 
+#endif
+
 static PyMethodDef ADS_methods[] = {
 	{ "connect", (PyCFunction)py_ads_connect, METH_NOARGS,
 		"Connect to the LDAP server" },
+#ifdef HAVE_ADS
 	{ "get_gpo_list", (PyCFunction)py_ads_get_gpo_list, METH_KEYWORDS,
 		NULL },
+#endif
 	{ NULL }
 };
 
diff -Npur samba-4.8.2/nsswitch/krb5_plugin/winbind_krb5_localauth.c samba-4.8.3/nsswitch/krb5_plugin/winbind_krb5_localauth.c
--- samba-4.8.2/nsswitch/krb5_plugin/winbind_krb5_localauth.c	1970-01-01 01:00:00.000000000 +0100
+++ samba-4.8.3/nsswitch/krb5_plugin/winbind_krb5_localauth.c	2018-06-26 16:42:46.000000000 +0200
@@ -0,0 +1,267 @@
+/*
+   Unix SMB/CIFS implementation.
+
+   A localauth plugin for MIT Kerberos
+
+   Copyright (C) 2018      Andreas Schneider <asn@samba.org>
+
+   This program is free software; you can redistribute it and/or modify
+   it under the terms of the GNU General Public License as published by
+   the Free Software Foundation; either version 3 of the License, or
+   (at your option) any later version.
+
+   This program is distributed in the hope that it will be useful,
+   but WITHOUT ANY WARRANTY; without even the implied warranty of
+   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+   GNU General Public License for more details.
+
+   You should have received a copy of the GNU General Public License
+   along with this program.  If not, see <http://www.gnu.org/licenses/>.
+*/
+
+#include "replace.h"
+#include <krb5/localauth_plugin.h>
+#include <wbclient.h>
+#if HAVE_COM_ERR_H
+#include <com_err.h>
+#endif
+
+struct krb5_localauth_moddata_st {
+	struct wbcContext *wbc_ctx;
+};
+
+/*
+ * Initialize the module data.
+ *
+ * This creates the wbclient context.
+ */
+static krb5_error_code winbind_init(krb5_context context,
+				    krb5_localauth_moddata *data)
+{
+	krb5_localauth_moddata d;
+
+	*data = NULL;
+	d = malloc(sizeof(struct krb5_localauth_moddata_st));
+	if (d == NULL) {
+		return ENOMEM;
+	}
+
+	d->wbc_ctx = wbcCtxCreate();
+	if (d->wbc_ctx == NULL) {
+		free(d);
+		return ENOMEM;
+	}
+
+	*data = d;
+
+	return 0;
+}
+
+/*
+ * Release resources used by module data.
+ */
+static void winbind_fini(krb5_context context, krb5_localauth_moddata data)
+{
+	wbcCtxFree(data->wbc_ctx);
+	free(data);
+	data = NULL;
+}
+
+/*
+ * Determine whether aname is authorized to log in as the local account lname.
+ *
+ * Return 0 if aname is authorized, EPERM if aname is authoritatively not
+ * authorized, KRB5_PLUGIN_NO_HANDLE if the module cannot determine whether
+ * aname is authorized, and any other error code for a serious failure to
+ * process the request.  aname will be considered authorized if at least one
+ * module returns 0 and all other modules return KRB5_PLUGIN_NO_HANDLE.
+ */
+static krb5_error_code winbind_userok(krb5_context context,
+				      krb5_localauth_moddata data,
+				      krb5_const_principal aname,
+				      const char *lname)
+{
+	krb5_error_code code = 0;
+	char *princ_str = NULL;
+	struct passwd *pwd = NULL;
+	uid_t princ_uid;
+	uid_t lname_uid;
+	wbcErr wbc_status;
+	int cmp;
+
+	code = krb5_unparse_name(context, aname, &princ_str);
+	if (code != 0) {
+		return code;
+	}
+
+	cmp = strcasecmp(princ_str, lname);
+	if (cmp == 0) {
+		krb5_free_unparsed_name(context, princ_str);
+		return 0;
+	}
+
+	wbc_status = wbcCtxGetpwnam(data->wbc_ctx,
+				    princ_str,
+				    &pwd);
+	krb5_free_unparsed_name(context, princ_str);
+	switch (wbc_status) {
+	case WBC_ERR_SUCCESS:
+		princ_uid = pwd->pw_uid;
+		code = 0;
+		break;
+	case WBC_ERR_UNKNOWN_USER:
+	/* match other insane libwbclient return codes */
+	case WBC_ERR_WINBIND_NOT_AVAILABLE:
+	case WBC_ERR_DOMAIN_NOT_FOUND:
+		code = KRB5_PLUGIN_NO_HANDLE;
+		break;
+	default:
+		code = EIO;
+		break;
+	}
+	wbcFreeMemory(pwd);
+	if (code != 0) {
+		return code;
+	}
+
+	wbc_status = wbcCtxGetpwnam(data->wbc_ctx,
+				    lname,
+				    &pwd);
+	switch (wbc_status) {
+	case WBC_ERR_SUCCESS:
+		lname_uid = pwd->pw_uid;
+		break;
+	case WBC_ERR_UNKNOWN_USER:
+	/* match other insane libwbclient return codes */
+	case WBC_ERR_WINBIND_NOT_AVAILABLE:
+	case WBC_ERR_DOMAIN_NOT_FOUND:
+		code = KRB5_PLUGIN_NO_HANDLE;
+		break;
+	default:
+		code = EIO;
+		break;
+	}
+	wbcFreeMemory(pwd);
+	if (code != 0) {
+		return code;
+	}
+
+	if (princ_uid != lname_uid) {
+		code = EPERM;
+	}
+
+	return code;
+}
+
+/*
+ * Determine the local account name corresponding to aname.
+ *
+ * Return 0 and set *lname_out if a mapping can be determined; the contents of
+ * *lname_out will later be released with a call to the module's free_string
+ * method.  Return KRB5_LNAME_NOTRANS if no mapping can be determined.  Return
+ * any other error code for a serious failure to process the request; this will
+ * halt the krb5_aname_to_localname operation.
+ *
+ * If the module's an2ln_types field is set, this method will only be invoked
+ * when a profile "auth_to_local" value references one of the module's types.
+ * type and residual will be set to the type and residual of the auth_to_local
+ * value.
+ *
+ * If the module's an2ln_types field is not set but the an2ln method is
+ * implemented, this method will be invoked independently of the profile's
+ * auth_to_local settings, with type and residual set to NULL.  If multiple
+ * modules are registered with an2ln methods but no an2ln_types field, the
+ * order of invocation is not defined, but all such modules will be consulted
+ * before the built-in mechanisms are tried.
+ */
+static krb5_error_code winbind_an2ln(krb5_context context,
+				     krb5_localauth_moddata data,
+				     const char *type,
+				     const char *residual,
+				     krb5_const_principal aname,
+				     char **lname_out)
+{
+	krb5_error_code code = 0;
+	char *princ_str = NULL;
+	char *name = NULL;
+	struct passwd *pwd = NULL;
+	wbcErr wbc_status;
+
+	code = krb5_unparse_name(context, aname, &princ_str);
+	if (code != 0) {
+		return code;
+	}
+
+	wbc_status = wbcCtxGetpwnam(data->wbc_ctx,
+				    princ_str,
+				    &pwd);
+	krb5_free_unparsed_name(context, princ_str);
+	switch (wbc_status) {
+	case WBC_ERR_SUCCESS:
+		name = strdup(pwd->pw_name);
+		code = 0;
+		break;
+	case WBC_ERR_UNKNOWN_USER:
+	/* match other insane libwbclient return codes */
+	case WBC_ERR_WINBIND_NOT_AVAILABLE:
+	case WBC_ERR_DOMAIN_NOT_FOUND:
+		code = KRB5_LNAME_NOTRANS;
+		break;
+	default:
+		code = EIO;
+		break;
+	}
+	wbcFreeMemory(pwd);
+	if (code != 0) {
+		return code;
+	}
+
+	if (name == NULL) {
+		return ENOMEM;
+	}
+
+	*lname_out = name;
+
+	return code;
+}
+
+/*
+ * Release the memory returned by an invocation of an2ln.
+ */
+static void winbind_free_string(krb5_context context,
+				krb5_localauth_moddata data,
+				char *str)
+{
+	free(str);
+}
+
+krb5_error_code
+localauth_winbind_initvt(krb5_context context,
+			 int maj_ver,
+			 int min_ver,
+			 krb5_plugin_vtable vtable);
+
+krb5_error_code
+localauth_winbind_initvt(krb5_context context,
+			 int maj_ver,
+			 int min_ver,
+			 krb5_plugin_vtable vtable)
+{
+	krb5_localauth_vtable vt = (krb5_localauth_vtable)vtable;
+
+	if (maj_ver != 1) {
+		com_err("winbind_localauth",
+			EINVAL,
+			"Failed to load, plugin API changed.");
+		return KRB5_PLUGIN_VER_NOTSUPP;
+	}
+
+	vt->init = winbind_init;
+	vt->fini = winbind_fini;
+	vt->name = "winbind";
+	vt->an2ln = winbind_an2ln;
+	vt->userok = winbind_userok;
+	vt->free_string = winbind_free_string;
+
+	return 0;
+}
diff -Npur samba-4.8.2/nsswitch/tests/test_idmap_ad.sh samba-4.8.3/nsswitch/tests/test_idmap_ad.sh
--- samba-4.8.2/nsswitch/tests/test_idmap_ad.sh	2018-01-17 09:08:39.000000000 +0100
+++ samba-4.8.3/nsswitch/tests/test_idmap_ad.sh	2018-06-26 16:42:46.000000000 +0200
@@ -20,7 +20,7 @@ failed=0
 
 . `dirname $0`/../../testprogs/blackbox/subunit.sh
 
-DOMAIN_SID=$($wbinfo -n "@$DOMAIN" | cut -f 1 -d " ")
+DOMAIN_SID=$($wbinfo -n "$DOMAIN/" | cut -f 1 -d " ")
 if [ $? -ne 0 ] ; then
     echo "Could not find domain SID" | subunit_fail_test "test_idmap_ad"
     exit 1
diff -Npur samba-4.8.2/nsswitch/tests/test_idmap_nss.sh samba-4.8.3/nsswitch/tests/test_idmap_nss.sh
--- samba-4.8.2/nsswitch/tests/test_idmap_nss.sh	2018-01-14 21:41:58.000000000 +0100
+++ samba-4.8.3/nsswitch/tests/test_idmap_nss.sh	2018-06-26 16:42:46.000000000 +0200
@@ -13,8 +13,8 @@ failed=0
 
 . `dirname $0`/../../testprogs/blackbox/subunit.sh
 
-testit "wbinfo returns domain SID" $wbinfo -n "@$DOMAIN" || exit 1
-DOMAIN_SID=$($wbinfo -n "@$DOMAIN" | cut -f 1 -d " ")
+testit "wbinfo returns domain SID" $wbinfo -n "$DOMAIN/" || exit 1
+DOMAIN_SID=$($wbinfo -n "$DOMAIN/" | cut -f 1 -d " ")
 echo "Domain $DOMAIN has SID $DOMAIN_SID"
 
 # Find an unused uid and SID
diff -Npur samba-4.8.2/nsswitch/tests/test_idmap_rid.sh samba-4.8.3/nsswitch/tests/test_idmap_rid.sh
--- samba-4.8.2/nsswitch/tests/test_idmap_rid.sh	2018-01-14 21:41:58.000000000 +0100
+++ samba-4.8.3/nsswitch/tests/test_idmap_rid.sh	2018-06-26 16:42:46.000000000 +0200
@@ -16,7 +16,7 @@ failed=0
 
 . `dirname $0`/../../testprogs/blackbox/subunit.sh
 
-DOMAIN_SID=$($wbinfo -n "@$DOMAIN" | cut -f 1 -d " ")
+DOMAIN_SID=$($wbinfo -n "$DOMAIN/" | cut -f 1 -d " ")
 if [ $? -ne 0 ] ; then
     echo "Could not find domain SID" | subunit_fail_test "test_idmap_rid"
     exit 1
diff -Npur samba-4.8.2/nsswitch/tests/test_wbinfo_name_lookup.sh samba-4.8.3/nsswitch/tests/test_wbinfo_name_lookup.sh
--- samba-4.8.2/nsswitch/tests/test_wbinfo_name_lookup.sh	2018-04-26 09:21:03.000000000 +0200
+++ samba-4.8.3/nsswitch/tests/test_wbinfo_name_lookup.sh	2018-06-26 16:42:46.000000000 +0200
@@ -8,8 +8,9 @@ exit 1;
 fi
 
 DOMAIN=$1
-DC_USERNAME=$2
-shift 2
+REALM=$2
+DC_USERNAME=$3
+shift 3
 
 failed=0
 sambabindir="$BINDIR"
@@ -22,6 +23,14 @@ testit "name-to-sid.single-separator" \
        $wbinfo -n $DOMAIN/$DC_USERNAME || \
 	failed=$(expr $failed + 1)
 
+testit "name-to-sid.at_domain" \
+       $wbinfo -n $DOMAIN/ || \
+	failed=$(expr $failed + 1)
+
+testit "name-to-sid.upn" \
+       $wbinfo -n $DC_USERNAME@$REALM || \
+	failed=$(expr $failed + 1)
+
 # Two separator characters should fail
 testit_expect_failure "name-to-sid.double-separator" \
 		      $wbinfo -n $DOMAIN//$DC_USERNAME || \
diff -Npur samba-4.8.2/nsswitch/tests/test_wbinfo_user_info.sh samba-4.8.3/nsswitch/tests/test_wbinfo_user_info.sh
--- samba-4.8.2/nsswitch/tests/test_wbinfo_user_info.sh	1970-01-01 01:00:00.000000000 +0100
+++ samba-4.8.3/nsswitch/tests/test_wbinfo_user_info.sh	2018-06-26 16:42:46.000000000 +0200
@@ -0,0 +1,83 @@
+#!/bin/sh
+# Blackbox test for wbinfo lookup for account name and upn
+# Copyright (c) 2018 Andreas Schneider <asn@samba.org>
+
+if [ $# -lt 5 ]; then
+cat <<EOF
+Usage: $(basename $0) DOMAIN REALM USERNAME1 UPN_NAME1 USERNAME2 UPN_NAME2
+EOF
+exit 1;
+fi
+
+DOMAIN=$1
+REALM=$2
+USERNAME1=$3
+UPN_NAME1=$4
+USERNAME2=$5
+UPN_NAME2=$6
+shift 6
+
+failed=0
+
+samba_bindir="$BINDIR"
+wbinfo_tool="$VALGRIND $samba_bindir/wbinfo"
+
+UPN1="$UPN_NAME1@$REALM"
+UPN2="$UPN_NAME2@$REALM"
+
+. $(dirname $0)/../../testprogs/blackbox/subunit.sh
+
+test_user_info()
+{
+	local cmd out ret user domain upn userinfo
+
+	domain="$1"
+	user="$2"
+	upn="$3"
+
+	if [ $# -lt 3 ]; then
+		userinfo="$domain/$user"
+	else
+		userinfo="$upn"
+	fi
+
+	cmd='$wbinfo_tool --user-info $userinfo'
+	eval echo "$cmd"
+	out=$(eval $cmd)
+	ret=$?
+	if [ $ret -ne 0 ]; then
+		echo "failed to lookup $userinfo"
+		echo "$out"
+		return 1
+	fi
+
+	echo "$out" | grep "$domain/$user:.*:.*:.*::/home/$domain/Domain Users/$user"
+	ret=$?
+	if [ $ret != 0 ]; then
+		echo "failed to lookup $userinfo"
+		echo "$out"
+		return 1
+	fi
+
+	return 0
+}
+
+testit "name_to_sid.domain.$USERNAME1" $wbinfo_tool --name-to-sid $DOMAIN/$USERNAME1 || failed=$(expr $failed + 1)
+testit "name_to_sid.upn.$UPN_NAME1" $wbinfo_tool --name-to-sid $UPN1 || failed=$(expr $failed + 1)
+
+testit "user_info.domain.$USERNAME1" test_user_info $DOMAIN $USERNAME1 || failed=$(expr $failed + 1)
+testit "user_info.upn.$UPN_NAME1" test_user_info $DOMAIN $USERNAME1 $UPN1 || failed=$(expr $failed + 1)
+
+testit "name_to_sid.domain.$USERNAME2" $wbinfo_tool --name-to-sid $DOMAIN/$USERNAME2 || failed=$(expr $failed + 1)
+testit "name_to_sid.upn.$UPN_NAME2" $wbinfo_tool --name-to-sid $UPN2 || failed=$(expr $failed + 1)
+
+testit "user_info.domain.$USERNAME2" test_user_info $DOMAIN $USERNAME2 || failed=$(expr $failed + 1)
+testit "user_info.upn.$UPN_NAME2" test_user_info $DOMAIN $USERNAME2 $UPN2 || failed=$(expr $failed + 1)
+
+USERNAME3="testdenied"
+UPN_NAME3="testdenied_upn"
+UPN3="$UPN_NAME3@${REALM}.upn"
+testit "name_to_sid.upn.$UPN_NAME3" $wbinfo_tool --name-to-sid $UPN3 || failed=$(expr $failed + 1)
+testit "user_info.upn.$UPN_NAME3" test_user_info $DOMAIN $USERNAME3 $UPN3 || failed=$(expr $failed + 1)
+
+exit $failed
diff -Npur samba-4.8.2/nsswitch/wscript_build samba-4.8.3/nsswitch/wscript_build
--- samba-4.8.2/nsswitch/wscript_build	2018-01-14 21:41:58.000000000 +0100
+++ samba-4.8.3/nsswitch/wscript_build	2018-06-26 16:42:46.000000000 +0200
@@ -110,6 +110,12 @@ if bld.CONFIG_SET('HAVE_KRB5_LOCATE_PLUG
 		deps='wbclient krb5 com_err',
 		realname='winbind_krb5_locator.so')
 
+if bld.CONFIG_SET('HAVE_KRB5_LOCALAUTH_PLUGIN_H'):
+    bld.SAMBA_LIBRARY('winbind_krb5_localauth',
+                      source='krb5_plugin/winbind_krb5_localauth.c',
+                      deps='wbclient krb5 com_err',
+                      realname='winbind-krb5-localauth.so')
+
 bld.SAMBA_SUBSYSTEM('WB_REQTRANS',
 	source='wb_reqtrans.c',
 	deps='talloc tevent LIBASYNC_REQ'
diff -Npur samba-4.8.2/selftest/knownfail samba-4.8.3/selftest/knownfail
--- samba-4.8.2/selftest/knownfail	2018-01-17 09:08:39.000000000 +0100
+++ samba-4.8.3/selftest/knownfail	2018-06-26 16:42:46.000000000 +0200
@@ -8,6 +8,7 @@
 .*driver.add_driver_timestamps # we only can store dates, not timestamps
  ^samba3.smbtorture_s3.crypt_server\(nt4_dc\).SMB2-SESSION-REAUTH # expected to give ACCESS_DENIED SMB2.1 doesn't have encryption
 ^samba3.smbtorture_s3.crypt_server\(nt4_dc\).SMB2-SESSION-RECONNECT # expected to give CONNECTION_DISCONNECTED, we need to fix the test
+^samba3.smbtorture_s3.*ad_dc_ntvfs.*SMB2-DIR-FSYNC.*
 ^samba3.smb2.session enc.reconnect # expected to give CONNECTION_DISCONNECTED, we need to fix the test
 ^samba3.raw.session enc # expected to give ACCESS_DENIED as SMB1 encryption isn't used
 ^samba3.smbtorture_s3.crypt_server # expected to give ACCESS_DENIED as SMB1 encryption isn't used
diff -Npur samba-4.8.2/selftest/knownfail.d/upn_handling samba-4.8.3/selftest/knownfail.d/upn_handling
--- samba-4.8.2/selftest/knownfail.d/upn_handling	1970-01-01 01:00:00.000000000 +0100
+++ samba-4.8.3/selftest/knownfail.d/upn_handling	2018-06-26 16:42:46.000000000 +0200
@@ -0,0 +1,8 @@
+^samba3\.wbinfo_user_info\.name_to_sid\.upn\.testdenied_upn.ad_member
+^samba3\.wbinfo_user_info\.user_info\.upn\.testdenied_upn.ad_member
+^samba3\.wbinfo_user_info\.user_info\.domain\.alice.fl2008r2dc
+^samba3\.wbinfo_user_info\.user_info\.upn\.alice.fl2008r2dc
+^samba3\.wbinfo_user_info\.user_info\.domain\.jane.fl2008r2dc
+^samba3\.wbinfo_user_info\.user_info\.upn\.jane\.doe.fl2008r2dc
+^samba3\.wbinfo_user_info\.name_to_sid\.upn\.testdenied_upn.fl2008r2dc
+^samba3\.wbinfo_user_info\.user_info\.upn\.testdenied_upn.fl2008r2dc
diff -Npur samba-4.8.2/selftest/target/Samba3.pm samba-4.8.3/selftest/target/Samba3.pm
--- samba-4.8.2/selftest/target/Samba3.pm	2018-05-16 12:09:25.000000000 +0200
+++ samba-4.8.3/selftest/target/Samba3.pm	2018-06-26 16:42:46.000000000 +0200
@@ -2140,6 +2140,12 @@ sub provision($$$$$$$$$)
 	vfs objects = acl_xattr fake_acls xattr_tdb fake_dfq
 	admin users = $unix_name
 	include = $dfqconffile
+[dfq_cache]
+	path = $shrdir/dfree
+	vfs objects = acl_xattr fake_acls xattr_tdb fake_dfq
+	admin users = $unix_name
+	include = $dfqconffile
+	dfree cache time = 60
 [dfq_owner]
 	path = $shrdir/dfree
 	vfs objects = acl_xattr fake_acls xattr_tdb fake_dfq
@@ -2425,6 +2431,9 @@ sub wait_for_start($$$$$)
 	$netcmd .= "NSS_WRAPPER_GROUP='$envvars->{NSS_WRAPPER_GROUP}' ";
 	$netcmd .= Samba::bindir_path($self, "net") ." $envvars->{CONFIGURATION} ";
 
+	$cmd = $netcmd . "groupmap delete ntgroup=domusers";
+	$ret = system($cmd);
+
 	$cmd = $netcmd . "groupmap add rid=513 unixgroup=domusers type=domain";
 	$ret = system($cmd);
 	if ($ret != 0) {
@@ -2432,6 +2441,9 @@ sub wait_for_start($$$$$)
 		return 1;
 	}
 
+	$cmd = $netcmd . "groupmap delete ntgroup=domadmins";
+	$ret = system($cmd);
+
 	$cmd = $netcmd . "groupmap add rid=512 unixgroup=domadmins type=domain";
 	$ret = system($cmd);
 	if ($ret != 0) {
@@ -2439,6 +2451,9 @@ sub wait_for_start($$$$$)
 		return 1;
 	}
 
+	$cmd = $netcmd . "groupmap delete ntgroup=everyone";
+	$ret = system($cmd);
+
 	$cmd = $netcmd . "groupmap add sid=S-1-1-0 unixgroup=everyone type=builtin";
 	$ret = system($cmd);
 	if ($ret != 0) {
diff -Npur samba-4.8.2/selftest/target/Samba4.pm samba-4.8.3/selftest/target/Samba4.pm
--- samba-4.8.2/selftest/target/Samba4.pm	2018-01-17 09:08:39.000000000 +0100
+++ samba-4.8.3/selftest/target/Samba4.pm	2018-06-26 16:42:46.000000000 +0200
@@ -847,7 +847,7 @@ userPrincipalName: testdenied_upn\@$ctx-
 	}
 
 	# Create to users alice and bob!
-	my $user_account_array = ["alice", "bob"];
+	my $user_account_array = ["alice", "bob", "jane"];
 
 	foreach my $user_account (@{$user_account_array}) {
 		my $samba_tool_cmd = "";
@@ -862,6 +862,23 @@ userPrincipalName: testdenied_upn\@$ctx-
 		}
 	}
 
+	my $ldbmodify = "";
+	$ldbmodify .= "KRB5_CONFIG=\"$ret->{KRB5_CONFIG}\" ";
+	$ldbmodify .= "KRB5CCNAME=\"$ret->{KRB5_CCACHE}\" ";
+	$ldbmodify .= Samba::bindir_path($self, "ldbmodify");
+
+	my $base_dn = "DC=".join(",DC=", split(/\./, $ctx->{realm}));
+	my $user_dn = "cn=jane,cn=users,$base_dn";
+
+	open(LDIF, "|$ldbmodify -H $ctx->{privatedir}/sam.ldb");
+	print LDIF "dn: $user_dn
+changetype: modify
+replace: userPrincipalName
+userPrincipalName: jane.doe\@$ctx->{realm}
+-
+";
+	close(LDIF);
+
 	return $ret;
 }
 
diff -Npur samba-4.8.2/source3/include/local.h samba-4.8.3/source3/include/local.h
--- samba-4.8.2/source3/include/local.h	2018-01-14 21:41:58.000000000 +0100
+++ samba-4.8.3/source3/include/local.h	2018-06-26 16:42:46.000000000 +0200
@@ -172,9 +172,6 @@
 /* Number in seconds for winbindd to wait for the mutex. Make this 2 * smbd wait time. */
 #define WINBIND_SERVER_MUTEX_WAIT_TIME (( ((NUM_CLI_AUTH_CONNECT_RETRIES) * ((CLI_AUTH_TIMEOUT)/1000)) + 5)*2)
 
-/* Buffer size to use when printing backtraces */
-#define BACKTRACE_STACK_SIZE 64
-
 /* size of listen() backlog in smbd */
 #define SMBD_LISTEN_BACKLOG 50
 
diff -Npur samba-4.8.2/source3/include/proto.h samba-4.8.3/source3/include/proto.h
--- samba-4.8.2/source3/include/proto.h	2018-01-17 09:08:39.000000000 +0100
+++ samba-4.8.3/source3/include/proto.h	2018-06-26 16:42:46.000000000 +0200
@@ -356,7 +356,6 @@ char *gidtoname(gid_t gid);
 uid_t nametouid(const char *name);
 gid_t nametogid(const char *name);
 void smb_panic_s3(const char *why);
-void log_stack_trace(void);
 const char *readdirname(DIR *p);
 bool is_in_path(const char *name, name_compare_entry *namelist, bool case_sensitive);
 void set_namearray(name_compare_entry **ppname_array, const char *namelist);
diff -Npur samba-4.8.2/source3/lib/ldap_escape.c samba-4.8.3/source3/lib/ldap_escape.c
--- samba-4.8.2/source3/lib/ldap_escape.c	2018-01-14 21:41:58.000000000 +0100
+++ samba-4.8.3/source3/lib/ldap_escape.c	2018-06-26 16:42:46.000000000 +0200
@@ -76,7 +76,7 @@ char *escape_ldap_string(TALLOC_CTX *mem
 			output = tmp;
 
 			p = &output[i];
-			strncpy (p, sub, 3);
+			memcpy(p, sub, 3);
 			p += 3;
 			i += 3;
 
diff -Npur samba-4.8.2/source3/lib/util.c samba-4.8.3/source3/lib/util.c
--- samba-4.8.2/source3/lib/util.c	2018-01-25 20:55:34.000000000 +0100
+++ samba-4.8.3/source3/lib/util.c	2018-06-26 16:42:46.000000000 +0200
@@ -839,145 +839,6 @@ void smb_panic_s3(const char *why)
 }
 
 /*******************************************************************
- Print a backtrace of the stack to the debug log. This function
- DELIBERATELY LEAKS MEMORY. The expectation is that you should
- exit shortly after calling it.
-********************************************************************/
-
-#ifdef HAVE_LIBUNWIND_H
-#include <libunwind.h>
-#endif
-
-#ifdef HAVE_EXECINFO_H
-#include <execinfo.h>
-#endif
-
-#ifdef HAVE_LIBEXC_H
-#include <libexc.h>
-#endif
-
-void log_stack_trace(void)
-{
-#ifdef HAVE_LIBUNWIND
-	/* Try to use libunwind before any other technique since on ia64
-	 * libunwind correctly walks the stack in more circumstances than
-	 * backtrace.
-	 */ 
-	unw_cursor_t cursor;
-	unw_context_t uc;
-	unsigned i = 0;
-
-	char procname[256];
-	unw_word_t ip, sp, off;
-
-	procname[sizeof(procname) - 1] = '\0';
-
-	if (unw_getcontext(&uc) != 0) {
-		goto libunwind_failed;
-	}
-
-	if (unw_init_local(&cursor, &uc) != 0) {
-		goto libunwind_failed;
-	}
-
-	DEBUG(0, ("BACKTRACE:\n"));
-
-	do {
-	    ip = sp = 0;
-	    unw_get_reg(&cursor, UNW_REG_IP, &ip);
-	    unw_get_reg(&cursor, UNW_REG_SP, &sp);
-
-	    switch (unw_get_proc_name(&cursor,
-			procname, sizeof(procname) - 1, &off) ) {
-	    case 0:
-		    /* Name found. */
-	    case -UNW_ENOMEM:
-		    /* Name truncated. */
-		    DEBUGADD(0, (" #%u %s + %#llx [ip=%#llx] [sp=%#llx]\n",
-			    i, procname, (long long)off,
-			    (long long)ip, (long long) sp));
-		    break;
-	    default:
-	    /* case -UNW_ENOINFO: */
-	    /* case -UNW_EUNSPEC: */
-		    /* No symbol name found. */
-		    DEBUGADD(0, (" #%u %s [ip=%#llx] [sp=%#llx]\n",
-			    i, "<unknown symbol>",
-			    (long long)ip, (long long) sp));
-	    }
-	    ++i;
-	} while (unw_step(&cursor) > 0);
-
-	return;
-
-libunwind_failed:
-	DEBUG(0, ("unable to produce a stack trace with libunwind\n"));
-
-#elif HAVE_BACKTRACE_SYMBOLS
-	void *backtrace_stack[BACKTRACE_STACK_SIZE];
-	size_t backtrace_size;
-	char **backtrace_strings;
-
-	/* get the backtrace (stack frames) */
-	backtrace_size = backtrace(backtrace_stack,BACKTRACE_STACK_SIZE);
-	backtrace_strings = backtrace_symbols(backtrace_stack, backtrace_size);
-
-	DEBUG(0, ("BACKTRACE: %lu stack frames:\n", 
-		  (unsigned long)backtrace_size));
-
-	if (backtrace_strings) {
-		int i;
-
-		for (i = 0; i < backtrace_size; i++)
-			DEBUGADD(0, (" #%u %s\n", i, backtrace_strings[i]));
-
-		/* Leak the backtrace_strings, rather than risk what free() might do */
-	}
-
-#elif HAVE_LIBEXC
-
-	/* The IRIX libexc library provides an API for unwinding the stack. See
-	 * libexc(3) for details. Apparantly trace_back_stack leaks memory, but
-	 * since we are about to abort anyway, it hardly matters.
-	 */
-
-#define NAMESIZE 32 /* Arbitrary */
-
-	__uint64_t	addrs[BACKTRACE_STACK_SIZE];
-	char *      	names[BACKTRACE_STACK_SIZE];
-	char		namebuf[BACKTRACE_STACK_SIZE * NAMESIZE];
-
-	int		i;
-	int		levels;
-
-	ZERO_ARRAY(addrs);
-	ZERO_ARRAY(names);
-	ZERO_ARRAY(namebuf);
-
-	/* We need to be root so we can open our /proc entry to walk
-	 * our stack. It also helps when we want to dump core.
-	 */
-	become_root();
-
-	for (i = 0; i < BACKTRACE_STACK_SIZE; i++) {
-		names[i] = namebuf + (i * NAMESIZE);
-	}
-
-	levels = trace_back_stack(0, addrs, names,
-			BACKTRACE_STACK_SIZE, NAMESIZE - 1);
-
-	DEBUG(0, ("BACKTRACE: %d stack frames:\n", levels));
-	for (i = 0; i < levels; i++) {
-		DEBUGADD(0, (" #%d 0x%llx %s\n", i, addrs[i], names[i]));
-	}
-#undef NAMESIZE
-
-#else
-	DEBUG(0, ("unable to produce a stack trace on this platform\n"));
-#endif
-}
-
-/*******************************************************************
   A readdir wrapper which just returns the file name.
  ********************************************************************/
 
diff -Npur samba-4.8.2/source3/modules/vfs_acl_common.c samba-4.8.3/source3/modules/vfs_acl_common.c
--- samba-4.8.2/source3/modules/vfs_acl_common.c	2018-01-17 09:08:39.000000000 +0100
+++ samba-4.8.3/source3/modules/vfs_acl_common.c	2018-06-26 16:42:46.000000000 +0200
@@ -941,8 +941,11 @@ NTSTATUS fset_nt_acl_common(
 	}
 
 	psd->revision = orig_psd->revision;
-	/* All our SD's are self relative. */
-	psd->type = orig_psd->type | SEC_DESC_SELF_RELATIVE;
+	if (security_info_sent & SECINFO_DACL) {
+		psd->type = orig_psd->type;
+		/* All our SD's are self relative. */
+		psd->type |= SEC_DESC_SELF_RELATIVE;
+	}
 
 	if ((security_info_sent & SECINFO_OWNER) && (orig_psd->owner_sid != NULL)) {
 		if (!dom_sid_equal(orig_psd->owner_sid, psd->owner_sid)) {
diff -Npur samba-4.8.2/source3/passdb/pdb_smbpasswd.c samba-4.8.3/source3/passdb/pdb_smbpasswd.c
--- samba-4.8.2/source3/passdb/pdb_smbpasswd.c	2018-01-14 21:41:58.000000000 +0100
+++ samba-4.8.3/source3/passdb/pdb_smbpasswd.c	2018-06-26 16:42:46.000000000 +0200
@@ -741,7 +741,7 @@ static bool mod_smbfilepwd_entry(struct
 	char linebuf[LINEBUF_SIZE + 1];
 	char readbuf[1024];
 	int c;
-	fstring ascii_p16;
+	char ascii_p16[FSTRING_LEN + 20];
 	fstring encode_bits;
 	unsigned char *p = NULL;
 	size_t linebuf_len = 0;
diff -Npur samba-4.8.2/source3/printing/printing.c samba-4.8.3/source3/printing/printing.c
--- samba-4.8.2/source3/printing/printing.c	2018-01-17 09:08:39.000000000 +0100
+++ samba-4.8.3/source3/printing/printing.c	2018-06-26 16:42:46.000000000 +0200
@@ -1693,7 +1693,7 @@ extern pid_t background_lpq_updater_pid;
 static void print_queue_update(struct messaging_context *msg_ctx,
 			       int snum, bool force)
 {
-	fstring key;
+	char key[268];
 	fstring sharename;
 	char *lpqcommand = NULL;
 	char *lprmcommand = NULL;
diff -Npur samba-4.8.2/source3/printing/printspoolss.c samba-4.8.3/source3/printing/printspoolss.c
--- samba-4.8.2/source3/printing/printspoolss.c	2018-01-14 21:41:58.000000000 +0100
+++ samba-4.8.3/source3/printing/printspoolss.c	2018-06-26 16:42:46.000000000 +0200
@@ -309,6 +309,23 @@ void print_spool_end(files_struct *fsp,
 	WERROR werr;
 	struct dcerpc_binding_handle *b = NULL;
 
+	if (fsp->fh->private_options &
+	    NTCREATEX_OPTIONS_PRIVATE_DELETE_ON_CLOSE) {
+		int ret;
+
+		/*
+		 * Job was requested to be cancelled by setting
+		 * delete on close so truncate the job file.
+		 * print_job_end() which is called from
+		 * _spoolss_EndDocPrinter() will take
+		 * care of deleting it for us.
+		 */
+		ret = ftruncate(fsp->fh->fd, 0);
+		if (ret == -1) {
+			DBG_ERR("ftruncate failed: %s\n", strerror(errno));
+		}
+	}
+
 	b = fsp->conn->spoolss_pipe->binding_handle;
 
 	switch (close_type) {
diff -Npur samba-4.8.2/source3/registry/reg_perfcount.c samba-4.8.3/source3/registry/reg_perfcount.c
--- samba-4.8.2/source3/registry/reg_perfcount.c	2018-01-14 21:41:58.000000000 +0100
+++ samba-4.8.3/source3/registry/reg_perfcount.c	2018-06-26 16:42:46.000000000 +0200
@@ -166,13 +166,12 @@ static uint32_t _reg_perfcount_multi_sz_
 					       uint32_t buffer_size)
 {
 	TDB_DATA kbuf, dbuf;
-	char temp[256];
+	char temp[PERFCOUNT_MAX_LEN] = {0};
 	char *buf1 = *retbuf;
 	uint32_t working_size = 0;
 	DATA_BLOB name_index, name;
 	bool ok;
 
-	memset(temp, 0, sizeof(temp));
 	snprintf(temp, sizeof(temp), "%d", keyval);
 	kbuf = string_tdb_data(temp);
 	dbuf = tdb_fetch(tdb, kbuf);
@@ -709,13 +708,13 @@ static bool _reg_perfcount_get_instance_
 					     TDB_CONTEXT *names)
 {
 	TDB_DATA key, data;
-	char buf[PERFCOUNT_MAX_LEN], temp[PERFCOUNT_MAX_LEN];
+	char buf[PERFCOUNT_MAX_LEN] = {0};
+	char temp[32] = {0};
 	smb_ucs2_t *name = NULL;
 	int pad;
 
 	/* First grab the instance data from the data file */
-	memset(temp, 0, PERFCOUNT_MAX_LEN);
-	snprintf(temp, PERFCOUNT_MAX_LEN, "i%d", instId);
+	snprintf(temp, sizeof(temp), "i%d", instId);
 	_reg_perfcount_make_key(&key, buf, PERFCOUNT_MAX_LEN, obj->ObjectNameTitleIndex, temp);
 	if (!_reg_perfcount_get_counter_data(key, &data)) {
 		DEBUG(3, ("_reg_perfcount_get_counter_data failed\n"));
@@ -739,8 +738,7 @@ static bool _reg_perfcount_get_instance_
 	SAFE_FREE(data.dptr);
 
 	/* Fetch instance name */
-	memset(temp, 0, PERFCOUNT_MAX_LEN);
-	snprintf(temp, PERFCOUNT_MAX_LEN, "i%dname", instId);
+	snprintf(temp, sizeof(temp), "i%dname", instId);
 	_reg_perfcount_make_key(&key, buf, PERFCOUNT_MAX_LEN, obj->ObjectNameTitleIndex, temp);
 	data = tdb_fetch(names, key);
 	if(data.dptr == NULL)
diff -Npur samba-4.8.2/source3/script/tests/test_dfree_quota.sh samba-4.8.3/source3/script/tests/test_dfree_quota.sh
--- samba-4.8.2/source3/script/tests/test_dfree_quota.sh	2018-01-14 21:41:58.000000000 +0100
+++ samba-4.8.3/source3/script/tests/test_dfree_quota.sh	2018-06-26 16:42:46.000000000 +0200
@@ -130,6 +130,35 @@ test_smbclient_dfree() {
 	return $status
 }
 
+# Issue two queries to different directories in one session to test
+# caching effects
+test_smbclient_dfree_2() {
+	name="$1"
+	share="$2"
+	dir1="$3"
+	dir2="$4"
+	confs="$5"
+	expected="$6"
+	subunit_start_test "$name"
+	setup_conf $confs
+	output=$($VALGRIND $smbclient //$SERVER/$share \
+			   -c "cd $dir1; du; cd ..; cd $dir2 ; du" $@ 2>&1)
+	status=$?
+	if [ "$status" = "0" ]; then
+		received=$(echo "$output" | \
+				   awk '/blocks of size/ {print $1, $5, $6}' | \
+				   tr '\n' ' ')
+		if [ "$expected" = "$received" ]; then
+			subunit_pass_test "$name"
+		else
+			echo "$output" | subunit_fail_test "$name"
+		fi
+	else
+		echo "$output" | subunit_fail_test "$name"
+	fi
+	return $status
+}
+
 test_smbcquotas() {
 	name="$1"
     conf="$2"
@@ -164,6 +193,12 @@ test_smbclient_dfree "Test large disk" d
 #basic quota test (SMB1 only)
 test_smbcquotas "Test user quota" confq1 $USERNAME "40960/4096000/3072000" -U$USERNAME%$PASSWORD --option=clientmaxprotocol=NT1 || failed=`expr $failed + 1`
 
+# Test dfree cache through queries in two different directories
+test_smbclient_dfree_2 "Test dfree cache" dfq_cache "." "subdir1" \
+		       "conf1 . conf2 subdir1" "10 1024. 5 20 1024. 10 " \
+		       -U$USERNAME%$PASSWORD --option=clientmaxprotocol=SMB3 \
+	|| failed=`expr $failed + 1`
+
 #quota limit > disk size, remaining quota > disk free
 test_smbclient_dfree "Test dfree share root df vs quota case 1" dfq "." "confdfq1 ." "80 1024. 40" -U$USERNAME%$PASSWORD --option=clientmaxprotocol=SMB3 || failed=`expr $failed + 1`
 #quota limit > disk size, remaining quota < disk free
diff -Npur samba-4.8.2/source3/script/tests/test_smbspool.sh samba-4.8.3/source3/script/tests/test_smbspool.sh
--- samba-4.8.2/source3/script/tests/test_smbspool.sh	2018-05-16 12:09:25.000000000 +0200
+++ samba-4.8.3/source3/script/tests/test_smbspool.sh	2018-06-26 16:42:46.000000000 +0200
@@ -22,6 +22,7 @@ incdir=`dirname $0`/../../../testprogs/b
 samba_bindir="$BINDIR"
 samba_vlp="$samba_bindir/vlp"
 samba_smbspool="$samba_bindir/smbspool"
+samba_smbtorture3="$samba_bindir/smbtorture3"
 samba_smbspool_krb5="$samba_bindir/smbspool_krb5_wrapper"
 
 test_smbspool_noargs()
@@ -119,6 +120,64 @@ test_vlp_verify()
 	fi
 }
 
+test_delete_on_close()
+{
+	tdbfile="$PREFIX_ABS/$TARGET_ENV/lockdir/vlp.tdb"
+	if [ ! -w $tdbfile ]; then
+		echo "vlp tdbfile $tdbfile doesn't exist or is not writeable!"
+		return 1
+	fi
+
+	cmd='$samba_vlp tdbfile=$tdbfile lpq print1 2>&1'
+	eval echo "$cmd"
+	out=$(eval $cmd)
+	ret=$?
+	if [ $ret != 0 ]; then
+		echo "failed to lpq jobs on print1 with $samba_vlp"
+		echo "$out"
+		return 1
+	fi
+
+	num_jobs=$(echo "$out" | wc -l)
+	#
+	# Now run the test DELETE-PRINT from smbtorture3
+	#
+	cmd='$samba_smbtorture3 //$SERVER_IP/print1 -U$USERNAME%$PASSWORD DELETE-PRINT 2>&1'
+	eval echo "$cmd"
+	out_t=$(eval $cmd)
+	ret=$?
+	if [ $ret != 0 ]; then
+		echo "failed to run DELETE-PRINT on print1"
+		echo "$out_t"
+		return 1
+	fi
+
+	cmd='$samba_vlp tdbfile=$tdbfile lpq print1 2>&1'
+	eval echo "$cmd"
+	out1=$(eval $cmd)
+	ret=$?
+	if [ $ret != 0 ]; then
+		echo "(2) failed to lpq jobs on print1 with $samba_vlp"
+		echo "$out1"
+		return 1
+	fi
+	num_jobs1=$(echo "$out1" | wc -l)
+
+	#
+	# Number of jobs should not change. Job
+	# should not have made it to backend.
+	#
+	if [ "$num_jobs1" -ne "$num_jobs" ]; then
+		echo "delete-on-close fail $num_jobs1 -ne $num_jobs"
+		echo "$out"
+		echo "$out_t"
+		echo "$out1"
+		return 1
+	fi
+
+	return 0
+}
+
 testit "smbspool no args" \
 	test_smbspool_noargs $samba_smbspool || \
 	failed=$(expr $failed + 1)
@@ -180,4 +239,8 @@ testit "vlp verify example.ps" \
 	failed=$(expr $failed + 1)
 unset AUTH_INFO_REQUIRED
 
+testit "delete on close" \
+	test_delete_on_close \
+	|| failed=$(expr $failed + 1)
+
 exit $failed
diff -Npur samba-4.8.2/source3/selftest/tests.py samba-4.8.3/source3/selftest/tests.py
--- samba-4.8.2/source3/selftest/tests.py	2018-05-16 12:09:25.000000000 +0200
+++ samba-4.8.3/source3/selftest/tests.py	2018-06-26 16:42:46.000000000 +0200
@@ -78,7 +78,7 @@ tests = ["FDPASS", "LOCK1", "LOCK2", "LO
         "UID-REGRESSION-TEST", "SHORTNAME-TEST",
         "CASE-INSENSITIVE-CREATE", "SMB2-BASIC", "NTTRANS-FSCTL", "SMB2-NEGPROT",
         "SMB2-SESSION-REAUTH", "SMB2-SESSION-RECONNECT", "SMB2-FTRUNCATE",
-        "SMB2-ANONYMOUS",
+        "SMB2-ANONYMOUS", "SMB2-DIR-FSYNC",
         "CLEANUP1",
         "CLEANUP2",
         "CLEANUP4",
@@ -210,7 +210,21 @@ plantestsuite("samba3.wbinfo_simple.(%s:
 plantestsuite("samba3.wbinfo_name_lookup", env,
               [ os.path.join(srcdir(),
                             "nsswitch/tests/test_wbinfo_name_lookup.sh"),
-                '$DOMAIN', '$DC_USERNAME' ])
+                '$DOMAIN', '$REALM', '$DC_USERNAME' ])
+
+env = "ad_member:local"
+plantestsuite("samba3.wbinfo_user_info", env,
+              [ os.path.join(srcdir(),
+                            "nsswitch/tests/test_wbinfo_user_info.sh"),
+                '$DOMAIN', '$REALM', 'alice', 'alice', 'jane', 'jane.doe' ])
+
+env = "fl2008r2dc:local"
+plantestsuite("samba3.wbinfo_user_info", env,
+              [ os.path.join(srcdir(),
+                            "nsswitch/tests/test_wbinfo_user_info.sh"),
+                '$TRUST_DOMAIN', '$TRUST_REALM', 'alice', 'alice', 'jane', 'jane.doe' ])
+
+env = "ad_member"
 t = "WBCLIENT-MULTI-PING"
 plantestsuite("samba3.smbtorture_s3.%s" % t, env, [os.path.join(samba3srcdir, "script/tests/test_smbtorture_s3.sh"), t, '//foo/bar', '""', '""', smbtorture3, ""])
 plantestsuite("samba3.substitutions", env, [os.path.join(samba3srcdir, "script/tests/test_substitutions.sh"), "$SERVER", "alice", "Secret007", "$PREFIX"])
diff -Npur samba-4.8.2/source3/smbd/dfree.c samba-4.8.3/source3/smbd/dfree.c
--- samba-4.8.2/source3/smbd/dfree.c	2018-01-14 21:41:58.000000000 +0100
+++ samba-4.8.3/source3/smbd/dfree.c	2018-06-26 16:42:46.000000000 +0200
@@ -21,6 +21,7 @@
 #include "smbd/smbd.h"
 #include "smbd/globals.h"
 #include "lib/util_file.h"
+#include "lib/util/memcache.h"
 
 /****************************************************************************
  Normalise for DOS usage.
@@ -167,48 +168,113 @@ dfree_done:
 
 /****************************************************************************
  Potentially returned cached dfree info.
+
+ Depending on the file system layout and file system features, the free space
+ information can be different for different sub directories underneath a SMB
+ share. Store the cache information in memcache using the query path as the
+ key to accomodate this.
 ****************************************************************************/
 
 uint64_t get_dfree_info(connection_struct *conn, struct smb_filename *fname,
 			uint64_t *bsize, uint64_t *dfree, uint64_t *dsize)
 {
 	int dfree_cache_time = lp_dfree_cache_time(SNUM(conn));
-	struct dfree_cached_info *dfc = conn->dfree_info;
+	struct dfree_cached_info *dfc = NULL;
+	struct dfree_cached_info dfc_new = { 0 };
 	uint64_t dfree_ret;
+	char tmpbuf[PATH_MAX];
+	char *full_path = NULL;
+	char *to_free = NULL;
+	char *key_path = NULL;
+	size_t len;
+	DATA_BLOB key, value;
+	bool found;
 
 	if (!dfree_cache_time) {
 		return sys_disk_free(conn, fname, bsize, dfree, dsize);
 	}
 
+	len = full_path_tos(conn->connectpath,
+			    fname->base_name,
+			    tmpbuf,
+			    sizeof(tmpbuf),
+			    &full_path,
+			    &to_free);
+	if (len == -1) {
+		errno = ENOMEM;
+		return -1;
+	}
+
+	if (VALID_STAT(fname->st) && S_ISREG(fname->st.st_ex_mode)) {
+		/*
+		 * In case of a file use the parent directory to reduce number
+		 * of cache entries.
+		 */
+		bool ok;
+
+		ok = parent_dirname(talloc_tos(),
+				    full_path,
+				    &key_path,
+				    NULL);
+		TALLOC_FREE(to_free); /* We're done with full_path */
+
+		if (!ok) {
+			errno = ENOMEM;
+			return -1;
+		}
+
+		/*
+		 * key_path is always a talloced object.
+		 */
+		to_free = key_path;
+	} else {
+		/*
+		 * key_path might not be a talloced object; rely on
+		 * to_free set from full_path_tos.
+		 */
+		key_path = full_path;
+	}
+
+	key = data_blob_const(key_path, strlen(key_path));
+	found = memcache_lookup(smbd_memcache(),
+				DFREE_CACHE,
+				key,
+				&value);
+	dfc = found ? (struct dfree_cached_info *)value.data : NULL;
+
 	if (dfc && (conn->lastused - dfc->last_dfree_time < dfree_cache_time)) {
-		/* Return cached info. */
+		DBG_DEBUG("Returning dfree cache entry for %s\n", key_path);
 		*bsize = dfc->bsize;
 		*dfree = dfc->dfree;
 		*dsize = dfc->dsize;
-		return dfc->dfree_ret;
+		dfree_ret = dfc->dfree_ret;
+		goto out;
 	}
 
 	dfree_ret = sys_disk_free(conn, fname, bsize, dfree, dsize);
 
 	if (dfree_ret == (uint64_t)-1) {
 		/* Don't cache bad data. */
-		return dfree_ret;
+		goto out;
 	}
 
-	/* No cached info or time to refresh. */
-	if (!dfc) {
-		dfc = talloc(conn, struct dfree_cached_info);
-		if (!dfc) {
-			return dfree_ret;
-		}
-		conn->dfree_info = dfc;
-	}
-
-	dfc->bsize = *bsize;
-	dfc->dfree = *dfree;
-	dfc->dsize = *dsize;
-	dfc->dfree_ret = dfree_ret;
-	dfc->last_dfree_time = conn->lastused;
+	DBG_DEBUG("Creating dfree cache entry for %s\n", key_path);
+	dfc_new.bsize = *bsize;
+	dfc_new.dfree = *dfree;
+	dfc_new.dsize = *dsize;
+	dfc_new.dfree_ret = dfree_ret;
+	dfc_new.last_dfree_time = conn->lastused;
+	memcache_add(smbd_memcache(),
+		     DFREE_CACHE,
+		     key,
+		     data_blob_const(&dfc_new, sizeof(dfc_new)));
 
+out:
+	TALLOC_FREE(to_free);
 	return dfree_ret;
 }
+
+void flush_dfree_cache(void)
+{
+	memcache_flush(smbd_memcache(), DFREE_CACHE);
+}
diff -Npur samba-4.8.2/source3/smbd/proto.h samba-4.8.3/source3/smbd/proto.h
--- samba-4.8.2/source3/smbd/proto.h	2018-01-17 09:08:39.000000000 +0100
+++ samba-4.8.3/source3/smbd/proto.h	2018-06-26 16:42:46.000000000 +0200
@@ -176,6 +176,7 @@ uint64_t sys_disk_free(connection_struct
 		       uint64_t *bsize, uint64_t *dfree, uint64_t *dsize);
 uint64_t get_dfree_info(connection_struct *conn, struct smb_filename *fname,
 			uint64_t *bsize, uint64_t *dfree, uint64_t *dsize);
+void flush_dfree_cache(void);
 
 /* The following definitions come from smbd/dir.c  */
 
diff -Npur samba-4.8.2/source3/smbd/pysmbd.c samba-4.8.3/source3/smbd/pysmbd.c
--- samba-4.8.2/source3/smbd/pysmbd.c	2018-01-17 09:08:39.000000000 +0100
+++ samba-4.8.3/source3/smbd/pysmbd.c	2018-06-26 16:42:46.000000000 +0200
@@ -268,101 +268,101 @@ static int set_acl_entry_perms(SMB_ACL_E
 	return 0;
 }
 
-static SMB_ACL_T make_simple_acl(gid_t gid, mode_t chmod_mode)
+static SMB_ACL_T make_simple_acl(TALLOC_CTX *mem_ctx,
+			gid_t gid,
+			mode_t chmod_mode)
 {
-	TALLOC_CTX *frame = talloc_stackframe();
-
 	mode_t mode = SMB_ACL_READ|SMB_ACL_WRITE|SMB_ACL_EXECUTE;
 
 	mode_t mode_user = (chmod_mode & 0700) >> 6;
 	mode_t mode_group = (chmod_mode & 070) >> 3;
 	mode_t mode_other = chmod_mode &  07;
 	SMB_ACL_ENTRY_T entry;
-	SMB_ACL_T acl = sys_acl_init(frame);
+	SMB_ACL_T acl = sys_acl_init(mem_ctx);
 
 	if (!acl) {
 		return NULL;
 	}
 
 	if (sys_acl_create_entry(&acl, &entry) != 0) {
-		TALLOC_FREE(frame);
+		TALLOC_FREE(acl);
 		return NULL;
 	}
 
 	if (sys_acl_set_tag_type(entry, SMB_ACL_USER_OBJ) != 0) {
-		TALLOC_FREE(frame);
+		TALLOC_FREE(acl);
 		return NULL;
 	}
 
 	if (set_acl_entry_perms(entry, mode_user) != 0) {
-		TALLOC_FREE(frame);
+		TALLOC_FREE(acl);
 		return NULL;
 	}
 
 	if (sys_acl_create_entry(&acl, &entry) != 0) {
-		TALLOC_FREE(frame);
+		TALLOC_FREE(acl);
 		return NULL;
 	}
 
 	if (sys_acl_set_tag_type(entry, SMB_ACL_GROUP_OBJ) != 0) {
-		TALLOC_FREE(frame);
+		TALLOC_FREE(acl);
 		return NULL;
 	}
 
 	if (set_acl_entry_perms(entry, mode_group) != 0) {
-		TALLOC_FREE(frame);
+		TALLOC_FREE(acl);
 		return NULL;
 	}
 
 	if (sys_acl_create_entry(&acl, &entry) != 0) {
-		TALLOC_FREE(frame);
+		TALLOC_FREE(acl);
 		return NULL;
 	}
 
 	if (sys_acl_set_tag_type(entry, SMB_ACL_OTHER) != 0) {
-		TALLOC_FREE(frame);
+		TALLOC_FREE(acl);
 		return NULL;
 	}
 
 	if (set_acl_entry_perms(entry, mode_other) != 0) {
-		TALLOC_FREE(frame);
+		TALLOC_FREE(acl);
 		return NULL;
 	}
 
 	if (gid != -1) {
 		if (sys_acl_create_entry(&acl, &entry) != 0) {
-			TALLOC_FREE(frame);
+			TALLOC_FREE(acl);
 			return NULL;
 		}
 
 		if (sys_acl_set_tag_type(entry, SMB_ACL_GROUP) != 0) {
-			TALLOC_FREE(frame);
+			TALLOC_FREE(acl);
 			return NULL;
 		}
 
 		if (sys_acl_set_qualifier(entry, &gid) != 0) {
-			TALLOC_FREE(frame);
+			TALLOC_FREE(acl);
 			return NULL;
 		}
 
 		if (set_acl_entry_perms(entry, mode_group) != 0) {
-			TALLOC_FREE(frame);
+			TALLOC_FREE(acl);
 			return NULL;
 		}
 	}
 
 	if (sys_acl_create_entry(&acl, &entry) != 0) {
-		TALLOC_FREE(frame);
+		TALLOC_FREE(acl);
 		return NULL;
 	}
 
 	if (sys_acl_set_tag_type(entry, SMB_ACL_MASK) != 0) {
-		TALLOC_FREE(frame);
+		TALLOC_FREE(acl);
 		return NULL;
 	}
 
 	if (set_acl_entry_perms(entry, mode) != 0) {
-		TALLOC_FREE(frame);
+		TALLOC_FREE(acl);
 		return NULL;
 	}
 	return acl;
@@ -386,17 +386,20 @@ static PyObject *py_smbd_set_simple_acl(
 					 &fname, &mode, &gid, &service))
 		return NULL;
 
-	acl = make_simple_acl(gid, mode);
-
 	frame = talloc_stackframe();
 
+	acl = make_simple_acl(frame, gid, mode);
+	if (acl == NULL) {
+		TALLOC_FREE(frame);
+		return NULL;
+	}
+
 	conn = get_conn(frame, service);
 	if (!conn) {
 		return NULL;
 	}
 
 	ret = set_sys_acl_conn(fname, SMB_ACL_TYPE_ACCESS, acl, conn);
-	TALLOC_FREE(acl);
 
 	if (ret != 0) {
 		TALLOC_FREE(frame);
diff -Npur samba-4.8.2/source3/smbd/server_reload.c samba-4.8.3/source3/smbd/server_reload.c
--- samba-4.8.2/source3/smbd/server_reload.c	2018-01-14 21:41:58.000000000 +0100
+++ samba-4.8.3/source3/smbd/server_reload.c	2018-06-26 16:42:46.000000000 +0200
@@ -164,6 +164,7 @@ bool reload_services(struct smbd_server_
 
 	mangle_reset_cache();
 	reset_stat_cache();
+	flush_dfree_cache();
 
 	/* this forces service parameters to be flushed */
 	set_current_service(NULL,0,True);
diff -Npur samba-4.8.2/source3/smbd/smb2_flush.c samba-4.8.3/source3/smbd/smb2_flush.c
--- samba-4.8.2/source3/smbd/smb2_flush.c	2018-04-26 09:21:03.000000000 +0200
+++ samba-4.8.3/source3/smbd/smb2_flush.c	2018-06-26 16:42:46.000000000 +0200
@@ -23,6 +23,7 @@
 #include "smbd/globals.h"
 #include "../libcli/smb/smb_common.h"
 #include "../lib/util/tevent_ntstatus.h"
+#include "libcli/security/security.h"
 
 #undef DBGC_CLASS
 #define DBGC_CLASS DBGC_SMB2
@@ -147,8 +148,29 @@ static struct tevent_req *smbd_smb2_flus
 	}
 
 	if (!CHECK_WRITE(fsp)) {
-		tevent_req_nterror(req, NT_STATUS_ACCESS_DENIED);
-		return tevent_req_post(req, ev);
+		bool allow_dir_flush = false;
+		uint32_t flush_access = FILE_ADD_FILE | FILE_ADD_SUBDIRECTORY;
+
+		if (!fsp->is_directory) {
+			tevent_req_nterror(req, NT_STATUS_ACCESS_DENIED);
+			return tevent_req_post(req, ev);
+		}
+
+		/*
+		 * Directories are not writable in the conventional
+		 * sense, but if opened with *either*
+		 * FILE_ADD_FILE or FILE_ADD_SUBDIRECTORY
+		 * they can be flushed.
+		 */
+
+		if ((fsp->access_mask & flush_access) != 0) {
+			allow_dir_flush = true;
+		}
+
+		if (allow_dir_flush == false) {
+			tevent_req_nterror(req, NT_STATUS_ACCESS_DENIED);
+			return tevent_req_post(req, ev);
+		}
 	}
 
 	if (fsp->fh->fd == -1) {
diff -Npur samba-4.8.2/source3/torture/proto.h samba-4.8.3/source3/torture/proto.h
--- samba-4.8.2/source3/torture/proto.h	2018-04-26 09:21:03.000000000 +0200
+++ samba-4.8.3/source3/torture/proto.h	2018-06-26 16:42:46.000000000 +0200
@@ -101,6 +101,7 @@ bool run_smb2_tcon_dependence(int dummy)
 bool run_smb2_multi_channel(int dummy);
 bool run_smb2_session_reauth(int dummy);
 bool run_smb2_ftruncate(int dummy);
+bool run_smb2_dir_fsync(int dummy);
 bool run_chain3(int dummy);
 bool run_local_conv_auth_info(int dummy);
 bool run_local_sprintf_append(int dummy);
diff -Npur samba-4.8.2/source3/torture/test_smb2.c samba-4.8.3/source3/torture/test_smb2.c
--- samba-4.8.2/source3/torture/test_smb2.c	2018-04-26 09:21:03.000000000 +0200
+++ samba-4.8.3/source3/torture/test_smb2.c	2018-06-26 16:42:46.000000000 +0200
@@ -2065,3 +2065,273 @@ bool run_smb2_ftruncate(int dummy)
 	}
 	return correct;
 }
+
+/* Ensure SMB2 flush on directories behaves correctly. */
+
+static bool test_dir_fsync(struct cli_state *cli, const char *path)
+{
+	NTSTATUS status;
+	uint64_t fid_persistent, fid_volatile;
+	uint8_t *dir_data = NULL;
+	uint32_t dir_data_length = 0;
+
+	/* Open directory - no write abilities. */
+	status = smb2cli_create(cli->conn, cli->timeout, cli->smb2.session,
+			cli->smb2.tcon, path,
+			SMB2_OPLOCK_LEVEL_NONE, /* oplock_level, */
+			SMB2_IMPERSONATION_IMPERSONATION, /* impersonation_level, */
+			SEC_STD_SYNCHRONIZE|
+			SEC_DIR_LIST|
+			SEC_DIR_READ_ATTRIBUTE, /* desired_access, */
+			0, /* file_attributes, */
+			FILE_SHARE_READ|FILE_SHARE_WRITE|FILE_SHARE_DELETE, /* share_access, */
+			FILE_OPEN, /* create_disposition, */
+			FILE_SYNCHRONOUS_IO_NONALERT|FILE_DIRECTORY_FILE, /* create_options, */
+			NULL, /* smb2_create_blobs *blobs */
+			&fid_persistent,
+			&fid_volatile,
+			NULL, NULL, NULL);
+	if (!NT_STATUS_IS_OK(status)) {
+		printf("smb2cli_create '%s' (readonly) returned %s\n",
+			path,
+			nt_errstr(status));
+		return false;
+	}
+
+	status = smb2cli_query_directory(
+		cli->conn, cli->timeout, cli->smb2.session, cli->smb2.tcon,
+		1, 0, 0, fid_persistent, fid_volatile, "*", 0xffff,
+		talloc_tos(), &dir_data, &dir_data_length);
+
+	if (!NT_STATUS_IS_OK(status)) {
+		printf("smb2cli_query_directory returned %s\n",
+			nt_errstr(status));
+		return false;
+	}
+
+	/* Open directory no write access. Flush should fail. */
+
+	status = smb2cli_flush(cli->conn, cli->timeout, cli->smb2.session,
+			       cli->smb2.tcon, fid_persistent, fid_volatile);
+	if (!NT_STATUS_EQUAL(status, NT_STATUS_ACCESS_DENIED)) {
+		printf("smb2cli_flush on a read-only directory returned %s\n",
+			nt_errstr(status));
+		return false;
+	}
+
+	status = smb2cli_close(cli->conn, cli->timeout, cli->smb2.session,
+			       cli->smb2.tcon, 0, fid_persistent, fid_volatile);
+	if (!NT_STATUS_IS_OK(status)) {
+		printf("smb2cli_close returned %s\n", nt_errstr(status));
+		return false;
+	}
+
+	/* Open directory write-attributes only. Flush should still fail. */
+
+	status = smb2cli_create(cli->conn, cli->timeout, cli->smb2.session,
+			cli->smb2.tcon, path,
+			SMB2_OPLOCK_LEVEL_NONE, /* oplock_level, */
+			SMB2_IMPERSONATION_IMPERSONATION, /* impersonation_level, */
+			SEC_STD_SYNCHRONIZE|
+			SEC_DIR_LIST|
+			SEC_DIR_WRITE_ATTRIBUTE|
+			SEC_DIR_READ_ATTRIBUTE, /* desired_access, */
+			0, /* file_attributes, */
+			FILE_SHARE_READ|FILE_SHARE_WRITE|FILE_SHARE_DELETE, /* share_access, */
+			FILE_OPEN, /* create_disposition, */
+			FILE_SYNCHRONOUS_IO_NONALERT|FILE_DIRECTORY_FILE, /* create_options, */
+			NULL, /* smb2_create_blobs *blobs */
+			&fid_persistent,
+			&fid_volatile,
+			NULL, NULL, NULL);
+	if (!NT_STATUS_IS_OK(status)) {
+		printf("smb2cli_create '%s' (write attr) returned %s\n",
+			path,
+			nt_errstr(status));
+		return false;
+	}
+
+	status = smb2cli_query_directory(
+		cli->conn, cli->timeout, cli->smb2.session, cli->smb2.tcon,
+		1, 0, 0, fid_persistent, fid_volatile, "*", 0xffff,
+		talloc_tos(), &dir_data, &dir_data_length);
+
+	if (!NT_STATUS_IS_OK(status)) {
+		printf("smb2cli_query_directory returned %s\n", nt_errstr(status));
+		return false;
+	}
+
+	status = smb2cli_flush(cli->conn, cli->timeout, cli->smb2.session,
+			       cli->smb2.tcon, fid_persistent, fid_volatile);
+	if (!NT_STATUS_EQUAL(status, NT_STATUS_ACCESS_DENIED)) {
+		printf("smb2cli_flush on a write-attributes directory "
+			"returned %s\n",
+			nt_errstr(status));
+		return false;
+	}
+
+	status = smb2cli_close(cli->conn, cli->timeout, cli->smb2.session,
+			       cli->smb2.tcon, 0, fid_persistent, fid_volatile);
+	if (!NT_STATUS_IS_OK(status)) {
+		printf("smb2cli_close returned %s\n", nt_errstr(status));
+		return false;
+	}
+
+	/* Open directory with SEC_DIR_ADD_FILE access. Flush should now succeed. */
+
+	status = smb2cli_create(cli->conn, cli->timeout, cli->smb2.session,
+			cli->smb2.tcon, path,
+			SMB2_OPLOCK_LEVEL_NONE, /* oplock_level, */
+			SMB2_IMPERSONATION_IMPERSONATION, /* impersonation_level, */
+			SEC_STD_SYNCHRONIZE|
+			SEC_DIR_LIST|
+			SEC_DIR_ADD_FILE, /* desired_access, */
+			0, /* file_attributes, */
+			FILE_SHARE_READ|FILE_SHARE_WRITE|FILE_SHARE_DELETE, /* share_access, */
+			FILE_OPEN, /* create_disposition, */
+			FILE_SYNCHRONOUS_IO_NONALERT|FILE_DIRECTORY_FILE, /* create_options, */
+			NULL, /* smb2_create_blobs *blobs */
+			&fid_persistent,
+			&fid_volatile,
+			NULL, NULL, NULL);
+	if (!NT_STATUS_IS_OK(status)) {
+		printf("smb2cli_create '%s' (write FILE access) returned %s\n",
+			path,
+			nt_errstr(status));
+		return false;
+	}
+
+	status = smb2cli_query_directory(
+		cli->conn, cli->timeout, cli->smb2.session, cli->smb2.tcon,
+		1, 0, 0, fid_persistent, fid_volatile, "*", 0xffff,
+		talloc_tos(), &dir_data, &dir_data_length);
+
+	if (!NT_STATUS_IS_OK(status)) {
+		printf("smb2cli_query_directory returned %s\n", nt_errstr(status));
+		return false;
+	}
+
+	status = smb2cli_flush(cli->conn, cli->timeout, cli->smb2.session,
+			       cli->smb2.tcon, fid_persistent, fid_volatile);
+	if (!NT_STATUS_IS_OK(status)) {
+		printf("smb2cli_flush on a directory returned %s\n",
+			nt_errstr(status));
+		return false;
+	}
+
+	status = smb2cli_close(cli->conn, cli->timeout, cli->smb2.session,
+			       cli->smb2.tcon, 0, fid_persistent, fid_volatile);
+	if (!NT_STATUS_IS_OK(status)) {
+		printf("smb2cli_close returned %s\n", nt_errstr(status));
+		return false;
+	}
+
+	/* Open directory with SEC_DIR_ADD_FILE access. Flush should now succeed. */
+
+	status = smb2cli_create(cli->conn, cli->timeout, cli->smb2.session,
+			cli->smb2.tcon, path,
+			SMB2_OPLOCK_LEVEL_NONE, /* oplock_level, */
+			SMB2_IMPERSONATION_IMPERSONATION, /* impersonation_level, */
+			SEC_STD_SYNCHRONIZE|
+			SEC_DIR_LIST|
+			SEC_DIR_ADD_SUBDIR, /* desired_access, */
+			0, /* file_attributes, */
+			FILE_SHARE_READ|FILE_SHARE_WRITE|FILE_SHARE_DELETE, /* share_access, */
+			FILE_OPEN, /* create_disposition, */
+			FILE_SYNCHRONOUS_IO_NONALERT|FILE_DIRECTORY_FILE, /* create_options, */
+			NULL, /* smb2_create_blobs *blobs */
+			&fid_persistent,
+			&fid_volatile,
+			NULL, NULL, NULL);
+	if (!NT_STATUS_IS_OK(status)) {
+		printf("smb2cli_create '%s' (write DIR access) returned %s\n",
+			path,
+			nt_errstr(status));
+		return false;
+	}
+
+	status = smb2cli_query_directory(
+		cli->conn, cli->timeout, cli->smb2.session, cli->smb2.tcon,
+		1, 0, 0, fid_persistent, fid_volatile, "*", 0xffff,
+		talloc_tos(), &dir_data, &dir_data_length);
+
+	if (!NT_STATUS_IS_OK(status)) {
+		printf("smb2cli_query_directory returned %s\n", nt_errstr(status));
+		return false;
+	}
+
+	status = smb2cli_flush(cli->conn, cli->timeout, cli->smb2.session,
+			       cli->smb2.tcon, fid_persistent, fid_volatile);
+	if (!NT_STATUS_IS_OK(status)) {
+		printf("smb2cli_flush on a directory returned %s\n",
+			nt_errstr(status));
+		return false;
+	}
+
+	status = smb2cli_close(cli->conn, cli->timeout, cli->smb2.session,
+			       cli->smb2.tcon, 0, fid_persistent, fid_volatile);
+	if (!NT_STATUS_IS_OK(status)) {
+		printf("smb2cli_close returned %s\n", nt_errstr(status));
+		return false;
+	}
+
+
+	return true;
+}
+
+bool run_smb2_dir_fsync(int dummy)
+{
+	struct cli_state *cli = NULL;
+	NTSTATUS status;
+	bool bret = false;
+	const char *dname = "fsync_test_dir";
+
+	printf("Starting SMB2-DIR-FSYNC\n");
+
+	if (!torture_init_connection(&cli)) {
+		return false;
+	}
+
+	status = smbXcli_negprot(cli->conn, cli->timeout,
+				 PROTOCOL_SMB2_02, PROTOCOL_SMB2_02);
+	if (!NT_STATUS_IS_OK(status)) {
+		printf("smbXcli_negprot returned %s\n", nt_errstr(status));
+		return false;
+	}
+
+	status = cli_session_setup_creds(cli, torture_creds);
+	if (!NT_STATUS_IS_OK(status)) {
+		printf("cli_session_setup returned %s\n", nt_errstr(status));
+		return false;
+	}
+
+	status = cli_tree_connect(cli, share, "?????", NULL);
+	if (!NT_STATUS_IS_OK(status)) {
+		printf("cli_tree_connect returned %s\n", nt_errstr(status));
+		return false;
+	}
+
+	(void)cli_rmdir(cli, dname);
+	status = cli_mkdir(cli, dname);
+	if (!NT_STATUS_IS_OK(status)) {
+		printf("cli_mkdir(%s) returned %s\n",
+			dname,
+			nt_errstr(status));
+		return false;
+	}
+
+	/* Test on a subdirectory. */
+	bret = test_dir_fsync(cli, dname);
+	if (bret == false) {
+		(void)cli_rmdir(cli, dname);
+		return false;
+	}
+	(void)cli_rmdir(cli, dname);
+
+	/* Test on the root handle of a share. */
+	bret = test_dir_fsync(cli, "");
+	if (bret == false) {
+		return false;
+	}
+	return true;
+}
diff -Npur samba-4.8.2/source3/torture/torture.c samba-4.8.3/source3/torture/torture.c
--- samba-4.8.2/source3/torture/torture.c	2018-04-26 09:21:03.000000000 +0200
+++ samba-4.8.3/source3/torture/torture.c	2018-06-26 16:42:46.000000000 +0200
@@ -4560,6 +4560,78 @@ static bool run_deletetest(int dummy)
 	return correct;
 }
 
+/*
+  Exercise delete on close semantics - use on the PRINT1 share in torture
+  testing.
+ */
+static bool run_delete_print_test(int dummy)
+{
+	struct cli_state *cli1 = NULL;
+	const char *fname = "print_delete.file";
+	uint16_t fnum1 = (uint16_t)-1;
+	bool correct = false;
+	const char *buf = "print file data\n";
+	NTSTATUS status;
+
+	printf("starting print delete test\n");
+
+	if (!torture_open_connection(&cli1, 0)) {
+		return false;
+	}
+
+	smbXcli_conn_set_sockopt(cli1->conn, sockops);
+
+	status = cli_ntcreate(cli1, fname, 0, GENERIC_ALL_ACCESS|DELETE_ACCESS,
+			      FILE_ATTRIBUTE_NORMAL, 0, FILE_OVERWRITE_IF,
+			      0, 0, &fnum1, NULL);
+	if (!NT_STATUS_IS_OK(status)) {
+		printf("open of %s failed (%s)\n",
+			fname,
+			nt_errstr(status));
+		goto fail;
+	}
+
+	status = cli_writeall(cli1,
+			fnum1,
+			0,
+			(const uint8_t *)buf,
+			0, /* offset */
+			strlen(buf), /* size */
+			NULL);
+	if (!NT_STATUS_IS_OK(status)) {
+		printf("writing print file data failed (%s)\n",
+			nt_errstr(status));
+		goto fail;
+	}
+
+	status = cli_nt_delete_on_close(cli1, fnum1, true);
+	if (!NT_STATUS_IS_OK(status)) {
+		printf("setting delete_on_close failed (%s)\n",
+			nt_errstr(status));
+		goto fail;
+	}
+
+	status = cli_close(cli1, fnum1);
+	if (!NT_STATUS_IS_OK(status)) {
+		printf("close failed (%s)\n", nt_errstr(status));
+		goto fail;
+	}
+
+	printf("finished print delete test\n");
+
+	correct = true;
+
+  fail:
+
+	if (fnum1 != (uint16_t)-1) {
+		cli_close(cli1, fnum1);
+	}
+
+	if (cli1 && !torture_close_connection(cli1)) {
+		correct = false;
+	}
+	return correct;
+}
 
 /*
   Test wildcard delete.
@@ -11550,6 +11622,7 @@ static struct {
 	{"RENAME-ACCESS", run_rename_access, 0},
 	{"OWNER-RIGHTS", run_owner_rights, 0},
 	{"DELETE", run_deletetest, 0},
+	{"DELETE-PRINT", run_delete_print_test, 0},
 	{"WILDDELETE", run_wild_deletetest, 0},
 	{"DELETE-LN", run_deletetest_ln, 0},
 	{"PROPERTIES", run_properties, 0},
@@ -11594,6 +11667,7 @@ static struct {
 	{ "SMB2-MULTI-CHANNEL", run_smb2_multi_channel },
 	{ "SMB2-SESSION-REAUTH", run_smb2_session_reauth },
 	{ "SMB2-FTRUNCATE", run_smb2_ftruncate },
+	{ "SMB2-DIR-FSYNC", run_smb2_dir_fsync },
 	{ "CLEANUP1", run_cleanup1 },
 	{ "CLEANUP2", run_cleanup2 },
 	{ "CLEANUP3", run_cleanup3 },
diff -Npur samba-4.8.2/source3/utils/net_dns.c samba-4.8.3/source3/utils/net_dns.c
--- samba-4.8.2/source3/utils/net_dns.c	2018-01-14 21:41:58.000000000 +0100
+++ samba-4.8.3/source3/utils/net_dns.c	2018-06-26 16:42:46.000000000 +0200
@@ -75,6 +75,7 @@ DNS_ERROR DoDNSUpdate(char *pszServerNam
 
 		if (!ERR_DNS_IS_OK(err)) {
 			DEBUG(3,("DoDNSUpdate: failed to probe DNS\n"));
+			goto error;
 		}
 
 		if ((dns_response_code(resp->flags) == DNS_NO_ERROR) &&
diff -Npur samba-4.8.2/source3/utils/smbget.c samba-4.8.3/source3/utils/smbget.c
--- samba-4.8.2/source3/utils/smbget.c	2018-01-14 21:41:58.000000000 +0100
+++ samba-4.8.3/source3/utils/smbget.c	2018-06-26 16:42:46.000000000 +0200
@@ -288,7 +288,7 @@ static void print_progress(const char *n
 	double avg = 0.0;
 	long eta = -1;
 	double prcnt = 0.0;
-	char hpos[20], htotal[20], havg[20];
+	char hpos[22], htotal[22], havg[22];
 	char *status, *filename;
 	int len;
 	if (now - start) {
diff -Npur samba-4.8.2/source3/utils/smbpasswd.c samba-4.8.3/source3/utils/smbpasswd.c
--- samba-4.8.2/source3/utils/smbpasswd.c	2018-01-17 09:08:39.000000000 +0100
+++ samba-4.8.3/source3/utils/smbpasswd.c	2018-06-26 16:42:46.000000000 +0200
@@ -368,36 +368,44 @@ static int process_root(int local_flags)
 
 	if (local_flags & LOCAL_TRUST_ACCOUNT) {
 		/* add the $ automatically */
-		static fstring buf;
+		size_t user_name_len = strlen(user_name);
 
-		/*
-		 * Remove any trailing '$' before we
-		 * generate the initial machine password.
-		 */
-
-		if (user_name[strlen(user_name)-1] == '$') {
-			user_name[strlen(user_name)-1] = 0;
+		if (user_name[user_name_len - 1] == '$') {
+			user_name_len--;
+		} else {
+			if (user_name_len + 2 > sizeof(user_name)) {
+				fprintf(stderr, "machine name too long\n");
+				exit(1);
+			}
+			user_name[user_name_len] = '$';
+			user_name[user_name_len + 1] = '\0';
 		}
 
 		if (local_flags & LOCAL_ADD_USER) {
 		        SAFE_FREE(new_passwd);
-			new_passwd = smb_xstrdup(user_name);
+
+			/*
+			 * Remove any trailing '$' before we
+			 * generate the initial machine password.
+			 */
+			new_passwd = smb_xstrndup(user_name, user_name_len);
 			if (!strlower_m(new_passwd)) {
 				fprintf(stderr, "strlower_m %s failed\n",
 					new_passwd);
 				exit(1);
 			}
 		}
-
-		/*
-		 * Now ensure the username ends in '$' for
-		 * the machine add.
-		 */
-
-		slprintf(buf, sizeof(buf)-1, "%s$", user_name);
-		strlcpy(user_name, buf, sizeof(user_name));
 	} else if (local_flags & LOCAL_INTERDOM_ACCOUNT) {
-		static fstring buf;
+		size_t user_name_len = strlen(user_name);
+
+		if (user_name[user_name_len - 1] != '$') {
+			if (user_name_len + 2 > sizeof(user_name)) {
+				fprintf(stderr, "machine name too long\n");
+				exit(1);
+			}
+			user_name[user_name_len] = '$';
+			user_name[user_name_len + 1] = '\0';
+		}
 
 		if ((local_flags & LOCAL_ADD_USER) && (new_passwd == NULL)) {
 			/*
@@ -409,11 +417,6 @@ static int process_root(int local_flags)
 				exit(1);
 			}
 		}
-
-		/* prepare uppercased and '$' terminated username */
-		slprintf(buf, sizeof(buf) - 1, "%s$", user_name);
-		strlcpy(user_name, buf, sizeof(user_name));
-
 	} else {
 
 		if (remote_machine != NULL) {
diff -Npur samba-4.8.2/source3/winbindd/wb_getpwsid.c samba-4.8.3/source3/winbindd/wb_getpwsid.c
--- samba-4.8.2/source3/winbindd/wb_getpwsid.c	2018-01-17 09:08:39.000000000 +0100
+++ samba-4.8.3/source3/winbindd/wb_getpwsid.c	2018-06-26 16:42:46.000000000 +0200
@@ -69,7 +69,8 @@ static void wb_getpwsid_queryuser_done(s
 		req, struct wb_getpwsid_state);
 	struct winbindd_pw *pw = state->pw;
 	struct wbint_userinfo *info;
-	fstring acct_name, output_username;
+	fstring acct_name;
+	const char *output_username = NULL;
 	char *mapped_name = NULL;
 	char *tmp;
 	NTSTATUS status;
@@ -100,17 +101,17 @@ static void wb_getpwsid_queryuser_done(s
 				    info->domain_name,
 				    acct_name,
 				    &mapped_name);
-	if (NT_STATUS_IS_OK(status)) {
-		fill_domain_username(output_username,
-				     info->domain_name,
-				     mapped_name, true);
+	if (NT_STATUS_IS_OK(status) ||
+	    NT_STATUS_EQUAL(status, NT_STATUS_FILE_RENAMED)) {
 		fstrcpy(acct_name, mapped_name);
-	} else if (NT_STATUS_EQUAL(status, NT_STATUS_FILE_RENAMED)) {
-		fstrcpy(acct_name, mapped_name);
-	} else {
-		fill_domain_username(output_username,
-				     info->domain_name,
-				     acct_name, true);
+	}
+	output_username = fill_domain_username_talloc(state,
+						      info->domain_name,
+						      acct_name,
+						      true);
+	if (output_username == NULL) {
+		tevent_req_nterror(req, NT_STATUS_NO_MEMORY);
+		return;
 	}
 
 	strlcpy(pw->pw_name, output_username, sizeof(pw->pw_name));
diff -Npur samba-4.8.2/source3/winbindd/wb_lookupname.c samba-4.8.3/source3/winbindd/wb_lookupname.c
--- samba-4.8.2/source3/winbindd/wb_lookupname.c	2018-01-14 21:41:58.000000000 +0100
+++ samba-4.8.3/source3/winbindd/wb_lookupname.c	2018-06-26 16:42:46.000000000 +0200
@@ -35,7 +35,9 @@ static void wb_lookupname_done(struct te
 
 struct tevent_req *wb_lookupname_send(TALLOC_CTX *mem_ctx,
 				      struct tevent_context *ev,
-				      const char *dom_name, const char *name,
+				      const char *namespace,
+				      const char *dom_name,
+				      const char *name,
 				      uint32_t flags)
 {
 	struct tevent_req *req, *subreq;
@@ -61,9 +63,9 @@ struct tevent_req *wb_lookupname_send(TA
 		return tevent_req_post(req, ev);
 	}
 
-	domain = find_lookup_domain_from_name(state->dom_name);
+	domain = find_lookup_domain_from_name(namespace);
 	if (domain == NULL) {
-		DEBUG(5, ("Could not find domain for %s\n", state->dom_name));
+		DEBUG(5, ("Could not find domain for %s\n", namespace));
 		tevent_req_nterror(req, NT_STATUS_NONE_MAPPED);
 		return tevent_req_post(req, ev);
 	}
diff -Npur samba-4.8.2/source3/winbindd/wb_query_user_list.c samba-4.8.3/source3/winbindd/wb_query_user_list.c
--- samba-4.8.2/source3/winbindd/wb_query_user_list.c	2018-01-14 21:41:58.000000000 +0100
+++ samba-4.8.3/source3/winbindd/wb_query_user_list.c	2018-06-26 16:42:46.000000000 +0200
@@ -104,11 +104,14 @@ static void wb_query_user_list_done(stru
 
 	for (i=0; i<state->names.num_principals; i++) {
 		struct wbint_Principal *p = &state->names.principals[i];
-		fstring name;
+		const char *name;
 		int ret;
 
-		fill_domain_username(name, state->domain_name, p->name, true);
-
+		name = fill_domain_username_talloc(state, state->domain_name, p->name, true);
+		if (name == NULL) {
+			tevent_req_nterror(req, NT_STATUS_NO_MEMORY);
+			return;
+		}
 		ret = strv_add(state, &state->users, name);
 		if (ret != 0) {
 			tevent_req_nterror(req, map_nt_error_from_unix(ret));
diff -Npur samba-4.8.2/source3/winbindd/wb_xids2sids.c samba-4.8.3/source3/winbindd/wb_xids2sids.c
--- samba-4.8.2/source3/winbindd/wb_xids2sids.c	2018-01-17 09:08:39.000000000 +0100
+++ samba-4.8.3/source3/winbindd/wb_xids2sids.c	2018-06-26 16:42:46.000000000 +0200
@@ -185,6 +185,7 @@ static void wb_xids2sids_init_dom_maps_l
 	subreq = wb_lookupname_send(state,
 				    state->ev,
 				    dom_maps[state->dom_idx].name,
+				    dom_maps[state->dom_idx].name,
 				    "",
 				    LOOKUP_NAME_NO_NSS);
 	if (tevent_req_nomem(subreq, state->req)) {
diff -Npur samba-4.8.2/source3/winbindd/winbindd_cache.c samba-4.8.3/source3/winbindd/winbindd_cache.c
--- samba-4.8.2/source3/winbindd/winbindd_cache.c	2018-01-17 09:08:39.000000000 +0100
+++ samba-4.8.3/source3/winbindd/winbindd_cache.c	2018-06-26 16:42:46.000000000 +0200
@@ -3221,7 +3221,8 @@ bool lookup_cached_sid(TALLOC_CTX *mem_c
 	return NT_STATUS_IS_OK(status);
 }
 
-bool lookup_cached_name(const char *domain_name,
+bool lookup_cached_name(const char *namespace,
+			const char *domain_name,
 			const char *name,
 			struct dom_sid *sid,
 			enum lsa_SidType *type)
@@ -3230,7 +3231,7 @@ bool lookup_cached_name(const char *doma
 	NTSTATUS status;
 	bool original_online_state;
 
-	domain = find_lookup_domain_from_name(domain_name);
+	domain = find_lookup_domain_from_name(namespace);
 	if (domain == NULL) {
 		return false;
 	}
diff -Npur samba-4.8.2/source3/winbindd/winbindd_ccache_access.c samba-4.8.3/source3/winbindd/winbindd_ccache_access.c
--- samba-4.8.2/source3/winbindd/winbindd_ccache_access.c	2018-01-14 21:41:58.000000000 +0100
+++ samba-4.8.3/source3/winbindd/winbindd_ccache_access.c	2018-06-26 16:42:46.000000000 +0200
@@ -43,8 +43,9 @@ static bool client_can_access_ccache_ent
 	return False;
 }
 
-static NTSTATUS do_ntlm_auth_with_stored_pw(const char *username,
+static NTSTATUS do_ntlm_auth_with_stored_pw(const char *namespace,
 					    const char *domain,
+					    const char *username,
 					    const char *password,
 					    const DATA_BLOB initial_msg,
 					    const DATA_BLOB challenge_msg,
@@ -182,11 +183,12 @@ static bool check_client_uid(struct winb
 void winbindd_ccache_ntlm_auth(struct winbindd_cli_state *state)
 {
 	struct winbindd_domain *domain;
-	fstring name_domain, name_user;
+	fstring name_namespace, name_domain, name_user;
 	NTSTATUS result = NT_STATUS_NOT_SUPPORTED;
 	struct WINBINDD_MEMORY_CREDS *entry;
 	DATA_BLOB initial, challenge, auth;
 	uint32_t initial_blob_len, challenge_blob_len, extra_len;
+	bool ok;
 
 	/* Ensure null termination */
 	state->request->data.ccache_ntlm_auth.user[
@@ -197,8 +199,11 @@ void winbindd_ccache_ntlm_auth(struct wi
 
 	/* Parse domain and username */
 
-	if (!canonicalize_username(state->request->data.ccache_ntlm_auth.user,
-				name_domain, name_user)) {
+	ok = canonicalize_username(state->request->data.ccache_ntlm_auth.user,
+				   name_namespace,
+				   name_domain,
+				   name_user);
+	if (!ok) {
 		DEBUG(5,("winbindd_ccache_ntlm_auth: cannot parse domain and user from name [%s]\n",
 			state->request->data.ccache_ntlm_auth.user));
 		request_error(state);
@@ -238,7 +243,11 @@ void winbindd_ccache_ntlm_auth(struct wi
 	}
 
 	/* Parse domain and username */
-	if (!parse_domain_user(state->request->data.ccache_ntlm_auth.user, name_domain, name_user)) {
+	ok = parse_domain_user(state->request->data.ccache_ntlm_auth.user,
+			       name_namespace,
+			       name_domain,
+			       name_user);
+	if (!ok) {
 		DEBUG(10,("winbindd_dual_ccache_ntlm_auth: cannot parse "
 			"domain and user from name [%s]\n",
 			state->request->data.ccache_ntlm_auth.user));
@@ -273,10 +282,16 @@ void winbindd_ccache_ntlm_auth(struct wi
 		state->request->data.ccache_ntlm_auth.challenge_blob_len);
 
 	result = do_ntlm_auth_with_stored_pw(
-		name_user, name_domain, entry->pass,
-		initial, challenge, talloc_tos(), &auth,
-		state->response->data.ccache_ntlm_auth.session_key,
-		&state->response->data.ccache_ntlm_auth.new_spnego);
+			name_namespace,
+			name_domain,
+			name_user,
+			entry->pass,
+			initial,
+			challenge,
+			talloc_tos(),
+			&auth,
+			state->response->data.ccache_ntlm_auth.session_key,
+			&state->response->data.ccache_ntlm_auth.new_spnego);
 
 	if (!NT_STATUS_IS_OK(result)) {
 		goto process_result;
@@ -304,8 +319,9 @@ void winbindd_ccache_ntlm_auth(struct wi
 void winbindd_ccache_save(struct winbindd_cli_state *state)
 {
 	struct winbindd_domain *domain;
-	fstring name_domain, name_user;
+	fstring name_namespace, name_domain, name_user;
 	NTSTATUS status;
+	bool ok;
 
 	/* Ensure null termination */
 	state->request->data.ccache_save.user[
@@ -319,8 +335,11 @@ void winbindd_ccache_save(struct winbind
 
 	/* Parse domain and username */
 
-	if (!canonicalize_username(state->request->data.ccache_save.user,
-				   name_domain, name_user)) {
+	ok = canonicalize_username(state->request->data.ccache_save.user,
+				   name_namespace,
+				   name_domain,
+				   name_user);
+	if (!ok) {
 		DEBUG(5,("winbindd_ccache_save: cannot parse domain and user "
 			 "from name [%s]\n",
 			 state->request->data.ccache_save.user));
diff -Npur samba-4.8.2/source3/winbindd/winbindd_creds.c samba-4.8.3/source3/winbindd/winbindd_creds.c
--- samba-4.8.2/source3/winbindd/winbindd_creds.c	2018-01-14 21:41:58.000000000 +0100
+++ samba-4.8.3/source3/winbindd/winbindd_creds.c	2018-06-26 16:42:46.000000000 +0200
@@ -76,7 +76,8 @@ NTSTATUS winbindd_store_creds(struct win
 
 		enum lsa_SidType type;
 
-		if (!lookup_cached_name(domain->name,
+		if (!lookup_cached_name(domain->name, /* namespace */
+					domain->name,
 					user,
 					&cred_sid,
 					&type)) {
diff -Npur samba-4.8.2/source3/winbindd/winbindd_getgrnam.c samba-4.8.3/source3/winbindd/winbindd_getgrnam.c
--- samba-4.8.2/source3/winbindd/winbindd_getgrnam.c	2018-01-17 09:08:39.000000000 +0100
+++ samba-4.8.3/source3/winbindd/winbindd_getgrnam.c	2018-06-26 16:42:46.000000000 +0200
@@ -22,7 +22,7 @@
 
 struct winbindd_getgrnam_state {
 	struct tevent_context *ev;
-	fstring name_domain, name_group;
+	fstring name_namespace, name_domain, name_group;
 	struct dom_sid sid;
 	const char *domname;
 	const char *name;
@@ -42,6 +42,7 @@ struct tevent_req *winbindd_getgrnam_sen
 	struct winbindd_getgrnam_state *state;
 	char *tmp;
 	NTSTATUS nt_status;
+	bool ok;
 
 	req = tevent_req_create(mem_ctx, &state,
 				struct winbindd_getgrnam_state);
@@ -66,7 +67,15 @@ struct tevent_req *winbindd_getgrnam_sen
 
 	/* Parse domain and groupname */
 
-	parse_domain_user(tmp, state->name_domain, state->name_group);
+	ok = parse_domain_user(tmp,
+			       state->name_namespace,
+			       state->name_domain,
+			       state->name_group);
+	if (!ok) {
+		DBG_INFO("Could not parse domain user: %s\n", tmp);
+		tevent_req_nterror(req, NT_STATUS_INVALID_PARAMETER);
+		return tevent_req_post(req, ev);
+	}
 
 	/* if no domain or our local domain and no local tdb group, default to
 	 * our local domain for aliases */
@@ -76,7 +85,10 @@ struct tevent_req *winbindd_getgrnam_sen
 		fstrcpy(state->name_domain, get_global_sam_name());
 	}
 
-	subreq = wb_lookupname_send(state, ev, state->name_domain, state->name_group,
+	subreq = wb_lookupname_send(state, ev,
+				    state->name_namespace,
+				    state->name_domain,
+				    state->name_group,
 				    0);
 	if (tevent_req_nomem(subreq, req)) {
 		return tevent_req_post(req, ev);
diff -Npur samba-4.8.2/source3/winbindd/winbindd_getgroups.c samba-4.8.3/source3/winbindd/winbindd_getgroups.c
--- samba-4.8.2/source3/winbindd/winbindd_getgroups.c	2018-01-14 21:41:58.000000000 +0100
+++ samba-4.8.3/source3/winbindd/winbindd_getgroups.c	2018-06-26 16:42:46.000000000 +0200
@@ -23,6 +23,7 @@
 
 struct winbindd_getgroups_state {
 	struct tevent_context *ev;
+	fstring namespace;
 	fstring domname;
 	fstring username;
 	struct dom_sid sid;
@@ -46,6 +47,7 @@ struct tevent_req *winbindd_getgroups_se
 	struct winbindd_getgroups_state *state;
 	char *domuser, *mapped_user;
 	NTSTATUS status;
+	bool ok;
 
 	req = tevent_req_create(mem_ctx, &state,
 				struct winbindd_getgroups_state);
@@ -69,13 +71,20 @@ struct tevent_req *winbindd_getgroups_se
 		domuser = mapped_user;
 	}
 
-	if (!parse_domain_user(domuser, state->domname, state->username)) {
+	ok = parse_domain_user(domuser,
+			       state->namespace,
+			       state->domname,
+			       state->username);
+	if (!ok) {
 		DEBUG(5, ("Could not parse domain user: %s\n", domuser));
 		tevent_req_nterror(req, NT_STATUS_INVALID_PARAMETER);
 		return tevent_req_post(req, ev);
 	}
 
-	subreq = wb_lookupname_send(state, ev, state->domname, state->username,
+	subreq = wb_lookupname_send(state, ev,
+				    state->namespace,
+				    state->domname,
+				    state->username,
 				    LOOKUP_NAME_NO_NSS);
 	if (tevent_req_nomem(subreq, req)) {
 		return tevent_req_post(req, ev);
diff -Npur samba-4.8.2/source3/winbindd/winbindd_getpwnam.c samba-4.8.3/source3/winbindd/winbindd_getpwnam.c
--- samba-4.8.2/source3/winbindd/winbindd_getpwnam.c	2018-01-17 09:08:39.000000000 +0100
+++ samba-4.8.3/source3/winbindd/winbindd_getpwnam.c	2018-06-26 16:42:46.000000000 +0200
@@ -23,6 +23,7 @@
 
 struct winbindd_getpwnam_state {
 	struct tevent_context *ev;
+	fstring namespace;
 	fstring domname;
 	fstring username;
 	struct dom_sid sid;
@@ -42,6 +43,7 @@ struct tevent_req *winbindd_getpwnam_sen
 	struct winbindd_getpwnam_state *state;
 	char *domuser, *mapped_user;
 	NTSTATUS status;
+	bool ok;
 
 	req = tevent_req_create(mem_ctx, &state,
 				struct winbindd_getpwnam_state);
@@ -65,13 +67,20 @@ struct tevent_req *winbindd_getpwnam_sen
 		domuser = mapped_user;
 	}
 
-	if (!parse_domain_user(domuser, state->domname, state->username)) {
+	ok = parse_domain_user(domuser,
+			       state->namespace,
+			       state->domname,
+			       state->username);
+	if (!ok) {
 		DEBUG(5, ("Could not parse domain user: %s\n", domuser));
 		tevent_req_nterror(req, NT_STATUS_INVALID_PARAMETER);
 		return tevent_req_post(req, ev);
 	}
 
-	subreq = wb_lookupname_send(state, ev, state->domname, state->username,
+	subreq = wb_lookupname_send(state, ev,
+				    state->namespace,
+				    state->domname,
+				    state->username,
 				    LOOKUP_NAME_NO_NSS);
 	if (tevent_req_nomem(subreq, req)) {
 		return tevent_req_post(req, ev);
diff -Npur samba-4.8.2/source3/winbindd/winbindd_group.c samba-4.8.3/source3/winbindd/winbindd_group.c
--- samba-4.8.2/source3/winbindd/winbindd_group.c	2018-01-17 09:08:39.000000000 +0100
+++ samba-4.8.3/source3/winbindd/winbindd_group.c	2018-06-26 16:42:46.000000000 +0200
@@ -34,7 +34,7 @@
 bool fill_grent(TALLOC_CTX *mem_ctx, struct winbindd_gr *gr,
 		const char *dom_name, const char *gr_name, gid_t unix_gid)
 {
-	fstring full_group_name;
+	const char *full_group_name;
 	char *mapped_name = NULL;
 	NTSTATUS nt_status = NT_STATUS_UNSUCCESSFUL;
 
@@ -43,19 +43,23 @@ bool fill_grent(TALLOC_CTX *mem_ctx, str
 
 	/* Basic whitespace replacement */
 	if (NT_STATUS_IS_OK(nt_status)) {
-		fill_domain_username(full_group_name, dom_name,
+		full_group_name = fill_domain_username_talloc(mem_ctx, dom_name,
 				     mapped_name, true);
 	}
 	/* Mapped to an aliase */
 	else if (NT_STATUS_EQUAL(nt_status, NT_STATUS_FILE_RENAMED)) {
-		fstrcpy(full_group_name, mapped_name);
+		full_group_name = mapped_name;
 	}
 	/* no change */
 	else {
-		fill_domain_username( full_group_name, dom_name,
+		full_group_name = fill_domain_username_talloc(mem_ctx, dom_name,
 				      gr_name, True );
 	}
 
+	if (full_group_name == NULL) {
+		return false;
+	}
+
 	gr->gr_gid = unix_gid;
 
 	/* Group name and password */
diff -Npur samba-4.8.2/source3/winbindd/winbindd_irpc.c samba-4.8.3/source3/winbindd/winbindd_irpc.c
--- samba-4.8.2/source3/winbindd/winbindd_irpc.c	2018-03-01 21:18:10.000000000 +0100
+++ samba-4.8.3/source3/winbindd/winbindd_irpc.c	2018-06-26 16:42:46.000000000 +0200
@@ -464,6 +464,7 @@ static void wb_irpc_lsa_LookupSids3_done
 struct wb_irpc_lsa_LookupNames4_name {
 	void *state;
 	uint32_t idx;
+	const char *namespace;
 	const char *domain;
 	char *name;
 	struct dom_sid sid;
@@ -551,11 +552,12 @@ static NTSTATUS wb_irpc_lsa_LookupNames4
 		if (p != NULL) {
 			*p = 0;
 			nstate->domain = nstate->name;
+			nstate->namespace = nstate->domain;
 			nstate->name = p+1;
 		} else if ((p = strchr(nstate->name, '@')) != NULL) {
 			/* upn */
-			nstate->domain = p + 1;
-			*p = 0;
+			nstate->domain = "";
+			nstate->namespace = p + 1;
 		} else {
 			/*
 			 * TODO: select the domain based on
@@ -570,6 +572,7 @@ static NTSTATUS wb_irpc_lsa_LookupNames4
 
 		subreq = wb_lookupname_send(msg,
 					    server_event_context(),
+					    nstate->namespace,
 					    nstate->domain,
 					    nstate->name,
 					    LOOKUP_NAME_NO_NSS);
diff -Npur samba-4.8.2/source3/winbindd/winbindd_list_groups.c samba-4.8.3/source3/winbindd/winbindd_list_groups.c
--- samba-4.8.2/source3/winbindd/winbindd_list_groups.c	2018-01-14 21:41:58.000000000 +0100
+++ samba-4.8.3/source3/winbindd/winbindd_list_groups.c	2018-06-26 16:42:46.000000000 +0200
@@ -166,10 +166,13 @@ NTSTATUS winbindd_list_groups_recv(struc
 		struct winbindd_list_groups_domstate *d = &state->domains[i];
 
 		for (j=0; j<d->groups.num_principals; j++) {
-			fstring name;
-			fill_domain_username(name, d->domain->name,
+			const char *name;
+			name = fill_domain_username_talloc(response, d->domain->name,
 					     d->groups.principals[j].name,
 					     True);
+			if (name == NULL) {
+				return NT_STATUS_NO_MEMORY;
+			}
 			len += strlen(name)+1;
 		}
 		response->data.num_entries += d->groups.num_principals;
@@ -185,11 +188,14 @@ NTSTATUS winbindd_list_groups_recv(struc
 		struct winbindd_list_groups_domstate *d = &state->domains[i];
 
 		for (j=0; j<d->groups.num_principals; j++) {
-			fstring name;
+			const char *name;
 			size_t this_len;
-			fill_domain_username(name, d->domain->name,
+			name = fill_domain_username_talloc(response, d->domain->name,
 					     d->groups.principals[j].name,
 					     True);
+			if (name == NULL) {
+				return NT_STATUS_NO_MEMORY;
+			}
 			this_len = strlen(name);
 			memcpy(result+len, name, this_len);
 			len += this_len;
diff -Npur samba-4.8.2/source3/winbindd/winbindd_lookupname.c samba-4.8.3/source3/winbindd/winbindd_lookupname.c
--- samba-4.8.2/source3/winbindd/winbindd_lookupname.c	2018-04-26 09:21:03.000000000 +0200
+++ samba-4.8.3/source3/winbindd/winbindd_lookupname.c	2018-06-26 16:42:46.000000000 +0200
@@ -35,8 +35,10 @@ struct tevent_req *winbindd_lookupname_s
 {
 	struct tevent_req *req, *subreq;
 	struct winbindd_lookupname_state *state;
-	const char *domname = NULL, *name = NULL;
 	char *p = NULL;
+	const char *domname = NULL;
+	const char *name = NULL;
+	const char *namespace = NULL;
 
 	req = tevent_req_create(mem_ctx, &state,
 				struct winbindd_lookupname_state);
@@ -56,28 +58,29 @@ struct tevent_req *winbindd_lookupname_s
 		if (p != NULL) {
 			*p = '\0';
 			domname = request->data.name.name;
+			namespace = domname;
 			name = p + 1;
 		} else {
 			p = strchr(request->data.name.name, '@');
 			if (p != NULL) {
 				/* upn */
-				domname = p + 1;
-				*p = '\0';
-				name = request->data.name.name;
+				namespace = p + 1;
 			} else {
-				domname = "";
-				name = request->data.name.name;
+				namespace = "";
 			}
+			domname = "";
+			name = request->data.name.name;
 		}
 	} else {
 		domname = request->data.name.dom_name;
+		namespace = domname;
 		name = request->data.name.name;
 	}
 
 	DEBUG(3, ("lookupname %s%s%s\n", domname, lp_winbind_separator(),
 		  name));
 
-	subreq = wb_lookupname_send(state, ev, domname, name, 0);
+	subreq = wb_lookupname_send(state, ev, namespace, domname, name, 0);
 	if (tevent_req_nomem(subreq, req)) {
 		return tevent_req_post(req, ev);
 	}
diff -Npur samba-4.8.2/source3/winbindd/winbindd_pam.c samba-4.8.3/source3/winbindd/winbindd_pam.c
--- samba-4.8.2/source3/winbindd/winbindd_pam.c	2018-02-12 11:27:16.000000000 +0100
+++ samba-4.8.3/source3/winbindd/winbindd_pam.c	2018-06-26 16:42:46.000000000 +0200
@@ -193,7 +193,7 @@ static NTSTATUS append_unix_username(TAL
 	/* We've been asked to return the unix username, per
 	   'winbind use default domain' settings and the like */
 
-	const char *nt_username, *nt_domain;
+	const char *nt_username, *nt_domain, *unix_username;
 
 	nt_domain = talloc_strdup(mem_ctx, info3->base.logon_domain.string);
 	if (!nt_domain) {
@@ -209,8 +209,15 @@ static NTSTATUS append_unix_username(TAL
 		nt_username = name_user;
 	}
 
-	fill_domain_username(resp->data.auth.unix_username,
-			     nt_domain, nt_username, true);
+	unix_username = fill_domain_username_talloc(mem_ctx,
+						    nt_domain,
+						    nt_username,
+						    true);
+	if (unix_username == NULL) {
+		return NT_STATUS_NO_MEMORY;
+	}
+
+	fstrcpy(resp->data.auth.unix_username, unix_username);
 
 	DEBUG(5, ("Setting unix username to [%s]\n",
 		  resp->data.auth.unix_username));
@@ -645,7 +652,7 @@ static NTSTATUS winbindd_raw_kerberos_lo
 	const char *principal_s = NULL;
 	const char *service = NULL;
 	char *realm = NULL;
-	fstring name_domain, name_user;
+	fstring name_namespace, name_domain, name_user;
 	time_t ticket_lifetime = 0;
 	time_t renewal_until = 0;
 	ADS_STRUCT *ads;
@@ -658,6 +665,7 @@ static NTSTATUS winbindd_raw_kerberos_lo
 	const char *local_service;
 	uint32_t i;
 	struct netr_SamInfo6 *info6_copy = NULL;
+	bool ok;
 
 	*info6 = NULL;
 
@@ -693,7 +701,10 @@ static NTSTATUS winbindd_raw_kerberos_lo
 	/* 3rd step:
 	 * do kerberos auth and setup ccache as the user */
 
-	parse_domain_user(user, name_domain, name_user);
+	ok = parse_domain_user(user, name_namespace, name_domain, name_user);
+	if (!ok) {
+		return NT_STATUS_INVALID_PARAMETER;
+	}
 
 	realm = talloc_strdup(mem_ctx, domain->alt_name);
 	if (realm == NULL) {
@@ -975,7 +986,7 @@ static NTSTATUS winbindd_dual_pam_auth_c
 {
 	NTSTATUS result = NT_STATUS_LOGON_FAILURE;
 	uint16_t max_allowed_bad_attempts;
-	fstring name_domain, name_user;
+	fstring name_namespace, name_domain, name_user;
 	struct dom_sid sid;
 	enum lsa_SidType type;
 	uchar new_nt_pass[NT_HASH_LEN];
@@ -996,10 +1007,14 @@ static NTSTATUS winbindd_dual_pam_auth_c
 
 	/* Parse domain and username */
 
-	parse_domain_user(state->request->data.auth.user, name_domain, name_user);
+	parse_domain_user(state->request->data.auth.user,
+			  name_namespace,
+			  name_domain,
+			  name_user);
 
 
-	if (!lookup_cached_name(name_domain,
+	if (!lookup_cached_name(name_namespace,
+				name_domain,
 				name_user,
 				&sid,
 				&type)) {
@@ -1244,19 +1259,28 @@ static NTSTATUS winbindd_dual_pam_auth_k
 						struct netr_SamInfo6 **info6)
 {
 	struct winbindd_domain *contact_domain;
-	fstring name_domain, name_user;
+	fstring name_namespace, name_domain, name_user;
 	NTSTATUS result;
+	bool ok;
 
 	DEBUG(10,("winbindd_dual_pam_auth_kerberos\n"));
 
 	/* Parse domain and username */
 
-	parse_domain_user(state->request->data.auth.user, name_domain, name_user);
+	ok = parse_domain_user(state->request->data.auth.user,
+			       name_namespace,
+			       name_domain,
+			       name_user);
+	if (!ok) {
+		result = NT_STATUS_INVALID_PARAMETER;
+		goto done;
+	}
 
 	/* what domain should we contact? */
 
 	if ( IS_DC ) {
-		if (!(contact_domain = find_domain_from_name(name_domain))) {
+		contact_domain = find_domain_from_name(name_namespace);
+		if (contact_domain == NULL) {
 			DEBUG(3, ("Authentication for domain for [%s] -> [%s]\\[%s] failed as %s is not a trusted domain\n",
 				  state->request->data.auth.user, name_domain, name_user, name_domain));
 			result = NT_STATUS_NO_SUCH_USER;
@@ -1270,7 +1294,7 @@ static NTSTATUS winbindd_dual_pam_auth_k
 			goto done;
 		}
 
-		contact_domain = find_domain_from_name(name_domain);
+		contact_domain = find_domain_from_name(name_namespace);
 		if (contact_domain == NULL) {
 			DEBUG(3, ("Authentication for domain for [%s] -> [%s]\\[%s] failed as %s is not a trusted domain\n",
 				  state->request->data.auth.user, name_domain, name_user, name_domain));
@@ -1662,19 +1686,23 @@ static NTSTATUS winbindd_dual_pam_auth_s
 	DATA_BLOB lm_resp;
 	DATA_BLOB nt_resp;
 	unsigned char local_nt_response[24];
-	fstring name_domain, name_user;
+	fstring name_namespace, name_domain, name_user;
 	NTSTATUS result;
 	uint8_t authoritative = 0;
 	uint32_t flags = 0;
 	uint16_t validation_level;
 	union netr_Validation *validation = NULL;
 	struct netr_SamBaseInfo *base_info = NULL;
+	bool ok;
 
 	DEBUG(10,("winbindd_dual_pam_auth_samlogon\n"));
 
 	/* Parse domain and username */
 
-	parse_domain_user(user, name_domain, name_user);
+	ok = parse_domain_user(user, name_namespace, name_domain, name_user);
+	if (!ok) {
+		return NT_STATUS_INVALID_PARAMETER;
+	}
 
 	/*
 	 * We check against domain->name instead of
@@ -1869,12 +1897,13 @@ enum winbindd_result winbindd_dual_pam_a
 {
 	NTSTATUS result = NT_STATUS_LOGON_FAILURE;
 	NTSTATUS krb5_result = NT_STATUS_OK;
-	fstring name_domain, name_user;
+	fstring name_namespace, name_domain, name_user;
 	char *mapped_user;
 	fstring domain_user;
 	uint16_t validation_level = UINT16_MAX;
 	union netr_Validation *validation = NULL;
 	NTSTATUS name_map_status = NT_STATUS_UNSUCCESSFUL;
+	bool ok;
 
 	/* Ensure null termination */
 	state->request->data.auth.user[sizeof(state->request->data.auth.user)-1]='\0';
@@ -1900,7 +1929,14 @@ enum winbindd_result winbindd_dual_pam_a
 		mapped_user = state->request->data.auth.user;
 	}
 
-	parse_domain_user(mapped_user, name_domain, name_user);
+	ok = parse_domain_user(mapped_user,
+			       name_namespace,
+			       name_domain,
+			       name_user);
+	if (!ok) {
+		result = NT_STATUS_INVALID_PARAMETER;
+		goto process_result;
+	}
 
 	if ( mapped_user != state->request->data.auth.user ) {
 		fstr_sprintf( domain_user, "%s%c%s", name_domain,
@@ -2490,15 +2526,20 @@ enum winbindd_result winbindd_dual_pam_c
 	struct samr_DomInfo1 *info = NULL;
 	struct userPwdChangeFailureInformation *reject = NULL;
 	NTSTATUS result = NT_STATUS_UNSUCCESSFUL;
-	fstring domain, user;
+	fstring namespace, domain, user;
 	struct dcerpc_binding_handle *b = NULL;
+	bool ok;
 
 	ZERO_STRUCT(dom_pol);
 
 	DEBUG(3, ("[%5lu]: dual pam chauthtok %s\n", (unsigned long)state->pid,
 		  state->request->data.auth.user));
 
-	if (!parse_domain_user(state->request->data.chauthtok.user, domain, user)) {
+	ok = parse_domain_user(state->request->data.chauthtok.user,
+			       namespace,
+			       domain,
+			       user);
+	if (!ok) {
 		goto done;
 	}
 
@@ -2707,7 +2748,7 @@ enum winbindd_result winbindd_dual_pam_c
 	DATA_BLOB old_nt_hash_enc;
 	DATA_BLOB new_lm_password;
 	DATA_BLOB old_lm_hash_enc;
-	fstring  domain,user;
+	fstring  namespace, domain, user;
 	struct policy_handle dom_pol;
 	struct winbindd_domain *contact_domain = domainSt;
 	struct rpc_pipe_client *cli = NULL;
@@ -2720,8 +2761,9 @@ enum winbindd_result winbindd_dual_pam_c
 		sizeof(state->request->data.chng_pswd_auth_crap.user)-1]=0;
 	state->request->data.chng_pswd_auth_crap.domain[
 		sizeof(state->request->data.chng_pswd_auth_crap.domain)-1]=0;
-	*domain = 0;
-	*user = 0;
+	domain[0] = '\0';
+	namespace[0] = '\0';
+	user[0] = '\0';
 
 	DEBUG(3, ("[%5lu]: pam change pswd auth crap domain: %s user: %s\n",
 		  (unsigned long)state->pid,
@@ -2738,8 +2780,16 @@ enum winbindd_result winbindd_dual_pam_c
 	if (*state->request->data.chng_pswd_auth_crap.domain) {
 		fstrcpy(domain,state->request->data.chng_pswd_auth_crap.domain);
 	} else {
-		parse_domain_user(state->request->data.chng_pswd_auth_crap.user,
-				  domain, user);
+		bool ok;
+
+		ok = parse_domain_user(state->request->data.chng_pswd_auth_crap.user,
+				       namespace,
+				       domain,
+				       user);
+		if (!ok) {
+			result = NT_STATUS_INVALID_PARAMETER;
+			goto done;
+		}
 
 		if(!*domain) {
 			DEBUG(3,("no domain specified with username (%s) - "
diff -Npur samba-4.8.2/source3/winbindd/winbindd_pam_auth.c samba-4.8.3/source3/winbindd/winbindd_pam_auth.c
--- samba-4.8.2/source3/winbindd/winbindd_pam_auth.c	2018-01-17 09:08:39.000000000 +0100
+++ samba-4.8.3/source3/winbindd/winbindd_pam_auth.c	2018-06-26 16:42:46.000000000 +0200
@@ -36,9 +36,10 @@ struct tevent_req *winbindd_pam_auth_sen
 	struct tevent_req *req, *subreq;
 	struct winbindd_pam_auth_state *state;
 	struct winbindd_domain *domain;
-	fstring name_domain, name_user;
+	fstring name_namespace, name_domain, name_user;
 	char *mapped = NULL;
 	NTSTATUS status;
+	bool ok;
 
 	req = tevent_req_create(mem_ctx, &state,
 				struct winbindd_pam_auth_state);
@@ -71,12 +72,16 @@ struct tevent_req *winbindd_pam_auth_sen
 		fstrcpy(request->data.auth.user, mapped);
 	}
 
-	if (!canonicalize_username(request->data.auth.user, name_domain, name_user)) {
+	ok = canonicalize_username(request->data.auth.user,
+				   name_namespace,
+				   name_domain,
+				   name_user);
+	if (!ok) {
 		tevent_req_nterror(req, NT_STATUS_NO_SUCH_USER);
 		return tevent_req_post(req, ev);
 	}
 
-	domain = find_auth_domain(request->flags, name_domain);
+	domain = find_auth_domain(request->flags, name_namespace);
 	if (domain == NULL) {
 		tevent_req_nterror(req, NT_STATUS_NO_SUCH_USER);
 		return tevent_req_post(req, ev);
diff -Npur samba-4.8.2/source3/winbindd/winbindd_pam_chauthtok.c samba-4.8.3/source3/winbindd/winbindd_pam_chauthtok.c
--- samba-4.8.2/source3/winbindd/winbindd_pam_chauthtok.c	2018-01-17 09:08:39.000000000 +0100
+++ samba-4.8.3/source3/winbindd/winbindd_pam_chauthtok.c	2018-06-26 16:42:46.000000000 +0200
@@ -36,9 +36,10 @@ struct tevent_req *winbindd_pam_chauthto
 	struct tevent_req *req, *subreq;
 	struct winbindd_pam_chauthtok_state *state;
 	struct winbindd_domain *contact_domain;
-	fstring domain, user;
+	fstring namespace, domain, user;
 	char *mapped_user;
 	NTSTATUS status;
+	bool ok;
 
 	req = tevent_req_create(mem_ctx, &state,
 				struct winbindd_pam_chauthtok_state);
@@ -62,15 +63,18 @@ struct tevent_req *winbindd_pam_chauthto
 		fstrcpy(request->data.chauthtok.user, mapped_user);
 	}
 
-	if (!canonicalize_username(request->data.chauthtok.user, domain,
-				   user)) {
+	ok = canonicalize_username(request->data.chauthtok.user,
+				   namespace,
+				   domain,
+				   user);
+	if (!ok) {
 		DEBUG(10, ("winbindd_pam_chauthtok: canonicalize_username %s "
 			   "failed with\n", request->data.chauthtok.user));
 		tevent_req_nterror(req, NT_STATUS_NO_SUCH_USER);
 		return tevent_req_post(req, ev);
 	}
 
-	contact_domain = find_domain_from_name(domain);
+	contact_domain = find_domain_from_name(namespace);
 	if (contact_domain == NULL) {
 		DEBUG(3, ("Cannot change password for [%s] -> [%s]\\[%s] "
 			  "as %s is not a trusted domain\n",
diff -Npur samba-4.8.2/source3/winbindd/winbindd_pam_logoff.c samba-4.8.3/source3/winbindd/winbindd_pam_logoff.c
--- samba-4.8.2/source3/winbindd/winbindd_pam_logoff.c	2018-01-17 09:08:39.000000000 +0100
+++ samba-4.8.3/source3/winbindd/winbindd_pam_logoff.c	2018-06-26 16:42:46.000000000 +0200
@@ -35,10 +35,11 @@ struct tevent_req *winbindd_pam_logoff_s
 	struct tevent_req *req, *subreq;
 	struct winbindd_pam_logoff_state *state;
 	struct winbindd_domain *domain;
-	fstring name_domain, user;
+	fstring name_namespace, name_domain, user;
 	uid_t caller_uid;
 	gid_t caller_gid;
 	int res;
+	bool ok;
 
 	req = tevent_req_create(mem_ctx, &state,
 				struct winbindd_pam_logoff_state);
@@ -60,12 +61,15 @@ struct tevent_req *winbindd_pam_logoff_s
 		goto failed;
 	}
 
-	if (!canonicalize_username(request->data.logoff.user, name_domain,
-				   user)) {
+	ok = canonicalize_username(request->data.logoff.user,
+				   name_namespace,
+				   name_domain,
+				   user);
+	if (!ok) {
 		goto failed;
 	}
 
-	domain = find_auth_domain(request->flags, name_domain);
+	domain = find_auth_domain(request->flags, name_namespace);
 	if (domain == NULL) {
 		goto failed;
 	}
diff -Npur samba-4.8.2/source3/winbindd/winbindd_proto.h samba-4.8.3/source3/winbindd/winbindd_proto.h
--- samba-4.8.2/source3/winbindd/winbindd_proto.h	2018-04-26 09:21:03.000000000 +0200
+++ samba-4.8.3/source3/winbindd/winbindd_proto.h	2018-06-26 16:42:46.000000000 +0200
@@ -134,7 +134,8 @@ void close_winbindd_cache(void);
 bool lookup_cached_sid(TALLOC_CTX *mem_ctx, const struct dom_sid *sid,
 		       char **domain_name, char **name,
 		       enum lsa_SidType *type);
-bool lookup_cached_name(const char *domain_name,
+bool lookup_cached_name(const char *namespace,
+			const char *domain_name,
 			const char *name,
 			struct dom_sid *sid,
 			enum lsa_SidType *type);
@@ -476,11 +477,14 @@ struct winbindd_domain *find_our_domain(
 struct winbindd_domain *find_default_route_domain(void);
 struct winbindd_domain *find_lookup_domain_from_sid(const struct dom_sid *sid);
 struct winbindd_domain *find_lookup_domain_from_name(const char *domain_name);
-bool parse_domain_user(const char *domuser, fstring domain, fstring user);
-bool parse_domain_user_talloc(TALLOC_CTX *mem_ctx, const char *domuser,
-			      char **domain, char **user);
-bool canonicalize_username(fstring username_inout, fstring domain, fstring user);
-void fill_domain_username(fstring name, const char *domain, const char *user, bool can_assume);
+bool parse_domain_user(const char *domuser,
+		       fstring namespace,
+		       fstring domain,
+		       fstring user);
+bool canonicalize_username(fstring username_inout,
+			   fstring namespace,
+			   fstring domain,
+			   fstring user);
 char *fill_domain_username_talloc(TALLOC_CTX *ctx,
 				  const char *domain,
 				  const char *user,
@@ -568,7 +572,9 @@ NTSTATUS winbindd_lookupsids_recv(struct
 
 struct tevent_req *wb_lookupname_send(TALLOC_CTX *mem_ctx,
 				      struct tevent_context *ev,
-				      const char *dom_name, const char *name,
+				      const char *namespace,
+				      const char *dom_name,
+				      const char *name,
 				      uint32_t flags);
 NTSTATUS wb_lookupname_recv(struct tevent_req *req, struct dom_sid *sid,
 			    enum lsa_SidType *type);
diff -Npur samba-4.8.2/source3/winbindd/winbindd_util.c samba-4.8.3/source3/winbindd/winbindd_util.c
--- samba-4.8.2/source3/winbindd/winbindd_util.c	2018-03-01 21:18:10.000000000 +0100
+++ samba-4.8.3/source3/winbindd/winbindd_util.c	2018-06-26 16:42:46.000000000 +0200
@@ -1575,45 +1575,42 @@ static bool assume_domain(const char *do
 	return False;
 }
 
-/* Parse a string of the form DOMAIN\user into a domain and a user */
-
-bool parse_domain_user(const char *domuser, fstring domain, fstring user)
+/* Parse a DOMAIN\user or UPN string into a domain, namespace and a user */
+bool parse_domain_user(const char *domuser,
+		       fstring namespace,
+		       fstring domain,
+		       fstring user)
 {
-	char *p = strchr(domuser,*lp_winbind_separator());
+	char *p = NULL;
+
+	if (strlen(domuser) == 0) {
+		return false;
+	}
 
-	if ( !p ) {
+	p = strchr(domuser, *lp_winbind_separator());
+	if (p != NULL) {
+		fstrcpy(user, p + 1);
+		fstrcpy(domain, domuser);
+		domain[PTR_DIFF(p, domuser)] = '\0';
+		fstrcpy(namespace, domain);
+	} else {
 		fstrcpy(user, domuser);
-		p = strchr(domuser, '@');
 
-		if ( assume_domain(lp_workgroup()) && p == NULL) {
+		domain[0] = '\0';
+		namespace[0] = '\0';
+		p = strchr(domuser, '@');
+		if (p != NULL) {
+			/* upn */
+			fstrcpy(namespace, p + 1);
+		} else if (assume_domain(lp_workgroup())) {
 			fstrcpy(domain, lp_workgroup());
-		} else if (p != NULL) {
-			fstrcpy(domain, p + 1);
-			user[PTR_DIFF(p, domuser)] = 0;
-		} else {
-			return False;
+			fstrcpy(namespace, domain);
 		}
-	} else {
-		fstrcpy(user, p+1);
-		fstrcpy(domain, domuser);
-		domain[PTR_DIFF(p, domuser)] = 0;
 	}
 
 	return strupper_m(domain);
 }
 
-bool parse_domain_user_talloc(TALLOC_CTX *mem_ctx, const char *domuser,
-			      char **domain, char **user)
-{
-	fstring fstr_domain, fstr_user;
-	if (!parse_domain_user(domuser, fstr_domain, fstr_user)) {
-		return False;
-	}
-	*domain = talloc_strdup(mem_ctx, fstr_domain);
-	*user = talloc_strdup(mem_ctx, fstr_user);
-	return ((*domain != NULL) && (*user != NULL));
-}
-
 /* Ensure an incoming username from NSS is fully qualified. Replace the
    incoming fstring with DOMAIN <separator> user. Returns the same
    values as parse_domain_user() but also replaces the incoming username.
@@ -1623,9 +1620,15 @@ bool parse_domain_user_talloc(TALLOC_CTX
    really should be changed to use this instead of doing things
    by hand. JRA. */
 
-bool canonicalize_username(fstring username_inout, fstring domain, fstring user)
+bool canonicalize_username(fstring username_inout,
+			   fstring namespace,
+			   fstring domain,
+			   fstring user)
 {
-	if (!parse_domain_user(username_inout, domain, user)) {
+	bool ok;
+
+	ok = parse_domain_user(username_inout, namespace, domain, user);
+	if (!ok) {
 		return False;
 	}
 	slprintf(username_inout, sizeof(fstring) - 1, "%s%c%s",
@@ -1647,26 +1650,6 @@ bool canonicalize_username(fstring usern
 
     We always canonicalize as UPPERCASE DOMAIN, lowercase username.
 */
-void fill_domain_username(fstring name, const char *domain, const char *user, bool can_assume)
-{
-	fstring tmp_user;
-
-	if (lp_server_role() == ROLE_ACTIVE_DIRECTORY_DC) {
-		can_assume = false;
-	}
-
-	fstrcpy(tmp_user, user);
-	(void)strlower_m(tmp_user);
-
-	if (can_assume && assume_domain(domain)) {
-		strlcpy(name, tmp_user, sizeof(fstring));
-	} else {
-		slprintf(name, sizeof(fstring) - 1, "%s%c%s",
-			 domain, *lp_winbind_separator(),
-			 tmp_user);
-	}
-}
-
 /**
  * talloc version of fill_domain_username()
  * return NULL on talloc failure.
diff -Npur samba-4.8.2/source3/wscript samba-4.8.3/source3/wscript
--- samba-4.8.2/source3/wscript	2018-03-01 21:18:10.000000000 +0100
+++ samba-4.8.3/source3/wscript	2018-06-26 16:42:46.000000000 +0200
@@ -96,7 +96,7 @@ def configure(conf):
     # We crash without vfs_default
     required_static_modules.extend(TO_LIST('vfs_default'))
 
-    conf.CHECK_HEADERS('execinfo.h libexc.h libunwind.h netdb.h')
+    conf.CHECK_HEADERS('netdb.h')
     conf.CHECK_HEADERS('linux/falloc.h linux/ioctl.h')
 
     conf.CHECK_FUNCS('getcwd fchown chmod fchmod mknod')
diff -Npur samba-4.8.2/source4/dsdb/samdb/ldb_modules/samldb.c samba-4.8.3/source4/dsdb/samdb/ldb_modules/samldb.c
--- samba-4.8.2/source4/dsdb/samdb/ldb_modules/samldb.c	2018-04-26 09:21:03.000000000 +0200
+++ samba-4.8.3/source4/dsdb/samdb/ldb_modules/samldb.c	2018-06-26 16:42:46.000000000 +0200
@@ -345,7 +345,7 @@ static int samldb_generate_next_linkid(s
 static int samldb_schema_add_handle_linkid(struct samldb_ctx *ac)
 {
 	int ret;
-	bool ok, found;
+	bool ok, found = false;
 	struct ldb_message_element *el;
 	const char *enc_str;
 	const struct dsdb_attribute *attr;
diff -Npur samba-4.8.2/source4/heimdal/lib/com_err/compile_et.c samba-4.8.3/source4/heimdal/lib/com_err/compile_et.c
--- samba-4.8.2/source4/heimdal/lib/com_err/compile_et.c	2018-01-14 21:41:58.000000000 +0100
+++ samba-4.8.3/source4/heimdal/lib/com_err/compile_et.c	2018-06-26 16:42:46.000000000 +0200
@@ -60,8 +60,8 @@ extern int yydebug = 1;
 #endif
 
 char *filename;
-char hfn[128];
-char cfn[128];
+char hfn[130];
+char cfn[130];
 
 struct error_code *codes = NULL;
 
@@ -128,7 +128,7 @@ static int
 generate_h(void)
 {
     struct error_code *ec;
-    char fn[128];
+    char fn[134];
     FILE *h_file = fopen(hfn, "w");
     char *p;
 
diff -Npur samba-4.8.2/source4/heimdal/lib/krb5/config_file.c samba-4.8.3/source4/heimdal/lib/krb5/config_file.c
--- samba-4.8.2/source4/heimdal/lib/krb5/config_file.c	2018-01-14 21:41:58.000000000 +0100
+++ samba-4.8.3/source4/heimdal/lib/krb5/config_file.c	2018-06-26 16:42:46.000000000 +0200
@@ -370,11 +370,11 @@ krb5_config_parse_debug (struct fileptr
 	    b = NULL;
 	} else if (*p == '}') {
 	    *err_message = "unmatched }";
-	    return EINVAL;	/* XXX */
+	    return KRB5_CONFIG_BADFORMAT;
 	} else if(*p != '\0') {
 	    if (s == NULL) {
 		*err_message = "binding before section";
-		return EINVAL;
+		return KRB5_CONFIG_BADFORMAT;
 	    }
 	    ret = parse_binding(f, lineno, p, &b, &s->u.list, err_message);
 	    if (ret)
diff -Npur samba-4.8.2/source4/heimdal/lib/krb5/context.c samba-4.8.3/source4/heimdal/lib/krb5/context.c
--- samba-4.8.2/source4/heimdal/lib/krb5/context.c	2018-01-14 21:41:58.000000000 +0100
+++ samba-4.8.3/source4/heimdal/lib/krb5/context.c	2018-06-26 16:42:46.000000000 +0200
@@ -646,7 +646,8 @@ krb5_set_config_files(krb5_context conte
     krb5_config_binding *tmp = NULL;
     while(filenames != NULL && *filenames != NULL && **filenames != '\0') {
 	ret = krb5_config_parse_file_multi(context, *filenames, &tmp);
-	if(ret != 0 && ret != ENOENT && ret != EACCES && ret != EPERM) {
+	if (ret != 0 && ret != ENOENT && ret != EACCES && ret != EPERM
+	    && ret != KRB5_CONFIG_BADFORMAT) {
 	    krb5_config_file_free(context, tmp);
 	    return ret;
 	}
diff -Npur samba-4.8.2/source4/ntvfs/ipc/rap_server.c samba-4.8.3/source4/ntvfs/ipc/rap_server.c
--- samba-4.8.2/source4/ntvfs/ipc/rap_server.c	2018-01-14 21:41:58.000000000 +0100
+++ samba-4.8.3/source4/ntvfs/ipc/rap_server.c	2018-06-26 16:42:46.000000000 +0200
@@ -63,13 +63,18 @@ NTSTATUS rap_netshareenum(TALLOC_CTX *me
 				   union rap_share_info, r->out.available);
 
 	for (i = 0, j = 0; i < r->out.available; i++) {
+		size_t sname_len;
+
 		if (!NT_STATUS_IS_OK(share_get_config(mem_ctx, sctx, snames[i], &scfg))) {
 			DEBUG(3, ("WARNING: Service [%s] disappeared after enumeration!\n", snames[i]));
 			continue;
 		}
-		strncpy((char *)r->out.info[j].info1.share_name,
+		/* Make sure we have NUL-termination */
+		sname_len = MIN(strlen(snames[i]),
+				sizeof(r->out.info[j].info1.share_name));
+		strlcpy((char *)r->out.info[j].info1.share_name,
 			snames[i],
-			sizeof(r->out.info[0].info1.share_name));
+			sname_len);
 		r->out.info[i].info1.reserved1 = 0;
 		r->out.info[i].info1.share_type = dcesrv_common_get_share_type(mem_ctx, NULL, scfg);
 		r->out.info[i].info1.comment = share_string_option(mem_ctx, scfg, SHARE_COMMENT, "");
diff -Npur samba-4.8.2/source4/selftest/tests.py samba-4.8.3/source4/selftest/tests.py
--- samba-4.8.2/source4/selftest/tests.py	2018-03-01 21:18:10.000000000 +0100
+++ samba-4.8.3/source4/selftest/tests.py	2018-06-26 16:42:46.000000000 +0200
@@ -116,6 +116,13 @@ for env in ["ad_dc_ntvfs", "fl2008r2dc",
         '--option=clientldapsaslwrapping=plain',
         '--sign',
         '--encrypt',
+        '-k yes --option=clientldapsaslwrapping=plain',
+        '-k yes --sign',
+        '-k yes --encrypt',
+        '-k no --option=clientldapsaslwrapping=plain',
+        '-k no --sign --option=ntlmssp_client:ldap_style_send_seal=no',
+        '-k no --sign',
+        '-k no --encrypt',
     ]
 
     for auth_option in auth_options:
diff -Npur samba-4.8.2/source4/torture/basic/mangle_test.c samba-4.8.3/source4/torture/basic/mangle_test.c
--- samba-4.8.2/source4/torture/basic/mangle_test.c	2018-01-14 21:41:59.000000000 +0100
+++ samba-4.8.3/source4/torture/basic/mangle_test.c	2018-06-26 16:42:46.000000000 +0200
@@ -145,7 +145,7 @@ static char *gen_name(TALLOC_CTX *mem_ct
 
 	/* and a medium probability of a common lead string */
 	if ((len > 5) && (random() % 10 == 0)) {
-		strncpy(p, "ABCDE", 5);
+		strlcpy(p, "ABCDE", 6);
 	}
 
 	/* and a high probability of a good extension length */
diff -Npur samba-4.8.2/source4/torture/smb2/acls.c samba-4.8.3/source4/torture/smb2/acls.c
--- samba-4.8.2/source4/torture/smb2/acls.c	2018-01-14 21:41:59.000000000 +0100
+++ samba-4.8.3/source4/torture/smb2/acls.c	2018-06-26 16:42:46.000000000 +0200
@@ -1501,6 +1501,283 @@ done:
 }
 
 /*
+ * This is basically a copy of test_inheritance_flags() with an additional twist
+ * to change the owner of the testfile, verifying that the security descriptor
+ * flags are not altered.
+ */
+static bool test_sd_flags_vs_chown(struct torture_context *tctx,
+				   struct smb2_tree *tree)
+{
+	NTSTATUS status;
+	struct smb2_create io;
+	const char *dname = BASEDIR "\\inheritance";
+	const char *fname1 = BASEDIR "\\inheritance\\testfile";
+	bool ret = true;
+	struct smb2_handle handle = {{0}};
+	struct smb2_handle handle2 = {{0}};
+	int i, j;
+	union smb_fileinfo q;
+	union smb_setfileinfo set;
+	struct security_descriptor *sd, *sd2, *sd_orig=NULL;
+	struct security_descriptor *owner_sd = NULL;
+	const char *owner_sid_string = NULL;
+	struct dom_sid *owner_sid = NULL;
+	struct dom_sid world_sid = global_sid_World;
+	struct {
+		uint32_t parent_set_sd_type; /* 3 options */
+		uint32_t parent_set_ace_inherit; /* 1 option */
+		uint32_t parent_get_sd_type;
+		uint32_t parent_get_ace_inherit;
+		uint32_t child_get_sd_type;
+		uint32_t child_get_ace_inherit;
+	} tflags[16] = {{0}}; /* 2^4 */
+
+	owner_sd = security_descriptor_dacl_create(tctx,
+						   0,
+						   SID_WORLD,
+						   NULL,
+						   NULL);
+	torture_assert_not_null_goto(tctx, owner_sd, ret, done,
+				     "security_descriptor_dacl_create failed\n");
+
+	for (i = 0; i < 15; i++) {
+		torture_comment(tctx, "i=%d:", i);
+
+		if (i & 1) {
+			tflags[i].parent_set_sd_type |=
+			    SEC_DESC_DACL_AUTO_INHERITED;
+			torture_comment(tctx, "AUTO_INHERITED, ");
+		}
+		if (i & 2) {
+			tflags[i].parent_set_sd_type |=
+			    SEC_DESC_DACL_AUTO_INHERIT_REQ;
+			torture_comment(tctx, "AUTO_INHERIT_REQ, ");
+		}
+		if (i & 4) {
+			tflags[i].parent_set_sd_type |=
+			    SEC_DESC_DACL_PROTECTED;
+			torture_comment(tctx, "PROTECTED, ");
+			tflags[i].parent_get_sd_type |=
+			    SEC_DESC_DACL_PROTECTED;
+		}
+		if (i & 8) {
+			tflags[i].parent_set_ace_inherit |=
+			    SEC_ACE_FLAG_INHERITED_ACE;
+			torture_comment(tctx, "INHERITED, ");
+			tflags[i].parent_get_ace_inherit |=
+			    SEC_ACE_FLAG_INHERITED_ACE;
+		}
+
+		if ((tflags[i].parent_set_sd_type &
+		    (SEC_DESC_DACL_AUTO_INHERITED | SEC_DESC_DACL_AUTO_INHERIT_REQ)) ==
+		    (SEC_DESC_DACL_AUTO_INHERITED | SEC_DESC_DACL_AUTO_INHERIT_REQ)) {
+			tflags[i].parent_get_sd_type |=
+			    SEC_DESC_DACL_AUTO_INHERITED;
+			tflags[i].child_get_sd_type |=
+			    SEC_DESC_DACL_AUTO_INHERITED;
+			tflags[i].child_get_ace_inherit |=
+			    SEC_ACE_FLAG_INHERITED_ACE;
+			torture_comment(tctx, "  ... parent is AUTO INHERITED");
+		}
+
+		if (tflags[i].parent_set_ace_inherit &
+		    SEC_ACE_FLAG_INHERITED_ACE) {
+			tflags[i].parent_get_ace_inherit =
+			    SEC_ACE_FLAG_INHERITED_ACE;
+			torture_comment(tctx, "  ... parent ACE is INHERITED");
+		}
+
+		torture_comment(tctx, "\n");
+	}
+
+	if (!smb2_util_setup_dir(tctx, tree, BASEDIR))
+		return false;
+
+	torture_comment(tctx, "TESTING ACL INHERITANCE FLAGS\n");
+
+	ZERO_STRUCT(io);
+	io.level = RAW_OPEN_SMB2;
+	io.in.create_flags = 0;
+	io.in.desired_access = SEC_RIGHTS_FILE_ALL;
+	io.in.create_options = NTCREATEX_OPTIONS_DIRECTORY;
+	io.in.file_attributes = FILE_ATTRIBUTE_DIRECTORY;
+	io.in.share_access = NTCREATEX_SHARE_ACCESS_MASK;
+	io.in.alloc_size = 0;
+	io.in.create_disposition = NTCREATEX_DISP_CREATE;
+	io.in.impersonation_level = NTCREATEX_IMPERSONATION_ANONYMOUS;
+	io.in.security_flags = 0;
+	io.in.fname = dname;
+
+	torture_comment(tctx, "creating initial directory %s\n", dname);
+	status = smb2_create(tree, tctx, &io);
+	CHECK_STATUS(status, NT_STATUS_OK);
+	handle = io.out.file.handle;
+
+	torture_comment(tctx, "getting original sd\n");
+	q.query_secdesc.level = RAW_FILEINFO_SEC_DESC;
+	q.query_secdesc.in.file.handle = handle;
+	q.query_secdesc.in.secinfo_flags = SECINFO_DACL | SECINFO_OWNER;
+	status = smb2_getinfo_file(tree, tctx, &q);
+	CHECK_STATUS(status, NT_STATUS_OK);
+	sd_orig = q.query_secdesc.out.sd;
+
+	owner_sid = sd_orig->owner_sid;
+	owner_sid_string = dom_sid_string(tctx, sd_orig->owner_sid);
+	torture_comment(tctx, "owner_sid is %s\n", owner_sid_string);
+
+	for (i=0; i < ARRAY_SIZE(tflags); i++) {
+		torture_comment(tctx, "setting a new sd on directory, pass #%d\n", i);
+
+		sd = security_descriptor_dacl_create(tctx,
+						tflags[i].parent_set_sd_type,
+						NULL, NULL,
+						owner_sid_string,
+						SEC_ACE_TYPE_ACCESS_ALLOWED,
+						SEC_FILE_WRITE_DATA | SEC_STD_WRITE_DAC,
+						SEC_ACE_FLAG_OBJECT_INHERIT |
+						SEC_ACE_FLAG_CONTAINER_INHERIT |
+						tflags[i].parent_set_ace_inherit,
+						SID_WORLD,
+						SEC_ACE_TYPE_ACCESS_ALLOWED,
+						SEC_FILE_ALL | SEC_STD_ALL,
+						0,
+						NULL);
+		set.set_secdesc.level = RAW_SFILEINFO_SEC_DESC;
+		set.set_secdesc.in.file.handle = handle;
+		set.set_secdesc.in.secinfo_flags = SECINFO_DACL;
+		set.set_secdesc.in.sd = sd;
+		status = smb2_setinfo_file(tree, &set);
+		CHECK_STATUS(status, NT_STATUS_OK);
+
+		/*
+		 * Check DACL we just set, except change the bits to what they
+		 * should be.
+		 */
+		torture_comment(tctx, "  checking new sd\n");
+
+		/* REQ bit should always be false. */
+		sd->type &= ~SEC_DESC_DACL_AUTO_INHERIT_REQ;
+
+		if ((tflags[i].parent_get_sd_type & SEC_DESC_DACL_AUTO_INHERITED) == 0)
+			sd->type &= ~SEC_DESC_DACL_AUTO_INHERITED;
+
+		q.query_secdesc.in.file.handle = handle;
+		q.query_secdesc.in.secinfo_flags = SECINFO_DACL;
+		status = smb2_getinfo_file(tree, tctx, &q);
+		CHECK_STATUS(status, NT_STATUS_OK);
+		CHECK_SECURITY_DESCRIPTOR(q.query_secdesc.out.sd, sd);
+
+		/* Create file. */
+		torture_comment(tctx, "  creating file %s\n", fname1);
+		io.in.fname = fname1;
+		io.in.create_options = 0;
+		io.in.file_attributes = FILE_ATTRIBUTE_NORMAL;
+		io.in.desired_access = SEC_RIGHTS_FILE_ALL;
+		io.in.create_disposition = NTCREATEX_DISP_CREATE;
+		status = smb2_create(tree, tctx, &io);
+		CHECK_STATUS(status, NT_STATUS_OK);
+		handle2 = io.out.file.handle;
+		CHECK_ACCESS_FLAGS(handle2, SEC_RIGHTS_FILE_ALL);
+
+		q.query_secdesc.in.file.handle = handle2;
+		q.query_secdesc.in.secinfo_flags = SECINFO_DACL | SECINFO_OWNER;
+		status = smb2_getinfo_file(tree, tctx, &q);
+		CHECK_STATUS(status, NT_STATUS_OK);
+
+		torture_comment(tctx, "  checking sd on file %s\n", fname1);
+		sd2 = security_descriptor_dacl_create(tctx,
+						 tflags[i].child_get_sd_type,
+						 owner_sid_string, NULL,
+						 owner_sid_string,
+						 SEC_ACE_TYPE_ACCESS_ALLOWED,
+						 SEC_FILE_WRITE_DATA | SEC_STD_WRITE_DAC,
+						 tflags[i].child_get_ace_inherit,
+						 NULL);
+		CHECK_SECURITY_DESCRIPTOR(q.query_secdesc.out.sd, sd2);
+
+		/*
+		 * Set new sd on file ... prove that the bits have nothing to
+		 * do with the parents bits when manually setting an ACL. The
+		 * _AUTO_INHERITED bit comes directly from the ACL set.
+		 */
+		for (j = 0; j < ARRAY_SIZE(tflags); j++) {
+			torture_comment(tctx, "  setting new file sd, pass #%d\n", j);
+
+			/* Change sd type. */
+			sd2->type &= ~(SEC_DESC_DACL_AUTO_INHERITED |
+			    SEC_DESC_DACL_AUTO_INHERIT_REQ |
+			    SEC_DESC_DACL_PROTECTED);
+			sd2->type |= tflags[j].parent_set_sd_type;
+
+			sd2->dacl->aces[0].flags &=
+			    ~SEC_ACE_FLAG_INHERITED_ACE;
+			sd2->dacl->aces[0].flags |=
+			    tflags[j].parent_set_ace_inherit;
+
+			set.set_secdesc.level = RAW_SFILEINFO_SEC_DESC;
+			set.set_secdesc.in.file.handle = handle2;
+			set.set_secdesc.in.secinfo_flags = SECINFO_DACL;
+			set.set_secdesc.in.sd = sd2;
+			status = smb2_setinfo_file(tree, &set);
+			CHECK_STATUS(status, NT_STATUS_OK);
+
+			/* Check DACL we just set. */
+			sd2->type &= ~SEC_DESC_DACL_AUTO_INHERIT_REQ;
+			if ((tflags[j].parent_get_sd_type & SEC_DESC_DACL_AUTO_INHERITED) == 0)
+				sd2->type &= ~SEC_DESC_DACL_AUTO_INHERITED;
+
+			q.query_secdesc.in.file.handle = handle2;
+			q.query_secdesc.in.secinfo_flags = SECINFO_DACL | SECINFO_OWNER;
+			status = smb2_getinfo_file(tree, tctx, &q);
+			CHECK_STATUS(status, NT_STATUS_OK);
+
+			CHECK_SECURITY_DESCRIPTOR(q.query_secdesc.out.sd, sd2);
+
+			/*
+			 * Check that changing ownder doesn't affect SD flags.
+			 *
+			 * Do this by first changing ownder to world and then
+			 * back to the original ownder. Afterwards compare SD,
+			 * should be the same.
+			 */
+			owner_sd->owner_sid = &world_sid;
+			set.set_secdesc.level = RAW_SFILEINFO_SEC_DESC;
+			set.set_secdesc.in.file.handle = handle2;
+			set.set_secdesc.in.secinfo_flags = SECINFO_OWNER;
+			set.set_secdesc.in.sd = owner_sd;
+			status = smb2_setinfo_file(tree, &set);
+			CHECK_STATUS(status, NT_STATUS_OK);
+
+			owner_sd->owner_sid = owner_sid;
+			set.set_secdesc.level = RAW_SFILEINFO_SEC_DESC;
+			set.set_secdesc.in.file.handle = handle2;
+			set.set_secdesc.in.secinfo_flags = SECINFO_OWNER;
+			set.set_secdesc.in.sd = owner_sd;
+			status = smb2_setinfo_file(tree, &set);
+			CHECK_STATUS(status, NT_STATUS_OK);
+
+			q.query_secdesc.in.file.handle = handle2;
+			q.query_secdesc.in.secinfo_flags = SECINFO_DACL | SECINFO_OWNER;
+			status = smb2_getinfo_file(tree, tctx, &q);
+			CHECK_STATUS(status, NT_STATUS_OK);
+
+			CHECK_SECURITY_DESCRIPTOR(q.query_secdesc.out.sd, sd2);
+			torture_assert_goto(tctx, ret, ret, done, "CHECK_SECURITY_DESCRIPTOR failed\n");
+		}
+
+		smb2_util_close(tree, handle2);
+		smb2_util_unlink(tree, fname1);
+	}
+
+done:
+	smb2_util_close(tree, handle);
+	smb2_deltree(tree, BASEDIR);
+	smb2_tdis(tree);
+	smb2_logoff(tree->session);
+	return ret;
+}
+
+/*
   test dynamic acl inheritance
   Note: This test was copied from raw/acls.c.
 */
@@ -2098,6 +2375,7 @@ struct torture_suite *torture_smb2_acls_
 	torture_suite_add_1smb2_test(suite, "OWNER", test_owner_bits);
 	torture_suite_add_1smb2_test(suite, "INHERITANCE", test_inheritance);
 	torture_suite_add_1smb2_test(suite, "INHERITFLAGS", test_inheritance_flags);
+	torture_suite_add_1smb2_test(suite, "SDFLAGSVSCHOWN", test_sd_flags_vs_chown);
 	torture_suite_add_1smb2_test(suite, "DYNAMIC", test_inheritance_dynamic);
 #if 0
 	/* XXX This test does not work against XP or Vista. */
diff -Npur samba-4.8.2/source4/torture/smb2/session.c samba-4.8.3/source4/torture/smb2/session.c
--- samba-4.8.2/source4/torture/smb2/session.c	2018-01-17 09:08:39.000000000 +0100
+++ samba-4.8.3/source4/torture/smb2/session.c	2018-06-26 16:42:46.000000000 +0200
@@ -616,7 +616,7 @@ bool test_session_reauth5(struct torture
 {
 	NTSTATUS status;
 	TALLOC_CTX *mem_ctx = talloc_new(tctx);
-	char dname[256];
+	char dname[128];
 	char fname[256];
 	char fname2[256];
 	struct smb2_handle _dh1;
diff -Npur samba-4.8.2/wscript_configure_system_mitkrb5 samba-4.8.3/wscript_configure_system_mitkrb5
--- samba-4.8.2/wscript_configure_system_mitkrb5	2018-01-17 09:08:39.000000000 +0100
+++ samba-4.8.3/wscript_configure_system_mitkrb5	2018-06-26 16:42:46.000000000 +0200
@@ -80,6 +80,7 @@ conf.CHECK_HEADERS('com_err.h', lib='com
 conf.CHECK_HEADERS('kdb.h', lib='kdb5')
 
 conf.CHECK_HEADERS('krb5.h krb5/locate_plugin.h', lib='krb5')
+conf.CHECK_HEADERS('krb5.h krb5/localauth_plugin.h', lib='krb5')
 possible_gssapi_headers="gssapi.h gssapi/gssapi_generic.h gssapi/gssapi.h gssapi/gssapi_ext.h gssapi/gssapi_krb5.h gssapi/gssapi_oid.h"
 conf.CHECK_HEADERS(possible_gssapi_headers, lib='gssapi')
 
