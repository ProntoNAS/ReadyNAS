Backport of:

From 3c7a6dc6694d9b26400d2bd672e04d09ed8a4276 Mon Sep 17 00:00:00 2001
From: Tim Kientzle <kientzle@acm.org>
Date: Sun, 26 Jul 2015 17:09:22 -0700
Subject: [PATCH] Issue #582: reject sparse blocks with negative size or
 offset, detect overflow when tracking sparse blocks

---
 libarchive/archive_read_support_format_tar.c | 10 +++++++++-
 1 file changed, 9 insertions(+), 1 deletion(-)

Index: libarchive-3.1.2/libarchive/archive_read_support_format_tar.c
===================================================================
--- libarchive-3.1.2.orig/libarchive/archive_read_support_format_tar.c	2016-07-13 09:06:29.630619916 -0400
+++ libarchive-3.1.2/libarchive/archive_read_support_format_tar.c	2016-07-13 09:06:29.626619869 -0400
@@ -2075,6 +2075,10 @@
 	else
 		tar->sparse_list = p;
 	tar->sparse_last = p;
+	if (remaining < 0 || offset < 0) {
+		archive_set_error(&a->archive, ARCHIVE_ERRNO_MISC, "Malformed sparse map data");
+		return (ARCHIVE_FATAL);
+	}
 	p->offset = offset;
 	p->remaining = remaining;
 	return (ARCHIVE_OK);
