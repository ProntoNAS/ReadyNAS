From e8a2e4d2e6b450a239bb8f9d74239fa434bf7d35 Mon Sep 17 00:00:00 2001
From: Tim Kientzle <kientzle@acm.org>
Date: Sat, 7 Feb 2015 13:32:58 -0800
Subject: [PATCH] Issue 402: Failed to recognize empty dir name in lha/lzh file

When parsing a directory name, we checked for the name
length being zero, but not for the first byte being a
null byte.  Add a similar check for the file case.
---
 libarchive/archive_read_support_format_lha.c | 6 ++++--
 1 file changed, 4 insertions(+), 2 deletions(-)

Index: libarchive-3.1.2/libarchive/archive_read_support_format_lha.c
===================================================================
--- libarchive-3.1.2.orig/libarchive/archive_read_support_format_lha.c	2016-07-13 08:49:10.186229510 -0400
+++ libarchive-3.1.2/libarchive/archive_read_support_format_lha.c	2016-07-13 08:49:10.186229510 -0400
@@ -1230,13 +1230,15 @@
 				archive_string_empty(&lha->filename);
 				break;
 			}
+			if (extdheader[0] == '\0')
+				goto invalid;
 			archive_strncpy(&lha->filename,
 			    (const char *)extdheader, datasize);
 			break;
 		case EXT_DIRECTORY:
-			if (datasize == 0)
+			if (datasize == 0 || extdheader[0] == '\0')
 				/* no directory name data. exit this case. */
-				break;
+				goto invalid;
 
 			archive_strncpy(&lha->dirname,
 		  	    (const char *)extdheader, datasize);
