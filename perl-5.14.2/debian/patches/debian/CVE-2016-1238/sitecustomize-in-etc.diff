From 5c16571b16cd00c0007100934ceed2a0d4218ee9 Mon Sep 17 00:00:00 2001
From: Niko Tyni <ntyni@debian.org>
Date: Tue, 5 Jul 2016 15:47:40 +0200
Subject: Look for sitecustomize.pl in /etc/perl rather than sitelib on Debian
 systems

Debian uses this sitecustomize.pl as a transition mechanism for removing
the current working directory (".") from @INC by default while leaving
the local administrator a temporary means of re-adding it back.

This mechanism is expected to be removed after one Debian stable release.

Backported to 5.14 by Dominic Hargreaves

Patch-Name: debian/CVE-2016-1238/sitecustomize-in-etc.diff
---
 perl.c          | 5 +++++
 pod/perlrun.pod | 5 +++++
 2 files changed, 10 insertions(+)

diff --git a/perl.c b/perl.c
index bcf6450..63bb9b6 100644
--- a/perl.c
+++ b/perl.c
@@ -1995,7 +1995,12 @@ S_parse_body(pTHX_ char **env, XSINIT_t xsinit)
 	}
 #  else
 	/* SITELIB_EXP is a function call on Win32.  */
+    #ifdef DEBIAN
+    /* temporary transition mechanism for dropping "." from @INC */
+    const char *const sitelib = "/etc/perl";
+    #else
 	const char *const sitelib = SITELIB_EXP;
+    #endif
 	(void)Perl_av_create_and_unshift_one(aTHX_ &PL_preambleav,
 					     Perl_newSVpvf(aTHX_
 							   "BEGIN { do {local $!; -f '%s/sitecustomize.pl'} && do '%s/sitecustomize.pl' }", sitelib, sitelib));
diff --git a/pod/perlrun.pod b/pod/perlrun.pod
index d51342f..9630288 100644
--- a/pod/perlrun.pod
+++ b/pod/perlrun.pod
@@ -476,6 +476,11 @@ blocks will be likewise executed very late.
 To determine at runtime if this capability has been compiled in your
 perl, you can check the value of C<$Config{usesitecustomize}>.
 
+Note: on Debian based systems, the system perl currently uses
+C</etc/perl/sitecustomize.pl> rather than C<$Config{sitelib}/sitecustomize.pl>.
+This may change in the future and is only provided as a temporary transition
+mechanism for removing the current working directory from C<@INC>.
+
 =item B<-F>I<pattern>
 X<-F>
 
