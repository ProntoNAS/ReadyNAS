#!/usr/bin/make -f
# -*- makefile -*-

# Uncomment this to turn on verbose mode.
#export DH_VERBOSE=1

export AR = gcc-ar
export RANLIB = gcc-ranlib
export DEB_CFLAGS_MAINT_APPEND = -flto
export DEB_CXXFLAGS_MAINT_APPEND = -flto
export DEB_LDFLAGS_MAINT_APPEND = -flto

%:
	dh $@ --parallel --with autoreconf

override_dh_auto_configure:
	dh_auto_configure \
		-- \
		--disable-openconnect \
		--disable-openvpn \
		--with-systemdunitdir=/lib/systemd/system \
                --with-dns-backend=systemd-resolved \
		--enable-polkit \
		--disable-wispr \
		--disable-pacrunner \
		--disable-ofono \
		--disable-bluetooth \
		--disable-dundee

override_dh_install:
	find $(CURDIR) -name "*.la" -print -delete
	/bin/mkdir -p $(CURDIR)/debian/tmp/usr/bin
	/bin/bash ./libtool --mode=install /usr/bin/install -c client/connmanctl $(CURDIR)/debian/tmp/usr/bin
	dh_install --fail-missing

override_dh_installinit:
	dh_installinit --restart-after-upgrade

override_dh_auto_clean:
	rm -f debian/connman.init
	rm -f plugins/net.connman.policy
	dh_auto_clean

override_dh_strip:
	dh_strip --dbg-package=connman-dbg
