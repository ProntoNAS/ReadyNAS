Index: libxml2-2.9.1+dfsg1/xzlib.c
===================================================================
--- libxml2-2.9.1+dfsg1.orig/xzlib.c	2018-09-20 15:21:04.139211440 +0200
+++ libxml2-2.9.1+dfsg1/xzlib.c	2018-09-20 15:21:04.131211440 +0200
@@ -535,6 +535,10 @@
                          "internal error: inflate stream corrupt");
                 return -1;
             }
+            /*
+             * FIXME: Remapping a couple of error codes and falling through
+             * to the LZMA error handling looks fragile.
+             */
             if (ret == Z_MEM_ERROR)
                 ret = LZMA_MEM_ERROR;
             if (ret == Z_DATA_ERROR)
@@ -560,6 +564,11 @@
             xz_error(state, LZMA_PROG_ERROR, "compression error");
             return -1;
         }
+        if ((state->how != GZIP) &&
+            (ret != LZMA_OK) && (ret != LZMA_STREAM_END)) {
+            xz_error(state, ret, "lzma error");
+            return -1;
+        }
     } while (strm->avail_out && ret != LZMA_STREAM_END);
 
     /* update available output and crc check value */
