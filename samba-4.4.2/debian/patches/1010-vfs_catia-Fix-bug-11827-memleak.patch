From 5f291dd3d957f12696dcf29f8219c150cb19b123 Mon Sep 17 00:00:00 2001
From: Volker Lendecke <vl@samba.org>
Date: Sun, 10 Apr 2016 12:51:15 +0200
Subject: [PATCH 1010/1096] vfs_catia: Fix bug 11827, memleak
MIME-Version: 1.0
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: 8bit

add_srt should add the mappings to the linked list even if
mappings==NULL (the default)

Bug: https://bugzilla.samba.org/show_bug.cgi?id=11827
Signed-off-by: Volker Lendecke <vl@samba.org>
Reviewed-by: Ralph Boehme <slow@samba.org>

Autobuild-User(master): Ralph BÃ¶hme <slow@samba.org>
Autobuild-Date(master): Mon Apr 11 14:25:59 CEST 2016 on sn-devel-144

(cherry picked from commit 3e2af1568d150de1cb12fef40580f4880ac787ff)

Autobuild-User(v4-4-test): Karolin Seeger <kseeger@samba.org>
Autobuild-Date(v4-4-test): Mon Apr 18 16:33:23 CEST 2016 on sn-devel-144

(cherry picked from commit eb96e1519726df4b5d0d0182b4c78cb47805021b)
---
 source3/modules/vfs_catia.c | 6 +++---
 1 file changed, 3 insertions(+), 3 deletions(-)

diff --git a/source3/modules/vfs_catia.c b/source3/modules/vfs_catia.c
index c17ffa8..e270c0b 100644
--- a/source3/modules/vfs_catia.c
+++ b/source3/modules/vfs_catia.c
@@ -141,6 +141,9 @@ static struct share_mapping_entry *add_srt(int snum, const char **mappings)
 
 	ret->snum = snum;
 
+	ret->next = srt_head;
+	srt_head = ret;
+
 	if (mappings) {
 		ret->mappings = (struct char_mappings**) ((unsigned char*) ret +
 		    sizeof(struct share_mapping_entry));
@@ -176,9 +179,6 @@ static struct share_mapping_entry *add_srt(int snum, const char **mappings)
 		}
 	}
 
-	ret->next = srt_head;
-	srt_head = ret;
-
 	return ret;
 }
 
-- 
2.9.0

