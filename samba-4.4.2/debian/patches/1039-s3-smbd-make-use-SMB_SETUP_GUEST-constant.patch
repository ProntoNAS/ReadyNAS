From 25b53048e998cfa5f5d0ca9d85b7ad22957c48cc Mon Sep 17 00:00:00 2001
From: Stefan Metzmacher <metze@samba.org>
Date: Mon, 18 Apr 2016 17:36:56 +0200
Subject: [PATCH 1039/1096] s3:smbd: make use SMB_SETUP_GUEST constant
MIME-Version: 1.0
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: 8bit

BUG: https://bugzilla.samba.org/show_bug.cgi?id=11847

Signed-off-by: Stefan Metzmacher <metze@samba.org>
Reviewed-by: Andreas Schneider <asn@samba.org>
Reviewed-by: GÃ¼nther Deschner <gd@samba.org>
(cherry picked from commit 25ce97892ad3ce5028e4dbbbdd844ef6619ac396)
(cherry picked from commit 2a9cbef97d2e5803f1e67dbc2c5205db9eee2285)
---
 source3/smbd/sesssetup.c | 6 +++---
 1 file changed, 3 insertions(+), 3 deletions(-)

diff --git a/source3/smbd/sesssetup.c b/source3/smbd/sesssetup.c
index b7fdd00..88cbf97 100644
--- a/source3/smbd/sesssetup.c
+++ b/source3/smbd/sesssetup.c
@@ -294,7 +294,7 @@ static void reply_sesssetup_and_X_spnego(struct smb_request *req)
 		}
 
 		if (security_session_user_level(session_info, NULL) < SECURITY_USER) {
-			action = 1;
+			action |= SMB_SETUP_GUEST;
 		}
 
 		if (session_info->session_key.length > 0) {
@@ -420,7 +420,7 @@ static void reply_sesssetup_and_X_spnego(struct smb_request *req)
 		}
 
 		if (security_session_user_level(session_info, NULL) < SECURITY_USER) {
-			action = 1;
+			action |= SMB_SETUP_GUEST;
 		}
 
 		/*
@@ -949,7 +949,7 @@ void reply_sesssetup_and_X(struct smb_request *req)
 	}
 
 	if (security_session_user_level(session_info, NULL) < SECURITY_USER) {
-		action = 1;
+		action |= SMB_SETUP_GUEST;
 	}
 
 	/* register the name and uid as being validated, so further connections
-- 
2.9.0

