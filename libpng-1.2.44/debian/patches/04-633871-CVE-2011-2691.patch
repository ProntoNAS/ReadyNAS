From 9dad5e37aef295b4ef8dea39392b652deebc9261 Mon Sep 17 00:00:00 2001
From: Glenn Randers-Pehrson <glennrp at users.sourceforge.net>
Date: Fri, 3 Jun 2011 21:14:55 -0500
Subject: [PATCH] [master] Pass "" instead of '\0' to png_default_error() in
 png_err().

This mistake was introduced in libpng-1.2.20beta01.
---
 pngerror.c |    9 +++++++--

diff --git a/pngerror.c b/pngerror.c
index c196b11..9798fb7 100644
--- a/pngerror.c
+++ b/pngerror.c
@@ -87,12 +87,17 @@ png_error(png_structp png_ptr, png_const_charp error_message)
 void PNGAPI
 png_err(png_structp png_ptr)
 {
+   /* Prior to 1.4.8 the error_fn received a NULL pointer, expressed
+    * erroneously as '\0', instead of the empty string "".  This was
+    * apparently an error, introduced in libpng-1.2.20, and png_default_error
+    * will crash in this case.
+    */
    if (png_ptr != NULL && png_ptr->error_fn != NULL)
-      (*(png_ptr->error_fn))(png_ptr, '\0');
+      (*(png_ptr->error_fn))(png_ptr, "");
 
    /* If the custom handler doesn't exist, or if it returns,
       use the default handler, which will not return. */
-   png_default_error(png_ptr, '\0');
+   png_default_error(png_ptr, "");
 }
 #endif /* PNG_ERROR_TEXT_SUPPORTED */
 
-- 
1.7.5.4

