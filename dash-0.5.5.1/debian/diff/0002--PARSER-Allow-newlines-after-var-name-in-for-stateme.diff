From a348219cc2469658ba4a9c8fcb003074b2091635 Mon Sep 17 00:00:00 2001
From: Gerrit Pape <pape@smarden.org>
Date: Wed, 26 May 2010 10:54:01 +0000
Subject: [PATCH] [PARSER] Allow newlines after var name in for statements
MIME-Version: 1.0
Content-Type: text/plain; charset=utf-8
Content-Transfer-Encoding: 8bit

POSIX allows newlines before the "in" keyword in for statements
so we should too.

Thanks to Maximilian Bern√∂cker for reporting this.

Signed-off-by: Herbert Xu <herbert@gondor.apana.org.au>
(cherry picked from commit 22e8fb41be2bfd0e6757c80d6365af9080a3b4a1)

Conflicts:

	ChangeLog
---
 src/parser.c |    4 ++--
 1 files changed, 2 insertions(+), 2 deletions(-)

diff --git a/src/parser.c b/src/parser.c
index ab66f30..425c457 100644
--- a/src/parser.c
+++ b/src/parser.c
@@ -357,7 +357,7 @@ TRACE(("expecting DO got %s %s\n", tokname[got], got == TWORD ? wordtext : ""));
 		n1 = (union node *)stalloc(sizeof (struct nfor));
 		n1->type = NFOR;
 		n1->nfor.var = wordtext;
-		checkkwd = CHKKWD | CHKALIAS;
+		checkkwd = CHKNL | CHKKWD | CHKALIAS;
 		if (readtoken() == TIN) {
 			app = &ap;
 			while (readtoken() == TWORD) {
@@ -383,7 +383,7 @@ TRACE(("expecting DO got %s %s\n", tokname[got], got == TWORD ? wordtext : ""));
 			 * Newline or semicolon here is optional (but note
 			 * that the original Bourne shell only allowed NL).
 			 */
-			if (lasttoken != TNL && lasttoken != TSEMI)
+			if (lasttoken != TSEMI)
 				tokpushback++;
 		}
 		checkkwd = CHKNL | CHKKWD | CHKALIAS;
-- 
1.6.0.3

